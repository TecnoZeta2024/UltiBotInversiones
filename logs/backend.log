2025-06-05 08:19:25,962 - src.ultibot_backend.main - INFO - Middleware: Solicitud procesada: GET /api/v1/opportunities/real-trading-candidates - Status: 200
2025-06-05 08:42:30,696 - src.ultibot_backend.api.v1.endpoints.opportunities - INFO - Router de oportunidades inicializado: <fastapi.routing.APIRouter object at 0x000001FE13C9F570>
2025-06-05 08:42:30,843 - src.ultibot_backend.main - INFO - Logging configurado con RotatingFileHandler para escribir en logs/backend.log (max ~100KB).
2025-06-05 08:42:30,844 - src.ultibot_backend.main - INFO - Iniciando UltiBot Backend...
2025-06-05 08:42:30,844 - src.ultibot_backend.main - INFO - Inicializando servicios base...
2025-06-05 08:42:31,465 - src.ultibot_backend.adapters.persistence_service - INFO - Conexión a la base de datos Supabase (psycopg) establecida exitosamente usando DSN directo.
2025-06-05 08:42:31,643 - src.ultibot_backend.services.credential_service - INFO - CredentialService __init__ intentando obtener encryption_key de ENV: Presente
2025-06-05 08:42:31,643 - src.ultibot_backend.services.credential_service - INFO - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-05 08:42:31,643 - src.ultibot_backend.main - INFO - Inicializando servicios dependientes...
2025-06-05 08:42:31,643 - src.ultibot_backend.main - INFO - Inicializando servicios de trading...
2025-06-05 08:42:31,643 - src.ultibot_backend.services.order_execution_service - INFO - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-05 08:42:31,643 - src.ultibot_backend.services.unified_order_execution_service - INFO - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-05 08:42:31,643 - src.ultibot_backend.main - INFO - Inicializando servicios avanzados...
2025-06-05 08:42:31,643 - src.ultibot_backend.main - INFO - PerformanceService inicializado.
2025-06-05 08:42:31,840 - src.ultibot_backend.main - INFO - LLM Provider (ChatGoogleGenerativeAI) inicializado con GEMINI_API_KEY.
2025-06-05 08:42:31,840 - src.ultibot_backend.services.ai_orchestrator_service - INFO - AIOrchestrator initialized (using MOCK implementation for Gemini).
2025-06-05 08:42:31,840 - src.ultibot_backend.main - INFO - AIOrchestrator inicializado.
2025-06-05 08:42:31,840 - src.ultibot_backend.main - INFO - TradingReportService inicializado.
2025-06-05 08:42:31,840 - src.ultibot_backend.main - INFO - Todos los servicios principales inicializados.
2025-06-05 08:42:31,983 - src.ultibot_backend.main - INFO - Configuración de usuario cargada para 00000000-0000-0000-0000-000000000001.
2025-06-05 08:42:32,057 - src.ultibot_backend.main - INFO - No se encontraron credenciales de Telegram para 00000000-0000-0000-0000-000000000001.
2025-06-05 08:42:32,058 - src.ultibot_backend.main - INFO - Aplicación iniciada correctamente.
2025-06-05 08:42:32,320 - src.ultibot_backend.main - INFO - Middleware: Solicitud entrante: GET /health
2025-06-05 08:42:32,321 - src.ultibot_backend.main - INFO - Middleware: Solicitud procesada: GET /health - Status: 200
2025-06-05 08:42:35,488 - src.ultibot_backend.main - INFO - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-05 08:42:35,489 - src.ultibot_backend.main - INFO - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-05 08:42:36,392 - src.ultibot_backend.main - INFO - Middleware: Solicitud entrante: GET /api/v1/market/klines
2025-06-05 08:42:36,393 - src.ultibot_backend.main - INFO - Middleware: Solicitud entrante: GET /api/v1/portfolio/snapshot/00000000-0000-0000-0000-000000000001
2025-06-05 08:42:36,394 - src.ultibot_backend.main - INFO - Middleware: Solicitud procesada: GET /api/v1/portfolio/snapshot/00000000-0000-0000-0000-000000000001 - Status: 200
2025-06-05 08:42:36,571 - src.ultibot_backend.main - INFO - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-05 08:42:36,574 - src.ultibot_backend.api.v1.endpoints.reports - INFO - Calculando métricas de rendimiento de paper trading para usuario 00000000-0000-0000-0000-000000000001
2025-06-05 08:42:36,574 - src.ultibot_backend.api.v1.endpoints.reports - INFO - Filtros: symbol=None, start_date=2025-05-06 00:00:00, end_date=2025-06-05 23:59:59.999999
2025-06-05 08:42:36,586 - src.ultibot_backend.main - INFO - Middleware: Solicitud entrante: GET /api/v1/trades/00000000-0000-0000-0000-000000000001
2025-06-05 08:42:36,587 - src.ultibot_backend.main - INFO - Middleware: Solicitud procesada: GET /api/v1/trades/00000000-0000-0000-0000-000000000001 - Status: 200
2025-06-05 08:42:36,651 - src.ultibot_backend.adapters.persistence_service - INFO - Obtenidos 0 trades cerrados con filtros: {'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'positionStatus': 'closed'}
2025-06-05 08:42:36,651 - src.ultibot_backend.services.trading_report_service - INFO - Obtenidos 0 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-05 08:42:36,651 - src.ultibot_backend.api.v1.endpoints.reports - INFO - Métricas calculadas: 0 trades, Win Rate: 0.00%, P&L Total: 0.00
2025-06-05 08:42:36,652 - src.ultibot_backend.main - INFO - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-05 08:42:36,804 - src.ultibot_backend.main - INFO - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-05 08:42:36,804 - src.ultibot_backend.main - INFO - Middleware: Solicitud entrante: GET /api/v1/notifications/history
2025-06-05 08:42:36,805 - src.ultibot_backend.services.performance_service - INFO - Fetching performance data for user 00000000-0000-0000-0000-000000000001, mode_filter: None
2025-06-05 08:42:36,819 - src.ultibot_backend.main - INFO - Middleware: Solicitud entrante: GET /api/v1/gemini/opportunities
2025-06-05 08:42:36,819 - root - INFO - [TRACE] BACKEND: Solicitud GET a /gemini/opportunities recibida.
2025-06-05 08:42:36,819 - root - INFO - [TRACE] BACKEND: Generando nuevas oportunidades de IA (caché expirada o vacía).
2025-06-05 08:42:36,819 - src.ultibot_backend.services.ai_orchestrator_service - INFO - AIOrchestrator initialized (using MOCK implementation for Gemini).
2025-06-05 08:42:36,820 - root - INFO - Devolviendo oportunidades de IA: [{'id': 'demo-opp-1', 'symbol': 'BTC/USDT', 'side': 'BUY', 'entry_price': 30000.0, 'confidence_score': 0.75, 'strategy_id': 'DemoScalping', 'exchange': 'Binance (Demo)', 'timestamp_utc': '2025-06-05T12:42:36.820822+00:00', 'raw_suggested_action': 'buy', 'reasoning': 'Based on the scalping strategy parameters and the BTC/USDT opportunity, I detect a favorable short-term price movement pattern. The entry signal shows good momentum with acceptable risk parameters.', 'raw_analysis_id': 'mock-1'}]
2025-06-05 08:42:36,821 - src.ultibot_backend.main - INFO - Middleware: Solicitud procesada: GET /api/v1/gemini/opportunities - Status: 200
2025-06-05 08:42:36,877 - src.ultibot_backend.services.performance_service - INFO - No closed trades found for user 00000000-0000-0000-0000-000000000001 with mode_filter: None
2025-06-05 08:42:36,877 - src.ultibot_backend.main - INFO - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-05 08:42:36,920 - src.ultibot_backend.main - INFO - Middleware: Solicitud entrante: GET /api/v1/trades/00000000-0000-0000-0000-000000000001/open
2025-06-05 08:42:36,921 - src.ultibot_backend.main - INFO - Middleware: Solicitud procesada: GET /api/v1/trades/00000000-0000-0000-0000-000000000001/open - Status: 200
2025-06-05 08:42:36,948 - src.ultibot_backend.services.notification_service - INFO - Historial de notificaciones recuperado para el usuario 00000000-0000-0000-0000-000000000001.
2025-06-05 08:42:36,948 - src.ultibot_backend.main - INFO - Middleware: Solicitud procesada: GET /api/v1/notifications/history - Status: 200
2025-06-05 08:42:36,982 - httpx - INFO - HTTP Request: GET https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1h&limit=200 "HTTP/1.1 200 OK"
2025-06-05 08:42:36,983 - src.ultibot_backend.services.market_data_service - INFO - Datos de velas para BTCUSDT-1h obtenidos y procesados para el usuario 00000000-0000-0000-0000-000000000001.
2025-06-05 08:42:36,984 - src.ultibot_backend.main - INFO - Middleware: Solicitud procesada: GET /api/v1/market/klines - Status: 200
2025-06-05 08:47:25,955 - src.ultibot_backend.api.v1.endpoints.opportunities - INFO - Router de oportunidades inicializado: <fastapi.routing.APIRouter object at 0x00000203EAFFF570>
2025-06-05 08:47:26,105 - src.ultibot_backend.main - INFO - Logging configurado con RotatingFileHandler para escribir en logs/backend.log (max ~100KB).
2025-06-05 08:47:26,106 - src.ultibot_backend.main - INFO - Iniciando UltiBot Backend...
2025-06-05 08:47:26,106 - src.ultibot_backend.main - INFO - Inicializando servicios base...
2025-06-05 08:47:26,682 - src.ultibot_backend.adapters.persistence_service - INFO - Conexión a la base de datos Supabase (psycopg) establecida exitosamente usando DSN directo.
2025-06-05 08:47:26,867 - src.ultibot_backend.services.credential_service - INFO - CredentialService __init__ intentando obtener encryption_key de ENV: Presente
2025-06-05 08:47:26,867 - src.ultibot_backend.services.credential_service - INFO - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-05 08:47:26,867 - src.ultibot_backend.main - INFO - Inicializando servicios dependientes...
2025-06-05 08:47:26,867 - src.ultibot_backend.main - INFO - Inicializando servicios de trading...
2025-06-05 08:47:26,867 - src.ultibot_backend.services.order_execution_service - INFO - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-05 08:47:26,867 - src.ultibot_backend.services.unified_order_execution_service - INFO - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-05 08:47:26,868 - src.ultibot_backend.main - INFO - Inicializando servicios avanzados...
2025-06-05 08:47:26,868 - src.ultibot_backend.main - INFO - PerformanceService inicializado.
2025-06-05 08:47:27,071 - src.ultibot_backend.main - INFO - LLM Provider (ChatGoogleGenerativeAI) inicializado con GEMINI_API_KEY.
2025-06-05 08:47:27,071 - src.ultibot_backend.services.ai_orchestrator_service - INFO - AIOrchestrator initialized (using MOCK implementation for Gemini).
2025-06-05 08:47:27,071 - src.ultibot_backend.main - INFO - AIOrchestrator inicializado.
2025-06-05 08:47:27,071 - src.ultibot_backend.main - INFO - TradingReportService inicializado.
2025-06-05 08:47:27,071 - src.ultibot_backend.main - INFO - Todos los servicios principales inicializados.
2025-06-05 08:47:27,214 - src.ultibot_backend.main - INFO - Configuración de usuario cargada para 00000000-0000-0000-0000-000000000001.
2025-06-05 08:47:27,292 - src.ultibot_backend.main - INFO - No se encontraron credenciales de Telegram para 00000000-0000-0000-0000-000000000001.
2025-06-05 08:47:27,292 - src.ultibot_backend.main - INFO - Aplicación iniciada correctamente.
2025-06-05 08:47:27,449 - src.ultibot_backend.main - INFO - Middleware: Solicitud entrante: GET /health
2025-06-05 08:47:27,450 - src.ultibot_backend.main - INFO - Middleware: Solicitud procesada: GET /health - Status: 200
2025-06-05 08:47:31,073 - src.ultibot_backend.main - INFO - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-05 08:47:31,075 - src.ultibot_backend.main - INFO - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-05 08:47:32,042 - src.ultibot_backend.main - INFO - Middleware: Solicitud entrante: GET /api/v1/portfolio/snapshot/00000000-0000-0000-0000-000000000001
2025-06-05 08:47:32,043 - src.ultibot_backend.main - INFO - Middleware: Solicitud procesada: GET /api/v1/portfolio/snapshot/00000000-0000-0000-0000-000000000001 - Status: 200
2025-06-05 08:47:32,053 - src.ultibot_backend.main - INFO - Middleware: Solicitud entrante: GET /api/v1/market/klines
2025-06-05 08:47:32,256 - src.ultibot_backend.main - INFO - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-05 08:47:32,257 - src.ultibot_backend.main - INFO - Middleware: Solicitud entrante: GET /api/v1/trades/00000000-0000-0000-0000-000000000001
2025-06-05 08:47:32,257 - src.ultibot_backend.api.v1.endpoints.reports - INFO - Calculando métricas de rendimiento de paper trading para usuario 00000000-0000-0000-0000-000000000001
2025-06-05 08:47:32,258 - src.ultibot_backend.api.v1.endpoints.reports - INFO - Filtros: symbol=None, start_date=2025-05-06 00:00:00, end_date=2025-06-05 23:59:59.999999
2025-06-05 08:47:32,258 - src.ultibot_backend.main - INFO - Middleware: Solicitud procesada: GET /api/v1/trades/00000000-0000-0000-0000-000000000001 - Status: 200
2025-06-05 08:47:32,334 - src.ultibot_backend.adapters.persistence_service - INFO - Obtenidos 0 trades cerrados con filtros: {'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'positionStatus': 'closed'}
2025-06-05 08:47:32,334 - src.ultibot_backend.services.trading_report_service - INFO - Obtenidos 0 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-05 08:47:32,334 - src.ultibot_backend.api.v1.endpoints.reports - INFO - Métricas calculadas: 0 trades, Win Rate: 0.00%, P&L Total: 0.00
2025-06-05 08:47:32,335 - src.ultibot_backend.main - INFO - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-05 08:47:32,476 - src.ultibot_backend.main - INFO - Middleware: Solicitud entrante: GET /api/v1/notifications/history
2025-06-05 08:47:32,476 - src.ultibot_backend.main - INFO - Middleware: Solicitud entrante: GET /api/v1/gemini/opportunities
2025-06-05 08:47:32,476 - root - INFO - [TRACE] BACKEND: Solicitud GET a /gemini/opportunities recibida.
2025-06-05 08:47:32,477 - root - INFO - [TRACE] BACKEND: Generando nuevas oportunidades de IA (caché expirada o vacía).
2025-06-05 08:47:32,477 - src.ultibot_backend.services.ai_orchestrator_service - INFO - AIOrchestrator initialized (using MOCK implementation for Gemini).
2025-06-05 08:47:32,478 - root - INFO - Devolviendo oportunidades de IA: [{'id': 'demo-opp-1', 'symbol': 'BTC/USDT', 'side': 'BUY', 'entry_price': 30000.0, 'confidence_score': 0.75, 'strategy_id': 'DemoScalping', 'exchange': 'Binance (Demo)', 'timestamp_utc': '2025-06-05T12:47:32.477810+00:00', 'raw_suggested_action': 'buy', 'reasoning': 'Based on the scalping strategy parameters and the BTC/USDT opportunity, I detect a favorable short-term price movement pattern. The entry signal shows good momentum with acceptable risk parameters.', 'raw_analysis_id': 'mock-1'}]
2025-06-05 08:47:32,478 - src.ultibot_backend.main - INFO - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-05 08:47:32,479 - src.ultibot_backend.main - INFO - Middleware: Solicitud procesada: GET /api/v1/gemini/opportunities - Status: 200
2025-06-05 08:47:32,480 - src.ultibot_backend.services.performance_service - INFO - Fetching performance data for user 00000000-0000-0000-0000-000000000001, mode_filter: None
2025-06-05 08:47:32,554 - src.ultibot_backend.services.notification_service - INFO - Historial de notificaciones recuperado para el usuario 00000000-0000-0000-0000-000000000001.
2025-06-05 08:47:32,554 - src.ultibot_backend.main - INFO - Middleware: Solicitud procesada: GET /api/v1/notifications/history - Status: 200
2025-06-05 08:47:32,599 - src.ultibot_backend.main - INFO - Middleware: Solicitud entrante: GET /api/v1/trades/00000000-0000-0000-0000-000000000001/open
2025-06-05 08:47:32,600 - src.ultibot_backend.main - INFO - Middleware: Solicitud procesada: GET /api/v1/trades/00000000-0000-0000-0000-000000000001/open - Status: 200
2025-06-05 08:47:32,630 - src.ultibot_backend.services.performance_service - INFO - No closed trades found for user 00000000-0000-0000-0000-000000000001 with mode_filter: None
2025-06-05 08:47:32,630 - src.ultibot_backend.main - INFO - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-05 08:47:32,662 - httpx - INFO - HTTP Request: GET https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1h&limit=200 "HTTP/1.1 200 OK"
2025-06-05 08:47:32,664 - src.ultibot_backend.services.market_data_service - INFO - Datos de velas para BTCUSDT-1h obtenidos y procesados para el usuario 00000000-0000-0000-0000-000000000001.
2025-06-05 08:47:32,665 - src.ultibot_backend.main - INFO - Middleware: Solicitud procesada: GET /api/v1/market/klines - Status: 200
