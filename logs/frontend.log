2025-06-25 21:13:55,587 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-25 21:13:55,587 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-25 21:13:55,589 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-25 21:13:55,589 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-25 21:13:55,589 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-25 21:13:55,589 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-25 21:13:55,590 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 21:13:55,597 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/market/klines
2025-06-25 21:13:55,598 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 21:13:55,609 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 21:13:55,609 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 21:13:55,611 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Thu, 26 Jun 2025 01:13:55 GMT'), (b'server', b'uvicorn'), (b'content-length', b'1204'), (b'content-type', b'application/json')])
2025-06-25 21:13:55,611 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/config "HTTP/1.1 200 OK"
2025-06-25 21:13:55,611 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/config "HTTP/1.1 200 OK"
2025-06-25 21:13:55,612 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-25 21:13:55,612 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-25 21:13:55,613 - httpcore.http11 - DEBUG - response_closed.started
2025-06-25 21:13:55,613 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-25 21:13:55,613 - ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/config "HTTP/HTTP/1.1 200 OK"
2025-06-25 21:13:55,613 - ultibot_ui.services.api_client - DEBUG - Response content (processed): {'id': 'f4d1053d-1e49-4b3d-9333-f5040437568d', 'userId': '00000000-0000-0000-0000-000000000001', 'telegramChatId': None, 'notificationPreferences': [], 'enableTelegramNotifications': False, 'defaultPaperTradingCapital': '10000.00000000', 'paperTradingActive': True, 'paperTradingAssets': None, 'watchlists': [], 'favoritePairs': ['BTCUSDT', 'ETHUSDT', 'BNBUSDT'], 'riskProfile': 'moderate', 'riskProfileSettings': {'daily_capital_risk_percentage': 0.01, 'per_trade_capital_risk_percentage': 0.005, 'max_drawdown_percentage': 0.1}, 'realTradingSettings': {'real_trading_mode_active': False, 'real_trades_executed_count': 0, 'max_concurrent_operations': None, 'daily_loss_limit_absolute': None, 'daily_profit_target_absolute': None, 'asset_specific_stop_loss': None, 'auto_pause_trading_conditions': None, 'daily_capital_risked_usd': '0.0', 'last_daily_reset': '2025-06-25T23:02:27.070318Z'}, 'aiStrategyConfigurations': None, 'aiAnalysisConfidenceThresholds': {'paper_trading': 0.7, 'real_trading': 0.8}, 'mcpServerPreferences': [], 'selectedTheme': 'dark', 'dashboardLayoutProfiles': None, 'activeDashboardLayoutProfileId': None, 'dashboardLayoutConfig': None, 'cloudSyncPreferences': None, 'createdAt': '2025-06-25T23:02:27.075317', 'updatedAt': '2025-06-25T23:02:27.075317'}
2025-06-25 21:13:55,613 - ultibot_ui.windows.main_window - INFO - Configuration received and validated for user ID: 00000000-0000-0000-0000-000000000001. Updating UI.
2025-06-25 21:13:55,613 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 21:13:55,614 - ultibot_ui.windows.main_window - INFO - User configuration set for ID: 00000000-0000-0000-0000-000000000001
2025-06-25 21:13:55,614 - ultibot_ui.windows.dashboard_view - INFO - DashboardView: User ID set to 00000000-0000-0000-0000-000000000001. Initializing async components.
2025-06-25 21:13:55,614 - ultibot_ui.widgets.portfolio_widget - INFO - PortfolioWidget: User ID set to 00000000-0000-0000-0000-000000000001. Starting updates.
2025-06-25 21:13:55,614 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 21:13:55,614 - ultibot_ui.widgets.market_data_widget - INFO - Cargando configuración inicial para MarketDataWidget...
2025-06-25 21:13:55,614 - ultibot_ui.views.opportunities_view - INFO - OpportunitiesView: User ID set to 00000000-0000-0000-0000-000000000001. Loading initial data.
2025-06-25 21:13:55,614 - ultibot_ui.views.opportunities_view - INFO - OpportunitiesView: _load_initial_data called.
2025-06-25 21:13:55,614 - ultibot_ui.views.portfolio_view - INFO - PortfolioView: User ID set to 00000000-0000-0000-0000-000000000001. Triggering initial data fetch.
2025-06-25 21:13:55,614 - ultibot_ui.windows.history_view - INFO - HistoryView: User ID set to 00000000-0000-0000-0000-000000000001. Loading data.
2025-06-25 21:13:55,616 - ultibot_ui.widgets.paper_trading_report_widget - INFO - PaperTradingReportWidget: User ID set to 00000000-0000-0000-0000-000000000001. Loading data.
2025-06-25 21:13:55,616 - ultibot_ui.views.orders_view - INFO - OrdersView: User ID set to 00000000-0000-0000-0000-000000000001. Triggering order load.
2025-06-25 21:13:55,616 - ultibot_ui.views.orders_view - INFO - Creating asyncio task to fetch orders.
2025-06-25 21:13:55,616 - ultibot_ui.windows.settings_view - INFO - SettingsView: User ID set to 00000000-0000-0000-0000-000000000001. Loading initial data.
2025-06-25 21:13:55,616 - ultibot_ui.windows.settings_view - INFO - SettingsView: Iniciando carga de datos iniciales (_load_initial_data).
2025-06-25 21:13:55,616 - __main__ - INFO - Initial user configuration fetched and applied successfully.
2025-06-25 21:13:55,616 - __main__ - INFO - Initialization complete. Showing MainWindow.
2025-06-25 21:13:55,711 - ultibot_ui.windows.main_window - INFO - MainWindow: Post-show initialization started.
2025-06-25 21:13:55,712 - ultibot_ui.views.strategies_view - INFO - StrategiesView: Initializing view data (loading strategies)...
2025-06-25 21:13:55,712 - ultibot_ui.views.trading_terminal_view - INFO - TradingTerminalView: Initializing view data (starting price feed)...
2025-06-25 21:13:55,712 - ultibot_ui.views.trading_terminal_view - INFO - Price feed task created for BTC/USDT.
2025-06-25 21:13:55,712 - ultibot_ui.windows.dashboard_view - INFO - DashboardView: initialize_async_components INVOCADO
2025-06-25 21:13:55,712 - ultibot_ui.windows.main_window - INFO - MainWindow: Post-show initialization finished.
2025-06-25 21:13:55,713 - ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-25 21:13:55,713 - ultibot_ui.services.api_client - INFO - Obteniendo configuración de usuario.
2025-06-25 21:13:55,713 - ultibot_ui.services.api_client - DEBUG - APIClient httpx client ya está inicializado.
2025-06-25 21:13:55,713 - ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/config
2025-06-25 21:13:55,714 - httpcore.connection - DEBUG - close.started
2025-06-25 21:13:55,714 - ultibot_ui.widgets.paper_trading_report_widget - INFO - Cargando datos de trades con filtros: {'date_from': '2025-05-26', 'date_to': '2025-06-25', 'limit': 500, 'offset': 0}
2025-06-25 21:13:55,714 - ultibot_ui.widgets.paper_trading_report_widget - ERROR - Error al cargar los datos del informe de paper trading: UltiBotAPIClient.get_trades() got an unexpected keyword argument 'date_from'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\widgets\paper_trading_report_widget.py", line 212, in _load_data_async
    trades_data = await self.api_client.get_trades(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: UltiBotAPIClient.get_trades() got an unexpected keyword argument 'date_from'
2025-06-25 21:13:55,736 - ultibot_ui.views.portfolio_view - INFO - PortfolioView: Scheduling portfolio snapshot fetch.
2025-06-25 21:13:55,777 - ultibot_ui.views.opportunities_view - INFO - Fetching Gemini IA opportunities.
2025-06-25 21:13:56,298 - ultibot_backend.services.market_data_service - CRITICAL - [MainThread] - market_data_service.py:291 - Error inesperado al obtener datos de velas para BTCUSDT-1h: (sqlite3.OperationalError) table market_data has no column named open
[SQL: 
            INSERT INTO market_data ("id", "symbol", "timestamp", "open", "high", "low", "close", "volume", "created_at")
            VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
            ON CONFLICT ("symbol", "timestamp") DO UPDATE
            SET "id" = EXCLUDED."id", "open" = EXCLUDED."open", "high" = EXCLUDED."high", "low" = EXCLUDED."low", "close" = EXCLUDED."close", "volume" = EXCLUDED."volume", "created_at" = EXCLUDED."created_at";
        ]
[parameters: [(None, 'BTCUSDT', '2025-06-17T18:00:00Z', 103814.0, 104414.85, 103626.05, 104414.84, 582.53411, '2025-06-26T01:13:56.288297'), (None, 'BTCUSDT', '2025-06-17T19:00:00Z', 104414.84, 105336.82, 104414.83, 104686.12, 1030.66661, '2025-06-26T01:13:56.288297'), (None, 'BTCUSDT', '2025-06-17T20:00:00Z', 104686.12, 104898.81, 104262.88, 104362.39, 631.39909, '2025-06-26T01:13:56.288297'), (None, 'BTCUSDT', '2025-06-17T21:00:00Z', 104362.39, 104822.31, 104252.33, 104552.58, 424.96971, '2025-06-26T01:13:56.288297'), (None, 'BTCUSDT', '2025-06-17T22:00:00Z', 104552.59, 104731.61, 104203.85, 104228.31, 339.43238, '2025-06-26T01:13:56.288297'), (None, 'BTCUSDT', '2025-06-17T23:00:00Z', 104228.31, 104730.77, 104228.31, 104551.17, 310.84641, '2025-06-26T01:13:56.288297'), (None, 'BTCUSDT', '2025-06-18T00:00:00Z', 104551.17, 104857.14, 104379.52, 104842.78, 396.62544, '2025-06-26T01:13:56.288297'), (None, 'BTCUSDT', '2025-06-18T01:00:00Z', 104842.78, 105176.61, 104680.0, 104776.92, 347.92348, '2025-06-26T01:13:56.288297')  ... displaying 10 of 200 total bound parameter sets ...  (None, 'BTCUSDT', '2025-06-26T00:00:00Z', 107340.59, 107623.52, 107252.21, 107320.0, 388.09743, '2025-06-26T01:13:56.289818'), (None, 'BTCUSDT', '2025-06-26T01:00:00Z', 107320.0, 107320.0, 107200.0, 107202.73, 49.03257, '2025-06-26T01:13:56.289818')]]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1932, in _exec_single_context
    self.dialect.do_executemany(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 940, in do_executemany
    cursor.executemany(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 160, in executemany
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 154, in executemany
    self.await_(_cursor.executemany(operation, seq_of_parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 47, in executemany
    await self._execute(self._cursor.executemany, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.OperationalError: table market_data has no column named open

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 282, in get_candlestick_data
    await self._persistence_service.upsert_all(market_data_to_save)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 172, in upsert_all
    await session.execute(text(query), data_list)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2260, in _execute_internal
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1932, in _exec_single_context
    self.dialect.do_executemany(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 940, in do_executemany
    cursor.executemany(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 160, in executemany
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 154, in executemany
    self.await_(_cursor.executemany(operation, seq_of_parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 47, in executemany
    await self._execute(self._cursor.executemany, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) table market_data has no column named open
[SQL: 
            INSERT INTO market_data ("id", "symbol", "timestamp", "open", "high", "low", "close", "volume", "created_at")
            VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
            ON CONFLICT ("symbol", "timestamp") DO UPDATE
            SET "id" = EXCLUDED."id", "open" = EXCLUDED."open", "high" = EXCLUDED."high", "low" = EXCLUDED."low", "close" = EXCLUDED."close", "volume" = EXCLUDED."volume", "created_at" = EXCLUDED."created_at";
        ]
[parameters: [(None, 'BTCUSDT', '2025-06-17T18:00:00Z', 103814.0, 104414.85, 103626.05, 104414.84, 582.53411, '2025-06-26T01:13:56.288297'), (None, 'BTCUSDT', '2025-06-17T19:00:00Z', 104414.84, 105336.82, 104414.83, 104686.12, 1030.66661, '2025-06-26T01:13:56.288297'), (None, 'BTCUSDT', '2025-06-17T20:00:00Z', 104686.12, 104898.81, 104262.88, 104362.39, 631.39909, '2025-06-26T01:13:56.288297'), (None, 'BTCUSDT', '2025-06-17T21:00:00Z', 104362.39, 104822.31, 104252.33, 104552.58, 424.96971, '2025-06-26T01:13:56.288297'), (None, 'BTCUSDT', '2025-06-17T22:00:00Z', 104552.59, 104731.61, 104203.85, 104228.31, 339.43238, '2025-06-26T01:13:56.288297'), (None, 'BTCUSDT', '2025-06-17T23:00:00Z', 104228.31, 104730.77, 104228.31, 104551.17, 310.84641, '2025-06-26T01:13:56.288297'), (None, 'BTCUSDT', '2025-06-18T00:00:00Z', 104551.17, 104857.14, 104379.52, 104842.78, 396.62544, '2025-06-26T01:13:56.288297'), (None, 'BTCUSDT', '2025-06-18T01:00:00Z', 104842.78, 105176.61, 104680.0, 104776.92, 347.92348, '2025-06-26T01:13:56.288297')  ... displaying 10 of 200 total bound parameter sets ...  (None, 'BTCUSDT', '2025-06-26T00:00:00Z', 107340.59, 107623.52, 107252.21, 107320.0, 388.09743, '2025-06-26T01:13:56.289818'), (None, 'BTCUSDT', '2025-06-26T01:00:00Z', 107320.0, 107320.0, 107200.0, 107202.73, 49.03257, '2025-06-26T01:13:56.289818')]]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-06-25 21:13:56,426 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/market/klines - Status: 500
2025-06-25 21:13:56,540 - ultibot_backend - INFO - [MainThread] - main.py:104 - Apagando UltiBot Backend (lifespan)...
2025-06-25 21:13:56,541 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:189 - Shutting down dependency container...
2025-06-25 21:13:56,543 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:40 - Redis client closed.
2025-06-25 21:13:56,545 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:196 - Dependency container shut down.
2025-06-25 21:13:56,545 - ultibot_backend - INFO - [MainThread] - main.py:107 - Recursos liberados y aplicación apagada (lifespan).
2025-06-25 21:14:01,225 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 21:14:01,226 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 21:14:01,245 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 21:14:01,246 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 21:14:01,247 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 21:14:01,248 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 21:14:01,248 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 21:14:01,249 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 21:14:01,249 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 21:14:01,288 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 21:14:01,465 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 21:14:01,466 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 21:14:01,647 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 21:14:01,649 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 21:14:01,650 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 21:14:01,650 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 21:14:01,663 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 21:14:01,664 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000027B93A90650>
2025-06-25 21:14:01,664 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 21:14:01,664 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 21:14:01,664 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 21:14:03,886 - ultibot_ui.widgets.paper_trading_report_widget - ERROR - Error mostrado al usuario: Error cargando datos: UltiBotAPIClient.get_trades() got an unexpected keyword argument 'date_from'
2025-06-25 21:14:03,886 - ultibot_ui.widgets.paper_trading_report_widget - INFO - Cargando datos de trades con filtros: {'date_from': '2025-05-26', 'date_to': '2025-06-25', 'limit': 500, 'offset': 0}
2025-06-25 21:14:03,887 - ultibot_ui.widgets.paper_trading_report_widget - ERROR - Error al cargar los datos del informe de paper trading: UltiBotAPIClient.get_trades() got an unexpected keyword argument 'date_from'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\widgets\paper_trading_report_widget.py", line 212, in _load_data_async
    trades_data = await self.api_client.get_trades(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: UltiBotAPIClient.get_trades() got an unexpected keyword argument 'date_from'
2025-06-25 21:14:05,013 - ultibot_ui.widgets.paper_trading_report_widget - ERROR - Error mostrado al usuario: Error cargando datos: UltiBotAPIClient.get_trades() got an unexpected keyword argument 'date_from'
2025-06-25 21:14:05,013 - ultibot_ui.workers - INFO - Fetching order history from API...
2025-06-25 21:14:05,013 - ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open', 'user_id': '00000000-0000-0000-0000-000000000001'}
2025-06-25 21:14:05,014 - ultibot_ui.services.api_client - DEBUG - APIClient httpx client ya está inicializado.
2025-06-25 21:14:05,014 - ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-25 21:14:05,014 - ultibot_ui.windows.settings_view - INFO - SettingsView: Solicitando configuración de usuario general.
2025-06-25 21:14:05,014 - ultibot_ui.workers - INFO - Fetching user configuration from API...
2025-06-25 21:14:05,014 - ultibot_ui.services.api_client - INFO - Obteniendo configuración de usuario.
2025-06-25 21:14:05,014 - ultibot_ui.services.api_client - DEBUG - APIClient httpx client ya está inicializado.
2025-06-25 21:14:05,014 - ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/config
2025-06-25 21:14:05,016 - ultibot_ui.windows.settings_view - INFO - SettingsView: Solicitando configuración de usuario para estado de operativa real.
2025-06-25 21:14:05,016 - ultibot_ui.workers - INFO - Fetching user configuration from API...
2025-06-25 21:14:05,016 - ultibot_ui.services.api_client - INFO - Obteniendo configuración de usuario.
2025-06-25 21:14:05,016 - ultibot_ui.services.api_client - DEBUG - APIClient httpx client ya está inicializado.
2025-06-25 21:14:05,016 - ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/config
2025-06-25 21:14:05,017 - ultibot_ui.services.api_client - INFO - Obteniendo estrategias de trading.
2025-06-25 21:14:05,017 - ultibot_ui.services.api_client - DEBUG - APIClient httpx client ya está inicializado.
2025-06-25 21:14:05,017 - ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/strategies
2025-06-25 21:14:05,017 - ultibot_ui.workers - INFO - Starting real-time price feed for BTC/USDT...
2025-06-25 21:14:05,018 - ultibot_ui.services.api_client - INFO - Obteniendo datos de mercado para símbolos: ['BTC/USDT']
2025-06-25 21:14:05,018 - ultibot_ui.services.api_client - DEBUG - APIClient httpx client ya está inicializado.
2025-06-25 21:14:05,018 - ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/market/tickers
2025-06-25 21:14:05,018 - ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: both, filtros: {'trading_mode': 'both', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-25 21:14:05,019 - ultibot_ui.services.api_client - DEBUG - APIClient httpx client ya está inicializado.
2025-06-25 21:14:05,019 - ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-25 21:14:05,019 - httpcore.connection - DEBUG - close.failed exception=CancelledError()
2025-06-25 21:14:05,020 - ultibot_ui.workers - INFO - Price feed for BTC/USDT was cancelled.
2025-06-25 21:14:05,020 - httpcore.http11 - DEBUG - receive_response_headers.failed exception=CancelledError()
2025-06-25 21:14:05,020 - httpcore.http11 - DEBUG - response_closed.started
2025-06-25 21:14:05,021 - httpcore.http11 - DEBUG - receive_response_headers.failed exception=CancelledError()
2025-06-25 21:14:05,021 - httpcore.http11 - DEBUG - response_closed.started
2025-06-25 21:14:05,021 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-25 21:14:05,021 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-25 21:14:05,022 - __main__ - INFO - Starting application event loop.
2025-06-25 21:14:07,404 - ultibot_ui.windows.main_window - INFO - Cambiando a la vista: dashboard
2025-06-25 21:14:07,950 - ultibot_ui.windows.main_window - INFO - Cambiando a la vista: terminal
2025-06-25 21:14:08,621 - ultibot_ui.windows.main_window - INFO - Cambiando a la vista: opportunities
2025-06-25 21:14:09,217 - ultibot_ui.windows.main_window - INFO - Cambiando a la vista: portfolio
2025-06-25 21:14:09,696 - ultibot_ui.windows.main_window - INFO - Cambiando a la vista: strategies
2025-06-25 21:14:10,151 - ultibot_ui.windows.main_window - INFO - Cambiando a la vista: history
2025-06-25 21:14:10,671 - ultibot_ui.windows.main_window - INFO - Cambiando a la vista: settings
2025-06-25 21:14:17,175 - ultibot_ui.windows.main_window - INFO - Cambiando a la vista: terminal
2025-06-25 21:14:17,724 - ultibot_ui.windows.main_window - INFO - Cambiando a la vista: dashboard
2025-06-25 21:14:19,726 - ultibot_ui.windows.main_window - INFO - Cambiando a la vista: opportunities
2025-06-25 21:14:22,731 - ultibot_ui.windows.main_window - INFO - Cleaning up MainWindow resources. Stopping 0 active threads...
2025-06-25 21:14:22,732 - ultibot_ui.windows.dashboard_view - INFO - DashboardView: Iniciando limpieza de tareas.
2025-06-25 21:14:22,732 - ultibot_ui.widgets.portfolio_widget - INFO - PortfolioWidget: Iniciando limpieza.
2025-06-25 21:14:22,732 - ultibot_ui.widgets.portfolio_widget - INFO - PortfolioWidget: Limpieza completada.
2025-06-25 21:14:22,732 - ultibot_ui.widgets.chart_widget - INFO - ChartWidget: Limpieza completada.
2025-06-25 21:14:22,732 - ultibot_ui.windows.dashboard_view - INFO - DashboardView: Limpieza completada.
2025-06-25 21:14:22,733 - ultibot_ui.views.opportunities_view - INFO - Cleaning up OpportunitiesView...
2025-06-25 21:14:22,733 - ultibot_ui.views.opportunities_view - INFO - OpportunitiesView cleanup finished.
2025-06-25 21:14:22,733 - ultibot_ui.views.portfolio_view - INFO - PortfolioView: Cleaning up...
2025-06-25 21:14:22,733 - ultibot_ui.views.portfolio_view - INFO - PortfolioView: Cleanup finished.
2025-06-25 21:14:22,733 - ultibot_ui.widgets.paper_trading_report_widget - INFO - PaperTradingReportWidget cleanup: No hay acciones que tomar.
2025-06-25 21:14:22,734 - ultibot_ui.windows.history_view - INFO - HistoryView cleanup completado
2025-06-25 21:14:22,734 - ultibot_ui.windows.settings_view - INFO - SettingsView: Cleanup called.
2025-06-25 21:14:22,734 - ultibot_ui.views.trading_terminal_view - INFO - TradingTerminalView: Cleanup initiated.
2025-06-25 21:14:22,734 - ultibot_ui.views.trading_terminal_view - INFO - TradingTerminalView: Cleanup finished.
2025-06-25 21:14:22,734 - ultibot_ui.windows.main_window - INFO - MainWindow cleanup finished.
2025-06-25 21:14:22,753 - __main__ - INFO - Cleanup process started...
2025-06-25 21:14:22,754 - ultibot_ui.windows.main_window - INFO - Cleaning up MainWindow resources. Stopping 0 active threads...
2025-06-25 21:14:22,754 - ultibot_ui.windows.dashboard_view - INFO - DashboardView: Iniciando limpieza de tareas.
2025-06-25 21:14:22,754 - ultibot_ui.widgets.portfolio_widget - INFO - PortfolioWidget: Iniciando limpieza.
2025-06-25 21:14:22,755 - ultibot_ui.widgets.portfolio_widget - INFO - PortfolioWidget: Limpieza completada.
2025-06-25 21:14:22,755 - ultibot_ui.widgets.chart_widget - INFO - ChartWidget: Limpieza completada.
2025-06-25 21:14:22,755 - ultibot_ui.windows.dashboard_view - INFO - DashboardView: Limpieza completada.
2025-06-25 21:14:22,756 - ultibot_ui.views.opportunities_view - INFO - Cleaning up OpportunitiesView...
2025-06-25 21:14:22,756 - ultibot_ui.views.opportunities_view - INFO - OpportunitiesView cleanup finished.
2025-06-25 21:14:22,756 - ultibot_ui.views.portfolio_view - INFO - PortfolioView: Cleaning up...
2025-06-25 21:14:22,757 - ultibot_ui.views.portfolio_view - INFO - PortfolioView: Cleanup finished.
2025-06-25 21:14:22,757 - ultibot_ui.widgets.paper_trading_report_widget - INFO - PaperTradingReportWidget cleanup: No hay acciones que tomar.
2025-06-25 21:14:22,758 - ultibot_ui.windows.history_view - INFO - HistoryView cleanup completado
2025-06-25 21:14:22,758 - ultibot_ui.windows.settings_view - INFO - SettingsView: Cleanup called.
2025-06-25 21:14:22,758 - ultibot_ui.views.trading_terminal_view - INFO - TradingTerminalView: Cleanup initiated.
2025-06-25 21:14:22,759 - ultibot_ui.views.trading_terminal_view - INFO - TradingTerminalView: Cleanup finished.
2025-06-25 21:14:22,760 - ultibot_ui.windows.main_window - INFO - MainWindow cleanup finished.
2025-06-25 21:14:22,760 - __main__ - INFO - Scheduling API client cleanup task.
2025-06-25 21:14:27,766 - __main__ - ERROR - Error during API client cleanup: 
2025-06-25 21:14:27,766 - __main__ - INFO - Application cleanup finished.
2025-06-25 21:14:27,766 - __main__ - INFO - Application event loop has stopped.
2025-06-25 21:14:27,883 - qasync._windows._IocpProactor - DEBUG - Closing
2025-06-25 21:14:27,884 - qasync._windows._IocpProactor - DEBUG - Closing
2025-06-25 21:19:14,957 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-25 21:19:14,958 - __main__ - INFO - Starting asynchronous initialization...
2025-06-25 21:19:14,959 - asyncio - DEBUG - Using proactor: _IocpProactor
2025-06-25 21:19:14,959 - __main__ - INFO - QEventLoop initialized and set.
2025-06-25 21:19:14,960 - __main__ - INFO - Stylesheet loaded successfully.
2025-06-25 21:19:14,960 - __main__ - INFO - Initializing API client...
2025-06-25 21:19:14,960 - ultibot_ui.services.api_client - DEBUG - APIClient singleton: base URL establecida en http://127.0.0.1:8000
2025-06-25 21:19:15,143 - ultibot_ui.services.api_client - DEBUG - APIClient httpx client inicializado con base URL: http://127.0.0.1:8000
2025-06-25 21:19:15,143 - __main__ - INFO - API client initialized.
2025-06-25 21:19:15,143 - __main__ - INFO - Creating MainWindow...
2025-06-25 21:19:15,164 - ultibot_ui.services.trading_mode_state - INFO - TradingModeStateManager initialized with mode: paper
2025-06-25 21:19:15,164 - ultibot_ui.services.trading_mode_state - INFO - Created global trading mode state manager
2025-06-25 21:19:15,434 - ultibot_ui.widgets.portfolio_widget - INFO - Timer de actualización del portafolio iniciado.
2025-06-25 21:19:15,436 - ultibot_ui.widgets.chart_widget - INFO - Solicitando datos para BTCUSDT - 1h
2025-06-25 21:19:15,461 - ultibot_ui.widgets.market_data_widget - INFO - Cargando configuración inicial para MarketDataWidget...
2025-06-25 21:19:15,462 - ultibot_ui.views.opportunities_view - INFO - OpportunitiesView: __init__ called.
2025-06-25 21:19:15,462 - ultibot_ui.views.opportunities_view - DEBUG - OpportunitiesView initialized.
2025-06-25 21:19:15,491 - ultibot_ui.windows.history_view - INFO - HistoryView inicializada.
2025-06-25 21:19:15,499 - ultibot_ui.views.orders_view - INFO - OrdersView initialized.
2025-06-25 21:19:15,507 - ultibot_ui.views.trading_terminal_view - INFO - Price chart initialized for TradingTerminalView.
2025-06-25 21:19:15,508 - ultibot_ui.views.trading_terminal_view - INFO - TradingTerminalView initialized.
2025-06-25 21:19:15,509 - ultibot_ui.windows.main_window - INFO - Central widget y vistas configuradas.
2025-06-25 21:19:15,527 - ultibot_ui.windows.main_window - INFO - MainWindow inicializada y visible.
2025-06-25 21:19:15,528 - __main__ - INFO - MainWindow created.
2025-06-25 21:19:15,528 - __main__ - INFO - Fetching initial user configuration...
2025-06-25 21:19:15,528 - ultibot_ui.windows.main_window - INFO - Fetching initial user configuration directly...
2025-06-25 21:19:15,529 - ultibot_ui.services.api_client - INFO - Obteniendo configuración de usuario.
2025-06-25 21:19:15,529 - ultibot_ui.services.api_client - DEBUG - APIClient httpx client ya está inicializado.
2025-06-25 21:19:15,530 - ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/config
2025-06-25 21:19:15,542 - ultibot_ui.services.api_client - DEBUG - APIClient httpx client ya está inicializado.
2025-06-25 21:19:15,543 - ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/market/klines
2025-06-25 21:19:15,543 - ultibot_ui.services.api_client - INFO - Obteniendo configuración de usuario.
2025-06-25 21:19:15,544 - ultibot_ui.services.api_client - DEBUG - APIClient httpx client ya está inicializado.
2025-06-25 21:19:15,544 - ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/config
2025-06-25 21:19:15,545 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-25 21:19:15,546 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-25 21:19:15,546 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-25 21:19:15,547 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001B9B61B7090>
2025-06-25 21:19:15,548 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-25 21:19:15,548 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001B9B61B47D0>
2025-06-25 21:19:15,548 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001B9D5772590>
2025-06-25 21:19:15,549 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-25 21:19:15,549 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-25 21:19:15,549 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-25 21:19:15,549 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-25 21:19:15,549 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-25 21:19:15,550 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-25 21:19:15,550 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-25 21:19:15,550 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-25 21:19:15,550 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-25 21:19:15,550 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-25 21:19:15,551 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-25 21:19:15,551 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-25 21:19:15,551 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-25 21:19:15,551 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-25 21:19:15,552 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 21:19:15,559 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/market/klines
2025-06-25 21:19:15,560 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 21:19:15,570 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 21:19:15,571 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 21:19:15,572 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Thu, 26 Jun 2025 01:19:15 GMT'), (b'server', b'uvicorn'), (b'content-length', b'1204'), (b'content-type', b'application/json')])
2025-06-25 21:19:15,572 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/config "HTTP/1.1 200 OK"
2025-06-25 21:19:15,572 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/config "HTTP/1.1 200 OK"
2025-06-25 21:19:15,573 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-25 21:19:15,573 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-25 21:19:15,573 - httpcore.http11 - DEBUG - response_closed.started
ainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 21:19:15,573 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-25 21:19:15,574 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 21:19:15,574 - ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/config "HTTP/HTTP/1.1 200 OK"
2025-06-25 21:19:15,574 - ultibot_ui.services.api_client - DEBUG - Response content (processed): {'id': 'f4d1053d-1e49-4b3d-9333-f5040437568d', 'userId': '00000000-0000-0000-0000-000000000001', 'telegramChatId': None, 'notificationPreferences': [], 'enableTelegramNotifications': False, 'defaultPaperTradingCapital': '10000.00000000', 'paperTradingActive': True, 'paperTradingAssets': None, 'watchlists': [], 'favoritePairs': ['BTCUSDT', 'ETHUSDT', 'BNBUSDT'], 'riskProfile': 'moderate', 'riskProfileSettings': {'daily_capital_risk_percentage': 0.01, 'per_trade_capital_risk_percentage': 0.005, 'max_drawdown_percentage': 0.1}, 'realTradingSettings': {'real_trading_mode_active': False, 'real_trades_executed_count': 0, 'max_concurrent_operations': None, 'daily_loss_limit_absolute': None, 'daily_profit_target_absolute': None, 'asset_specific_stop_loss': None, 'auto_pause_trading_conditions': None, 'daily_capital_risked_usd': '0.0', 'last_daily_reset': '2025-06-25T23:02:27.070318Z'}, 'aiStrategyConfigurations': None, 'aiAnalysisConfidenceThresholds': {'paper_trading': 0.7, 'real_trading': 0.8}, 'mcpServerPreferences': [], 'selectedTheme': 'dark', 'dashboardLayoutProfiles': None, 'activeDashboardLayoutProfileId': None, 'dashboardLayoutConfig': None, 'cloudSyncPreferences': None, 'createdAt': '2025-06-25T23:02:27.075317', 'updatedAt': '2025-06-25T23:02:27.075317'}
2025-06-25 21:19:15,574 - ultibot_ui.windows.main_window - INFO - Configuration received and validated for user ID: 00000000-0000-0000-0000-000000000001. Updating UI.
2025-06-25 21:19:15,574 - ultibot_ui.windows.main_window - INFO - User configuration set for ID: 00000000-0000-0000-0000-000000000001
2025-06-25 21:19:15,574 - ultibot_ui.windows.dashboard_view - INFO - DashboardView: User ID set to 00000000-0000-0000-0000-000000000001. Initializing async components.
2025-06-25 21:19:15,576 - ultibot_ui.widgets.portfolio_widget - INFO - PortfolioWidget: User ID set to 00000000-0000-0000-0000-000000000001. Starting updates.
2025-06-25 21:19:15,576 - ultibot_ui.widgets.market_data_widget - INFO - Cargando configuración inicial para MarketDataWidget...
2025-06-25 21:19:15,576 - ultibot_ui.views.opportunities_view - INFO - OpportunitiesView: User ID set to 00000000-0000-0000-0000-000000000001. Loading initial data.
2025-06-25 21:19:15,577 - ultibot_ui.views.opportunities_view - INFO - OpportunitiesView: _load_initial_data called.
2025-06-25 21:19:15,577 - ultibot_ui.views.portfolio_view - INFO - PortfolioView: User ID set to 00000000-0000-0000-0000-000000000001. Triggering initial data fetch.
2025-06-25 21:19:15,577 - ultibot_ui.windows.history_view - INFO - HistoryView: User ID set to 00000000-0000-0000-0000-000000000001. Loading data.
2025-06-25 21:19:15,577 - ultibot_ui.widgets.paper_trading_report_widget - INFO - PaperTradingReportWidget: User ID set to 00000000-0000-0000-0000-000000000001. Loading data.
2025-06-25 21:19:15,577 - ultibot_ui.views.orders_view - INFO - OrdersView: User ID set to 00000000-0000-0000-0000-000000000001. Triggering order load.
2025-06-25 21:19:15,577 - ultibot_ui.views.orders_view - INFO - Creating asyncio task to fetch orders.
2025-06-25 21:19:15,577 - ultibot_ui.windows.settings_view - INFO - SettingsView: User ID set to 00000000-0000-0000-0000-000000000001. Loading initial data.
2025-06-25 21:19:15,578 - ultibot_ui.windows.settings_view - INFO - SettingsView: Iniciando carga de datos iniciales (_load_initial_data).
2025-06-25 21:19:15,578 - __main__ - INFO - Initial user configuration fetched and applied successfully.
2025-06-25 21:19:15,578 - __main__ - INFO - Initialization complete. Showing MainWindow.
2025-06-25 21:19:15,688 - ultibot_ui.windows.main_window - INFO - MainWindow: Post-show initialization started.
2025-06-25 21:19:15,688 - ultibot_ui.views.strategies_view - INFO - StrategiesView: Initializing view data (loading strategies)...
2025-06-25 21:19:15,689 - ultibot_ui.views.trading_terminal_view - INFO - TradingTerminalView: Initializing view data (starting price feed)...
2025-06-25 21:19:15,689 - ultibot_ui.views.trading_terminal_view - INFO - Price feed task created for BTC/USDT.
2025-06-25 21:19:15,689 - ultibot_ui.windows.dashboard_view - INFO - DashboardView: initialize_async_components INVOCADO
2025-06-25 21:19:15,690 - ultibot_ui.windows.main_window - INFO - MainWindow: Post-show initialization finished.
2025-06-25 21:19:15,690 - ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-25 21:19:15,690 - ultibot_ui.services.api_client - INFO - Obteniendo configuración de usuario.
2025-06-25 21:19:15,690 - ultibot_ui.services.api_client - DEBUG - APIClient httpx client ya está inicializado.
2025-06-25 21:19:15,690 - ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/config
2025-06-25 21:19:15,692 - ultibot_ui.widgets.paper_trading_report_widget - INFO - Cargando datos de trades con filtros: {'date_from': '2025-05-26', 'date_to': '2025-06-25', 'limit': 500, 'offset': 0}
2025-06-25 21:19:15,692 - ultibot_ui.widgets.paper_trading_report_widget - ERROR - Error al cargar los datos del informe de paper trading: UltiBotAPIClient.get_trades() got an unexpected keyword argument 'date_from'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\widgets\paper_trading_report_widget.py", line 212, in _load_data_async
    trades_data = await self.api_client.get_trades(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: UltiBotAPIClient.get_trades() got an unexpected keyword argument 'date_from'
2025-06-25 21:19:15,719 - ultibot_ui.views.portfolio_view - INFO - PortfolioView: Scheduling portfolio snapshot fetch.
2025-06-25 21:19:15,761 - ultibot_ui.views.opportunities_view - INFO - Fetching Gemini IA opportunities.
2025-06-25 21:19:16,196 - ultibot_backend.services.market_data_service - CRITICAL - [MainThread] - market_data_service.py:291 - Error inesperado al obtener datos de velas para BTCUSDT-1h: (sqlite3.OperationalError) table market_data has no column named open
[SQL: 
            INSERT INTO market_data ("id", "symbol", "timestamp", "open", "high", "low", "close", "volume", "created_at")
            VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
            ON CONFLICT ("symbol", "timestamp") DO UPDATE
            SET "id" = EXCLUDED."id", "open" = EXCLUDED."open", "high" = EXCLUDED."high", "low" = EXCLUDED."low", "close" = EXCLUDED."close", "volume" = EXCLUDED."volume", "created_at" = EXCLUDED."created_at";
        ]
[parameters: [(None, 'BTCUSDT', '2025-06-17T18:00:00Z', 103814.0, 104414.85, 103626.05, 104414.84, 582.53411, '2025-06-26T01:19:16.188414'), (None, 'BTCUSDT', '2025-06-17T19:00:00Z', 104414.84, 105336.82, 104414.83, 104686.12, 1030.66661, '2025-06-26T01:19:16.188414'), (None, 'BTCUSDT', '2025-06-17T20:00:00Z', 104686.12, 104898.81, 104262.88, 104362.39, 631.39909, '2025-06-26T01:19:16.188414'), (None, 'BTCUSDT', '2025-06-17T21:00:00Z', 104362.39, 104822.31, 104252.33, 104552.58, 424.96971, '2025-06-26T01:19:16.188414'), (None, 'BTCUSDT', '2025-06-17T22:00:00Z', 104552.59, 104731.61, 104203.85, 104228.31, 339.43238, '2025-06-26T01:19:16.188414'), (None, 'BTCUSDT', '2025-06-17T23:00:00Z', 104228.31, 104730.77, 104228.31, 104551.17, 310.84641, '2025-06-26T01:19:16.188414'), (None, 'BTCUSDT', '2025-06-18T00:00:00Z', 104551.17, 104857.14, 104379.52, 104842.78, 396.62544, '2025-06-26T01:19:16.188414'), (None, 'BTCUSDT', '2025-06-18T01:00:00Z', 104842.78, 105176.61, 104680.0, 104776.92, 347.92348, '2025-06-26T01:19:16.188414')  ... displaying 10 of 200 total bound parameter sets ...  (None, 'BTCUSDT', '2025-06-26T00:00:00Z', 107340.59, 107623.52, 107252.21, 107320.0, 388.09743, '2025-06-26T01:19:16.189416'), (None, 'BTCUSDT', '2025-06-26T01:00:00Z', 107320.0, 107320.0, 107147.82, 107147.82, 64.19882, '2025-06-26T01:19:16.189416')]]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1932, in _exec_single_context
    self.dialect.do_executemany(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 940, in do_executemany
    cursor.executemany(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 160, in executemany
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 154, in executemany
    self.await_(_cursor.executemany(operation, seq_of_parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 47, in executemany
    await self._execute(self._cursor.executemany, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.OperationalError: table market_data has no column named open

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 282, in get_candlestick_data
    await self._persistence_service.upsert_all(market_data_to_save)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 172, in upsert_all
    await session.execute(text(query), data_list)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 201, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2260, in _execute_internal
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1932, in _exec_single_context
    self.dialect.do_executemany(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 940, in do_executemany
    cursor.executemany(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 160, in executemany
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 154, in executemany
    self.await_(_cursor.executemany(operation, seq_of_parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 47, in executemany
    await self._execute(self._cursor.executemany, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) table market_data has no column named open
[SQL: 
            INSERT INTO market_data ("id", "symbol", "timestamp", "open", "high", "low", "close", "volume", "created_at")
            VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)
            ON CONFLICT ("symbol", "timestamp") DO UPDATE
            SET "id" = EXCLUDED."id", "open" = EXCLUDED."open", "high" = EXCLUDED."high", "low" = EXCLUDED."low", "close" = EXCLUDED."close", "volume" = EXCLUDED."volume", "created_at" = EXCLUDED."created_at";
        ]
[parameters: [(None, 'BTCUSDT', '2025-06-17T18:00:00Z', 103814.0, 104414.85, 103626.05, 104414.84, 582.53411, '2025-06-26T01:19:16.188414'), (None, 'BTCUSDT', '2025-06-17T19:00:00Z', 104414.84, 105336.82, 104414.83, 104686.12, 1030.66661, '2025-06-26T01:19:16.188414'), (None, 'BTCUSDT', '2025-06-17T20:00:00Z', 104686.12, 104898.81, 104262.88, 104362.39, 631.39909, '2025-06-26T01:19:16.188414'), (None, 'BTCUSDT', '2025-06-17T21:00:00Z', 104362.39, 104822.31, 104252.33, 104552.58, 424.96971, '2025-06-26T01:19:16.188414'), (None, 'BTCUSDT', '2025-06-17T22:00:00Z', 104552.59, 104731.61, 104203.85, 104228.31, 339.43238, '2025-06-26T01:19:16.188414'), (None, 'BTCUSDT', '2025-06-17T23:00:00Z', 104228.31, 104730.77, 104228.31, 104551.17, 310.84641, '2025-06-26T01:19:16.188414'), (None, 'BTCUSDT', '2025-06-18T00:00:00Z', 104551.17, 104857.14, 104379.52, 104842.78, 396.62544, '2025-06-26T01:19:16.188414'), (None, 'BTCUSDT', '2025-06-18T01:00:00Z', 104842.78, 105176.61, 104680.0, 104776.92, 347.92348, '2025-06-26T01:19:16.188414')  ... displaying 10 of 200 total bound parameter sets ...  (None, 'BTCUSDT', '2025-06-26T00:00:00Z', 107340.59, 107623.52, 107252.21, 107320.0, 388.09743, '2025-06-26T01:19:16.189416'), (None, 'BTCUSDT', '2025-06-26T01:00:00Z', 107320.0, 107320.0, 107147.82, 107147.82, 64.19882, '2025-06-26T01:19:16.189416')]]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-06-25 21:19:16,202 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/market/klines - Status: 500
2025-06-25 21:19:17,248 - ultibot_ui.widgets.paper_trading_report_widget - ERROR - Error mostrado al usuario: Error cargando datos: UltiBotAPIClient.get_trades() got an unexpected keyword argument 'date_from'
2025-06-25 21:19:17,248 - ultibot_ui.widgets.paper_trading_report_widget - INFO - Cargando datos de trades con filtros: {'date_from': '2025-05-26', 'date_to': '2025-06-25', 'limit': 500, 'offset': 0}
2025-06-25 21:19:17,249 - ultibot_ui.widgets.paper_trading_report_widget - ERROR - Error al cargar los datos del informe de paper trading: UltiBotAPIClient.get_trades() got an unexpected keyword argument 'date_from'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\widgets\paper_trading_report_widget.py", line 212, in _load_data_async
    trades_data = await self.api_client.get_trades(
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: UltiBotAPIClient.get_trades() got an unexpected keyword argument 'date_from'
2025-06-25 21:19:17,734 - ultibot_ui.widgets.paper_trading_report_widget - ERROR - Error mostrado al usuario: Error cargando datos: UltiBotAPIClient.get_trades() got an unexpected keyword argument 'date_from'
2025-06-25 21:19:17,734 - ultibot_ui.workers - INFO - Fetching order history from API...
2025-06-25 21:19:17,736 - ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open', 'user_id': '00000000-0000-0000-0000-000000000001'}
2025-06-25 21:19:17,736 - ultibot_ui.services.api_client - DEBUG - APIClient httpx client ya está inicializado.
2025-06-25 21:19:17,736 - ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-25 21:19:17,736 - ultibot_ui.windows.settings_view - INFO - SettingsView: Solicitando configuración de usuario general.
2025-06-25 21:19:17,736 - ultibot_ui.workers - INFO - Fetching user configuration from API...
2025-06-25 21:19:17,737 - ultibot_ui.services.api_client - INFO - Obteniendo configuración de usuario.
2025-06-25 21:19:17,737 - ultibot_ui.services.api_client - DEBUG - APIClient httpx client ya está inicializado.
2025-06-25 21:19:17,737 - ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/config
2025-06-25 21:19:17,737 - ultibot_ui.windows.settings_view - INFO - SettingsView: Solicitando configuración de usuario para estado de operativa real.
2025-06-25 21:19:17,738 - ultibot_ui.workers - INFO - Fetching user configuration from API...
2025-06-25 21:19:17,738 - ultibot_ui.services.api_client - INFO - Obteniendo configuración de usuario.
2025-06-25 21:19:17,738 - ultibot_ui.services.api_client - DEBUG - APIClient httpx client ya está inicializado.
2025-06-25 21:19:17,738 - ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/config
2025-06-25 21:19:17,739 - ultibot_ui.services.api_client - INFO - Obteniendo estrategias de trading.
2025-06-25 21:19:17,739 - ultibot_ui.services.api_client - DEBUG - APIClient httpx client ya está inicializado.
2025-06-25 21:19:17,739 - ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/strategies
2025-06-25 21:19:17,739 - ultibot_ui.workers - INFO - Starting real-time price feed for BTC/USDT...
2025-06-25 21:19:17,739 - ultibot_ui.services.api_client - INFO - Obteniendo datos de mercado para símbolos: ['BTC/USDT']
2025-06-25 21:19:17,741 - ultibot_ui.services.api_client - DEBUG - APIClient httpx client ya está inicializado.
2025-06-25 21:19:17,741 - ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/market/tickers
2025-06-25 21:19:17,741 - ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: both, filtros: {'trading_mode': 'both', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-25 21:19:17,741 - ultibot_ui.services.api_client - DEBUG - APIClient httpx client ya está inicializado.
2025-06-25 21:19:17,742 - ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-25 21:19:17,742 - httpcore.http11 - DEBUG - receive_response_headers.failed exception=CancelledError()
2025-06-25 21:19:17,742 - httpcore.http11 - DEBUG - response_closed.started
2025-06-25 21:19:17,743 - httpcore.http11 - DEBUG - receive_response_headers.failed exception=CancelledError()
2025-06-25 21:19:17,743 - httpcore.http11 - DEBUG - response_closed.started
2025-06-25 21:19:17,743 - ultibot_ui.workers - INFO - Price feed for BTC/USDT was cancelled.
2025-06-25 21:19:17,744 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-25 21:19:17,744 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-25 21:19:17,745 - __main__ - INFO - Starting application event loop.
2025-06-25 21:19:19,967 - ultibot_ui.windows.main_window - INFO - Cleaning up MainWindow resources. Stopping 0 active threads...
2025-06-25 21:19:19,967 - ultibot_ui.windows.dashboard_view - INFO - DashboardView: Iniciando limpieza de tareas.
2025-06-25 21:19:19,967 - ultibot_ui.widgets.portfolio_widget - INFO - PortfolioWidget: Iniciando limpieza.
2025-06-25 21:19:19,967 - ultibot_ui.widgets.portfolio_widget - INFO - PortfolioWidget: Limpieza completada.
2025-06-25 21:19:19,967 - ultibot_ui.widgets.chart_widget - INFO - ChartWidget: Limpieza completada.
2025-06-25 21:19:19,968 - ultibot_ui.windows.dashboard_view - INFO - DashboardView: Limpieza completada.
2025-06-25 21:19:19,968 - ultibot_ui.views.opportunities_view - INFO - Cleaning up OpportunitiesView...
2025-06-25 21:19:19,968 - ultibot_ui.views.opportunities_view - INFO - OpportunitiesView cleanup finished.
2025-06-25 21:19:19,968 - ultibot_ui.views.portfolio_view - INFO - PortfolioView: Cleaning up...
2025-06-25 21:19:19,968 - ultibot_ui.views.portfolio_view - INFO - PortfolioView: Cleanup finished.
2025-06-25 21:19:19,968 - ultibot_ui.widgets.paper_trading_report_widget - INFO - PaperTradingReportWidget cleanup: No hay acciones que tomar.
2025-06-25 21:19:19,969 - ultibot_ui.windows.history_view - INFO - HistoryView cleanup completado
2025-06-25 21:19:19,969 - ultibot_ui.windows.settings_view - INFO - SettingsView: Cleanup called.
2025-06-25 21:19:19,969 - ultibot_ui.views.trading_terminal_view - INFO - TradingTerminalView: Cleanup initiated.
2025-06-25 21:19:19,969 - ultibot_ui.views.trading_terminal_view - INFO - TradingTerminalView: Cleanup finished.
2025-06-25 21:19:19,969 - ultibot_ui.windows.main_window - INFO - MainWindow cleanup finished.
2025-06-25 21:19:19,985 - __main__ - INFO - Cleanup process started...
2025-06-25 21:19:19,985 - ultibot_ui.windows.main_window - INFO - Cleaning up MainWindow resources. Stopping 0 active threads...
2025-06-25 21:19:19,985 - ultibot_ui.windows.dashboard_view - INFO - DashboardView: Iniciando limpieza de tareas.
2025-06-25 21:19:19,986 - ultibot_ui.widgets.portfolio_widget - INFO - PortfolioWidget: Iniciando limpieza.
2025-06-25 21:19:19,986 - ultibot_ui.widgets.portfolio_widget - INFO - PortfolioWidget: Limpieza completada.
2025-06-25 21:19:19,986 - ultibot_ui.widgets.chart_widget - INFO - ChartWidget: Limpieza completada.
2025-06-25 21:19:19,986 - ultibot_ui.windows.dashboard_view - INFO - DashboardView: Limpieza completada.
2025-06-25 21:19:19,986 - ultibot_ui.views.opportunities_view - INFO - Cleaning up OpportunitiesView...
2025-06-25 21:19:19,986 - ultibot_ui.views.opportunities_view - INFO - OpportunitiesView cleanup finished.
2025-06-25 21:19:19,986 - ultibot_ui.views.portfolio_view - INFO - PortfolioView: Cleaning up...
2025-06-25 21:19:19,987 - ultibot_ui.views.portfolio_view - INFO - PortfolioView: Cleanup finished.
2025-06-25 21:19:19,987 - ultibot_ui.widgets.paper_trading_report_widget - INFO - PaperTradingReportWidget cleanup: No hay acciones que tomar.
2025-06-25 21:19:19,987 - ultibot_ui.windows.history_view - INFO - HistoryView cleanup completado
2025-06-25 21:19:19,987 - ultibot_ui.windows.settings_view - INFO - SettingsView: Cleanup called.
2025-06-25 21:19:19,987 - ultibot_ui.views.trading_terminal_view - INFO - TradingTerminalView: Cleanup initiated.
2025-06-25 21:19:19,987 - ultibot_ui.views.trading_terminal_view - INFO - TradingTerminalView: Cleanup finished.
2025-06-25 21:19:19,988 - ultibot_ui.windows.main_window - INFO - MainWindow cleanup finished.
2025-06-25 21:19:19,988 - __main__ - INFO - Scheduling API client cleanup task.
2025-06-25 21:19:25,000 - __main__ - ERROR - Error during API client cleanup: 
2025-06-25 21:19:25,000 - __main__ - INFO - Application cleanup finished.
2025-06-25 21:19:25,000 - __main__ - INFO - Application event loop has stopped.
2025-06-25 21:19:25,056 - qasync._windows._IocpProactor - DEBUG - Closing
2025-06-25 21:19:25,056 - qasync._windows._IocpProactor - DEBUG - Closing
2025-06-25 21:25:30,619 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /favicon.ico
2025-06-25 21:25:30,620 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /favicon.ico - Status: 404
2025-06-25 22:03:25,711 - ultibot_backend - INFO - [MainThread] - main.py:104 - Apagando UltiBot Backend (lifespan)...
2025-06-25 22:03:25,712 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:189 - Shutting down dependency container...
2025-06-25 22:03:25,715 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:40 - Redis client closed.
2025-06-25 22:03:25,715 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:196 - Dependency container shut down.
2025-06-25 22:03:25,716 - ultibot_backend - INFO - [MainThread] - main.py:107 - Recursos liberados y aplicación apagada (lifespan).
2025-06-25 22:03:30,406 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:03:30,407 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:03:30,428 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:03:30,429 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:03:30,431 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:03:30,431 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:03:30,432 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:03:30,432 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:03:30,432 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:03:30,472 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:03:30,648 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:03:30,648 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:03:30,824 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:03:30,828 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:03:30,828 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:03:30,829 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:03:30,841 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:03:30,841 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001A544D42650>
2025-06-25 22:03:30,841 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:03:30,842 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:03:30,842 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:03:35,383 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:03:35,384 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:03:35,401 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:03:35,402 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:03:35,403 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:03:35,403 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:03:35,404 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:03:35,404 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:03:35,404 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:03:35,442 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:03:35,627 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:03:35,628 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:03:35,812 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:03:35,815 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:03:35,817 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:03:35,817 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:03:35,830 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:03:35,831 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001BF9516C3D0>
2025-06-25 22:03:35,831 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:03:35,831 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:03:35,831 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:07:02,963 - ultibot_backend - INFO - [MainThread] - main.py:104 - Apagando UltiBot Backend (lifespan)...
2025-06-25 22:07:02,964 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:189 - Shutting down dependency container...
2025-06-25 22:07:02,968 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:40 - Redis client closed.
2025-06-25 22:07:02,968 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:196 - Dependency container shut down.
2025-06-25 22:07:02,969 - ultibot_backend - INFO - [MainThread] - main.py:107 - Recursos liberados y aplicación apagada (lifespan).
2025-06-25 22:07:07,509 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:07:07,510 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:07:07,529 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:07:07,529 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:07:07,531 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:07:07,531 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:07:07,533 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:07:07,533 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:07:07,533 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:07:07,574 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:07:07,745 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:07:07,746 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:07:07,926 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:07:07,929 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:07:07,930 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:07:07,930 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:07:07,943 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:07:07,944 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000019D082D01D0>
2025-06-25 22:07:07,944 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:07:07,944 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:07:07,945 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:07:12,470 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:07:12,470 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:07:12,489 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:07:12,490 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:07:12,491 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:07:12,491 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:07:12,492 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:07:12,492 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:07:12,493 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:07:12,527 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:07:12,708 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:07:12,709 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:07:12,886 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:07:12,889 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:07:12,890 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:07:12,890 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:07:12,904 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:07:12,905 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000205BB6F3350>
2025-06-25 22:07:12,905 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:07:12,905 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:07:12,905 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:10:12,873 - ultibot_backend - INFO - [MainThread] - main.py:104 - Apagando UltiBot Backend (lifespan)...
2025-06-25 22:10:12,875 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:189 - Shutting down dependency container...
2025-06-25 22:10:12,880 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:40 - Redis client closed.
2025-06-25 22:10:12,881 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:196 - Dependency container shut down.
2025-06-25 22:10:12,881 - ultibot_backend - INFO - [MainThread] - main.py:107 - Recursos liberados y aplicación apagada (lifespan).
2025-06-25 22:10:17,486 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:10:17,486 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:10:17,504 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:10:17,505 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:10:17,508 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:10:17,509 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:10:17,509 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:10:17,510 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:10:17,510 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:10:17,553 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:10:17,729 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:10:17,730 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:10:17,906 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:10:17,909 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:10:17,910 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:10:17,910 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:10:17,924 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:10:17,925 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001BFDADD1CD0>
2025-06-25 22:10:17,925 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:10:17,926 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:10:17,926 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:10:22,625 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:10:22,626 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:10:22,648 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:10:22,649 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:10:22,651 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:10:22,651 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:10:22,651 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:10:22,652 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:10:22,652 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:10:22,692 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:10:22,881 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:10:22,881 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:10:23,070 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:10:23,073 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:10:23,073 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:10:23,074 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:10:23,086 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:10:23,086 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000019F4C81EF50>
2025-06-25 22:10:23,086 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:10:23,088 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:10:23,088 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:12:15,238 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:12:15,238 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:12:15,257 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:12:15,258 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:14:02,888 - ultibot_backend - INFO - [MainThread] - main.py:104 - Apagando UltiBot Backend (lifespan)...
2025-06-25 22:14:02,890 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:189 - Shutting down dependency container...
2025-06-25 22:14:02,894 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:40 - Redis client closed.
2025-06-25 22:14:02,895 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:196 - Dependency container shut down.
2025-06-25 22:14:02,895 - ultibot_backend - INFO - [MainThread] - main.py:107 - Recursos liberados y aplicación apagada (lifespan).
2025-06-25 22:14:07,594 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:14:07,595 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:14:07,614 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:14:07,615 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:14:07,616 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:14:07,616 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:14:07,616 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:14:07,616 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:14:07,618 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:14:07,655 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:14:07,832 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:14:07,833 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:14:08,007 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:14:08,010 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:14:08,011 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:14:08,011 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:14:08,026 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:14:08,027 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001EDB7ABDD50>
2025-06-25 22:14:08,027 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:14:08,028 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:14:08,028 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:14:12,534 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:14:12,535 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:14:12,552 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:14:12,553 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:14:12,554 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:14:12,555 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:14:12,555 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:14:12,555 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:14:12,557 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:14:12,595 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:14:12,774 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:14:12,775 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:14:12,950 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:14:12,953 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:14:12,953 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:14:12,953 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:14:12,969 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:14:12,969 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000002DC0C63F050>
2025-06-25 22:14:12,970 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:14:12,970 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:14:12,970 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:18:14,266 - ultibot_backend - INFO - [MainThread] - main.py:104 - Apagando UltiBot Backend (lifespan)...
2025-06-25 22:18:14,266 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:189 - Shutting down dependency container...
2025-06-25 22:18:14,270 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:40 - Redis client closed.
2025-06-25 22:18:14,270 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:196 - Dependency container shut down.
2025-06-25 22:18:14,270 - ultibot_backend - INFO - [MainThread] - main.py:107 - Recursos liberados y aplicación apagada (lifespan).
2025-06-25 22:18:18,835 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:18:18,836 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:18:18,853 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:18:18,853 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:18:18,855 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:18:18,855 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:18:18,856 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:18:18,856 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:18:18,856 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:18:18,893 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:18:19,069 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:18:19,070 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:18:19,244 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:18:19,248 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:18:19,249 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:18:19,249 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:18:19,261 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:18:19,262 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001C99FB23490>
2025-06-25 22:18:19,262 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:18:19,263 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:18:19,264 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:18:23,826 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:18:23,826 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:18:23,844 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:18:23,845 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:18:23,846 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:18:23,848 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:18:23,848 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:18:23,849 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:18:23,849 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:18:23,889 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:18:24,069 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:18:24,069 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:18:24,251 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:18:24,254 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:18:24,254 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:18:24,255 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:18:24,266 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:18:24,267 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000025DD9930F10>
2025-06-25 22:18:24,267 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:18:24,269 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:18:24,269 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:23:21,796 - ultibot_backend - INFO - [MainThread] - main.py:104 - Apagando UltiBot Backend (lifespan)...
2025-06-25 22:23:21,798 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:189 - Shutting down dependency container...
2025-06-25 22:23:21,802 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:40 - Redis client closed.
2025-06-25 22:23:21,803 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:196 - Dependency container shut down.
2025-06-25 22:23:21,803 - ultibot_backend - INFO - [MainThread] - main.py:107 - Recursos liberados y aplicación apagada (lifespan).
2025-06-25 22:23:26,441 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:23:26,442 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:23:26,460 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:23:26,461 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:23:26,462 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:23:26,462 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:23:26,462 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:23:26,463 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:23:26,463 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:23:26,499 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:23:26,674 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:23:26,675 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:23:26,860 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:23:26,863 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:23:26,863 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:23:26,864 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:23:26,877 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:23:26,877 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000021809F4F110>
2025-06-25 22:23:26,878 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:23:26,878 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:23:26,878 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:23:31,452 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:23:31,453 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:23:31,470 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:23:31,471 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:23:31,472 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:23:31,472 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:23:31,472 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:23:31,473 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:23:31,473 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:23:31,511 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:23:31,685 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:23:31,686 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:23:31,859 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:23:31,862 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:23:31,863 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:23:31,863 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:23:31,876 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:23:31,877 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000018283DED1D0>
2025-06-25 22:23:31,877 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:23:31,877 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:23:31,878 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:23:46,988 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:23:46,989 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:23:47,008 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:23:47,008 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:23:47,656 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:23:47,656 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:23:47,674 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:23:47,674 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:24:43,062 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:24:43,062 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:24:43,082 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:24:43,082 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:24:43,259 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:24:43,260 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:24:43,278 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:24:43,278 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:24:43,938 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:24:43,938 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:24:43,970 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:24:44,102 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:24:44,105 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:24:44,108 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:24:44,109 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:24:44,117 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:24:44,117 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:24:44,136 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:24:44,139 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:24:44,141 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:24:44,147 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:24:44,149 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:24:44,165 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:24:44,168 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:24:44,170 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:24:44,178 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:24:44,178 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:24:44,196 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:24:44,198 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:24:44,200 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:24:44,208 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:24:44,209 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:24:44,225 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:24:44,227 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:24:44,229 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:24:44,236 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:24:44,236 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:24:44,255 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:24:44,256 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:24:44,257 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:24:44,257 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:24:44,257 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:24:44,257 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:24:44,278 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:24:44,457 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:24:44,474 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:24:44,651 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:24:44,651 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:24:44,652 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:24:44,652 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:24:44,750 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:24:44,750 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000023E633E51D0>
2025-06-25 22:24:44,751 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:24:44,751 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:24:44,752 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 422
2025-06-25 22:24:44,762 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:24:44,762 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:24:44,779 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:24:44,780 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:24:44,781 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:24:44,781 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:24:44,955 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:24:44,956 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:24:45,134 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:24:45,135 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:24:45,135 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:24:45,136 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:24:45,139 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:24:45,139 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000023E635F1AD0>
2025-06-25 22:24:45,140 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:24:45,140 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:24:45,151 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:24:45,160 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:24:45,161 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:24:45,169 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:24:45,169 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:24:45,188 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:24:45,189 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:24:45,190 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:24:45,190 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:24:45,368 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:24:45,369 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:24:45,546 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:24:45,546 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:24:45,546 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:24:45,547 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:24:45,550 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:24:45,550 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000023E6375AC10>
2025-06-25 22:24:45,550 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:24:45,551 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:24:45,555 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:24:45,562 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:24:45,562 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:24:45,563 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:24:45,568 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:24:45,569 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:24:45,570 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:24:45,570 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:24:45,580 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:24:45,580 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:24:45,598 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:24:45,599 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:24:45,600 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:24:45,600 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:24:45,779 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:24:45,779 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:24:45,961 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:24:45,961 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:24:45,962 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:24:45,962 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:24:45,964 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:24:45,965 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000023E635609D0>
2025-06-25 22:24:45,965 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:24:45,965 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:24:45,969 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:24:45,977 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:24:45,977 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:24:45,978 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:24:45,983 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:24:45,983 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:24:45,992 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:24:45,993 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:24:46,010 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:24:46,011 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:24:46,012 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:24:46,012 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:24:46,191 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:24:46,191 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:24:46,368 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:24:46,369 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:24:46,369 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:24:46,369 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:24:46,375 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:24:46,375 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000023E635C2490>
2025-06-25 22:24:46,375 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:24:46,375 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:24:46,378 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:24:46,386 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:24:46,386 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:24:46,387 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:24:46,392 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:24:46,393 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:24:46,402 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:24:46,402 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:24:46,419 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:24:46,421 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:24:46,422 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:24:46,422 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:24:46,596 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:24:46,596 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:24:46,774 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:24:46,774 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:24:46,775 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:24:46,775 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:24:46,778 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:24:46,779 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000023E6375A490>
2025-06-25 22:24:46,779 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:24:46,779 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:24:46,780 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 422
2025-06-25 22:24:46,798 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 30ff5310-6626-43f3-86b9-077f02eea2aa
2025-06-25 22:24:46,799 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:152 - User configuration saved after initializing last_daily_reset for user 6bb32dab-600c-4f17-b220-2f887b82ab3f.
2025-06-25 22:24:46,800 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 200.000
2025-06-25 22:24:46,800 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity 30ff5310-6626-43f3-86b9-077f02eea2aa
2025-06-25 22:24:46,801 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade bb458454-0080-405e-b1a6-7692a2bd5765 from decision e14fd4a1-72d3-4dd7-b079-bd77e04e0483
2025-06-25 22:24:46,801 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade bb458454-0080-405e-b1a6-7692a2bd5765 from confirmed opportunity.
2025-06-25 22:24:46,802 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:24:46,802 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:310 - Successfully created OCO order for trade bb458454-0080-405e-b1a6-7692a2bd5765. OCO List ID: oco_list_123
2025-06-25 22:24:46,803 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 6bb32dab-600c-4f17-b220-2f887b82ab3f: 200.0000000000000000000000000 (anterior: 0.0, valor trade: 200.0000000000000000000000000)
2025-06-25 22:24:46,804 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user 6bb32dab-600c-4f17-b220-2f887b82ab3f to 200.0000000000000000000000000.
2025-06-25 22:24:46,806 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 30ff5310-6626-43f3-86b9-077f02eea2aa status to converted_to_trade_real: Trade bb458454-0080-405e-b1a6-7692a2bd5765 executed based on user confirmation.
2025-06-25 22:24:46,807 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 30ff5310-6626-43f3-86b9-077f02eea2aa
2025-06-25 22:24:46,816 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity a8219b25-522f-4d9f-82a3-521278fc3bf8
2025-06-25 22:24:46,816 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 4800.0, Riesgo Potencial Trade USD: 300.000
2025-06-25 22:24:46,816 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:191 - Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:24:46,817 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity a8219b25-522f-4d9f-82a3-521278fc3bf8 status to error_in_processing: Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:24:46,817 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity a8219b25-522f-4d9f-82a3-521278fc3bf8
2025-06-25 22:24:46,832 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 3c1b6801-07af-422a-9c3f-ad83e3a0c1ee
2025-06-25 22:24:46,833 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:143 - Daily capital reset triggered for user a6ef9f1f-59dc-4eda-8263-09a6bda8d16b. Resetting daily_capital_risked_usd.
2025-06-25 22:24:46,833 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:147 - User configuration saved after daily capital reset for user a6ef9f1f-59dc-4eda-8263-09a6bda8d16b.
2025-06-25 22:24:46,833 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 2500.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 100.000
2025-06-25 22:24:46,834 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity 3c1b6801-07af-422a-9c3f-ad83e3a0c1ee
2025-06-25 22:24:46,834 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 2f735357-7ad3-4b6a-b5f2-df1699dea5d7 from decision aaad56dc-0c12-49f9-b06c-d0d3f4be6f88
2025-06-25 22:24:46,834 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 2f735357-7ad3-4b6a-b5f2-df1699dea5d7 from confirmed opportunity.
2025-06-25 22:24:46,835 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:24:46,836 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:310 - Successfully created OCO order for trade 2f735357-7ad3-4b6a-b5f2-df1699dea5d7. OCO List ID: oco_reset_test
2025-06-25 22:24:46,836 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario a6ef9f1f-59dc-4eda-8263-09a6bda8d16b: 100.000 (anterior: 0.0, valor trade: 100.000)
2025-06-25 22:24:46,836 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user a6ef9f1f-59dc-4eda-8263-09a6bda8d16b to 100.000.
2025-06-25 22:24:46,836 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 3c1b6801-07af-422a-9c3f-ad83e3a0c1ee status to converted_to_trade_real: Trade 2f735357-7ad3-4b6a-b5f2-df1699dea5d7 executed based on user confirmation.
2025-06-25 22:24:46,838 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 3c1b6801-07af-422a-9c3f-ad83e3a0c1ee
2025-06-25 22:24:48,246 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity f4d246e1-db7d-40e8-822c-b13dd1178843 for symbol BTCUSDT
2025-06-25 22:24:48,246 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 36b817ba-d761-45c1-b021-e63bd62daff8
2025-06-25 22:24:48,247 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy a5587aac-70b3-46f3-a7b2-a83025e4d212 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:24:48,256 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 27c11b75-35d6-4882-8e0c-33c8abfee301 for symbol BTCUSDT
2025-06-25 22:24:48,258 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 7babbe35-f29f-4405-addc-566498e7313a can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:24:48,265 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 7fabb356-a225-40d3-aa5f-0a29659d0918 for symbol ETHUSDT
2025-06-25 22:24:48,266 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 3daa419e-95ab-426a-8a69-62ab0fb47a3a
2025-06-25 22:24:48,267 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:590 - No active and applicable strategies found for opportunity 7fabb356-a225-40d3-aa5f-0a29659d0918 with symbol ETHUSDT.
2025-06-25 22:24:48,267 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 7fabb356-a225-40d3-aa5f-0a29659d0918 status to rejected_by_system: No active strategies are applicable to this opportunity's symbol.
2025-06-25 22:24:48,268 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 7fabb356-a225-40d3-aa5f-0a29659d0918
2025-06-25 22:24:48,276 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 6cede8cd-c685-4ae4-a821-e2da55bc3cc2 for symbol BTCUSDT
2025-06-25 22:24:48,277 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: b1d5b11c-5686-4edc-97ea-2299694fadb7
2025-06-25 22:24:48,277 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:703 - AI confidence 0.65 for strategy c608697a-dacc-4c3b-9c3c-67d4385ab3f2 is below threshold 0.8.
2025-06-25 22:24:48,279 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:718 - Strategy c608697a-dacc-4c3b-9c3c-67d4385ab3f2 did not produce a decision for opportunity 6cede8cd-c685-4ae4-a821-e2da55bc3cc2.
2025-06-25 22:24:48,279 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:609 - No affirmative trading decisions made for opportunity 6cede8cd-c685-4ae4-a821-e2da55bc3cc2.
2025-06-25 22:24:48,287 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity e3c6a04a-6995-4dfe-b540-5b62859dc17d for symbol BTCUSDT
2025-06-25 22:24:48,288 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 08015df5-3390-4a36-b6cb-9bec21176ce3
2025-06-25 22:24:48,298 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 3df94577-6e3d-4863-a20d-03a78ae6acd2 for symbol BTCUSDT
2025-06-25 22:24:48,298 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 8c891e03-53f2-46c7-a120-c03384d6beba
2025-06-25 22:24:48,305 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade db1eabb6-bc38-42a6-9ece-668551f0533a from decision d922dc49-fbe5-4c1c-a0f3-1b5687220274
2025-06-25 22:24:48,311 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 781b6a38-0a42-43fd-9636-2015abf3148d from decision 81fd75a2-a682-43f8-a571-0933aed03ced
2025-06-25 22:24:48,311 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 861c64be-7b4c-44f4-90f3-303db71ca690 from decision 81fd75a2-a682-43f8-a571-0933aed03ced
2025-06-25 22:24:48,318 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:24:48,318 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:24:48,327 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:24:48,328 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:24:48,330 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:24:48,332 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity faa0e2c4-6981-4007-873b-42ceb4895c88
2025-06-25 22:24:48,335 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 19e28414-a920-4e36-9b57-8a58039fdb1a. Creando y guardando configuración por defecto.
2025-06-25 22:24:48,337 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:24:48,340 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 19e28414-a920-4e36-9b57-8a58039fdb1a. Using default values.
2025-06-25 22:24:48,341 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 19e28414-a920-4e36-9b57-8a58039fdb1a with capital: 10000.0
2025-06-25 22:24:48,343 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:24:48,343 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:24:48,344 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:24:48,344 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity faa0e2c4-6981-4007-873b-42ceb4895c88
2025-06-25 22:24:48,344 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 4119a699-a8fb-4d7e-8a4b-af1e5c8f94ae from decision 44854c3b-0469-4420-8abb-b6f8e148801b
2025-06-25 22:24:48,345 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 4119a699-a8fb-4d7e-8a4b-af1e5c8f94ae from confirmed opportunity.
2025-06-25 22:24:48,346 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:24:48,346 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:317 - Failed to create OCO order for trade 4119a699-a8fb-4d7e-8a4b-af1e5c8f94ae: PENDING
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 296, in execute_trade_from_confirmed_opportunity
    oco_order_result = await self.unified_order_execution_service.create_oco_order(
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2248, in _execute_mock_call
    result = await effect(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\tests\conftest.py", line 683, in mock_create_oco_order
    status=OrderStatus.PENDING.value,
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\enum.py", line 784, in __getattr__
    raise AttributeError(name) from None
AttributeError: PENDING
2025-06-25 22:24:48,348 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 19e28414-a920-4e36-9b57-8a58039fdb1a: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:24:48,351 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('4119a699-a8fb-4d7e-8a4b-af1e5c8f94ae'), '8297dbc4-328e-4676-b56d-72cc3311237c', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:24:48.344015', '2025-06-26 02:24:48.344015', None, '{"id":"4119a699-a8fb-4d7e-8a4b-af1e5c8f94ae","user_id":"8297dbc4-328e-4676-b56d-72cc3311237c","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1201 characters truncated) ... ts":[],"created_at":"2025-06-26T02:24:48.344015","opened_at":"2025-06-26T02:24:48.344015","updated_at":"2025-06-26T02:24:48.344015","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('4119a699-a8fb-4d7e-8a4b-af1e5c8f94ae'), '8297dbc4-328e-4676-b56d-72cc3311237c', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:24:48.344015', '2025-06-26 02:24:48.344015', None, '{"id":"4119a699-a8fb-4d7e-8a4b-af1e5c8f94ae","user_id":"8297dbc4-328e-4676-b56d-72cc3311237c","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1201 characters truncated) ... ts":[],"created_at":"2025-06-26T02:24:48.344015","opened_at":"2025-06-26T02:24:48.344015","updated_at":"2025-06-26T02:24:48.344015","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:24:48,379 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity faa0e2c4-6981-4007-873b-42ceb4895c88: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('4119a699-a8fb-4d7e-8a4b-af1e5c8f94ae'), '8297dbc4-328e-4676-b56d-72cc3311237c', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:24:48.344015', '2025-06-26 02:24:48.344015', None, '{"id":"4119a699-a8fb-4d7e-8a4b-af1e5c8f94ae","user_id":"8297dbc4-328e-4676-b56d-72cc3311237c","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1201 characters truncated) ... ts":[],"created_at":"2025-06-26T02:24:48.344015","opened_at":"2025-06-26T02:24:48.344015","updated_at":"2025-06-26T02:24:48.344015","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:24:48,381 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity faa0e2c4-6981-4007-873b-42ceb4895c88 status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:24:48,382 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:541 - Failed to persist status update for opportunity faa0e2c4-6981-4007-873b-42ceb4895c88: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('4119a699-a8fb-4d7e-8a4b-af1e5c8f94ae'), '8297dbc4-328e-4676-b56d-72cc3311237c', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:24:48.344015', '2025-06-26 02:24:48.344015', None, '{"id":"4119a699-a8fb-4d7e-8a4b-af1e5c8f94ae","user_id":"8297dbc4-328e-4676-b56d-72cc3311237c","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1201 characters truncated) ... ts":[],"created_at":"2025-06-26T02:24:48.344015","opened_at":"2025-06-26T02:24:48.344015","updated_at":"2025-06-26T02:24:48.344015","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 534, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('4119a699-a8fb-4d7e-8a4b-af1e5c8f94ae'), '8297dbc4-328e-4676-b56d-72cc3311237c', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:24:48.344015', '2025-06-26 02:24:48.344015', None, '{"id":"4119a699-a8fb-4d7e-8a4b-af1e5c8f94ae","user_id":"8297dbc4-328e-4676-b56d-72cc3311237c","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1201 characters truncated) ... ts":[],"created_at":"2025-06-26T02:24:48.344015","opened_at":"2025-06-26T02:24:48.344015","updated_at":"2025-06-26T02:24:48.344015","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:24:48,416 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:24:48,416 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:24:48,425 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:24:48,425 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:24:48,434 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:24:48,435 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:24:48,437 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:24:48,439 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:24:48,440 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:24:48,448 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:24:48,448 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:24:48,457 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:24:48,457 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:24:48,459 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:24:48,461 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 293d68a1-fb10-422e-b44e-14bd607b18aa for symbol BTC/USDT
2025-06-25 22:24:48,464 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 82aa4cdf-8dea-40ec-87da-0d4752d6170f. Creando y guardando configuración por defecto.
2025-06-25 22:24:48,467 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:24:48,469 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:658 - AI profile 'ai-profile-scalping-1' for strategy 2fa2b197-ec42-473e-9108-8bf860c14589 not found. Skipping AI analysis.
2025-06-25 22:24:48,470 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 2fa2b197-ec42-473e-9108-8bf860c14589 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:24:48,470 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 293d68a1-fb10-422e-b44e-14bd607b18aa status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:24:48,476 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 293d68a1-fb10-422e-b44e-14bd607b18aa
2025-06-25 22:24:48,476 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:24:48,477 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:24:48,485 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:24:48,485 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:24:48,493 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:24:48,494 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:24:48,496 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:24:48,498 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity fe1cca7d-9bb1-48d5-9152-024cbcbc6394
2025-06-25 22:24:48,501 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 451309a4-0e86-4f69-a8db-8ca8b5160afb. Creando y guardando configuración por defecto.
2025-06-25 22:24:48,503 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:24:48,506 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 451309a4-0e86-4f69-a8db-8ca8b5160afb. Using default values.
2025-06-25 22:24:48,506 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 451309a4-0e86-4f69-a8db-8ca8b5160afb with capital: 10000.0
2025-06-25 22:24:48,508 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:24:48,508 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:24:48,508 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:24:48,509 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Autonomous Scalping' as context for confirmed opportunity fe1cca7d-9bb1-48d5-9152-024cbcbc6394
2025-06-25 22:24:48,509 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 956ab17d-62a3-435e-8f84-5665cf20a571 from decision aecc04b2-0950-4841-844d-43834ae1446a
2025-06-25 22:24:48,510 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 956ab17d-62a3-435e-8f84-5665cf20a571 from confirmed opportunity.
2025-06-25 22:24:48,511 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:24:48,511 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:317 - Failed to create OCO order for trade 956ab17d-62a3-435e-8f84-5665cf20a571: PENDING
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 296, in execute_trade_from_confirmed_opportunity
    oco_order_result = await self.unified_order_execution_service.create_oco_order(
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2248, in _execute_mock_call
    result = await effect(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\tests\conftest.py", line 683, in mock_create_oco_order
    status=OrderStatus.PENDING.value,
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\enum.py", line 784, in __getattr__
    raise AttributeError(name) from None
AttributeError: PENDING
2025-06-25 22:24:48,512 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 451309a4-0e86-4f69-a8db-8ca8b5160afb: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:24:48,515 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('956ab17d-62a3-435e-8f84-5665cf20a571'), 'd74dd527-f8df-486a-8963-0cd0ef2d9605', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:24:48.509287', '2025-06-26 02:24:48.509287', None, '{"id":"956ab17d-62a3-435e-8f84-5665cf20a571","user_id":"d74dd527-f8df-486a-8963-0cd0ef2d9605","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1199 characters truncated) ... ts":[],"created_at":"2025-06-26T02:24:48.509287","opened_at":"2025-06-26T02:24:48.509287","updated_at":"2025-06-26T02:24:48.509287","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('956ab17d-62a3-435e-8f84-5665cf20a571'), 'd74dd527-f8df-486a-8963-0cd0ef2d9605', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:24:48.509287', '2025-06-26 02:24:48.509287', None, '{"id":"956ab17d-62a3-435e-8f84-5665cf20a571","user_id":"d74dd527-f8df-486a-8963-0cd0ef2d9605","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1199 characters truncated) ... ts":[],"created_at":"2025-06-26T02:24:48.509287","opened_at":"2025-06-26T02:24:48.509287","updated_at":"2025-06-26T02:24:48.509287","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:24:48,516 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity fe1cca7d-9bb1-48d5-9152-024cbcbc6394: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('956ab17d-62a3-435e-8f84-5665cf20a571'), 'd74dd527-f8df-486a-8963-0cd0ef2d9605', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:24:48.509287', '2025-06-26 02:24:48.509287', None, '{"id":"956ab17d-62a3-435e-8f84-5665cf20a571","user_id":"d74dd527-f8df-486a-8963-0cd0ef2d9605","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1199 characters truncated) ... ts":[],"created_at":"2025-06-26T02:24:48.509287","opened_at":"2025-06-26T02:24:48.509287","updated_at":"2025-06-26T02:24:48.509287","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:24:48,519 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity fe1cca7d-9bb1-48d5-9152-024cbcbc6394 status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:24:48,520 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:541 - Failed to persist status update for opportunity fe1cca7d-9bb1-48d5-9152-024cbcbc6394: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('956ab17d-62a3-435e-8f84-5665cf20a571'), 'd74dd527-f8df-486a-8963-0cd0ef2d9605', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:24:48.509287', '2025-06-26 02:24:48.509287', None, '{"id":"956ab17d-62a3-435e-8f84-5665cf20a571","user_id":"d74dd527-f8df-486a-8963-0cd0ef2d9605","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1199 characters truncated) ... ts":[],"created_at":"2025-06-26T02:24:48.509287","opened_at":"2025-06-26T02:24:48.509287","updated_at":"2025-06-26T02:24:48.509287","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 534, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('956ab17d-62a3-435e-8f84-5665cf20a571'), 'd74dd527-f8df-486a-8963-0cd0ef2d9605', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:24:48.509287', '2025-06-26 02:24:48.509287', None, '{"id":"956ab17d-62a3-435e-8f84-5665cf20a571","user_id":"d74dd527-f8df-486a-8963-0cd0ef2d9605","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1199 characters truncated) ... ts":[],"created_at":"2025-06-26T02:24:48.509287","opened_at":"2025-06-26T02:24:48.509287","updated_at":"2025-06-26T02:24:48.509287","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:24:48,530 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:24:48,531 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:24:48,539 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:24:48,540 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:24:48,547 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:24:48,547 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:24:48,550 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:24:48,551 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 16a83cc0-7f75-4a38-8bb3-ce604eed0076
2025-06-25 22:24:48,555 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id a9251a70-0450-4a00-8fe8-cbfb8337d927. Creando y guardando configuración por defecto.
2025-06-25 22:24:48,558 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:24:48,561 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for a9251a70-0450-4a00-8fe8-cbfb8337d927. Using default values.
2025-06-25 22:24:48,561 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for a9251a70-0450-4a00-8fe8-cbfb8337d927 with capital: 10000.0
2025-06-25 22:24:48,562 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:24:48,563 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:24:48,563 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:24:48,563 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity 16a83cc0-7f75-4a38-8bb3-ce604eed0076
2025-06-25 22:24:48,564 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 03d5e758-0054-440c-9cdd-bba18e8a528b from decision 5bf397d3-5dfb-4bc9-aad6-61cb446f8131
2025-06-25 22:24:48,564 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 03d5e758-0054-440c-9cdd-bba18e8a528b from confirmed opportunity.
2025-06-25 22:24:48,565 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:24:48,566 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:317 - Failed to create OCO order for trade 03d5e758-0054-440c-9cdd-bba18e8a528b: PENDING
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 296, in execute_trade_from_confirmed_opportunity
    oco_order_result = await self.unified_order_execution_service.create_oco_order(
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2248, in _execute_mock_call
    result = await effect(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\tests\conftest.py", line 683, in mock_create_oco_order
    status=OrderStatus.PENDING.value,
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\enum.py", line 784, in __getattr__
    raise AttributeError(name) from None
AttributeError: PENDING
2025-06-25 22:24:48,567 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario a9251a70-0450-4a00-8fe8-cbfb8337d927: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:24:48,569 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('03d5e758-0054-440c-9cdd-bba18e8a528b'), '9bff321d-3555-4af3-b148-202865dad6a6', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:24:48.564860', '2025-06-26 02:24:48.564860', None, '{"id":"03d5e758-0054-440c-9cdd-bba18e8a528b","user_id":"9bff321d-3555-4af3-b148-202865dad6a6","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1200 characters truncated) ... ts":[],"created_at":"2025-06-26T02:24:48.564860","opened_at":"2025-06-26T02:24:48.564860","updated_at":"2025-06-26T02:24:48.564860","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('03d5e758-0054-440c-9cdd-bba18e8a528b'), '9bff321d-3555-4af3-b148-202865dad6a6', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:24:48.564860', '2025-06-26 02:24:48.564860', None, '{"id":"03d5e758-0054-440c-9cdd-bba18e8a528b","user_id":"9bff321d-3555-4af3-b148-202865dad6a6","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1200 characters truncated) ... ts":[],"created_at":"2025-06-26T02:24:48.564860","opened_at":"2025-06-26T02:24:48.564860","updated_at":"2025-06-26T02:24:48.564860","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:24:48,571 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 16a83cc0-7f75-4a38-8bb3-ce604eed0076: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('03d5e758-0054-440c-9cdd-bba18e8a528b'), '9bff321d-3555-4af3-b148-202865dad6a6', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:24:48.564860', '2025-06-26 02:24:48.564860', None, '{"id":"03d5e758-0054-440c-9cdd-bba18e8a528b","user_id":"9bff321d-3555-4af3-b148-202865dad6a6","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1200 characters truncated) ... ts":[],"created_at":"2025-06-26T02:24:48.564860","opened_at":"2025-06-26T02:24:48.564860","updated_at":"2025-06-26T02:24:48.564860","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:24:48,574 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 16a83cc0-7f75-4a38-8bb3-ce604eed0076 status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:24:48,574 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:541 - Failed to persist status update for opportunity 16a83cc0-7f75-4a38-8bb3-ce604eed0076: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('03d5e758-0054-440c-9cdd-bba18e8a528b'), '9bff321d-3555-4af3-b148-202865dad6a6', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:24:48.564860', '2025-06-26 02:24:48.564860', None, '{"id":"03d5e758-0054-440c-9cdd-bba18e8a528b","user_id":"9bff321d-3555-4af3-b148-202865dad6a6","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1200 characters truncated) ... ts":[],"created_at":"2025-06-26T02:24:48.564860","opened_at":"2025-06-26T02:24:48.564860","updated_at":"2025-06-26T02:24:48.564860","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 534, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('03d5e758-0054-440c-9cdd-bba18e8a528b'), '9bff321d-3555-4af3-b148-202865dad6a6', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:24:48.564860', '2025-06-26 02:24:48.564860', None, '{"id":"03d5e758-0054-440c-9cdd-bba18e8a528b","user_id":"9bff321d-3555-4af3-b148-202865dad6a6","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1200 characters truncated) ... ts":[],"created_at":"2025-06-26T02:24:48.564860","opened_at":"2025-06-26T02:24:48.564860","updated_at":"2025-06-26T02:24:48.564860","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:24:48,584 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:24:48,585 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:24:48,593 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:24:48,594 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:24:48,600 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:24:48,600 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:24:48,603 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:24:48,605 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity f62f6d26-2e5a-4edf-9e9d-f459014e34f1
2025-06-25 22:24:48,608 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 87a46c78-24a5-4419-9e8d-322bee348d22. Creando y guardando configuración por defecto.
2025-06-25 22:24:48,611 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:24:48,613 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 87a46c78-24a5-4419-9e8d-322bee348d22. Using default values.
2025-06-25 22:24:48,614 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 87a46c78-24a5-4419-9e8d-322bee348d22 with capital: 10000.0
2025-06-25 22:24:48,615 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:24:48,615 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:24:48,616 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:24:48,616 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Day Trading Strategy' as context for confirmed opportunity f62f6d26-2e5a-4edf-9e9d-f459014e34f1
2025-06-25 22:24:48,616 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade edeb4709-cc59-4036-ad12-d27d69f22fa5 from decision eb018886-4c97-4a36-8bfc-068e049068a3
2025-06-25 22:24:48,617 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade edeb4709-cc59-4036-ad12-d27d69f22fa5 from confirmed opportunity.
2025-06-25 22:24:48,618 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:24:48,618 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:317 - Failed to create OCO order for trade edeb4709-cc59-4036-ad12-d27d69f22fa5: PENDING
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 296, in execute_trade_from_confirmed_opportunity
    oco_order_result = await self.unified_order_execution_service.create_oco_order(
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2248, in _execute_mock_call
    result = await effect(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\tests\conftest.py", line 683, in mock_create_oco_order
    status=OrderStatus.PENDING.value,
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\enum.py", line 784, in __getattr__
    raise AttributeError(name) from None
AttributeError: PENDING
2025-06-25 22:24:48,619 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 87a46c78-24a5-4419-9e8d-322bee348d22: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:24:48,622 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('edeb4709-cc59-4036-ad12-d27d69f22fa5'), 'acf1b1e2-7b09-4048-b8d0-1b00fee9b8b5', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:24:48.616277', '2025-06-26 02:24:48.616277', None, '{"id":"edeb4709-cc59-4036-ad12-d27d69f22fa5","user_id":"acf1b1e2-7b09-4048-b8d0-1b00fee9b8b5","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1199 characters truncated) ... ts":[],"created_at":"2025-06-26T02:24:48.616277","opened_at":"2025-06-26T02:24:48.616277","updated_at":"2025-06-26T02:24:48.616277","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('edeb4709-cc59-4036-ad12-d27d69f22fa5'), 'acf1b1e2-7b09-4048-b8d0-1b00fee9b8b5', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:24:48.616277', '2025-06-26 02:24:48.616277', None, '{"id":"edeb4709-cc59-4036-ad12-d27d69f22fa5","user_id":"acf1b1e2-7b09-4048-b8d0-1b00fee9b8b5","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1199 characters truncated) ... ts":[],"created_at":"2025-06-26T02:24:48.616277","opened_at":"2025-06-26T02:24:48.616277","updated_at":"2025-06-26T02:24:48.616277","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:24:48,623 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity f62f6d26-2e5a-4edf-9e9d-f459014e34f1: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('edeb4709-cc59-4036-ad12-d27d69f22fa5'), 'acf1b1e2-7b09-4048-b8d0-1b00fee9b8b5', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:24:48.616277', '2025-06-26 02:24:48.616277', None, '{"id":"edeb4709-cc59-4036-ad12-d27d69f22fa5","user_id":"acf1b1e2-7b09-4048-b8d0-1b00fee9b8b5","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1199 characters truncated) ... ts":[],"created_at":"2025-06-26T02:24:48.616277","opened_at":"2025-06-26T02:24:48.616277","updated_at":"2025-06-26T02:24:48.616277","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:24:48,626 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity f62f6d26-2e5a-4edf-9e9d-f459014e34f1 status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:24:48,626 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:541 - Failed to persist status update for opportunity f62f6d26-2e5a-4edf-9e9d-f459014e34f1: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('edeb4709-cc59-4036-ad12-d27d69f22fa5'), 'acf1b1e2-7b09-4048-b8d0-1b00fee9b8b5', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:24:48.616277', '2025-06-26 02:24:48.616277', None, '{"id":"edeb4709-cc59-4036-ad12-d27d69f22fa5","user_id":"acf1b1e2-7b09-4048-b8d0-1b00fee9b8b5","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1199 characters truncated) ... ts":[],"created_at":"2025-06-26T02:24:48.616277","opened_at":"2025-06-26T02:24:48.616277","updated_at":"2025-06-26T02:24:48.616277","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 534, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('edeb4709-cc59-4036-ad12-d27d69f22fa5'), 'acf1b1e2-7b09-4048-b8d0-1b00fee9b8b5', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:24:48.616277', '2025-06-26 02:24:48.616277', None, '{"id":"edeb4709-cc59-4036-ad12-d27d69f22fa5","user_id":"acf1b1e2-7b09-4048-b8d0-1b00fee9b8b5","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1199 characters truncated) ... ts":[],"created_at":"2025-06-26T02:24:48.616277","opened_at":"2025-06-26T02:24:48.616277","updated_at":"2025-06-26T02:24:48.616277","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:24:48,636 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:24:48,637 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:24:48,646 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:24:48,646 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:24:48,653 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:24:48,653 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:24:48,656 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:24:48,658 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade bb4ed4ab-ad5e-4558-9082-ed0a361e047e from decision bc2ed473-8cb7-418c-8e93-84814e389ea4
2025-06-25 22:24:48,659 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:24:48,660 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:24:48,667 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:24:48,667 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:24:48,674 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:24:48,675 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:24:48,676 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:24:48,679 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 71acbf17-cb4b-49b5-953e-e81be8819eed from decision c30358e2-775c-40e3-a5fb-e1bfdc864c33
2025-06-25 22:24:48,680 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:24:48,681 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:24:48,689 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:24:48,689 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:24:48,697 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:24:48,697 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:24:48,700 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:24:48,701 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:24:48,703 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:24:50,632 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:24:50,633 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:24:50,639 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:24:50,641 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:24:50,643 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:24:50,650 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:24:50,653 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:24:50,655 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:24:50,661 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:24:50,668 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:24:50,674 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:24:50,680 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:24:50,681 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:24:50,684 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:24:50,685 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:24:50,686 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:24:50,690 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:24:50,691 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:24:50,698 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:24:50,698 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:24:50,705 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:24:50,706 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:24:50,710 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:24:50,713 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:24:50,713 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:24:50,716 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:286 - Verificación de Binance BINANCE_SPOT exitosa.
2025-06-25 22:24:50,722 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:24:50,722 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:24:50,725 - ultibot_backend.services.credential_service - ERROR - [MainThread] - credential_service.py:315 - Error de Binance API durante la verificación: Binance Down
2025-06-25 22:24:50,729 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:24:50,729 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:24:50,732 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:24:50,736 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:24:50,738 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:24:50,742 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:241 - Verificación de Telegram exitosa.
2025-06-25 22:24:50,749 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:72 - Conexión con Binance exitosa.
2025-06-25 22:24:50,753 - ultibot_backend.services.market_data_service - WARNING - [MainThread] - market_data_service.py:52 - Credenciales de Binance no encontradas. Por favor, configúrelas.
2025-06-25 22:24:50,759 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:69 - Fallo en la verificación de conexión con Binance. Revise sus credenciales y permisos.
2025-06-25 22:24:50,764 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:77 - Error al acceder a las credenciales de Binance: Decryption failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 45, in get_binance_connection_status
    binance_credential = await self.credential_service.get_credential(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.CredentialError: Decryption failed
2025-06-25 22:24:50,770 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:81 - Error de la API de Binance: API unavailable
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 61, in get_binance_connection_status
    is_connected = await self.credential_service.verify_credential(binance_credential)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.BinanceAPIError: API unavailable
2025-06-25 22:24:50,778 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:24:50,787 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:121 - Error de la API de Binance al obtener balances: Failed to fetch balances
2025-06-25 22:24:50,792 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2467002984144'>
2025-06-25 22:24:50,794 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 9cb6a373-354e-4a03-89e2-3ac9988cca83, mode_filter: None
2025-06-25 22:24:50,794 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2467002984144'>
2025-06-25 22:24:50,794 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 9cb6a373-354e-4a03-89e2-3ac9988cca83 with mode_filter: None
2025-06-25 22:24:50,798 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2467003064272'>
2025-06-25 22:24:50,798 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 9cb6a373-354e-4a03-89e2-3ac9988cca83, mode_filter: None
2025-06-25 22:24:50,799 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2467003064272'>
2025-06-25 22:24:50,799 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 9cb6a373-354e-4a03-89e2-3ac9988cca83 with mode_filter: None
2025-06-25 22:24:50,802 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2467002995216'>
2025-06-25 22:24:50,804 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 9cb6a373-354e-4a03-89e2-3ac9988cca83, mode_filter: OperatingMode.PAPER
2025-06-25 22:24:50,804 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2467002995216'>
2025-06-25 22:24:50,805 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 9cb6a373-354e-4a03-89e2-3ac9988cca83
2025-06-25 22:24:50,809 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2467003081552'>
2025-06-25 22:24:50,811 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 9cb6a373-354e-4a03-89e2-3ac9988cca83, mode_filter: OperatingMode.PAPER
2025-06-25 22:24:50,811 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2467003081552'>
2025-06-25 22:24:50,811 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 9cb6a373-354e-4a03-89e2-3ac9988cca83
2025-06-25 22:24:50,815 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2467003096144'>
2025-06-25 22:24:50,816 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 9cb6a373-354e-4a03-89e2-3ac9988cca83, mode_filter: OperatingMode.REAL
2025-06-25 22:24:50,816 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2467003096144'>
2025-06-25 22:24:50,816 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 9cb6a373-354e-4a03-89e2-3ac9988cca83
2025-06-25 22:24:50,819 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2467001489744'>
2025-06-25 22:24:50,821 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 9cb6a373-354e-4a03-89e2-3ac9988cca83, mode_filter: OperatingMode.PAPER
2025-06-25 22:24:50,822 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2467001489744'>
2025-06-25 22:24:50,822 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 9cb6a373-354e-4a03-89e2-3ac9988cca83
2025-06-25 22:24:50,826 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2467003265936'>
2025-06-25 22:24:50,828 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 9cb6a373-354e-4a03-89e2-3ac9988cca83, mode_filter: None
2025-06-25 22:24:50,828 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2467003265936'>
2025-06-25 22:24:50,828 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 2 performance entries for user 9cb6a373-354e-4a03-89e2-3ac9988cca83
2025-06-25 22:24:50,831 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2467003267344'>
2025-06-25 22:24:50,833 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 9cb6a373-354e-4a03-89e2-3ac9988cca83, mode_filter: OperatingMode.PAPER
2025-06-25 22:24:50,833 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2467003267344'>
2025-06-25 22:24:50,833 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 9cb6a373-354e-4a03-89e2-3ac9988cca83
2025-06-25 22:24:50,836 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2467009364688'>
2025-06-25 22:24:50,838 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 9cb6a373-354e-4a03-89e2-3ac9988cca83, mode_filter: OperatingMode.PAPER
2025-06-25 22:24:50,838 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2467009364688'>
2025-06-25 22:24:50,838 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 9cb6a373-354e-4a03-89e2-3ac9988cca83 with mode_filter: OperatingMode.PAPER
2025-06-25 22:24:50,841 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2467001843792'>
2025-06-25 22:24:50,843 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 9cb6a373-354e-4a03-89e2-3ac9988cca83, mode_filter: OperatingMode.PAPER
2025-06-25 22:24:50,843 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2467001843792'>
2025-06-25 22:24:50,843 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 9cb6a373-354e-4a03-89e2-3ac9988cca83 with mode_filter: OperatingMode.PAPER
2025-06-25 22:24:50,846 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2466977808464'>
2025-06-25 22:24:50,847 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 9cb6a373-354e-4a03-89e2-3ac9988cca83, mode_filter: OperatingMode.PAPER
2025-06-25 22:24:50,847 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2466977808464'>
2025-06-25 22:24:50,849 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 9cb6a373-354e-4a03-89e2-3ac9988cca83
2025-06-25 22:24:50,852 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2467001311760'>
2025-06-25 22:24:50,853 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 9cb6a373-354e-4a03-89e2-3ac9988cca83, mode_filter: OperatingMode.PAPER
2025-06-25 22:24:50,854 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2467001311760'>
2025-06-25 22:24:50,855 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 9cb6a373-354e-4a03-89e2-3ac9988cca83
2025-06-25 22:24:50,859 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2466977814544'>
2025-06-25 22:24:50,861 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 9cb6a373-354e-4a03-89e2-3ac9988cca83, mode_filter: OperatingMode.PAPER
2025-06-25 22:24:50,861 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2466977814544'>
2025-06-25 22:24:50,862 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 9cb6a373-354e-4a03-89e2-3ac9988cca83
2025-06-25 22:24:50,865 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2467001580240'>
2025-06-25 22:24:50,866 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 9cb6a373-354e-4a03-89e2-3ac9988cca83, mode_filter: OperatingMode.PAPER
2025-06-25 22:24:50,866 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2467001580240'>
2025-06-25 22:24:50,867 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 9cb6a373-354e-4a03-89e2-3ac9988cca83
2025-06-25 22:24:50,917 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 883ebbb5-2f79-4394-b010-c393fb02b4c6 en modo paper
2025-06-25 22:24:50,923 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 0c8f6a5b-dc31-481e-bf4a-8581d27dc939 en modo paper
2025-06-25 22:24:50,928 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario c8322327-f2aa-4313-9e52-b6b876a25f3c en modo paper
2025-06-25 22:24:50,933 - ultibot_backend.services.trading_report_service - ERROR - [MainThread] - trading_report_service.py:79 - Error al obtener trades cerrados para usuario d2cc4ad9-f16e-48ed-8ec5-3d76e7571003: Database connection failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_report_service.py", line 65, in get_closed_trades
    trades = await persistence_service.get_closed_trades(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
Exception: Database connection failed
2025-06-25 22:24:50,942 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity ff1801b1-c7a4-4e7c-8f1c-f09519495e39 for symbol BTC/USDT
2025-06-25 22:24:50,943 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 9d6bcefd-9b42-4d6d-ab7a-8b1556426c0f can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:24:50,943 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity ff1801b1-c7a4-4e7c-8f1c-f09519495e39 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:24:50,944 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity ff1801b1-c7a4-4e7c-8f1c-f09519495e39
2025-06-25 22:24:50,955 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 371d3f92-9475-490f-ac65-285737f73aa5 for symbol BTC/USDT
2025-06-25 22:24:50,956 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 4d0c218f-c64a-42e7-b5f6-52eaed4d8353 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:24:50,956 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 371d3f92-9475-490f-ac65-285737f73aa5 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:24:50,957 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 371d3f92-9475-490f-ac65-285737f73aa5
2025-06-25 22:24:50,967 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 9642e7e5-4e44-4fb0-b497-7698528f3f30 for symbol BTC/USDT
2025-06-25 22:24:50,968 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy fcb4312f-ebec-42ff-82e5-ed97883abdf3 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:24:50,969 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 9642e7e5-4e44-4fb0-b497-7698528f3f30 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:24:50,970 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 9642e7e5-4e44-4fb0-b497-7698528f3f30
2025-06-25 22:24:50,978 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 3d11a224-a847-4379-80c8-0f6a4a1cbd1d for symbol BTC/USDT
2025-06-25 22:24:50,980 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 48be8621-ce50-48c8-bd51-4485d0072b86 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:24:50,980 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 3d11a224-a847-4379-80c8-0f6a4a1cbd1d status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:24:50,981 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 3d11a224-a847-4379-80c8-0f6a4a1cbd1d
2025-06-25 22:24:50,993 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity fb2b7e85-e831-4943-8814-04e101ae5939 for symbol BTC/USDT
2025-06-25 22:24:50,994 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:639 - Unknown strategy type 'CUSTOM_UNKNOWN_TYPE' for strategy 1644d3b0-f0a4-4747-a27d-220a6be0eeef. Recommending investigation.
2025-06-25 22:24:50,994 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity fb2b7e85-e831-4943-8814-04e101ae5939 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:24:50,995 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity fb2b7e85-e831-4943-8814-04e101ae5939
2025-06-25 22:24:51,005 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity eabdfcb0-968a-4963-b9d6-ac56c713f5b2 for symbol BTC/USDT
2025-06-25 22:24:51,008 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy e4746d32-2f95-454c-9f42-062ce00f0db3 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:24:51,008 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity eabdfcb0-968a-4963-b9d6-ac56c713f5b2 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:24:51,009 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity eabdfcb0-968a-4963-b9d6-ac56c713f5b2
2025-06-25 22:24:51,041 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity f62f9076-b016-4f9e-a76a-e92b6b540f40 for symbol BTC/USDT
2025-06-25 22:24:51,044 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy c0c07afd-6b51-4503-99ad-4b41e622bc58 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:24:51,044 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity f62f9076-b016-4f9e-a76a-e92b6b540f40 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:24:51,046 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity f62f9076-b016-4f9e-a76a-e92b6b540f40
2025-06-25 22:26:07,269 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:26:07,269 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:26:07,286 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:26:07,288 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:26:07,449 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:26:07,449 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:26:07,467 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:26:07,467 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:26:08,184 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:26:08,185 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:26:08,205 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:26:08,220 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:26:08,222 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:26:08,225 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:26:08,226 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:26:08,234 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:26:08,234 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:26:08,254 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:26:08,257 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:26:08,258 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:26:08,267 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:26:08,267 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:26:08,285 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:26:08,287 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:26:08,289 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:26:08,296 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:26:08,296 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:26:08,316 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:26:08,319 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:26:08,320 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:26:08,329 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:26:08,329 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:26:08,348 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:26:08,350 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:26:08,352 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:26:08,359 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:26:08,359 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:26:08,378 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:26:08,379 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:26:08,379 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:26:08,380 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:26:08,380 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:26:08,380 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:26:08,400 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:26:08,582 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:26:08,583 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:26:08,763 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:26:08,763 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:26:08,764 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:26:08,764 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:26:08,781 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:26:08,781 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001CA583418D0>
2025-06-25 22:26:08,781 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:26:08,781 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:26:08,782 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 422
2025-06-25 22:26:08,791 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:26:08,791 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:26:08,902 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:26:08,903 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:26:08,904 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:26:08,904 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:26:09,083 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:26:09,083 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:26:09,269 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:26:09,270 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:26:09,270 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:26:09,271 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:26:09,275 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:26:09,276 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001CA583315D0>
2025-06-25 22:26:09,276 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:26:09,276 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:26:09,287 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:26:09,296 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:26:09,296 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:26:09,306 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:26:09,306 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:26:09,326 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:26:09,328 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:26:09,328 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:26:09,328 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:26:09,512 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:26:09,513 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:26:09,692 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:26:09,693 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:26:09,693 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:26:09,693 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:26:09,697 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:26:09,698 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001CA58395350>
2025-06-25 22:26:09,698 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:26:09,698 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:26:09,702 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:26:09,710 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:26:09,711 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:26:09,712 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:26:09,716 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:26:09,718 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:26:09,718 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:26:09,719 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:26:09,728 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:26:09,728 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:26:09,747 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:26:09,748 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:26:09,749 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:26:09,749 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:26:09,932 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:26:09,933 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:26:10,116 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:26:10,116 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:26:10,116 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:26:10,118 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:26:10,121 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:26:10,121 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001CA580115D0>
2025-06-25 22:26:10,121 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:26:10,122 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:26:10,125 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:26:10,133 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:26:10,133 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:26:10,134 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:26:10,139 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:26:10,140 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:26:10,149 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:26:10,149 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:26:10,167 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:26:10,169 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:26:10,170 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:26:10,170 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:26:10,362 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:26:10,363 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:26:10,549 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:26:10,549 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:26:10,550 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:26:10,550 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:26:10,554 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:26:10,555 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001CA584ADB10>
2025-06-25 22:26:10,556 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:26:10,556 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:26:10,560 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:26:10,568 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:26:10,568 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:26:10,569 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:26:10,577 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:26:10,578 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:26:10,586 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:26:10,586 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:26:10,605 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:26:10,606 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:26:10,607 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:26:10,607 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:26:10,786 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:26:10,786 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:26:10,966 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:26:10,966 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:26:10,968 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:26:10,968 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:26:10,971 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:26:10,971 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001CA580119D0>
2025-06-25 22:26:10,971 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:26:10,971 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:26:10,972 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 422
2025-06-25 22:26:10,992 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity b7835881-735f-4429-ae33-85113d69f0c3
2025-06-25 22:26:10,993 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:152 - User configuration saved after initializing last_daily_reset for user 8357f0bf-033d-4726-a85c-9ced16cd42be.
2025-06-25 22:26:10,993 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 200.000
2025-06-25 22:26:10,994 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity b7835881-735f-4429-ae33-85113d69f0c3
2025-06-25 22:26:10,994 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 674de6a1-9d8c-4c10-90b1-80156635d82b from decision 09d8dc5f-ef63-460d-8307-052bb2317b4f
2025-06-25 22:26:10,994 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 674de6a1-9d8c-4c10-90b1-80156635d82b from confirmed opportunity.
2025-06-25 22:26:10,995 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:26:10,996 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:310 - Successfully created OCO order for trade 674de6a1-9d8c-4c10-90b1-80156635d82b. OCO List ID: oco_list_123
2025-06-25 22:26:10,996 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 8357f0bf-033d-4726-a85c-9ced16cd42be: 200.0000000000000000000000000 (anterior: 0.0, valor trade: 200.0000000000000000000000000)
2025-06-25 22:26:10,998 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user 8357f0bf-033d-4726-a85c-9ced16cd42be to 200.0000000000000000000000000.
2025-06-25 22:26:10,998 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity b7835881-735f-4429-ae33-85113d69f0c3 status to converted_to_trade_real: Trade 674de6a1-9d8c-4c10-90b1-80156635d82b executed based on user confirmation.
2025-06-25 22:26:10,999 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity b7835881-735f-4429-ae33-85113d69f0c3
2025-06-25 22:26:11,008 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 11764880-e0cc-4219-b1db-26093befa4d0
2025-06-25 22:26:11,008 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 4800.0, Riesgo Potencial Trade USD: 300.000
2025-06-25 22:26:11,009 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:191 - Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:26:11,009 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 11764880-e0cc-4219-b1db-26093befa4d0 status to error_in_processing: Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:26:11,010 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 11764880-e0cc-4219-b1db-26093befa4d0
2025-06-25 22:26:11,025 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 67199fc9-91a6-430a-8ab1-7525ffa7a06d
2025-06-25 22:26:11,025 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:143 - Daily capital reset triggered for user 5a67cc85-471e-4399-9b16-6405dce4ac38. Resetting daily_capital_risked_usd.
2025-06-25 22:26:11,026 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:147 - User configuration saved after daily capital reset for user 5a67cc85-471e-4399-9b16-6405dce4ac38.
2025-06-25 22:26:11,026 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 2500.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 100.000
2025-06-25 22:26:11,026 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity 67199fc9-91a6-430a-8ab1-7525ffa7a06d
2025-06-25 22:26:11,026 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade d0c31c9b-9ab9-4366-9de3-3c54346c1b21 from decision b232e072-a818-44c2-87de-c2535a74415e
2025-06-25 22:26:11,027 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade d0c31c9b-9ab9-4366-9de3-3c54346c1b21 from confirmed opportunity.
2025-06-25 22:26:11,028 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:26:11,028 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:310 - Successfully created OCO order for trade d0c31c9b-9ab9-4366-9de3-3c54346c1b21. OCO List ID: oco_reset_test
2025-06-25 22:26:11,029 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 5a67cc85-471e-4399-9b16-6405dce4ac38: 100.000 (anterior: 0.0, valor trade: 100.000)
2025-06-25 22:26:11,029 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user 5a67cc85-471e-4399-9b16-6405dce4ac38 to 100.000.
2025-06-25 22:26:11,030 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 67199fc9-91a6-430a-8ab1-7525ffa7a06d status to converted_to_trade_real: Trade d0c31c9b-9ab9-4366-9de3-3c54346c1b21 executed based on user confirmation.
2025-06-25 22:26:11,030 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 67199fc9-91a6-430a-8ab1-7525ffa7a06d
2025-06-25 22:26:12,376 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity c1ee9945-6444-4f3d-9540-9398dbae7595 for symbol BTCUSDT
2025-06-25 22:26:12,376 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 6a0a82c7-00b7-4620-804c-338de4f86f68
2025-06-25 22:26:12,378 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 75ff2a02-10ff-4c75-9189-92dab0868e29 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:26:12,386 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity bf4174ba-cb98-4411-9177-f3ca27071c13 for symbol BTCUSDT
2025-06-25 22:26:12,387 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy ed3f8515-1b61-4012-bb50-36413049665f can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:26:12,394 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 0bcee49e-c646-4cb3-b0fc-926510fa875f for symbol ETHUSDT
2025-06-25 22:26:12,395 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 579975fc-e1b1-42c5-95b5-48e48786a5a7
2025-06-25 22:26:12,396 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:590 - No active and applicable strategies found for opportunity 0bcee49e-c646-4cb3-b0fc-926510fa875f with symbol ETHUSDT.
2025-06-25 22:26:12,396 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 0bcee49e-c646-4cb3-b0fc-926510fa875f status to rejected_by_system: No active strategies are applicable to this opportunity's symbol.
2025-06-25 22:26:12,398 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 0bcee49e-c646-4cb3-b0fc-926510fa875f
2025-06-25 22:26:12,405 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 8229368c-372c-42ee-98c7-4c9a8ff28c70 for symbol BTCUSDT
2025-06-25 22:26:12,406 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 805a97cf-e401-4723-8293-3076b2554a7e
2025-06-25 22:26:12,406 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:703 - AI confidence 0.65 for strategy 18c95432-f7b9-4d3c-820d-0e5695e0fa78 is below threshold 0.8.
2025-06-25 22:26:12,408 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:718 - Strategy 18c95432-f7b9-4d3c-820d-0e5695e0fa78 did not produce a decision for opportunity 8229368c-372c-42ee-98c7-4c9a8ff28c70.
2025-06-25 22:26:12,409 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:609 - No affirmative trading decisions made for opportunity 8229368c-372c-42ee-98c7-4c9a8ff28c70.
2025-06-25 22:26:12,418 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 2878ce67-ef04-42a2-b956-1985fe88f596 for symbol BTCUSDT
2025-06-25 22:26:12,418 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 888804d7-492b-425a-b3c2-1d116519744c
2025-06-25 22:26:12,428 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 89594d9a-0234-47aa-8d33-473372803f32 for symbol BTCUSDT
2025-06-25 22:26:12,429 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 6cb5c14c-6e66-4e2c-87d3-9fc461974116
2025-06-25 22:26:12,435 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 89c11520-9a70-47b6-921e-7c3c87c15383 from decision 4e4496bd-37fe-407e-ac9f-3dd1793caf86
2025-06-25 22:26:12,440 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 69d81011-4c62-4daa-ac1a-a29416ef5cab from decision 8ad24110-4e76-4b2d-b7ce-96c0d217c08b
2025-06-25 22:26:12,441 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade dbf44739-4802-488f-be1b-87384f7dbff6 from decision 8ad24110-4e76-4b2d-b7ce-96c0d217c08b
2025-06-25 22:26:12,448 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:26:12,448 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:26:12,459 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:26:12,459 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:26:12,462 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:26:12,464 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 93fd5a41-6ad7-4278-951b-f111e74f0eac
2025-06-25 22:26:12,467 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 892d7027-23f7-4aa6-9b37-6c8ecf626451. Creando y guardando configuración por defecto.
2025-06-25 22:26:12,470 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:26:12,473 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 892d7027-23f7-4aa6-9b37-6c8ecf626451. Using default values.
2025-06-25 22:26:12,475 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 892d7027-23f7-4aa6-9b37-6c8ecf626451 with capital: 10000.0
2025-06-25 22:26:12,476 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:26:12,476 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:26:12,476 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:26:12,476 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity 93fd5a41-6ad7-4278-951b-f111e74f0eac
2025-06-25 22:26:12,478 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade e09ed5eb-4ba2-4ad0-bdc4-ef83c8e8f292 from decision 26f9c943-b7b5-4abd-bcbf-56d3879df3a6
2025-06-25 22:26:12,478 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade e09ed5eb-4ba2-4ad0-bdc4-ef83c8e8f292 from confirmed opportunity.
2025-06-25 22:26:12,479 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:26:12,480 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:317 - Failed to create OCO order for trade e09ed5eb-4ba2-4ad0-bdc4-ef83c8e8f292: PENDING
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 296, in execute_trade_from_confirmed_opportunity
    oco_order_result = await self.unified_order_execution_service.create_oco_order(
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2248, in _execute_mock_call
    result = await effect(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\tests\conftest.py", line 684, in mock_create_oco_order
    status=OrderStatus.PENDING.value,
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\enum.py", line 784, in __getattr__
    raise AttributeError(name) from None
AttributeError: PENDING
2025-06-25 22:26:12,481 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 892d7027-23f7-4aa6-9b37-6c8ecf626451: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:26:12,485 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('e09ed5eb-4ba2-4ad0-bdc4-ef83c8e8f292'), '51288add-4a54-4d05-834d-4c7bed6e3762', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:26:12.478278', '2025-06-26 02:26:12.478278', None, '{"id":"e09ed5eb-4ba2-4ad0-bdc4-ef83c8e8f292","user_id":"51288add-4a54-4d05-834d-4c7bed6e3762","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1201 characters truncated) ... ts":[],"created_at":"2025-06-26T02:26:12.478278","opened_at":"2025-06-26T02:26:12.478278","updated_at":"2025-06-26T02:26:12.478278","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('e09ed5eb-4ba2-4ad0-bdc4-ef83c8e8f292'), '51288add-4a54-4d05-834d-4c7bed6e3762', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:26:12.478278', '2025-06-26 02:26:12.478278', None, '{"id":"e09ed5eb-4ba2-4ad0-bdc4-ef83c8e8f292","user_id":"51288add-4a54-4d05-834d-4c7bed6e3762","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1201 characters truncated) ... ts":[],"created_at":"2025-06-26T02:26:12.478278","opened_at":"2025-06-26T02:26:12.478278","updated_at":"2025-06-26T02:26:12.478278","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:26:12,488 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 93fd5a41-6ad7-4278-951b-f111e74f0eac: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('e09ed5eb-4ba2-4ad0-bdc4-ef83c8e8f292'), '51288add-4a54-4d05-834d-4c7bed6e3762', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:26:12.478278', '2025-06-26 02:26:12.478278', None, '{"id":"e09ed5eb-4ba2-4ad0-bdc4-ef83c8e8f292","user_id":"51288add-4a54-4d05-834d-4c7bed6e3762","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1201 characters truncated) ... ts":[],"created_at":"2025-06-26T02:26:12.478278","opened_at":"2025-06-26T02:26:12.478278","updated_at":"2025-06-26T02:26:12.478278","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:26:12,491 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 93fd5a41-6ad7-4278-951b-f111e74f0eac status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:26:12,492 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:541 - Failed to persist status update for opportunity 93fd5a41-6ad7-4278-951b-f111e74f0eac: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('e09ed5eb-4ba2-4ad0-bdc4-ef83c8e8f292'), '51288add-4a54-4d05-834d-4c7bed6e3762', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:26:12.478278', '2025-06-26 02:26:12.478278', None, '{"id":"e09ed5eb-4ba2-4ad0-bdc4-ef83c8e8f292","user_id":"51288add-4a54-4d05-834d-4c7bed6e3762","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1201 characters truncated) ... ts":[],"created_at":"2025-06-26T02:26:12.478278","opened_at":"2025-06-26T02:26:12.478278","updated_at":"2025-06-26T02:26:12.478278","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 534, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('e09ed5eb-4ba2-4ad0-bdc4-ef83c8e8f292'), '51288add-4a54-4d05-834d-4c7bed6e3762', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:26:12.478278', '2025-06-26 02:26:12.478278', None, '{"id":"e09ed5eb-4ba2-4ad0-bdc4-ef83c8e8f292","user_id":"51288add-4a54-4d05-834d-4c7bed6e3762","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1201 characters truncated) ... ts":[],"created_at":"2025-06-26T02:26:12.478278","opened_at":"2025-06-26T02:26:12.478278","updated_at":"2025-06-26T02:26:12.478278","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:26:12,505 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:26:12,506 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:26:12,514 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:26:12,515 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:26:12,524 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:26:12,524 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:26:12,526 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:26:12,529 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:26:12,530 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:26:12,538 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:26:12,538 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:26:12,546 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:26:12,547 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:26:12,551 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:26:12,553 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity a8b9e60e-1e66-4af3-b4da-244df85c5b03 for symbol BTC/USDT
2025-06-25 22:26:12,556 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id f256d103-a927-4bb2-861d-5671f7cc75c6. Creando y guardando configuración por defecto.
2025-06-25 22:26:12,559 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:26:12,561 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:658 - AI profile 'ai-profile-scalping-1' for strategy 2a0cf779-272b-4fc8-857e-3c6eb7566337 not found. Skipping AI analysis.
2025-06-25 22:26:12,561 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 2a0cf779-272b-4fc8-857e-3c6eb7566337 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:26:12,561 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity a8b9e60e-1e66-4af3-b4da-244df85c5b03 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:26:12,569 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity a8b9e60e-1e66-4af3-b4da-244df85c5b03
2025-06-25 22:26:12,570 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:26:12,571 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:26:12,580 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:26:12,580 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:26:12,589 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:26:12,589 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:26:12,593 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:26:12,595 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 8368790c-ee2a-4e50-870a-50f34fd65683
2025-06-25 22:26:12,600 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 372cff14-23d4-4aa0-8cb5-c73b39c2ad27. Creando y guardando configuración por defecto.
2025-06-25 22:26:12,603 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:26:12,606 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 372cff14-23d4-4aa0-8cb5-c73b39c2ad27. Using default values.
2025-06-25 22:26:12,606 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 372cff14-23d4-4aa0-8cb5-c73b39c2ad27 with capital: 10000.0
2025-06-25 22:26:12,607 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:26:12,607 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:26:12,607 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:26:12,608 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Autonomous Scalping' as context for confirmed opportunity 8368790c-ee2a-4e50-870a-50f34fd65683
2025-06-25 22:26:12,608 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade ba48b9e5-dfe8-4e6a-9b32-ecc84869cd3e from decision ea26b3d1-c4af-4397-84ca-62db62280bf2
2025-06-25 22:26:12,609 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade ba48b9e5-dfe8-4e6a-9b32-ecc84869cd3e from confirmed opportunity.
2025-06-25 22:26:12,610 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:26:12,610 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:317 - Failed to create OCO order for trade ba48b9e5-dfe8-4e6a-9b32-ecc84869cd3e: PENDING
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 296, in execute_trade_from_confirmed_opportunity
    oco_order_result = await self.unified_order_execution_service.create_oco_order(
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2248, in _execute_mock_call
    result = await effect(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\tests\conftest.py", line 684, in mock_create_oco_order
    status=OrderStatus.PENDING.value,
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\enum.py", line 784, in __getattr__
    raise AttributeError(name) from None
AttributeError: PENDING
2025-06-25 22:26:12,611 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 372cff14-23d4-4aa0-8cb5-c73b39c2ad27: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:26:12,614 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('ba48b9e5-dfe8-4e6a-9b32-ecc84869cd3e'), '8ce563a5-da22-4684-8743-24ab1e841fc9', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:26:12.608860', '2025-06-26 02:26:12.608860', None, '{"id":"ba48b9e5-dfe8-4e6a-9b32-ecc84869cd3e","user_id":"8ce563a5-da22-4684-8743-24ab1e841fc9","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1199 characters truncated) ... ts":[],"created_at":"2025-06-26T02:26:12.608860","opened_at":"2025-06-26T02:26:12.608860","updated_at":"2025-06-26T02:26:12.608860","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('ba48b9e5-dfe8-4e6a-9b32-ecc84869cd3e'), '8ce563a5-da22-4684-8743-24ab1e841fc9', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:26:12.608860', '2025-06-26 02:26:12.608860', None, '{"id":"ba48b9e5-dfe8-4e6a-9b32-ecc84869cd3e","user_id":"8ce563a5-da22-4684-8743-24ab1e841fc9","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1199 characters truncated) ... ts":[],"created_at":"2025-06-26T02:26:12.608860","opened_at":"2025-06-26T02:26:12.608860","updated_at":"2025-06-26T02:26:12.608860","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:26:12,616 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 8368790c-ee2a-4e50-870a-50f34fd65683: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('ba48b9e5-dfe8-4e6a-9b32-ecc84869cd3e'), '8ce563a5-da22-4684-8743-24ab1e841fc9', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:26:12.608860', '2025-06-26 02:26:12.608860', None, '{"id":"ba48b9e5-dfe8-4e6a-9b32-ecc84869cd3e","user_id":"8ce563a5-da22-4684-8743-24ab1e841fc9","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1199 characters truncated) ... ts":[],"created_at":"2025-06-26T02:26:12.608860","opened_at":"2025-06-26T02:26:12.608860","updated_at":"2025-06-26T02:26:12.608860","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:26:12,619 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 8368790c-ee2a-4e50-870a-50f34fd65683 status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:26:12,620 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:541 - Failed to persist status update for opportunity 8368790c-ee2a-4e50-870a-50f34fd65683: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('ba48b9e5-dfe8-4e6a-9b32-ecc84869cd3e'), '8ce563a5-da22-4684-8743-24ab1e841fc9', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:26:12.608860', '2025-06-26 02:26:12.608860', None, '{"id":"ba48b9e5-dfe8-4e6a-9b32-ecc84869cd3e","user_id":"8ce563a5-da22-4684-8743-24ab1e841fc9","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1199 characters truncated) ... ts":[],"created_at":"2025-06-26T02:26:12.608860","opened_at":"2025-06-26T02:26:12.608860","updated_at":"2025-06-26T02:26:12.608860","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 534, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('ba48b9e5-dfe8-4e6a-9b32-ecc84869cd3e'), '8ce563a5-da22-4684-8743-24ab1e841fc9', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:26:12.608860', '2025-06-26 02:26:12.608860', None, '{"id":"ba48b9e5-dfe8-4e6a-9b32-ecc84869cd3e","user_id":"8ce563a5-da22-4684-8743-24ab1e841fc9","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1199 characters truncated) ... ts":[],"created_at":"2025-06-26T02:26:12.608860","opened_at":"2025-06-26T02:26:12.608860","updated_at":"2025-06-26T02:26:12.608860","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:26:12,720 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:26:12,721 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:26:12,730 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:26:12,730 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:26:12,738 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:26:12,739 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:26:12,742 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:26:12,743 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 7bcac87e-0ee8-4b24-8327-5f4d7d2a0579
2025-06-25 22:26:12,746 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id a8bb96da-0b45-47f6-bd28-7ebc8cee56e2. Creando y guardando configuración por defecto.
2025-06-25 22:26:12,749 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:26:12,751 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for a8bb96da-0b45-47f6-bd28-7ebc8cee56e2. Using default values.
2025-06-25 22:26:12,751 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for a8bb96da-0b45-47f6-bd28-7ebc8cee56e2 with capital: 10000.0
2025-06-25 22:26:12,752 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:26:12,753 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:26:12,753 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:26:12,753 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity 7bcac87e-0ee8-4b24-8327-5f4d7d2a0579
2025-06-25 22:26:12,753 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade b801f041-783d-439e-ae2a-c988971b3ac6 from decision 7281def6-6d02-4ab8-b5fa-e0e57dff0b9b
2025-06-25 22:26:12,754 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade b801f041-783d-439e-ae2a-c988971b3ac6 from confirmed opportunity.
2025-06-25 22:26:12,756 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:26:12,756 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:317 - Failed to create OCO order for trade b801f041-783d-439e-ae2a-c988971b3ac6: PENDING
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 296, in execute_trade_from_confirmed_opportunity
    oco_order_result = await self.unified_order_execution_service.create_oco_order(
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2248, in _execute_mock_call
    result = await effect(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\tests\conftest.py", line 684, in mock_create_oco_order
    status=OrderStatus.PENDING.value,
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\enum.py", line 784, in __getattr__
    raise AttributeError(name) from None
AttributeError: PENDING
2025-06-25 22:26:12,758 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario a8bb96da-0b45-47f6-bd28-7ebc8cee56e2: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:26:12,761 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('b801f041-783d-439e-ae2a-c988971b3ac6'), '5d75a3fe-2828-4fa6-a0d2-5fb82a72876f', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:26:12.753274', '2025-06-26 02:26:12.753274', None, '{"id":"b801f041-783d-439e-ae2a-c988971b3ac6","user_id":"5d75a3fe-2828-4fa6-a0d2-5fb82a72876f","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1200 characters truncated) ... ts":[],"created_at":"2025-06-26T02:26:12.753274","opened_at":"2025-06-26T02:26:12.753274","updated_at":"2025-06-26T02:26:12.753274","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('b801f041-783d-439e-ae2a-c988971b3ac6'), '5d75a3fe-2828-4fa6-a0d2-5fb82a72876f', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:26:12.753274', '2025-06-26 02:26:12.753274', None, '{"id":"b801f041-783d-439e-ae2a-c988971b3ac6","user_id":"5d75a3fe-2828-4fa6-a0d2-5fb82a72876f","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1200 characters truncated) ... ts":[],"created_at":"2025-06-26T02:26:12.753274","opened_at":"2025-06-26T02:26:12.753274","updated_at":"2025-06-26T02:26:12.753274","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:26:12,763 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 7bcac87e-0ee8-4b24-8327-5f4d7d2a0579: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('b801f041-783d-439e-ae2a-c988971b3ac6'), '5d75a3fe-2828-4fa6-a0d2-5fb82a72876f', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:26:12.753274', '2025-06-26 02:26:12.753274', None, '{"id":"b801f041-783d-439e-ae2a-c988971b3ac6","user_id":"5d75a3fe-2828-4fa6-a0d2-5fb82a72876f","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1200 characters truncated) ... ts":[],"created_at":"2025-06-26T02:26:12.753274","opened_at":"2025-06-26T02:26:12.753274","updated_at":"2025-06-26T02:26:12.753274","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:26:12,765 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 7bcac87e-0ee8-4b24-8327-5f4d7d2a0579 status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:26:12,765 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:541 - Failed to persist status update for opportunity 7bcac87e-0ee8-4b24-8327-5f4d7d2a0579: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('b801f041-783d-439e-ae2a-c988971b3ac6'), '5d75a3fe-2828-4fa6-a0d2-5fb82a72876f', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:26:12.753274', '2025-06-26 02:26:12.753274', None, '{"id":"b801f041-783d-439e-ae2a-c988971b3ac6","user_id":"5d75a3fe-2828-4fa6-a0d2-5fb82a72876f","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1200 characters truncated) ... ts":[],"created_at":"2025-06-26T02:26:12.753274","opened_at":"2025-06-26T02:26:12.753274","updated_at":"2025-06-26T02:26:12.753274","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 534, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('b801f041-783d-439e-ae2a-c988971b3ac6'), '5d75a3fe-2828-4fa6-a0d2-5fb82a72876f', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:26:12.753274', '2025-06-26 02:26:12.753274', None, '{"id":"b801f041-783d-439e-ae2a-c988971b3ac6","user_id":"5d75a3fe-2828-4fa6-a0d2-5fb82a72876f","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1200 characters truncated) ... ts":[],"created_at":"2025-06-26T02:26:12.753274","opened_at":"2025-06-26T02:26:12.753274","updated_at":"2025-06-26T02:26:12.753274","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:26:12,776 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:26:12,778 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:26:12,784 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:26:12,784 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:26:12,794 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:26:12,794 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:26:12,796 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:26:12,798 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 6cdf902c-134b-46ad-b394-a7e9e9f8784f
2025-06-25 22:26:12,800 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 96f83c81-f733-48b2-8d37-3cb6d3336e9d. Creando y guardando configuración por defecto.
2025-06-25 22:26:12,802 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:26:12,806 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 96f83c81-f733-48b2-8d37-3cb6d3336e9d. Using default values.
2025-06-25 22:26:12,807 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 96f83c81-f733-48b2-8d37-3cb6d3336e9d with capital: 10000.0
2025-06-25 22:26:12,808 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:26:12,809 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:26:12,809 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:26:12,809 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Day Trading Strategy' as context for confirmed opportunity 6cdf902c-134b-46ad-b394-a7e9e9f8784f
2025-06-25 22:26:12,809 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 965a43a7-a7a7-4111-9553-3cc597e9efe7 from decision db6abb61-709e-4b74-84ff-3ae1fe0570cd
2025-06-25 22:26:12,810 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 965a43a7-a7a7-4111-9553-3cc597e9efe7 from confirmed opportunity.
2025-06-25 22:26:12,811 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:26:12,812 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:317 - Failed to create OCO order for trade 965a43a7-a7a7-4111-9553-3cc597e9efe7: PENDING
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 296, in execute_trade_from_confirmed_opportunity
    oco_order_result = await self.unified_order_execution_service.create_oco_order(
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2248, in _execute_mock_call
    result = await effect(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\tests\conftest.py", line 684, in mock_create_oco_order
    status=OrderStatus.PENDING.value,
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\enum.py", line 784, in __getattr__
    raise AttributeError(name) from None
AttributeError: PENDING
2025-06-25 22:26:12,812 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 96f83c81-f733-48b2-8d37-3cb6d3336e9d: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:26:12,815 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('965a43a7-a7a7-4111-9553-3cc597e9efe7'), 'e854e7c2-b272-457c-a421-cbd01f0611eb', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:26:12.809635', '2025-06-26 02:26:12.809635', None, '{"id":"965a43a7-a7a7-4111-9553-3cc597e9efe7","user_id":"e854e7c2-b272-457c-a421-cbd01f0611eb","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1199 characters truncated) ... ts":[],"created_at":"2025-06-26T02:26:12.809635","opened_at":"2025-06-26T02:26:12.809635","updated_at":"2025-06-26T02:26:12.809635","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('965a43a7-a7a7-4111-9553-3cc597e9efe7'), 'e854e7c2-b272-457c-a421-cbd01f0611eb', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:26:12.809635', '2025-06-26 02:26:12.809635', None, '{"id":"965a43a7-a7a7-4111-9553-3cc597e9efe7","user_id":"e854e7c2-b272-457c-a421-cbd01f0611eb","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1199 characters truncated) ... ts":[],"created_at":"2025-06-26T02:26:12.809635","opened_at":"2025-06-26T02:26:12.809635","updated_at":"2025-06-26T02:26:12.809635","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:26:12,818 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 6cdf902c-134b-46ad-b394-a7e9e9f8784f: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('965a43a7-a7a7-4111-9553-3cc597e9efe7'), 'e854e7c2-b272-457c-a421-cbd01f0611eb', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:26:12.809635', '2025-06-26 02:26:12.809635', None, '{"id":"965a43a7-a7a7-4111-9553-3cc597e9efe7","user_id":"e854e7c2-b272-457c-a421-cbd01f0611eb","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1199 characters truncated) ... ts":[],"created_at":"2025-06-26T02:26:12.809635","opened_at":"2025-06-26T02:26:12.809635","updated_at":"2025-06-26T02:26:12.809635","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:26:12,820 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 6cdf902c-134b-46ad-b394-a7e9e9f8784f status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:26:12,821 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:541 - Failed to persist status update for opportunity 6cdf902c-134b-46ad-b394-a7e9e9f8784f: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('965a43a7-a7a7-4111-9553-3cc597e9efe7'), 'e854e7c2-b272-457c-a421-cbd01f0611eb', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:26:12.809635', '2025-06-26 02:26:12.809635', None, '{"id":"965a43a7-a7a7-4111-9553-3cc597e9efe7","user_id":"e854e7c2-b272-457c-a421-cbd01f0611eb","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1199 characters truncated) ... ts":[],"created_at":"2025-06-26T02:26:12.809635","opened_at":"2025-06-26T02:26:12.809635","updated_at":"2025-06-26T02:26:12.809635","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 534, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('965a43a7-a7a7-4111-9553-3cc597e9efe7'), 'e854e7c2-b272-457c-a421-cbd01f0611eb', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:26:12.809635', '2025-06-26 02:26:12.809635', None, '{"id":"965a43a7-a7a7-4111-9553-3cc597e9efe7","user_id":"e854e7c2-b272-457c-a421-cbd01f0611eb","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1199 characters truncated) ... ts":[],"created_at":"2025-06-26T02:26:12.809635","opened_at":"2025-06-26T02:26:12.809635","updated_at":"2025-06-26T02:26:12.809635","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:26:12,831 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:26:12,832 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:26:12,839 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:26:12,839 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:26:12,848 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:26:12,848 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:26:12,850 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:26:12,851 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 58deb21b-8c81-40d8-b761-0b0ec480a867 from decision 872ba5da-8cf9-4286-b1e8-791b2d775b13
2025-06-25 22:26:12,852 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:26:12,853 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:26:12,862 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:26:12,863 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:26:12,869 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:26:12,870 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:26:12,872 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:26:12,874 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade e7c4eaa3-5ea7-4da9-93fa-1e000bed8e89 from decision 5ba7af25-5ebd-43d2-a962-1c8e936c4389
2025-06-25 22:26:12,875 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:26:12,876 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:26:12,883 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:26:12,883 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:26:12,892 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:26:12,892 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:26:12,895 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:26:12,897 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:26:12,898 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:26:14,764 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:26:14,764 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:26:14,769 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:26:14,771 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:26:14,772 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:26:14,782 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:26:14,785 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:26:14,786 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:26:14,790 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:26:14,797 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:26:14,800 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:26:14,805 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:26:14,806 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:26:14,810 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:26:14,811 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:26:14,812 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:26:14,815 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:26:14,816 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:26:14,823 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:26:14,823 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:26:14,830 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:26:14,830 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:26:14,834 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:26:14,838 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:26:14,838 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:26:14,841 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:286 - Verificación de Binance BINANCE_SPOT exitosa.
2025-06-25 22:26:14,845 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:26:14,846 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:26:14,849 - ultibot_backend.services.credential_service - ERROR - [MainThread] - credential_service.py:315 - Error de Binance API durante la verificación: Binance Down
2025-06-25 22:26:14,853 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:26:14,854 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:26:14,857 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:26:14,861 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:26:14,862 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:26:14,865 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:241 - Verificación de Telegram exitosa.
2025-06-25 22:26:14,873 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:72 - Conexión con Binance exitosa.
2025-06-25 22:26:14,878 - ultibot_backend.services.market_data_service - WARNING - [MainThread] - market_data_service.py:52 - Credenciales de Binance no encontradas. Por favor, configúrelas.
2025-06-25 22:26:14,883 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:69 - Fallo en la verificación de conexión con Binance. Revise sus credenciales y permisos.
2025-06-25 22:26:14,888 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:77 - Error al acceder a las credenciales de Binance: Decryption failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 45, in get_binance_connection_status
    binance_credential = await self.credential_service.get_credential(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.CredentialError: Decryption failed
2025-06-25 22:26:14,894 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:81 - Error de la API de Binance: API unavailable
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 61, in get_binance_connection_status
    is_connected = await self.credential_service.verify_credential(binance_credential)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.BinanceAPIError: API unavailable
2025-06-25 22:26:14,898 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:26:14,906 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:121 - Error de la API de Binance al obtener balances: Failed to fetch balances
2025-06-25 22:26:14,911 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1968602647696'>
2025-06-25 22:26:14,913 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 00c10d28-83df-44b4-bf0b-1a6794cea535, mode_filter: None
2025-06-25 22:26:14,913 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1968602647696'>
2025-06-25 22:26:14,913 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 00c10d28-83df-44b4-bf0b-1a6794cea535 with mode_filter: None
2025-06-25 22:26:14,916 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1968572325520'>
2025-06-25 22:26:14,917 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 00c10d28-83df-44b4-bf0b-1a6794cea535, mode_filter: None
2025-06-25 22:26:14,917 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1968572325520'>
2025-06-25 22:26:14,917 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 00c10d28-83df-44b4-bf0b-1a6794cea535 with mode_filter: None
2025-06-25 22:26:14,921 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1968597528592'>
2025-06-25 22:26:14,922 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 00c10d28-83df-44b4-bf0b-1a6794cea535, mode_filter: OperatingMode.PAPER
2025-06-25 22:26:14,923 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1968597528592'>
2025-06-25 22:26:14,923 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 00c10d28-83df-44b4-bf0b-1a6794cea535
2025-06-25 22:26:14,927 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1968598109520'>
2025-06-25 22:26:14,929 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 00c10d28-83df-44b4-bf0b-1a6794cea535, mode_filter: OperatingMode.PAPER
2025-06-25 22:26:14,929 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1968598109520'>
2025-06-25 22:26:14,930 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 00c10d28-83df-44b4-bf0b-1a6794cea535
2025-06-25 22:26:14,933 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1968598116752'>
2025-06-25 22:26:14,935 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 00c10d28-83df-44b4-bf0b-1a6794cea535, mode_filter: OperatingMode.REAL
2025-06-25 22:26:14,935 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1968598116752'>
2025-06-25 22:26:14,935 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 00c10d28-83df-44b4-bf0b-1a6794cea535
2025-06-25 22:26:14,939 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1968597512848'>
2025-06-25 22:26:14,941 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 00c10d28-83df-44b4-bf0b-1a6794cea535, mode_filter: OperatingMode.PAPER
2025-06-25 22:26:14,942 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1968597512848'>
2025-06-25 22:26:14,942 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 00c10d28-83df-44b4-bf0b-1a6794cea535
2025-06-25 22:26:14,945 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1968598146128'>
2025-06-25 22:26:14,947 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 00c10d28-83df-44b4-bf0b-1a6794cea535, mode_filter: None
2025-06-25 22:26:14,947 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1968598146128'>
2025-06-25 22:26:14,948 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 2 performance entries for user 00c10d28-83df-44b4-bf0b-1a6794cea535
2025-06-25 22:26:14,950 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1968597617360'>
2025-06-25 22:26:14,952 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 00c10d28-83df-44b4-bf0b-1a6794cea535, mode_filter: OperatingMode.PAPER
2025-06-25 22:26:14,952 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1968597617360'>
2025-06-25 22:26:14,952 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 00c10d28-83df-44b4-bf0b-1a6794cea535
2025-06-25 22:26:14,956 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1968610773008'>
2025-06-25 22:26:14,958 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 00c10d28-83df-44b4-bf0b-1a6794cea535, mode_filter: OperatingMode.PAPER
2025-06-25 22:26:14,959 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1968610773008'>
2025-06-25 22:26:14,959 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 00c10d28-83df-44b4-bf0b-1a6794cea535 with mode_filter: OperatingMode.PAPER
2025-06-25 22:26:14,963 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1968576466192'>
2025-06-25 22:26:14,965 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 00c10d28-83df-44b4-bf0b-1a6794cea535, mode_filter: OperatingMode.PAPER
2025-06-25 22:26:14,965 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1968576466192'>
2025-06-25 22:26:14,965 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 00c10d28-83df-44b4-bf0b-1a6794cea535 with mode_filter: OperatingMode.PAPER
2025-06-25 22:26:14,968 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1968598123472'>
2025-06-25 22:26:14,970 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 00c10d28-83df-44b4-bf0b-1a6794cea535, mode_filter: OperatingMode.PAPER
2025-06-25 22:26:14,970 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1968598123472'>
2025-06-25 22:26:14,971 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 00c10d28-83df-44b4-bf0b-1a6794cea535
2025-06-25 22:26:14,975 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1968597531024'>
2025-06-25 22:26:14,976 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 00c10d28-83df-44b4-bf0b-1a6794cea535, mode_filter: OperatingMode.PAPER
2025-06-25 22:26:14,977 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1968597531024'>
2025-06-25 22:26:14,977 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 00c10d28-83df-44b4-bf0b-1a6794cea535
2025-06-25 22:26:14,981 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1968572330064'>
2025-06-25 22:26:14,982 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 00c10d28-83df-44b4-bf0b-1a6794cea535, mode_filter: OperatingMode.PAPER
2025-06-25 22:26:14,983 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1968572330064'>
2025-06-25 22:26:14,983 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 00c10d28-83df-44b4-bf0b-1a6794cea535
2025-06-25 22:26:14,986 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1968597617488'>
2025-06-25 22:26:14,987 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 00c10d28-83df-44b4-bf0b-1a6794cea535, mode_filter: OperatingMode.PAPER
2025-06-25 22:26:14,988 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1968597617488'>
2025-06-25 22:26:14,988 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 00c10d28-83df-44b4-bf0b-1a6794cea535
2025-06-25 22:26:15,036 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 8957e992-2efc-4f3a-8696-bac1fd0ab833 en modo paper
2025-06-25 22:26:15,042 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 3bfa4d12-b393-4d80-9460-67544a921590 en modo paper
2025-06-25 22:26:15,046 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario 47137ab4-2f44-4fec-97bd-7f8697dd8f30 en modo paper
2025-06-25 22:26:15,050 - ultibot_backend.services.trading_report_service - ERROR - [MainThread] - trading_report_service.py:79 - Error al obtener trades cerrados para usuario 417a8915-1376-411d-b686-7d983c030485: Database connection failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_report_service.py", line 65, in get_closed_trades
    trades = await persistence_service.get_closed_trades(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
Exception: Database connection failed
2025-06-25 22:26:15,063 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 5af43a20-3e5e-47fa-9c21-e5e5fe4909fb for symbol BTC/USDT
2025-06-25 22:26:15,064 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 93560173-a070-46ca-8092-ca7cb6771264 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:26:15,064 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 5af43a20-3e5e-47fa-9c21-e5e5fe4909fb status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:26:15,065 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 5af43a20-3e5e-47fa-9c21-e5e5fe4909fb
2025-06-25 22:26:15,075 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity ea9cc2ef-921a-4da5-8898-ef553a01af16 for symbol BTC/USDT
2025-06-25 22:26:15,077 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 7009f58f-db5d-491a-b7f4-f5ce1e658ac3 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:26:15,077 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity ea9cc2ef-921a-4da5-8898-ef553a01af16 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:26:15,078 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity ea9cc2ef-921a-4da5-8898-ef553a01af16
2025-06-25 22:26:15,085 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 110e5546-bf56-4019-9a58-40f13ff030a4 for symbol BTC/USDT
2025-06-25 22:26:15,087 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 277bbff0-79cc-414a-bc7a-b971f9248833 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:26:15,087 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 110e5546-bf56-4019-9a58-40f13ff030a4 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:26:15,090 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 110e5546-bf56-4019-9a58-40f13ff030a4
2025-06-25 22:26:15,099 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 7438b886-6ea9-4f4d-8e1c-9f3872bd8083 for symbol BTC/USDT
2025-06-25 22:26:15,101 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 03b94cce-cc26-4028-83a0-17397c1e4b65 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:26:15,101 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 7438b886-6ea9-4f4d-8e1c-9f3872bd8083 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:26:15,102 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 7438b886-6ea9-4f4d-8e1c-9f3872bd8083
2025-06-25 22:26:15,112 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 60bd6dc1-fc09-4a34-afac-ba3440a730b1 for symbol BTC/USDT
2025-06-25 22:26:15,113 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:639 - Unknown strategy type 'CUSTOM_UNKNOWN_TYPE' for strategy 7fce3d46-02db-4d51-b180-60c4dc207f26. Recommending investigation.
2025-06-25 22:26:15,113 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 60bd6dc1-fc09-4a34-afac-ba3440a730b1 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:26:15,114 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 60bd6dc1-fc09-4a34-afac-ba3440a730b1
2025-06-25 22:26:15,123 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity df3bcfc0-41e9-412a-9a4e-5ef7969a7a85 for symbol BTC/USDT
2025-06-25 22:26:15,126 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 8e4e2428-585d-4a8a-aa46-185606ef01ff can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:26:15,126 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity df3bcfc0-41e9-412a-9a4e-5ef7969a7a85 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:26:15,127 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity df3bcfc0-41e9-412a-9a4e-5ef7969a7a85
2025-06-25 22:26:15,148 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity dfe93b40-e8b4-4e64-a2cc-599111b5494a for symbol BTC/USDT
2025-06-25 22:26:15,150 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 9655870a-5c05-4645-8688-b6052ba945fd can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:26:15,150 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity dfe93b40-e8b4-4e64-a2cc-599111b5494a status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:26:15,151 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity dfe93b40-e8b4-4e64-a2cc-599111b5494a
2025-06-25 22:27:36,414 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:27:36,414 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:27:36,431 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:27:36,431 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:27:36,614 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:27:36,615 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:27:36,632 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:27:36,633 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:27:37,300 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:27:37,300 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:27:37,323 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:27:37,338 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:27:37,340 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:27:37,343 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:27:37,345 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:27:37,353 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:27:37,354 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:27:37,371 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:27:37,374 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:27:37,375 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:27:37,383 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:27:37,383 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:27:37,402 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:27:37,405 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:27:37,406 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:27:37,414 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:27:37,414 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:27:37,432 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:27:37,434 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:27:37,436 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:27:37,443 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:27:37,443 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:27:37,461 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:27:37,464 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:27:37,466 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:27:37,474 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:27:37,475 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:27:37,579 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:27:37,580 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:27:37,581 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:27:37,581 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:27:37,581 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:27:37,581 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:27:37,603 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:27:37,776 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:27:37,777 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:27:37,952 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:27:37,955 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:37,955 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:37,955 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:27:37,971 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:27:37,971 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000023B6F0B0790>
2025-06-25 22:27:37,971 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:27:37,972 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:27:37,973 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 422
2025-06-25 22:27:37,983 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:27:37,983 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:27:38,001 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:27:38,002 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:27:38,003 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:27:38,003 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:27:38,175 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:27:38,175 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:27:38,353 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:27:38,354 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:38,354 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:38,354 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:27:38,358 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:27:38,359 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000023B6F0D8E50>
2025-06-25 22:27:38,359 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:27:38,359 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:27:38,368 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:27:38,376 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:27:38,376 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:27:38,386 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:27:38,386 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:27:38,403 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:27:38,404 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:27:38,405 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:27:38,405 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:27:38,579 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:27:38,579 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:27:38,751 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:27:38,752 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:38,752 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:38,752 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:27:38,755 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:27:38,755 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000023B6F328150>
2025-06-25 22:27:38,756 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:27:38,756 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:27:38,760 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:27:38,766 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:27:38,767 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:27:38,768 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:27:38,774 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:27:38,776 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:27:38,777 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:27:38,778 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:27:38,785 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:27:38,787 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:27:38,805 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:27:38,807 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:27:38,807 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:27:38,808 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:27:38,984 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:27:38,984 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:27:39,159 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:27:39,159 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:39,160 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:39,160 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:27:39,162 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:27:39,163 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000023B6F105B50>
2025-06-25 22:27:39,163 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:27:39,163 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:27:39,166 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:27:39,174 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:27:39,175 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:27:39,176 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:27:39,182 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:27:39,183 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:27:39,193 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:27:39,193 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:27:39,212 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:27:39,214 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:27:39,214 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:27:39,215 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:27:39,386 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:27:39,387 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:27:39,563 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:27:39,563 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:39,564 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:39,564 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:27:39,566 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:27:39,567 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000023B6F38AD90>
2025-06-25 22:27:39,567 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:27:39,567 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:27:39,570 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:27:39,578 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:27:39,578 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:27:39,579 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:27:39,584 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:27:39,584 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:27:39,594 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:27:39,594 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:27:39,613 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:27:39,615 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:27:39,616 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:27:39,616 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:27:39,796 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:27:39,796 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:27:39,965 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:27:39,965 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:39,965 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:39,965 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:27:39,969 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:27:39,969 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000023B6F35C150>
2025-06-25 22:27:39,970 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:27:39,970 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:27:39,970 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 422
2025-06-25 22:27:39,988 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity bc70032f-4819-4e13-b64e-a558e9c3c454
2025-06-25 22:27:39,991 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:152 - User configuration saved after initializing last_daily_reset for user cdde4b6b-720d-4981-82a1-a7f3582d4604.
2025-06-25 22:27:39,991 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 200.000
2025-06-25 22:27:39,991 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity bc70032f-4819-4e13-b64e-a558e9c3c454
2025-06-25 22:27:39,992 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 53e1358d-7e98-42ce-89ef-9a2a5679fca7 from decision 4ec8517a-07ab-4ea2-8490-2a406cc9d9c6
2025-06-25 22:27:39,992 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 53e1358d-7e98-42ce-89ef-9a2a5679fca7 from confirmed opportunity.
2025-06-25 22:27:39,993 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:27:39,993 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:310 - Successfully created OCO order for trade 53e1358d-7e98-42ce-89ef-9a2a5679fca7. OCO List ID: oco_list_123
2025-06-25 22:27:39,994 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario cdde4b6b-720d-4981-82a1-a7f3582d4604: 200.0000000000000000000000000 (anterior: 0.0, valor trade: 200.0000000000000000000000000)
2025-06-25 22:27:39,995 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user cdde4b6b-720d-4981-82a1-a7f3582d4604 to 200.0000000000000000000000000.
2025-06-25 22:27:39,995 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity bc70032f-4819-4e13-b64e-a558e9c3c454 status to converted_to_trade_real: Trade 53e1358d-7e98-42ce-89ef-9a2a5679fca7 executed based on user confirmation.
2025-06-25 22:27:39,996 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity bc70032f-4819-4e13-b64e-a558e9c3c454
2025-06-25 22:27:40,005 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 7e80c5fb-86da-4cb2-b830-b338ff064166
2025-06-25 22:27:40,005 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 4800.0, Riesgo Potencial Trade USD: 300.000
2025-06-25 22:27:40,006 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:191 - Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:27:40,006 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 7e80c5fb-86da-4cb2-b830-b338ff064166 status to error_in_processing: Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:27:40,007 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 7e80c5fb-86da-4cb2-b830-b338ff064166
2025-06-25 22:27:40,020 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity a1f15625-1c02-4028-b520-465f44237537
2025-06-25 22:27:40,020 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:143 - Daily capital reset triggered for user 58bf3e5d-e045-4873-a05c-d63759097bca. Resetting daily_capital_risked_usd.
2025-06-25 22:27:40,020 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:147 - User configuration saved after daily capital reset for user 58bf3e5d-e045-4873-a05c-d63759097bca.
2025-06-25 22:27:40,021 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 2500.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 100.000
2025-06-25 22:27:40,022 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity a1f15625-1c02-4028-b520-465f44237537
2025-06-25 22:27:40,022 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 5778c350-2808-4faf-b8ec-a17886baed22 from decision 73edc1ad-d044-4ad5-ae07-0f4b596f54c0
2025-06-25 22:27:40,023 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 5778c350-2808-4faf-b8ec-a17886baed22 from confirmed opportunity.
2025-06-25 22:27:40,024 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:27:40,025 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:310 - Successfully created OCO order for trade 5778c350-2808-4faf-b8ec-a17886baed22. OCO List ID: oco_reset_test
2025-06-25 22:27:40,025 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 58bf3e5d-e045-4873-a05c-d63759097bca: 100.000 (anterior: 0.0, valor trade: 100.000)
2025-06-25 22:27:40,026 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user 58bf3e5d-e045-4873-a05c-d63759097bca to 100.000.
2025-06-25 22:27:40,026 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity a1f15625-1c02-4028-b520-465f44237537 status to converted_to_trade_real: Trade 5778c350-2808-4faf-b8ec-a17886baed22 executed based on user confirmation.
2025-06-25 22:27:40,028 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity a1f15625-1c02-4028-b520-465f44237537
2025-06-25 22:27:40,044 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:27:40,044 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:27:40,061 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:27:40,063 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 22:27:40,063 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:27:40,063 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:27:40,236 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:27:40,236 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:27:40,413 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:27:40,413 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:40,413 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:40,414 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:27:40,416 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:27:40,417 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000023B703AE9D0>
2025-06-25 22:27:40,417 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:27:40,417 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:27:40,417 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 22:27:40,422 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"2be2b9ab-9ca6-425c-b82a-78213254f300","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:27:40.035117Z","submittedAt":"2025-06-26T02:27:40.035117Z","fillTimestamp":"2025-06-26T02:27:40.035117Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:27:40.035117Z","opened_at":"2025-06-26T02:27:40.035117Z","updated_at":"2025-06-26T02:27:40.035117Z","closed_at":"2025-06-26T02:27:40.035117Z"}
2025-06-25 22:27:40,423 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '2be2b9ab-9ca6-425c-b82a-78213254f300', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:27:40.035117Z', 'submittedAt': '2025-06-26T02:27:40.035117Z', 'fillTimestamp': '2025-06-26T02:27:40.035117Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:27:40.035117Z', 'opened_at': '2025-06-26T02:27:40.035117Z', 'updated_at': '2025-06-26T02:27:40.035117Z', 'closed_at': '2025-06-26T02:27:40.035117Z'}
2025-06-25 22:27:40,423 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"acd86a2a-73f3-431d-a539-f310c33574eb","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:27:40.035117Z","submittedAt":"2025-06-26T02:27:40.035117Z","fillTimestamp":"2025-06-26T02:27:40.035117Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:27:40.035117Z","opened_at":"2025-06-26T02:27:40.035117Z","updated_at":"2025-06-26T02:27:40.035117Z","closed_at":"2025-06-26T02:27:40.035117Z"}
2025-06-25 22:27:40,423 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': 'acd86a2a-73f3-431d-a539-f310c33574eb', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:27:40.035117Z', 'submittedAt': '2025-06-26T02:27:40.035117Z', 'fillTimestamp': '2025-06-26T02:27:40.035117Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:27:40.035117Z', 'opened_at': '2025-06-26T02:27:40.035117Z', 'updated_at': '2025-06-26T02:27:40.035117Z', 'closed_at': '2025-06-26T02:27:40.035117Z'}
2025-06-25 22:27:40,423 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"685a9d7e-78fa-4790-bb0f-8b61a886fade","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:27:40.035117Z","submittedAt":"2025-06-26T02:27:40.035117Z","fillTimestamp":"2025-06-26T02:27:40.035117Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:27:40.035117Z","opened_at":"2025-06-26T02:27:40.035117Z","updated_at":"2025-06-26T02:27:40.035117Z","closed_at":"2025-06-26T02:27:40.035117Z"}
2025-06-25 22:27:40,423 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '685a9d7e-78fa-4790-bb0f-8b61a886fade', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:27:40.035117Z', 'submittedAt': '2025-06-26T02:27:40.035117Z', 'fillTimestamp': '2025-06-26T02:27:40.035117Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:27:40.035117Z', 'opened_at': '2025-06-26T02:27:40.035117Z', 'updated_at': '2025-06-26T02:27:40.035117Z', 'closed_at': '2025-06-26T02:27:40.035117Z'}
2025-06-25 22:27:40,424 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 3
2025-06-25 22:27:40,424 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:27:40,424 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 22:27:40,441 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:27:40,442 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:27:40,461 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:27:40,462 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 22:27:40,463 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:27:40,463 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:27:40,637 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:27:40,638 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:27:40,810 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:27:40,811 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:40,811 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:40,811 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:27:40,813 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:27:40,814 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000023B7044D8D0>
2025-06-25 22:27:40,814 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:27:40,814 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:27:40,815 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: BTCUSDT, start_date: None, end_date: None
2025-06-25 22:27:40,819 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"1b6646d5-1fae-4399-bea7-1183480acb9f","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:27:40.433355Z","submittedAt":"2025-06-26T02:27:40.433355Z","fillTimestamp":"2025-06-26T02:27:40.433355Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:27:40.433355Z","opened_at":"2025-06-26T02:27:40.433355Z","updated_at":"2025-06-26T02:27:40.433355Z","closed_at":"2025-06-26T02:27:40.433355Z"}
2025-06-25 22:27:40,819 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '1b6646d5-1fae-4399-bea7-1183480acb9f', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:27:40.433355Z', 'submittedAt': '2025-06-26T02:27:40.433355Z', 'fillTimestamp': '2025-06-26T02:27:40.433355Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:27:40.433355Z', 'opened_at': '2025-06-26T02:27:40.433355Z', 'updated_at': '2025-06-26T02:27:40.433355Z', 'closed_at': '2025-06-26T02:27:40.433355Z'}
2025-06-25 22:27:40,819 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 1
2025-06-25 22:27:40,820 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 1 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:27:40,820 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 22:27:40,837 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:27:40,837 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:27:40,857 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:27:40,858 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 22:27:40,859 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:27:40,859 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:27:41,032 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:27:41,033 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:27:41,206 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:27:41,208 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:41,208 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:41,209 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:27:41,211 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:27:41,211 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000023B70404850>
2025-06-25 22:27:41,212 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:27:41,212 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:27:41,212 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 22:27:41,216 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"fab5d9f5-828d-4994-944d-def25a2067e4","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:27:40.830024Z","submittedAt":"2025-06-26T02:27:40.830024Z","fillTimestamp":"2025-06-26T02:27:40.830024Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:27:40.830024Z","opened_at":"2025-06-26T02:27:40.830024Z","updated_at":"2025-06-26T02:27:40.830024Z","closed_at":"2025-06-26T02:27:40.830024Z"}
2025-06-25 22:27:41,216 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': 'fab5d9f5-828d-4994-944d-def25a2067e4', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:27:40.830024Z', 'submittedAt': '2025-06-26T02:27:40.830024Z', 'fillTimestamp': '2025-06-26T02:27:40.830024Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:27:40.830024Z', 'opened_at': '2025-06-26T02:27:40.830024Z', 'updated_at': '2025-06-26T02:27:40.830024Z', 'closed_at': '2025-06-26T02:27:40.830024Z'}
2025-06-25 22:27:41,216 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"2bd894f9-4620-49a3-a1da-6fc5f7f18419","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:27:40.830024Z","submittedAt":"2025-06-26T02:27:40.830024Z","fillTimestamp":"2025-06-26T02:27:40.830024Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:27:40.830024Z","opened_at":"2025-06-26T02:27:40.830024Z","updated_at":"2025-06-26T02:27:40.830024Z","closed_at":"2025-06-26T02:27:40.830024Z"}
2025-06-25 22:27:41,216 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': '2bd894f9-4620-49a3-a1da-6fc5f7f18419', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:27:40.830024Z', 'submittedAt': '2025-06-26T02:27:40.830024Z', 'fillTimestamp': '2025-06-26T02:27:40.830024Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:27:40.830024Z', 'opened_at': '2025-06-26T02:27:40.830024Z', 'updated_at': '2025-06-26T02:27:40.830024Z', 'closed_at': '2025-06-26T02:27:40.830024Z'}
2025-06-25 22:27:41,217 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"5517d409-a086-46c4-88b2-b9951929db5c","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:27:40.830024Z","submittedAt":"2025-06-26T02:27:40.830024Z","fillTimestamp":"2025-06-26T02:27:40.830024Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:27:40.830024Z","opened_at":"2025-06-26T02:27:40.830024Z","updated_at":"2025-06-26T02:27:40.830024Z","closed_at":"2025-06-26T02:27:40.830024Z"}
2025-06-25 22:27:41,217 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '5517d409-a086-46c4-88b2-b9951929db5c', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:27:40.830024Z', 'submittedAt': '2025-06-26T02:27:40.830024Z', 'fillTimestamp': '2025-06-26T02:27:40.830024Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:27:40.830024Z', 'opened_at': '2025-06-26T02:27:40.830024Z', 'updated_at': '2025-06-26T02:27:40.830024Z', 'closed_at': '2025-06-26T02:27:40.830024Z'}
2025-06-25 22:27:41,217 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 3
2025-06-25 22:27:41,217 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:27:41,218 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 22:27:41,236 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:27:41,236 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:27:41,254 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:27:41,256 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 22:27:41,256 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:27:41,257 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:27:41,434 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:27:41,435 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:27:41,607 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:27:41,608 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:41,608 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:41,608 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:27:41,612 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:27:41,612 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000023B7046A390>
2025-06-25 22:27:41,613 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:27:41,613 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:27:41,613 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: 2025-06-27 02:27:41.255807+00:00, end_date: None
2025-06-25 22:27:41,616 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 0
2025-06-25 22:27:41,616 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:27:41,617 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 22:27:41,660 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 21ca16b5-a074-4008-ae6f-fdd7f71b23c1 for symbol BTCUSDT
2025-06-25 22:27:41,661 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: cd3479a1-3a15-4fb8-8816-4a10c65780f4
2025-06-25 22:27:41,661 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy c6d9b3a6-d805-41ab-8d5e-8b26a4cdf6a5 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:27:41,669 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 79f18f07-c316-4162-b09c-244188e47099 for symbol BTCUSDT
2025-06-25 22:27:41,670 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 77cf461c-2bec-417b-896f-c8dd11ee627a can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:27:41,678 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity a9c46f87-523f-457b-9102-d254b1ceed49 for symbol ETHUSDT
2025-06-25 22:27:41,678 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 24c4135e-d598-43c4-b04a-3c412e97dde7
2025-06-25 22:27:41,680 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:590 - No active and applicable strategies found for opportunity a9c46f87-523f-457b-9102-d254b1ceed49 with symbol ETHUSDT.
2025-06-25 22:27:41,680 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity a9c46f87-523f-457b-9102-d254b1ceed49 status to rejected_by_system: No active strategies are applicable to this opportunity's symbol.
2025-06-25 22:27:41,681 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity a9c46f87-523f-457b-9102-d254b1ceed49
2025-06-25 22:27:41,688 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 8f1d161a-9019-4d04-817a-bb45c219ca61 for symbol BTCUSDT
2025-06-25 22:27:41,688 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 7c85fc18-dba8-4013-8eca-ba8ca0ab6baa
2025-06-25 22:27:41,689 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:703 - AI confidence 0.65 for strategy 3fe690a7-38a5-44d5-ba8b-ecc4ff2f72d7 is below threshold 0.8.
2025-06-25 22:27:41,691 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:718 - Strategy 3fe690a7-38a5-44d5-ba8b-ecc4ff2f72d7 did not produce a decision for opportunity 8f1d161a-9019-4d04-817a-bb45c219ca61.
2025-06-25 22:27:41,691 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:609 - No affirmative trading decisions made for opportunity 8f1d161a-9019-4d04-817a-bb45c219ca61.
2025-06-25 22:27:41,699 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 28ea651f-17a2-4fe0-ab3a-8e1d0521b602 for symbol BTCUSDT
2025-06-25 22:27:41,700 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: b805b153-7aca-4df1-a8ce-7c2fcdc6b0b0
2025-06-25 22:27:41,709 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 5ffb821a-a1f4-43f3-8723-f9a7849320fe for symbol BTCUSDT
2025-06-25 22:27:41,709 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: fe9f6f7e-2015-4cf6-b844-8ef28a1f2496
2025-06-25 22:27:41,715 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 4cdd089b-91d2-4070-ac86-20f91f6f1b1a from decision ea12646a-fcf2-4ed9-ae94-d147e14b8a3f
2025-06-25 22:27:41,721 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade d170bb7d-8eca-43b3-956a-37585e864832 from decision d907b088-0606-4dd0-a7ef-b3ddb11c5ecd
2025-06-25 22:27:41,722 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 9e9393a6-35a4-48a0-8360-65a8032d0c2c from decision d907b088-0606-4dd0-a7ef-b3ddb11c5ecd
2025-06-25 22:27:41,729 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:41,729 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:41,737 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:27:41,737 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:27:41,740 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:27:41,742 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity b9d7916d-96da-484e-91fa-c6d10f71bf29
2025-06-25 22:27:41,745 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 16234078-bde3-4134-919e-be8c96322b01. Creando y guardando configuración por defecto.
2025-06-25 22:27:41,748 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:27:41,751 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 16234078-bde3-4134-919e-be8c96322b01. Using default values.
2025-06-25 22:27:41,751 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 16234078-bde3-4134-919e-be8c96322b01 with capital: 10000.0
2025-06-25 22:27:41,752 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:27:41,752 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:27:41,753 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:27:41,753 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity b9d7916d-96da-484e-91fa-c6d10f71bf29
2025-06-25 22:27:41,753 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 03e837ee-0aa7-48fd-b2b3-51683b4607fe from decision 6e3f9fef-1927-4a5e-bdbe-908a369826f6
2025-06-25 22:27:41,754 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 03e837ee-0aa7-48fd-b2b3-51683b4607fe from confirmed opportunity.
2025-06-25 22:27:41,755 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:27:41,756 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:317 - Failed to create OCO order for trade 03e837ee-0aa7-48fd-b2b3-51683b4607fe: 1 validation error for TradeOrderDetails
ocoOrderListId
  Input should be a valid string [type=string_type, input_value=126570839564234272395263796097863420071, input_type=int]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 296, in execute_trade_from_confirmed_opportunity
    oco_order_result = await self.unified_order_execution_service.create_oco_order(
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2248, in _execute_mock_call
    result = await effect(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\tests\conftest.py", line 682, in mock_create_oco_order
    return TradeOrderDetails(
           ^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for TradeOrderDetails
ocoOrderListId
  Input should be a valid string [type=string_type, input_value=126570839564234272395263796097863420071, input_type=int]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
2025-06-25 22:27:41,757 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 16234078-bde3-4134-919e-be8c96322b01: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:27:41,760 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('03e837ee-0aa7-48fd-b2b3-51683b4607fe'), '441706e2-3203-4e09-a5cf-89813eacaddb', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:27:41.753048', '2025-06-26 02:27:41.753048', None, '{"id":"03e837ee-0aa7-48fd-b2b3-51683b4607fe","user_id":"441706e2-3203-4e09-a5cf-89813eacaddb","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1457 characters truncated) ... ts":[],"created_at":"2025-06-26T02:27:41.753048","opened_at":"2025-06-26T02:27:41.753048","updated_at":"2025-06-26T02:27:41.753048","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('03e837ee-0aa7-48fd-b2b3-51683b4607fe'), '441706e2-3203-4e09-a5cf-89813eacaddb', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:27:41.753048', '2025-06-26 02:27:41.753048', None, '{"id":"03e837ee-0aa7-48fd-b2b3-51683b4607fe","user_id":"441706e2-3203-4e09-a5cf-89813eacaddb","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1457 characters truncated) ... ts":[],"created_at":"2025-06-26T02:27:41.753048","opened_at":"2025-06-26T02:27:41.753048","updated_at":"2025-06-26T02:27:41.753048","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:27:41,766 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity b9d7916d-96da-484e-91fa-c6d10f71bf29: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('03e837ee-0aa7-48fd-b2b3-51683b4607fe'), '441706e2-3203-4e09-a5cf-89813eacaddb', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:27:41.753048', '2025-06-26 02:27:41.753048', None, '{"id":"03e837ee-0aa7-48fd-b2b3-51683b4607fe","user_id":"441706e2-3203-4e09-a5cf-89813eacaddb","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1457 characters truncated) ... ts":[],"created_at":"2025-06-26T02:27:41.753048","opened_at":"2025-06-26T02:27:41.753048","updated_at":"2025-06-26T02:27:41.753048","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:27:41,769 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity b9d7916d-96da-484e-91fa-c6d10f71bf29 status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:27:41,770 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:541 - Failed to persist status update for opportunity b9d7916d-96da-484e-91fa-c6d10f71bf29: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('03e837ee-0aa7-48fd-b2b3-51683b4607fe'), '441706e2-3203-4e09-a5cf-89813eacaddb', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:27:41.753048', '2025-06-26 02:27:41.753048', None, '{"id":"03e837ee-0aa7-48fd-b2b3-51683b4607fe","user_id":"441706e2-3203-4e09-a5cf-89813eacaddb","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1457 characters truncated) ... ts":[],"created_at":"2025-06-26T02:27:41.753048","opened_at":"2025-06-26T02:27:41.753048","updated_at":"2025-06-26T02:27:41.753048","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 534, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('03e837ee-0aa7-48fd-b2b3-51683b4607fe'), '441706e2-3203-4e09-a5cf-89813eacaddb', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:27:41.753048', '2025-06-26 02:27:41.753048', None, '{"id":"03e837ee-0aa7-48fd-b2b3-51683b4607fe","user_id":"441706e2-3203-4e09-a5cf-89813eacaddb","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1457 characters truncated) ... ts":[],"created_at":"2025-06-26T02:27:41.753048","opened_at":"2025-06-26T02:27:41.753048","updated_at":"2025-06-26T02:27:41.753048","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:27:42,062 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:27:42,063 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:27:42,070 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:42,070 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:42,079 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:27:42,080 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:27:42,082 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:27:42,084 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:27:42,085 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:27:42,093 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:42,093 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:42,101 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:27:42,102 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:27:42,104 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:27:42,106 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 8ed1cc9d-0328-458c-84b6-9b86c4850a7f for symbol BTC/USDT
2025-06-25 22:27:42,109 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 47a7fe01-846e-4324-830e-de210d728b53. Creando y guardando configuración por defecto.
2025-06-25 22:27:42,112 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:27:42,113 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:658 - AI profile 'ai-profile-scalping-1' for strategy f5d6547b-9a72-4262-899a-f4c019885a0d not found. Skipping AI analysis.
2025-06-25 22:27:42,114 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy f5d6547b-9a72-4262-899a-f4c019885a0d can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:27:42,114 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 8ed1cc9d-0328-458c-84b6-9b86c4850a7f status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:27:42,121 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 8ed1cc9d-0328-458c-84b6-9b86c4850a7f
2025-06-25 22:27:42,122 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:27:42,123 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:27:42,131 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:42,131 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:42,139 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:27:42,140 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:27:42,142 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:27:42,144 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 586e3c47-4498-42f8-b684-51fca2cbc91c
2025-06-25 22:27:42,147 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 6a368971-f446-49b7-ac9d-520904531ded. Creando y guardando configuración por defecto.
2025-06-25 22:27:42,149 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:27:42,152 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 6a368971-f446-49b7-ac9d-520904531ded. Using default values.
2025-06-25 22:27:42,152 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 6a368971-f446-49b7-ac9d-520904531ded with capital: 10000.0
2025-06-25 22:27:42,153 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:27:42,154 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:27:42,154 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:27:42,154 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Autonomous Scalping' as context for confirmed opportunity 586e3c47-4498-42f8-b684-51fca2cbc91c
2025-06-25 22:27:42,154 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade e79d3db1-37e3-45e9-aa13-a1275e1eae6f from decision 338d957e-2a7e-4a0c-8ae5-3ae1db429bf8
2025-06-25 22:27:42,155 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade e79d3db1-37e3-45e9-aa13-a1275e1eae6f from confirmed opportunity.
2025-06-25 22:27:42,156 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:27:42,157 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:317 - Failed to create OCO order for trade e79d3db1-37e3-45e9-aa13-a1275e1eae6f: 1 validation error for TradeOrderDetails
ocoOrderListId
  Input should be a valid string [type=string_type, input_value=292502252777774814337424648357291963440, input_type=int]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 296, in execute_trade_from_confirmed_opportunity
    oco_order_result = await self.unified_order_execution_service.create_oco_order(
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2248, in _execute_mock_call
    result = await effect(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\tests\conftest.py", line 682, in mock_create_oco_order
    return TradeOrderDetails(
           ^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for TradeOrderDetails
ocoOrderListId
  Input should be a valid string [type=string_type, input_value=292502252777774814337424648357291963440, input_type=int]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
2025-06-25 22:27:42,157 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 6a368971-f446-49b7-ac9d-520904531ded: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:27:42,160 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('e79d3db1-37e3-45e9-aa13-a1275e1eae6f'), '1ecd23da-1055-4d2c-9b89-94726264449b', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:27:42.154237', '2025-06-26 02:27:42.154237', None, '{"id":"e79d3db1-37e3-45e9-aa13-a1275e1eae6f","user_id":"1ecd23da-1055-4d2c-9b89-94726264449b","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1455 characters truncated) ... ts":[],"created_at":"2025-06-26T02:27:42.154237","opened_at":"2025-06-26T02:27:42.154237","updated_at":"2025-06-26T02:27:42.154237","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('e79d3db1-37e3-45e9-aa13-a1275e1eae6f'), '1ecd23da-1055-4d2c-9b89-94726264449b', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:27:42.154237', '2025-06-26 02:27:42.154237', None, '{"id":"e79d3db1-37e3-45e9-aa13-a1275e1eae6f","user_id":"1ecd23da-1055-4d2c-9b89-94726264449b","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1455 characters truncated) ... ts":[],"created_at":"2025-06-26T02:27:42.154237","opened_at":"2025-06-26T02:27:42.154237","updated_at":"2025-06-26T02:27:42.154237","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:27:42,162 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 586e3c47-4498-42f8-b684-51fca2cbc91c: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('e79d3db1-37e3-45e9-aa13-a1275e1eae6f'), '1ecd23da-1055-4d2c-9b89-94726264449b', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:27:42.154237', '2025-06-26 02:27:42.154237', None, '{"id":"e79d3db1-37e3-45e9-aa13-a1275e1eae6f","user_id":"1ecd23da-1055-4d2c-9b89-94726264449b","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1455 characters truncated) ... ts":[],"created_at":"2025-06-26T02:27:42.154237","opened_at":"2025-06-26T02:27:42.154237","updated_at":"2025-06-26T02:27:42.154237","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:27:42,164 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 586e3c47-4498-42f8-b684-51fca2cbc91c status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:27:42,165 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:541 - Failed to persist status update for opportunity 586e3c47-4498-42f8-b684-51fca2cbc91c: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('e79d3db1-37e3-45e9-aa13-a1275e1eae6f'), '1ecd23da-1055-4d2c-9b89-94726264449b', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:27:42.154237', '2025-06-26 02:27:42.154237', None, '{"id":"e79d3db1-37e3-45e9-aa13-a1275e1eae6f","user_id":"1ecd23da-1055-4d2c-9b89-94726264449b","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1455 characters truncated) ... ts":[],"created_at":"2025-06-26T02:27:42.154237","opened_at":"2025-06-26T02:27:42.154237","updated_at":"2025-06-26T02:27:42.154237","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 534, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('e79d3db1-37e3-45e9-aa13-a1275e1eae6f'), '1ecd23da-1055-4d2c-9b89-94726264449b', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:27:42.154237', '2025-06-26 02:27:42.154237', None, '{"id":"e79d3db1-37e3-45e9-aa13-a1275e1eae6f","user_id":"1ecd23da-1055-4d2c-9b89-94726264449b","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1455 characters truncated) ... ts":[],"created_at":"2025-06-26T02:27:42.154237","opened_at":"2025-06-26T02:27:42.154237","updated_at":"2025-06-26T02:27:42.154237","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:27:42,175 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:27:42,176 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:27:42,184 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:42,185 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:42,193 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:27:42,194 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:27:42,196 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:27:42,198 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 64e8ced5-cbdf-4a67-be6c-85b73fd823a3
2025-06-25 22:27:42,201 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id b23bf083-2bf5-4b43-a510-c4cd63cad0dc. Creando y guardando configuración por defecto.
2025-06-25 22:27:42,203 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:27:42,206 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for b23bf083-2bf5-4b43-a510-c4cd63cad0dc. Using default values.
2025-06-25 22:27:42,206 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for b23bf083-2bf5-4b43-a510-c4cd63cad0dc with capital: 10000.0
2025-06-25 22:27:42,208 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:27:42,208 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:27:42,209 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:27:42,209 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity 64e8ced5-cbdf-4a67-be6c-85b73fd823a3
2025-06-25 22:27:42,210 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade f3d4785c-01a6-4884-a796-5f732ba28da1 from decision 2b4b2fa9-c9a6-4b22-9a8e-2c3b1995e408
2025-06-25 22:27:42,210 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade f3d4785c-01a6-4884-a796-5f732ba28da1 from confirmed opportunity.
2025-06-25 22:27:42,211 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:27:42,212 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:317 - Failed to create OCO order for trade f3d4785c-01a6-4884-a796-5f732ba28da1: 1 validation error for TradeOrderDetails
ocoOrderListId
  Input should be a valid string [type=string_type, input_value=197416654225327349366549658801472389, input_type=int]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 296, in execute_trade_from_confirmed_opportunity
    oco_order_result = await self.unified_order_execution_service.create_oco_order(
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2248, in _execute_mock_call
    result = await effect(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\tests\conftest.py", line 682, in mock_create_oco_order
    return TradeOrderDetails(
           ^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for TradeOrderDetails
ocoOrderListId
  Input should be a valid string [type=string_type, input_value=197416654225327349366549658801472389, input_type=int]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
2025-06-25 22:27:42,212 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario b23bf083-2bf5-4b43-a510-c4cd63cad0dc: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:27:42,216 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('f3d4785c-01a6-4884-a796-5f732ba28da1'), 'c763c00b-8806-457f-a516-a6d0ba72c2c3', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:27:42.210941', '2025-06-26 02:27:42.210941', None, '{"id":"f3d4785c-01a6-4884-a796-5f732ba28da1","user_id":"c763c00b-8806-457f-a516-a6d0ba72c2c3","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1453 characters truncated) ... ts":[],"created_at":"2025-06-26T02:27:42.210941","opened_at":"2025-06-26T02:27:42.210941","updated_at":"2025-06-26T02:27:42.210941","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('f3d4785c-01a6-4884-a796-5f732ba28da1'), 'c763c00b-8806-457f-a516-a6d0ba72c2c3', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:27:42.210941', '2025-06-26 02:27:42.210941', None, '{"id":"f3d4785c-01a6-4884-a796-5f732ba28da1","user_id":"c763c00b-8806-457f-a516-a6d0ba72c2c3","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1453 characters truncated) ... ts":[],"created_at":"2025-06-26T02:27:42.210941","opened_at":"2025-06-26T02:27:42.210941","updated_at":"2025-06-26T02:27:42.210941","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:27:42,218 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 64e8ced5-cbdf-4a67-be6c-85b73fd823a3: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('f3d4785c-01a6-4884-a796-5f732ba28da1'), 'c763c00b-8806-457f-a516-a6d0ba72c2c3', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:27:42.210941', '2025-06-26 02:27:42.210941', None, '{"id":"f3d4785c-01a6-4884-a796-5f732ba28da1","user_id":"c763c00b-8806-457f-a516-a6d0ba72c2c3","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1453 characters truncated) ... ts":[],"created_at":"2025-06-26T02:27:42.210941","opened_at":"2025-06-26T02:27:42.210941","updated_at":"2025-06-26T02:27:42.210941","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:27:42,221 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 64e8ced5-cbdf-4a67-be6c-85b73fd823a3 status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:27:42,222 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:541 - Failed to persist status update for opportunity 64e8ced5-cbdf-4a67-be6c-85b73fd823a3: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('f3d4785c-01a6-4884-a796-5f732ba28da1'), 'c763c00b-8806-457f-a516-a6d0ba72c2c3', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:27:42.210941', '2025-06-26 02:27:42.210941', None, '{"id":"f3d4785c-01a6-4884-a796-5f732ba28da1","user_id":"c763c00b-8806-457f-a516-a6d0ba72c2c3","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1453 characters truncated) ... ts":[],"created_at":"2025-06-26T02:27:42.210941","opened_at":"2025-06-26T02:27:42.210941","updated_at":"2025-06-26T02:27:42.210941","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 534, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('f3d4785c-01a6-4884-a796-5f732ba28da1'), 'c763c00b-8806-457f-a516-a6d0ba72c2c3', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:27:42.210941', '2025-06-26 02:27:42.210941', None, '{"id":"f3d4785c-01a6-4884-a796-5f732ba28da1","user_id":"c763c00b-8806-457f-a516-a6d0ba72c2c3","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1453 characters truncated) ... ts":[],"created_at":"2025-06-26T02:27:42.210941","opened_at":"2025-06-26T02:27:42.210941","updated_at":"2025-06-26T02:27:42.210941","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:27:42,231 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:27:42,233 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:27:42,240 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:42,241 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:42,248 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:27:42,248 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:27:42,251 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:27:42,252 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 19c19267-7343-4493-80b7-559ff21c1ecd
2025-06-25 22:27:42,255 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 895a56f5-a87d-485b-b2e1-b86211882790. Creando y guardando configuración por defecto.
2025-06-25 22:27:42,258 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:27:42,260 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 895a56f5-a87d-485b-b2e1-b86211882790. Using default values.
2025-06-25 22:27:42,261 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 895a56f5-a87d-485b-b2e1-b86211882790 with capital: 10000.0
2025-06-25 22:27:42,262 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:27:42,262 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:27:42,263 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:27:42,263 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Day Trading Strategy' as context for confirmed opportunity 19c19267-7343-4493-80b7-559ff21c1ecd
2025-06-25 22:27:42,263 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade e6ed508a-9681-401a-9874-fd7d93689beb from decision 95031ae1-a1c9-4527-b3a2-84b7a76b5da6
2025-06-25 22:27:42,264 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade e6ed508a-9681-401a-9874-fd7d93689beb from confirmed opportunity.
2025-06-25 22:27:42,265 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:27:42,265 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:317 - Failed to create OCO order for trade e6ed508a-9681-401a-9874-fd7d93689beb: 1 validation error for TradeOrderDetails
ocoOrderListId
  Input should be a valid string [type=string_type, input_value=262215956919457624109056659185106148544, input_type=int]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 296, in execute_trade_from_confirmed_opportunity
    oco_order_result = await self.unified_order_execution_service.create_oco_order(
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2248, in _execute_mock_call
    result = await effect(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\tests\conftest.py", line 682, in mock_create_oco_order
    return TradeOrderDetails(
           ^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for TradeOrderDetails
ocoOrderListId
  Input should be a valid string [type=string_type, input_value=262215956919457624109056659185106148544, input_type=int]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
2025-06-25 22:27:42,266 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 895a56f5-a87d-485b-b2e1-b86211882790: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:27:42,268 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('e6ed508a-9681-401a-9874-fd7d93689beb'), 'f3a874c9-2e01-466b-bc7b-29a301fdbceb', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:27:42.263496', '2025-06-26 02:27:42.263496', None, '{"id":"e6ed508a-9681-401a-9874-fd7d93689beb","user_id":"f3a874c9-2e01-466b-bc7b-29a301fdbceb","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1455 characters truncated) ... ts":[],"created_at":"2025-06-26T02:27:42.263496","opened_at":"2025-06-26T02:27:42.263496","updated_at":"2025-06-26T02:27:42.263496","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('e6ed508a-9681-401a-9874-fd7d93689beb'), 'f3a874c9-2e01-466b-bc7b-29a301fdbceb', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:27:42.263496', '2025-06-26 02:27:42.263496', None, '{"id":"e6ed508a-9681-401a-9874-fd7d93689beb","user_id":"f3a874c9-2e01-466b-bc7b-29a301fdbceb","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1455 characters truncated) ... ts":[],"created_at":"2025-06-26T02:27:42.263496","opened_at":"2025-06-26T02:27:42.263496","updated_at":"2025-06-26T02:27:42.263496","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:27:42,270 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 19c19267-7343-4493-80b7-559ff21c1ecd: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('e6ed508a-9681-401a-9874-fd7d93689beb'), 'f3a874c9-2e01-466b-bc7b-29a301fdbceb', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:27:42.263496', '2025-06-26 02:27:42.263496', None, '{"id":"e6ed508a-9681-401a-9874-fd7d93689beb","user_id":"f3a874c9-2e01-466b-bc7b-29a301fdbceb","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1455 characters truncated) ... ts":[],"created_at":"2025-06-26T02:27:42.263496","opened_at":"2025-06-26T02:27:42.263496","updated_at":"2025-06-26T02:27:42.263496","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:27:42,273 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 19c19267-7343-4493-80b7-559ff21c1ecd status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:27:42,273 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:541 - Failed to persist status update for opportunity 19c19267-7343-4493-80b7-559ff21c1ecd: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('e6ed508a-9681-401a-9874-fd7d93689beb'), 'f3a874c9-2e01-466b-bc7b-29a301fdbceb', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:27:42.263496', '2025-06-26 02:27:42.263496', None, '{"id":"e6ed508a-9681-401a-9874-fd7d93689beb","user_id":"f3a874c9-2e01-466b-bc7b-29a301fdbceb","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1455 characters truncated) ... ts":[],"created_at":"2025-06-26T02:27:42.263496","opened_at":"2025-06-26T02:27:42.263496","updated_at":"2025-06-26T02:27:42.263496","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 534, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('e6ed508a-9681-401a-9874-fd7d93689beb'), 'f3a874c9-2e01-466b-bc7b-29a301fdbceb', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:27:42.263496', '2025-06-26 02:27:42.263496', None, '{"id":"e6ed508a-9681-401a-9874-fd7d93689beb","user_id":"f3a874c9-2e01-466b-bc7b-29a301fdbceb","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1455 characters truncated) ... ts":[],"created_at":"2025-06-26T02:27:42.263496","opened_at":"2025-06-26T02:27:42.263496","updated_at":"2025-06-26T02:27:42.263496","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:27:42,283 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:27:42,284 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:27:42,292 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:42,293 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:42,299 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:27:42,299 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:27:42,302 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:27:42,302 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 2c61b4ad-f3e9-4996-957b-5c781b2afa71 from decision 77467136-fb0e-476b-ae29-2d7fbaec8a32
2025-06-25 22:27:42,304 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:27:42,305 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:27:42,313 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:42,313 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:42,319 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:27:42,319 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:27:42,322 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:27:42,324 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade fd380448-0983-45ed-b8cb-e7f0d2d157aa from decision b2d06a05-89e9-4083-bab9-af1b465c8fef
2025-06-25 22:27:42,326 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:27:42,327 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:27:42,334 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:42,335 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:42,342 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:27:42,342 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:27:42,346 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:27:42,347 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:27:42,348 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:27:44,195 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:44,195 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:44,201 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:27:44,202 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:27:44,203 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:27:44,212 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:27:44,215 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:27:44,216 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:27:44,220 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:27:44,226 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:27:44,229 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:27:44,233 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:44,233 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:44,236 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:44,238 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:44,239 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:27:44,346 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:44,347 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:44,353 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:44,354 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:44,363 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:44,363 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:44,367 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:27:44,369 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:44,369 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:44,374 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:286 - Verificación de Binance BINANCE_SPOT exitosa.
2025-06-25 22:27:44,380 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:44,380 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:44,384 - ultibot_backend.services.credential_service - ERROR - [MainThread] - credential_service.py:315 - Error de Binance API durante la verificación: Binance Down
2025-06-25 22:27:44,388 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:44,388 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:44,391 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:27:44,395 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:27:44,396 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:27:44,400 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:241 - Verificación de Telegram exitosa.
2025-06-25 22:27:44,407 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:72 - Conexión con Binance exitosa.
2025-06-25 22:27:44,413 - ultibot_backend.services.market_data_service - WARNING - [MainThread] - market_data_service.py:52 - Credenciales de Binance no encontradas. Por favor, configúrelas.
2025-06-25 22:27:44,418 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:69 - Fallo en la verificación de conexión con Binance. Revise sus credenciales y permisos.
2025-06-25 22:27:44,422 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:77 - Error al acceder a las credenciales de Binance: Decryption failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 45, in get_binance_connection_status
    binance_credential = await self.credential_service.get_credential(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.CredentialError: Decryption failed
2025-06-25 22:27:44,429 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:81 - Error de la API de Binance: API unavailable
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 61, in get_binance_connection_status
    is_connected = await self.credential_service.verify_credential(binance_credential)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.BinanceAPIError: API unavailable
2025-06-25 22:27:44,434 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:27:44,443 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:121 - Error de la API de Binance al obtener balances: Failed to fetch balances
2025-06-25 22:27:44,446 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2454316540688'>
2025-06-25 22:27:44,449 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1d5b8275-35cf-4047-a393-f63b7d7f4096, mode_filter: None
2025-06-25 22:27:44,449 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2454316540688'>
2025-06-25 22:27:44,449 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 1d5b8275-35cf-4047-a393-f63b7d7f4096 with mode_filter: None
2025-06-25 22:27:44,452 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2454315610000'>
2025-06-25 22:27:44,453 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1d5b8275-35cf-4047-a393-f63b7d7f4096, mode_filter: None
2025-06-25 22:27:44,454 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2454315610000'>
2025-06-25 22:27:44,454 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 1d5b8275-35cf-4047-a393-f63b7d7f4096 with mode_filter: None
2025-06-25 22:27:44,457 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2454316193296'>
2025-06-25 22:27:44,458 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1d5b8275-35cf-4047-a393-f63b7d7f4096, mode_filter: OperatingMode.PAPER
2025-06-25 22:27:44,459 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2454316193296'>
2025-06-25 22:27:44,459 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 1d5b8275-35cf-4047-a393-f63b7d7f4096
2025-06-25 22:27:44,463 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2454316107088'>
2025-06-25 22:27:44,464 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1d5b8275-35cf-4047-a393-f63b7d7f4096, mode_filter: OperatingMode.PAPER
2025-06-25 22:27:44,464 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2454316107088'>
2025-06-25 22:27:44,464 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 1d5b8275-35cf-4047-a393-f63b7d7f4096
2025-06-25 22:27:44,468 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2454316201488'>
2025-06-25 22:27:44,469 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1d5b8275-35cf-4047-a393-f63b7d7f4096, mode_filter: OperatingMode.REAL
2025-06-25 22:27:44,470 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2454316201488'>
2025-06-25 22:27:44,470 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 1d5b8275-35cf-4047-a393-f63b7d7f4096
2025-06-25 22:27:44,473 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2454316496272'>
2025-06-25 22:27:44,475 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1d5b8275-35cf-4047-a393-f63b7d7f4096, mode_filter: OperatingMode.PAPER
2025-06-25 22:27:44,475 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2454316496272'>
2025-06-25 22:27:44,475 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 1d5b8275-35cf-4047-a393-f63b7d7f4096
2025-06-25 22:27:44,479 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2454316424144'>
2025-06-25 22:27:44,480 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1d5b8275-35cf-4047-a393-f63b7d7f4096, mode_filter: None
2025-06-25 22:27:44,480 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2454316424144'>
2025-06-25 22:27:44,481 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 2 performance entries for user 1d5b8275-35cf-4047-a393-f63b7d7f4096
2025-06-25 22:27:44,483 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2454317073552'>
2025-06-25 22:27:44,485 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1d5b8275-35cf-4047-a393-f63b7d7f4096, mode_filter: OperatingMode.PAPER
2025-06-25 22:27:44,485 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2454317073552'>
2025-06-25 22:27:44,485 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 1d5b8275-35cf-4047-a393-f63b7d7f4096
2025-06-25 22:27:44,488 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2454316996816'>
2025-06-25 22:27:44,490 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1d5b8275-35cf-4047-a393-f63b7d7f4096, mode_filter: OperatingMode.PAPER
2025-06-25 22:27:44,491 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2454316996816'>
2025-06-25 22:27:44,491 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 1d5b8275-35cf-4047-a393-f63b7d7f4096 with mode_filter: OperatingMode.PAPER
2025-06-25 22:27:44,495 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2454317076176'>
2025-06-25 22:27:44,497 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1d5b8275-35cf-4047-a393-f63b7d7f4096, mode_filter: OperatingMode.PAPER
2025-06-25 22:27:44,497 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2454317076176'>
2025-06-25 22:27:44,498 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 1d5b8275-35cf-4047-a393-f63b7d7f4096 with mode_filter: OperatingMode.PAPER
2025-06-25 22:27:44,501 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2454316305552'>
2025-06-25 22:27:44,502 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1d5b8275-35cf-4047-a393-f63b7d7f4096, mode_filter: OperatingMode.PAPER
2025-06-25 22:27:44,502 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2454316305552'>
2025-06-25 22:27:44,503 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 1d5b8275-35cf-4047-a393-f63b7d7f4096
2025-06-25 22:27:44,506 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2454316493776'>
2025-06-25 22:27:44,509 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1d5b8275-35cf-4047-a393-f63b7d7f4096, mode_filter: OperatingMode.PAPER
2025-06-25 22:27:44,509 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2454316493776'>
2025-06-25 22:27:44,510 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 1d5b8275-35cf-4047-a393-f63b7d7f4096
2025-06-25 22:27:44,513 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2454316107472'>
2025-06-25 22:27:44,515 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1d5b8275-35cf-4047-a393-f63b7d7f4096, mode_filter: OperatingMode.PAPER
2025-06-25 22:27:44,515 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2454316107472'>
2025-06-25 22:27:44,515 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 1d5b8275-35cf-4047-a393-f63b7d7f4096
2025-06-25 22:27:44,519 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2454316692624'>
2025-06-25 22:27:44,521 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1d5b8275-35cf-4047-a393-f63b7d7f4096, mode_filter: OperatingMode.PAPER
2025-06-25 22:27:44,521 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2454316692624'>
2025-06-25 22:27:44,521 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 1d5b8275-35cf-4047-a393-f63b7d7f4096
2025-06-25 22:27:44,569 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario ce8aa2f8-2cca-4829-8abc-dcbd6e155703 en modo paper
2025-06-25 22:27:44,574 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario d08103e4-eb87-4aec-b918-e6af8285e7be en modo paper
2025-06-25 22:27:44,580 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario e14d84f6-f068-46b6-9197-568659acf147 en modo paper
2025-06-25 22:27:44,584 - ultibot_backend.services.trading_report_service - ERROR - [MainThread] - trading_report_service.py:79 - Error al obtener trades cerrados para usuario b744b072-266a-4043-9d88-08bd8983b519: Database connection failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_report_service.py", line 65, in get_closed_trades
    trades = await persistence_service.get_closed_trades(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
Exception: Database connection failed
2025-06-25 22:27:44,595 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 3f6e601c-e6ed-43cb-966d-0b999d598128 for symbol BTC/USDT
2025-06-25 22:27:44,596 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 469c54de-5d7a-4e25-9f5b-2d4f5313d14f can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:27:44,596 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 3f6e601c-e6ed-43cb-966d-0b999d598128 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:27:44,598 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 3f6e601c-e6ed-43cb-966d-0b999d598128
2025-06-25 22:27:44,606 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity e84d7918-8cef-487a-a406-8da7d2d4455f for symbol BTC/USDT
2025-06-25 22:27:44,608 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy c928b227-93d4-4598-b4df-7cc7461d8819 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:27:44,609 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity e84d7918-8cef-487a-a406-8da7d2d4455f status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:27:44,611 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity e84d7918-8cef-487a-a406-8da7d2d4455f
2025-06-25 22:27:44,619 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 248ff002-cb5b-460e-bb22-817db42319df for symbol BTC/USDT
2025-06-25 22:27:44,620 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy a4da6ce2-18ea-47f3-9593-8da63d1f0be9 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:27:44,621 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 248ff002-cb5b-460e-bb22-817db42319df status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:27:44,624 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 248ff002-cb5b-460e-bb22-817db42319df
2025-06-25 22:27:44,634 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity c235478a-5bc6-43b8-87da-2e09654b6c09 for symbol BTC/USDT
2025-06-25 22:27:44,635 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 15d06294-83ef-4a5f-9f2c-36cdfff35612 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:27:44,636 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity c235478a-5bc6-43b8-87da-2e09654b6c09 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:27:44,637 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity c235478a-5bc6-43b8-87da-2e09654b6c09
2025-06-25 22:27:44,646 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 691ed657-aba4-4d16-b6ee-660e759b14ff for symbol BTC/USDT
2025-06-25 22:27:44,646 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:639 - Unknown strategy type 'CUSTOM_UNKNOWN_TYPE' for strategy 4c45495e-6c5c-4ce9-9e7f-5aeeb65728e9. Recommending investigation.
2025-06-25 22:27:44,648 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 691ed657-aba4-4d16-b6ee-660e759b14ff status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:27:44,649 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 691ed657-aba4-4d16-b6ee-660e759b14ff
2025-06-25 22:27:44,658 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 7d618cd7-dafd-4a3d-a513-27cebd17b5da for symbol BTC/USDT
2025-06-25 22:27:44,661 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 0e2bbfea-09df-4bf7-abea-d7fdb937cbff can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:27:44,661 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 7d618cd7-dafd-4a3d-a513-27cebd17b5da status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:27:44,662 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 7d618cd7-dafd-4a3d-a513-27cebd17b5da
2025-06-25 22:27:44,681 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 3ee6aa34-a40f-4cf7-ba69-9df3eb2d20d6 for symbol BTC/USDT
2025-06-25 22:27:44,683 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 5e471a1e-7056-4aa6-ae91-5a662e34e088 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:27:44,683 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 3ee6aa34-a40f-4cf7-ba69-9df3eb2d20d6 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:27:44,684 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 3ee6aa34-a40f-4cf7-ba69-9df3eb2d20d6
2025-06-25 22:28:29,408 - ultibot_backend - INFO - [MainThread] - main.py:104 - Apagando UltiBot Backend (lifespan)...
2025-06-25 22:28:29,409 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:189 - Shutting down dependency container...
2025-06-25 22:28:29,413 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:40 - Redis client closed.
2025-06-25 22:28:29,413 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:196 - Dependency container shut down.
2025-06-25 22:28:29,415 - ultibot_backend - INFO - [MainThread] - main.py:107 - Recursos liberados y aplicación apagada (lifespan).
2025-06-25 22:28:34,051 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:28:34,051 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:28:34,071 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:28:34,072 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:28:34,073 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:28:34,073 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:28:34,073 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:28:34,074 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:28:34,074 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:28:34,115 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:28:34,301 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:28:34,301 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:28:34,489 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:28:34,493 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:28:34,493 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:28:34,494 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:28:34,506 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:28:34,508 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000017D51114E90>
2025-06-25 22:28:34,508 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:28:34,509 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:28:34,509 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:28:39,099 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:28:39,099 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:28:39,117 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:28:39,117 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:28:39,119 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:28:39,119 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:28:39,121 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:28:39,121 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:28:39,121 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:28:39,160 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:28:39,339 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:28:39,339 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:28:39,518 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:28:39,520 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:28:39,521 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:28:39,521 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:28:39,535 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:28:39,535 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000021856910850>
2025-06-25 22:28:39,535 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:28:39,537 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:28:39,537 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:31:41,848 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:31:41,849 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:31:41,870 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:31:41,870 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:31:42,042 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:31:42,043 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:31:42,060 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:31:42,060 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:31:42,766 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:31:42,766 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:31:42,788 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:31:42,804 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:31:42,806 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:31:42,809 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:31:42,810 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:31:42,818 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:31:42,818 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:31:42,838 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:31:42,841 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:31:42,843 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:31:42,850 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:31:42,851 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:31:42,869 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:31:42,874 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:31:42,875 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:31:42,885 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:31:42,885 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:31:42,903 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:31:42,906 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:31:42,908 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:31:42,916 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:31:42,916 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:31:42,935 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:31:42,938 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:31:42,939 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:31:42,946 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:31:42,946 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:31:43,056 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:31:43,059 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:31:43,060 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:31:43,060 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:31:43,060 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:31:43,061 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:31:43,082 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:31:43,263 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:31:43,264 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:31:43,444 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:31:43,444 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:43,444 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:43,445 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:31:43,462 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:31:43,462 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000027744B24990>
2025-06-25 22:31:43,463 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:31:43,463 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:31:43,464 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 422
2025-06-25 22:31:43,474 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:31:43,474 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:31:43,492 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:31:43,493 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:31:43,494 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:31:43,494 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:31:43,675 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:31:43,676 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:31:43,859 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:31:43,859 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:43,859 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:43,860 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:31:43,863 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:31:43,863 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000277448DE990>
2025-06-25 22:31:43,863 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:31:43,864 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:31:43,875 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:31:43,886 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:31:43,886 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:31:43,895 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:31:43,896 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:31:43,915 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:31:43,916 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:31:43,916 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:31:43,916 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:31:44,103 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:31:44,104 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:31:44,283 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:31:44,284 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:44,284 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:44,284 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:31:44,286 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:31:44,288 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000027744B4BFD0>
2025-06-25 22:31:44,288 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:31:44,288 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:31:44,291 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:31:44,300 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:31:44,301 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:31:44,302 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:31:44,307 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:31:44,308 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:31:44,309 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:31:44,309 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:31:44,319 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:31:44,319 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:31:44,339 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:31:44,340 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:31:44,341 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:31:44,341 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:31:44,522 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:31:44,522 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:31:44,700 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:31:44,700 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:44,700 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:44,701 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:31:44,704 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:31:44,704 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000027744940FD0>
2025-06-25 22:31:44,705 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:31:44,705 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:31:44,708 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:31:44,715 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:31:44,715 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:31:44,716 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:31:44,722 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:31:44,722 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:31:44,733 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:31:44,733 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:31:44,754 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:31:44,755 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:31:44,756 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:31:44,756 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:31:44,937 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:31:44,938 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:31:45,119 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:31:45,119 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:45,119 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:45,120 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:31:45,123 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:31:45,123 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000027744DD6550>
2025-06-25 22:31:45,123 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:31:45,123 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:31:45,128 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:31:45,135 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:31:45,136 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:31:45,137 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:31:45,142 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:31:45,143 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:31:45,152 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:31:45,153 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:31:45,173 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:31:45,174 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:31:45,175 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:31:45,176 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:31:45,356 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:31:45,357 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:31:45,533 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:31:45,533 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:45,534 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:45,534 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:31:45,537 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:31:45,537 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000027744E321D0>
2025-06-25 22:31:45,538 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:31:45,538 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:31:45,539 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 422
2025-06-25 22:31:45,560 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 13303836-2016-442d-8118-bedf0f74e2ad
2025-06-25 22:31:45,562 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:152 - User configuration saved after initializing last_daily_reset for user fcbd7e7a-2e2e-411e-9f0d-be79933c2b40.
2025-06-25 22:31:45,562 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 200.000
2025-06-25 22:31:45,562 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity 13303836-2016-442d-8118-bedf0f74e2ad
2025-06-25 22:31:45,563 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 08c8d5ca-6e31-4637-ab51-4cb963300e1b from decision ba2edd28-f840-4787-a556-4fd618b884c3
2025-06-25 22:31:45,563 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 08c8d5ca-6e31-4637-ab51-4cb963300e1b from confirmed opportunity.
2025-06-25 22:31:45,564 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:31:45,565 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:310 - Successfully created OCO order for trade 08c8d5ca-6e31-4637-ab51-4cb963300e1b. OCO List ID: oco_list_123
2025-06-25 22:31:45,566 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario fcbd7e7a-2e2e-411e-9f0d-be79933c2b40: 200.0000000000000000000000000 (anterior: 0.0, valor trade: 200.0000000000000000000000000)
2025-06-25 22:31:45,566 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user fcbd7e7a-2e2e-411e-9f0d-be79933c2b40 to 200.0000000000000000000000000.
2025-06-25 22:31:45,566 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 13303836-2016-442d-8118-bedf0f74e2ad status to converted_to_trade_real: Trade 08c8d5ca-6e31-4637-ab51-4cb963300e1b executed based on user confirmation.
2025-06-25 22:31:45,568 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 13303836-2016-442d-8118-bedf0f74e2ad
2025-06-25 22:31:45,578 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 3d0a18d5-29a8-41f0-a93a-c5fbd9408aac
2025-06-25 22:31:45,579 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 4800.0, Riesgo Potencial Trade USD: 300.000
2025-06-25 22:31:45,579 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:191 - Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:31:45,580 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 3d0a18d5-29a8-41f0-a93a-c5fbd9408aac status to error_in_processing: Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:31:45,581 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 3d0a18d5-29a8-41f0-a93a-c5fbd9408aac
2025-06-25 22:31:45,594 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 7c2c7740-6e50-45d6-b5be-2d5da1b9a3cb
2025-06-25 22:31:45,595 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:143 - Daily capital reset triggered for user 18ccc60d-e4a7-4daf-904f-c8ccd2f02501. Resetting daily_capital_risked_usd.
2025-06-25 22:31:45,595 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:147 - User configuration saved after daily capital reset for user 18ccc60d-e4a7-4daf-904f-c8ccd2f02501.
2025-06-25 22:31:45,596 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 2500.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 100.000
2025-06-25 22:31:45,597 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity 7c2c7740-6e50-45d6-b5be-2d5da1b9a3cb
2025-06-25 22:31:45,597 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 24e9e862-169e-4e90-99a0-48c8bea12ab8 from decision 84b96127-e422-4df9-b7a0-4399e55d42b8
2025-06-25 22:31:45,597 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 24e9e862-169e-4e90-99a0-48c8bea12ab8 from confirmed opportunity.
2025-06-25 22:31:45,599 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:31:45,600 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:310 - Successfully created OCO order for trade 24e9e862-169e-4e90-99a0-48c8bea12ab8. OCO List ID: oco_reset_test
2025-06-25 22:31:45,601 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 18ccc60d-e4a7-4daf-904f-c8ccd2f02501: 100.000 (anterior: 0.0, valor trade: 100.000)
2025-06-25 22:31:45,601 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user 18ccc60d-e4a7-4daf-904f-c8ccd2f02501 to 100.000.
2025-06-25 22:31:45,602 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 7c2c7740-6e50-45d6-b5be-2d5da1b9a3cb status to converted_to_trade_real: Trade 24e9e862-169e-4e90-99a0-48c8bea12ab8 executed based on user confirmation.
2025-06-25 22:31:45,603 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 7c2c7740-6e50-45d6-b5be-2d5da1b9a3cb
2025-06-25 22:31:45,617 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:31:45,617 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:31:45,636 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:31:45,639 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 22:31:45,639 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:31:45,640 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:31:45,816 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:31:45,816 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:31:45,997 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:31:45,998 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:45,998 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:45,998 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:31:46,001 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:31:46,001 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000027744E54C10>
2025-06-25 22:31:46,001 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:31:46,002 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:31:46,002 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 22:31:46,006 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"9ceb1141-78fa-48ce-a8e1-e14ce0f86994","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:31:45.608080Z","submittedAt":"2025-06-26T02:31:45.608080Z","fillTimestamp":"2025-06-26T02:31:45.608080Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:31:45.608080Z","opened_at":"2025-06-26T02:31:45.608080Z","updated_at":"2025-06-26T02:31:45.608080Z","closed_at":"2025-06-26T02:31:45.608080Z"}
2025-06-25 22:31:46,006 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '9ceb1141-78fa-48ce-a8e1-e14ce0f86994', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:31:45.608080Z', 'submittedAt': '2025-06-26T02:31:45.608080Z', 'fillTimestamp': '2025-06-26T02:31:45.608080Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:31:45.608080Z', 'opened_at': '2025-06-26T02:31:45.608080Z', 'updated_at': '2025-06-26T02:31:45.608080Z', 'closed_at': '2025-06-26T02:31:45.608080Z'}
2025-06-25 22:31:46,006 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"17731e9d-2dd7-415c-ae3e-6d458bab6a91","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:31:45.608080Z","submittedAt":"2025-06-26T02:31:45.608080Z","fillTimestamp":"2025-06-26T02:31:45.608080Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:31:45.608080Z","opened_at":"2025-06-26T02:31:45.608080Z","updated_at":"2025-06-26T02:31:45.608080Z","closed_at":"2025-06-26T02:31:45.608080Z"}
2025-06-25 22:31:46,008 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': '17731e9d-2dd7-415c-ae3e-6d458bab6a91', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:31:45.608080Z', 'submittedAt': '2025-06-26T02:31:45.608080Z', 'fillTimestamp': '2025-06-26T02:31:45.608080Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:31:45.608080Z', 'opened_at': '2025-06-26T02:31:45.608080Z', 'updated_at': '2025-06-26T02:31:45.608080Z', 'closed_at': '2025-06-26T02:31:45.608080Z'}
2025-06-25 22:31:46,008 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"7af5659c-bb93-46c3-9b95-0df74bd95ab7","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:31:45.608080Z","submittedAt":"2025-06-26T02:31:45.608080Z","fillTimestamp":"2025-06-26T02:31:45.608080Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:31:45.608080Z","opened_at":"2025-06-26T02:31:45.608080Z","updated_at":"2025-06-26T02:31:45.608080Z","closed_at":"2025-06-26T02:31:45.608080Z"}
2025-06-25 22:31:46,008 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '7af5659c-bb93-46c3-9b95-0df74bd95ab7', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:31:45.608080Z', 'submittedAt': '2025-06-26T02:31:45.608080Z', 'fillTimestamp': '2025-06-26T02:31:45.608080Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:31:45.608080Z', 'opened_at': '2025-06-26T02:31:45.608080Z', 'updated_at': '2025-06-26T02:31:45.608080Z', 'closed_at': '2025-06-26T02:31:45.608080Z'}
2025-06-25 22:31:46,008 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 3
2025-06-25 22:31:46,008 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:31:46,009 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 22:31:46,028 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:31:46,028 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:31:46,049 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:31:46,050 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 22:31:46,051 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:31:46,051 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:31:46,227 - ultibot_backend - INFO - [MainThread] - main.py:104 - Apagando UltiBot Backend (lifespan)...
2025-06-25 22:31:46,229 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:189 - Shutting down dependency container...
2025-06-25 22:31:46,232 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:31:46,233 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:31:46,233 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:40 - Redis client closed.
2025-06-25 22:31:46,234 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:196 - Dependency container shut down.
2025-06-25 22:31:46,234 - ultibot_backend - INFO - [MainThread] - main.py:107 - Recursos liberados y aplicación apagada (lifespan).
2025-06-25 22:31:46,412 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:31:46,413 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:46,413 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:46,413 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:31:46,416 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:31:46,416 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000277448BD2D0>
2025-06-25 22:31:46,416 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:31:46,418 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:31:46,418 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: BTCUSDT, start_date: None, end_date: None
2025-06-25 22:31:46,422 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"fe2d7120-969e-43e1-8db6-c94b2b4cf4ed","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:31:46.019097Z","submittedAt":"2025-06-26T02:31:46.019097Z","fillTimestamp":"2025-06-26T02:31:46.019097Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:31:46.019097Z","opened_at":"2025-06-26T02:31:46.019097Z","updated_at":"2025-06-26T02:31:46.019097Z","closed_at":"2025-06-26T02:31:46.019097Z"}
2025-06-25 22:31:46,422 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': 'fe2d7120-969e-43e1-8db6-c94b2b4cf4ed', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:31:46.019097Z', 'submittedAt': '2025-06-26T02:31:46.019097Z', 'fillTimestamp': '2025-06-26T02:31:46.019097Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:31:46.019097Z', 'opened_at': '2025-06-26T02:31:46.019097Z', 'updated_at': '2025-06-26T02:31:46.019097Z', 'closed_at': '2025-06-26T02:31:46.019097Z'}
2025-06-25 22:31:46,422 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 1
2025-06-25 22:31:46,423 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 1 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:31:46,423 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 22:31:46,440 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:31:46,441 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:31:46,461 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:31:46,462 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 22:31:46,463 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:31:46,463 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:31:46,649 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:31:46,650 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:31:46,831 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:31:46,831 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:46,832 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:46,832 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:31:46,835 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:31:46,835 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000027744D60AD0>
2025-06-25 22:31:46,835 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:31:46,835 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:31:46,835 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 22:31:46,839 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"1d6a9156-540d-4865-9278-37db455d3bf3","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:31:46.433269Z","submittedAt":"2025-06-26T02:31:46.433269Z","fillTimestamp":"2025-06-26T02:31:46.433269Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:31:46.433269Z","opened_at":"2025-06-26T02:31:46.433269Z","updated_at":"2025-06-26T02:31:46.433269Z","closed_at":"2025-06-26T02:31:46.433269Z"}
2025-06-25 22:31:46,839 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '1d6a9156-540d-4865-9278-37db455d3bf3', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:31:46.433269Z', 'submittedAt': '2025-06-26T02:31:46.433269Z', 'fillTimestamp': '2025-06-26T02:31:46.433269Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:31:46.433269Z', 'opened_at': '2025-06-26T02:31:46.433269Z', 'updated_at': '2025-06-26T02:31:46.433269Z', 'closed_at': '2025-06-26T02:31:46.433269Z'}
2025-06-25 22:31:46,840 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"149eca3d-b569-42ba-a020-8d47cd3e1e68","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:31:46.433269Z","submittedAt":"2025-06-26T02:31:46.433269Z","fillTimestamp":"2025-06-26T02:31:46.433269Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:31:46.433269Z","opened_at":"2025-06-26T02:31:46.433269Z","updated_at":"2025-06-26T02:31:46.433269Z","closed_at":"2025-06-26T02:31:46.433269Z"}
2025-06-25 22:31:46,840 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': '149eca3d-b569-42ba-a020-8d47cd3e1e68', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:31:46.433269Z', 'submittedAt': '2025-06-26T02:31:46.433269Z', 'fillTimestamp': '2025-06-26T02:31:46.433269Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:31:46.433269Z', 'opened_at': '2025-06-26T02:31:46.433269Z', 'updated_at': '2025-06-26T02:31:46.433269Z', 'closed_at': '2025-06-26T02:31:46.433269Z'}
2025-06-25 22:31:46,840 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"61b32ebb-2653-42d2-90fe-452ce62b8d5e","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:31:46.433269Z","submittedAt":"2025-06-26T02:31:46.433269Z","fillTimestamp":"2025-06-26T02:31:46.433269Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:31:46.433269Z","opened_at":"2025-06-26T02:31:46.433269Z","updated_at":"2025-06-26T02:31:46.433269Z","closed_at":"2025-06-26T02:31:46.433269Z"}
2025-06-25 22:31:46,840 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '61b32ebb-2653-42d2-90fe-452ce62b8d5e', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:31:46.433269Z', 'submittedAt': '2025-06-26T02:31:46.433269Z', 'fillTimestamp': '2025-06-26T02:31:46.433269Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:31:46.433269Z', 'opened_at': '2025-06-26T02:31:46.433269Z', 'updated_at': '2025-06-26T02:31:46.433269Z', 'closed_at': '2025-06-26T02:31:46.433269Z'}
2025-06-25 22:31:46,841 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 3
2025-06-25 22:31:46,841 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:31:46,841 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 22:31:46,859 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:31:46,860 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:31:46,878 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:31:46,880 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 22:31:46,881 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:31:46,881 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:31:47,061 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:31:47,062 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:31:47,245 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:31:47,246 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:47,246 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:47,246 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:31:47,250 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:31:47,250 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000027744F1D690>
2025-06-25 22:31:47,250 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:31:47,250 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:31:47,251 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: 2025-06-27 02:31:46.880054+00:00, end_date: None
2025-06-25 22:31:47,254 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 0
2025-06-25 22:31:47,255 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:31:47,255 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 22:31:47,302 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 33847670-dbfa-4e06-8c0e-101c4c929685 for symbol BTCUSDT
2025-06-25 22:31:47,303 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: e25787f4-6e7b-46af-acc4-84056417f73f
2025-06-25 22:31:47,304 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 8bb75b83-a5bd-4858-b0b8-51a05321b2bf can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:31:47,321 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 41049a31-75af-4261-a9f7-4f5e142a480c for symbol BTCUSDT
2025-06-25 22:31:47,322 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 670ec5ae-36a6-4b56-b8e5-103092fbed73 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:31:47,329 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 9da733fa-f7f3-4b18-b085-51e103919e5e for symbol ETHUSDT
2025-06-25 22:31:47,330 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: d93b1476-dbaa-495f-a921-bd68c0d7710a
2025-06-25 22:31:47,331 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:590 - No active and applicable strategies found for opportunity 9da733fa-f7f3-4b18-b085-51e103919e5e with symbol ETHUSDT.
2025-06-25 22:31:47,332 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 9da733fa-f7f3-4b18-b085-51e103919e5e status to rejected_by_system: No active strategies are applicable to this opportunity's symbol.
2025-06-25 22:31:47,333 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 9da733fa-f7f3-4b18-b085-51e103919e5e
2025-06-25 22:31:47,341 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity b30e788b-ca6e-45a9-bd85-e6c6e88c8412 for symbol BTCUSDT
2025-06-25 22:31:47,341 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 3784d29a-e2cf-4382-92f5-8f831352f30b
2025-06-25 22:31:47,342 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:703 - AI confidence 0.65 for strategy 79e88c3e-383a-49af-9748-e8d8680f9982 is below threshold 0.8.
2025-06-25 22:31:47,345 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:718 - Strategy 79e88c3e-383a-49af-9748-e8d8680f9982 did not produce a decision for opportunity b30e788b-ca6e-45a9-bd85-e6c6e88c8412.
2025-06-25 22:31:47,346 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:609 - No affirmative trading decisions made for opportunity b30e788b-ca6e-45a9-bd85-e6c6e88c8412.
2025-06-25 22:31:47,356 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 4326b3f3-1ee9-4906-8970-a03217b62994 for symbol BTCUSDT
2025-06-25 22:31:47,356 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 73b6d94a-3cae-44ba-a035-3bbe274d5cec
2025-06-25 22:31:47,365 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity fed2c1f6-111c-430d-83dc-71896b337c0c for symbol BTCUSDT
2025-06-25 22:31:47,366 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 88aeef14-afe8-4492-9d45-2fb696ade13d
2025-06-25 22:31:47,373 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade c3fdfd0d-fd1d-4cfd-881e-b697c6aab7b6 from decision 5d14ddb9-77d3-4ed8-af6a-a518b19982aa
2025-06-25 22:31:47,379 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 4aa89266-8618-4dff-ad34-74ab0689b3e1 from decision b03f1142-4032-4426-be9e-b726a11db274
2025-06-25 22:31:47,380 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade b6bc3417-bdaa-4b23-88f1-d64de34436e1 from decision b03f1142-4032-4426-be9e-b726a11db274
2025-06-25 22:31:47,386 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:47,386 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:47,396 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:31:47,396 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:31:47,399 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:31:47,401 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity c2b47bc4-70a9-4f90-9d38-83177e82c700
2025-06-25 22:31:47,406 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 93db54a3-9d5b-4f35-993b-86724bf543c4. Creando y guardando configuración por defecto.
2025-06-25 22:31:47,408 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:31:47,410 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 93db54a3-9d5b-4f35-993b-86724bf543c4. Using default values.
2025-06-25 22:31:47,410 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 93db54a3-9d5b-4f35-993b-86724bf543c4 with capital: 10000.0
2025-06-25 22:31:47,411 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:31:47,412 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:31:47,412 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:31:47,412 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity c2b47bc4-70a9-4f90-9d38-83177e82c700
2025-06-25 22:31:47,413 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 3e81168c-4dd0-4e2c-b1c9-0e4b86c2a529 from decision dbc9488c-8cce-46f2-8e3e-6c82a1188bce
2025-06-25 22:31:47,414 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 3e81168c-4dd0-4e2c-b1c9-0e4b86c2a529 from confirmed opportunity.
2025-06-25 22:31:47,415 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:31:47,415 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('942515b7-143f-4ee9-88d6-7cb400f13143') orderId_exchange='mock_exchange_oco_id_a38cef1e-4d11-49eb-8d21-3bd4ef7f81ef' clientOrderId_exchange='mock_client_oco_id_d1207b15-b37e-49c8-bbe5-cdfa791f8bcb' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 31, 47, 415775) submittedAt=datetime.datetime(2025, 6, 26, 2, 31, 47, 415775, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 31, 47, 415775, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 133328252804825227465864133249744211231, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_50d96951-ae27-4aa5-b7c6-cdec2a89813b', 'transactionTime': 1750905107415, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='133328252804825227465864133249744211231' price=None stopPrice=None timeInForce=None
2025-06-25 22:31:47,416 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 93db54a3-9d5b-4f35-993b-86724bf543c4: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:31:47,420 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('3e81168c-4dd0-4e2c-b1c9-0e4b86c2a529'), '309f7cef-f3b3-4366-a681-97db6965c522', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:31:47.413766', '2025-06-26 02:31:47.413766', None, '{"id":"3e81168c-4dd0-4e2c-b1c9-0e4b86c2a529","user_id":"309f7cef-f3b3-4366-a681-97db6965c522","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:31:47.413766","opened_at":"2025-06-26T02:31:47.413766","updated_at":"2025-06-26T02:31:47.413766","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('3e81168c-4dd0-4e2c-b1c9-0e4b86c2a529'), '309f7cef-f3b3-4366-a681-97db6965c522', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:31:47.413766', '2025-06-26 02:31:47.413766', None, '{"id":"3e81168c-4dd0-4e2c-b1c9-0e4b86c2a529","user_id":"309f7cef-f3b3-4366-a681-97db6965c522","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:31:47.413766","opened_at":"2025-06-26T02:31:47.413766","updated_at":"2025-06-26T02:31:47.413766","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:31:47,426 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity c2b47bc4-70a9-4f90-9d38-83177e82c700: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('3e81168c-4dd0-4e2c-b1c9-0e4b86c2a529'), '309f7cef-f3b3-4366-a681-97db6965c522', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:31:47.413766', '2025-06-26 02:31:47.413766', None, '{"id":"3e81168c-4dd0-4e2c-b1c9-0e4b86c2a529","user_id":"309f7cef-f3b3-4366-a681-97db6965c522","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:31:47.413766","opened_at":"2025-06-26T02:31:47.413766","updated_at":"2025-06-26T02:31:47.413766","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:31:47,430 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity c2b47bc4-70a9-4f90-9d38-83177e82c700 status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:31:47,431 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:541 - Failed to persist status update for opportunity c2b47bc4-70a9-4f90-9d38-83177e82c700: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('3e81168c-4dd0-4e2c-b1c9-0e4b86c2a529'), '309f7cef-f3b3-4366-a681-97db6965c522', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:31:47.413766', '2025-06-26 02:31:47.413766', None, '{"id":"3e81168c-4dd0-4e2c-b1c9-0e4b86c2a529","user_id":"309f7cef-f3b3-4366-a681-97db6965c522","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:31:47.413766","opened_at":"2025-06-26T02:31:47.413766","updated_at":"2025-06-26T02:31:47.413766","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 534, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('3e81168c-4dd0-4e2c-b1c9-0e4b86c2a529'), '309f7cef-f3b3-4366-a681-97db6965c522', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:31:47.413766', '2025-06-26 02:31:47.413766', None, '{"id":"3e81168c-4dd0-4e2c-b1c9-0e4b86c2a529","user_id":"309f7cef-f3b3-4366-a681-97db6965c522","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:31:47.413766","opened_at":"2025-06-26T02:31:47.413766","updated_at":"2025-06-26T02:31:47.413766","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:31:47,729 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:31:47,731 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:31:47,740 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:47,740 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:47,750 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:31:47,750 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:31:47,753 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:31:47,755 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:31:47,757 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:31:47,765 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:47,765 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:47,773 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:31:47,773 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:31:47,775 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:31:47,777 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 89fa5aa1-3361-4764-b42c-23021a0591e9 for symbol BTC/USDT
2025-06-25 22:31:47,780 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id ee668220-fcb8-4b04-9e8f-4cab0bfe231d. Creando y guardando configuración por defecto.
2025-06-25 22:31:47,783 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:31:47,786 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:658 - AI profile 'ai-profile-scalping-1' for strategy 4bb84a47-5f79-48f4-b297-14649c5c5b69 not found. Skipping AI analysis.
2025-06-25 22:31:47,786 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 4bb84a47-5f79-48f4-b297-14649c5c5b69 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:31:47,786 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 89fa5aa1-3361-4764-b42c-23021a0591e9 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:31:47,792 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 89fa5aa1-3361-4764-b42c-23021a0591e9
2025-06-25 22:31:47,793 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:31:47,794 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:31:47,803 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:47,804 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:47,814 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:31:47,814 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:31:47,816 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:31:47,819 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 326772d3-740c-464f-8fae-b5c44ea3c805
2025-06-25 22:31:47,822 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 8731d7ad-f3e7-40e2-86fc-b88e39903cc5. Creando y guardando configuración por defecto.
2025-06-25 22:31:47,825 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:31:47,829 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 8731d7ad-f3e7-40e2-86fc-b88e39903cc5. Using default values.
2025-06-25 22:31:47,829 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 8731d7ad-f3e7-40e2-86fc-b88e39903cc5 with capital: 10000.0
2025-06-25 22:31:47,830 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:31:47,831 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:31:47,831 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:31:47,831 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Autonomous Scalping' as context for confirmed opportunity 326772d3-740c-464f-8fae-b5c44ea3c805
2025-06-25 22:31:47,832 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 51e30848-daca-41e7-9f4b-2fcd420d87aa from decision dbaeafb1-8720-4fb2-a7b2-9caa10e6375a
2025-06-25 22:31:47,833 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 51e30848-daca-41e7-9f4b-2fcd420d87aa from confirmed opportunity.
2025-06-25 22:31:47,834 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:31:47,835 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('969c4dd8-558d-43b3-8876-8e4ef39c99b7') orderId_exchange='mock_exchange_oco_id_e8a27f0f-63f7-4cc4-bcaa-ab3dc4e424d3' clientOrderId_exchange='mock_client_oco_id_4e48469e-6d79-49a1-82b9-e9d08b61fa14' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 31, 47, 835835) submittedAt=datetime.datetime(2025, 6, 26, 2, 31, 47, 835835, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 31, 47, 835835, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 337275695784504779821558948021255158915, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_58d618a0-c906-4c5b-a87e-44fe3bf0d6f8', 'transactionTime': 1750905107835, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='337275695784504779821558948021255158915' price=None stopPrice=None timeInForce=None
2025-06-25 22:31:47,836 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 8731d7ad-f3e7-40e2-86fc-b88e39903cc5: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:31:47,840 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('51e30848-daca-41e7-9f4b-2fcd420d87aa'), 'ee0042a5-c9dd-49a9-b96c-dd6892e53562', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:31:47.832833', '2025-06-26 02:31:47.832833', None, '{"id":"51e30848-daca-41e7-9f4b-2fcd420d87aa","user_id":"ee0042a5-c9dd-49a9-b96c-dd6892e53562","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:31:47.832833","opened_at":"2025-06-26T02:31:47.832833","updated_at":"2025-06-26T02:31:47.832833","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('51e30848-daca-41e7-9f4b-2fcd420d87aa'), 'ee0042a5-c9dd-49a9-b96c-dd6892e53562', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:31:47.832833', '2025-06-26 02:31:47.832833', None, '{"id":"51e30848-daca-41e7-9f4b-2fcd420d87aa","user_id":"ee0042a5-c9dd-49a9-b96c-dd6892e53562","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:31:47.832833","opened_at":"2025-06-26T02:31:47.832833","updated_at":"2025-06-26T02:31:47.832833","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:31:47,842 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 326772d3-740c-464f-8fae-b5c44ea3c805: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('51e30848-daca-41e7-9f4b-2fcd420d87aa'), 'ee0042a5-c9dd-49a9-b96c-dd6892e53562', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:31:47.832833', '2025-06-26 02:31:47.832833', None, '{"id":"51e30848-daca-41e7-9f4b-2fcd420d87aa","user_id":"ee0042a5-c9dd-49a9-b96c-dd6892e53562","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:31:47.832833","opened_at":"2025-06-26T02:31:47.832833","updated_at":"2025-06-26T02:31:47.832833","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:31:47,845 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 326772d3-740c-464f-8fae-b5c44ea3c805 status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:31:47,845 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:541 - Failed to persist status update for opportunity 326772d3-740c-464f-8fae-b5c44ea3c805: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('51e30848-daca-41e7-9f4b-2fcd420d87aa'), 'ee0042a5-c9dd-49a9-b96c-dd6892e53562', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:31:47.832833', '2025-06-26 02:31:47.832833', None, '{"id":"51e30848-daca-41e7-9f4b-2fcd420d87aa","user_id":"ee0042a5-c9dd-49a9-b96c-dd6892e53562","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:31:47.832833","opened_at":"2025-06-26T02:31:47.832833","updated_at":"2025-06-26T02:31:47.832833","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 534, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('51e30848-daca-41e7-9f4b-2fcd420d87aa'), 'ee0042a5-c9dd-49a9-b96c-dd6892e53562', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:31:47.832833', '2025-06-26 02:31:47.832833', None, '{"id":"51e30848-daca-41e7-9f4b-2fcd420d87aa","user_id":"ee0042a5-c9dd-49a9-b96c-dd6892e53562","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:31:47.832833","opened_at":"2025-06-26T02:31:47.832833","updated_at":"2025-06-26T02:31:47.832833","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:31:47,855 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:31:47,856 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:31:47,866 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:47,868 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:47,877 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:31:47,878 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:31:47,882 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:31:47,885 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 38afaa54-5b6a-4f81-9332-52cd4d94c69d
2025-06-25 22:31:47,888 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id b8546ae8-be7a-4323-8894-22ebcea3ac30. Creando y guardando configuración por defecto.
2025-06-25 22:31:47,891 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:31:47,895 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for b8546ae8-be7a-4323-8894-22ebcea3ac30. Using default values.
2025-06-25 22:31:47,895 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for b8546ae8-be7a-4323-8894-22ebcea3ac30 with capital: 10000.0
2025-06-25 22:31:47,896 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:31:47,897 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:31:47,897 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:31:47,897 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity 38afaa54-5b6a-4f81-9332-52cd4d94c69d
2025-06-25 22:31:47,898 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 67a5d3e1-c1c6-4b66-8278-a18a423416fb from decision 4932e1fb-c05d-474b-8b2d-b5b6965d0a02
2025-06-25 22:31:47,898 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 67a5d3e1-c1c6-4b66-8278-a18a423416fb from confirmed opportunity.
2025-06-25 22:31:47,899 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:31:47,900 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('cb2cb281-6526-4e81-b649-fb3bab2c295a') orderId_exchange='mock_exchange_oco_id_edbe3691-4c0e-4d52-9348-f897ba8f61da' clientOrderId_exchange='mock_client_oco_id_2f9ae4b3-ad9e-4304-adb9-63012226df8a' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 31, 47, 900521) submittedAt=datetime.datetime(2025, 6, 26, 2, 31, 47, 900521, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 31, 47, 900521, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 293804408836109549934766612706048265826, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_d85e18a0-869b-4e4c-bc69-7684ccd3719c', 'transactionTime': 1750905107900, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='293804408836109549934766612706048265826' price=None stopPrice=None timeInForce=None
2025-06-25 22:31:47,900 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario b8546ae8-be7a-4323-8894-22ebcea3ac30: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:31:47,903 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('67a5d3e1-c1c6-4b66-8278-a18a423416fb'), '645efca1-2e62-4f9a-8064-71484d37e14c', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:31:47.898233', '2025-06-26 02:31:47.898233', None, '{"id":"67a5d3e1-c1c6-4b66-8278-a18a423416fb","user_id":"645efca1-2e62-4f9a-8064-71484d37e14c","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:31:47.898233","opened_at":"2025-06-26T02:31:47.898233","updated_at":"2025-06-26T02:31:47.898233","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('67a5d3e1-c1c6-4b66-8278-a18a423416fb'), '645efca1-2e62-4f9a-8064-71484d37e14c', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:31:47.898233', '2025-06-26 02:31:47.898233', None, '{"id":"67a5d3e1-c1c6-4b66-8278-a18a423416fb","user_id":"645efca1-2e62-4f9a-8064-71484d37e14c","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:31:47.898233","opened_at":"2025-06-26T02:31:47.898233","updated_at":"2025-06-26T02:31:47.898233","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:31:47,905 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 38afaa54-5b6a-4f81-9332-52cd4d94c69d: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('67a5d3e1-c1c6-4b66-8278-a18a423416fb'), '645efca1-2e62-4f9a-8064-71484d37e14c', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:31:47.898233', '2025-06-26 02:31:47.898233', None, '{"id":"67a5d3e1-c1c6-4b66-8278-a18a423416fb","user_id":"645efca1-2e62-4f9a-8064-71484d37e14c","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:31:47.898233","opened_at":"2025-06-26T02:31:47.898233","updated_at":"2025-06-26T02:31:47.898233","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:31:47,908 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 38afaa54-5b6a-4f81-9332-52cd4d94c69d status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:31:47,909 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:541 - Failed to persist status update for opportunity 38afaa54-5b6a-4f81-9332-52cd4d94c69d: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('67a5d3e1-c1c6-4b66-8278-a18a423416fb'), '645efca1-2e62-4f9a-8064-71484d37e14c', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:31:47.898233', '2025-06-26 02:31:47.898233', None, '{"id":"67a5d3e1-c1c6-4b66-8278-a18a423416fb","user_id":"645efca1-2e62-4f9a-8064-71484d37e14c","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:31:47.898233","opened_at":"2025-06-26T02:31:47.898233","updated_at":"2025-06-26T02:31:47.898233","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 534, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('67a5d3e1-c1c6-4b66-8278-a18a423416fb'), '645efca1-2e62-4f9a-8064-71484d37e14c', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:31:47.898233', '2025-06-26 02:31:47.898233', None, '{"id":"67a5d3e1-c1c6-4b66-8278-a18a423416fb","user_id":"645efca1-2e62-4f9a-8064-71484d37e14c","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:31:47.898233","opened_at":"2025-06-26T02:31:47.898233","updated_at":"2025-06-26T02:31:47.898233","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:31:47,918 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:31:47,919 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:31:47,928 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:47,929 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:47,937 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:31:47,937 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:31:47,939 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:31:47,941 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 53ae979e-9d25-41f9-97f5-24b73b4633f0
2025-06-25 22:31:47,944 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id a9b03818-a7fc-4566-bd14-f52edf854860. Creando y guardando configuración por defecto.
2025-06-25 22:31:47,948 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:31:47,951 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for a9b03818-a7fc-4566-bd14-f52edf854860. Using default values.
2025-06-25 22:31:47,952 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for a9b03818-a7fc-4566-bd14-f52edf854860 with capital: 10000.0
2025-06-25 22:31:47,953 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:31:47,953 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:31:47,954 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:31:47,954 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Day Trading Strategy' as context for confirmed opportunity 53ae979e-9d25-41f9-97f5-24b73b4633f0
2025-06-25 22:31:47,954 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade a63d0390-4b67-4988-957d-c9738078fab6 from decision 5197f494-76c3-4e02-adad-bcc07656061b
2025-06-25 22:31:47,955 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade a63d0390-4b67-4988-957d-c9738078fab6 from confirmed opportunity.
2025-06-25 22:31:47,956 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:31:47,956 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('6dd797d3-3764-453b-b26f-deceb6064610') orderId_exchange='mock_exchange_oco_id_51d3b121-3cc4-44da-9e17-b38c03524835' clientOrderId_exchange='mock_client_oco_id_6fe16953-7db9-4a0e-9619-4398250eefbc' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 31, 47, 956178) submittedAt=datetime.datetime(2025, 6, 26, 2, 31, 47, 956178, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 31, 47, 956178, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 213545235264108041790384938748608191189, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_5144b667-f88a-4784-bc9f-da37c13460c4', 'transactionTime': 1750905107956, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='213545235264108041790384938748608191189' price=None stopPrice=None timeInForce=None
2025-06-25 22:31:47,957 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario a9b03818-a7fc-4566-bd14-f52edf854860: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:31:47,959 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('a63d0390-4b67-4988-957d-c9738078fab6'), '38068421-49d5-4c36-8dd4-cc95c41cb0e3', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:31:47.954178', '2025-06-26 02:31:47.954178', None, '{"id":"a63d0390-4b67-4988-957d-c9738078fab6","user_id":"38068421-49d5-4c36-8dd4-cc95c41cb0e3","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:31:47.954178","opened_at":"2025-06-26T02:31:47.954178","updated_at":"2025-06-26T02:31:47.954178","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('a63d0390-4b67-4988-957d-c9738078fab6'), '38068421-49d5-4c36-8dd4-cc95c41cb0e3', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:31:47.954178', '2025-06-26 02:31:47.954178', None, '{"id":"a63d0390-4b67-4988-957d-c9738078fab6","user_id":"38068421-49d5-4c36-8dd4-cc95c41cb0e3","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:31:47.954178","opened_at":"2025-06-26T02:31:47.954178","updated_at":"2025-06-26T02:31:47.954178","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:31:47,962 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 53ae979e-9d25-41f9-97f5-24b73b4633f0: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('a63d0390-4b67-4988-957d-c9738078fab6'), '38068421-49d5-4c36-8dd4-cc95c41cb0e3', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:31:47.954178', '2025-06-26 02:31:47.954178', None, '{"id":"a63d0390-4b67-4988-957d-c9738078fab6","user_id":"38068421-49d5-4c36-8dd4-cc95c41cb0e3","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:31:47.954178","opened_at":"2025-06-26T02:31:47.954178","updated_at":"2025-06-26T02:31:47.954178","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:31:47,965 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 53ae979e-9d25-41f9-97f5-24b73b4633f0 status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:31:47,966 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:541 - Failed to persist status update for opportunity 53ae979e-9d25-41f9-97f5-24b73b4633f0: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('a63d0390-4b67-4988-957d-c9738078fab6'), '38068421-49d5-4c36-8dd4-cc95c41cb0e3', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:31:47.954178', '2025-06-26 02:31:47.954178', None, '{"id":"a63d0390-4b67-4988-957d-c9738078fab6","user_id":"38068421-49d5-4c36-8dd4-cc95c41cb0e3","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:31:47.954178","opened_at":"2025-06-26T02:31:47.954178","updated_at":"2025-06-26T02:31:47.954178","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 534, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('a63d0390-4b67-4988-957d-c9738078fab6'), '38068421-49d5-4c36-8dd4-cc95c41cb0e3', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:31:47.954178', '2025-06-26 02:31:47.954178', None, '{"id":"a63d0390-4b67-4988-957d-c9738078fab6","user_id":"38068421-49d5-4c36-8dd4-cc95c41cb0e3","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:31:47.954178","opened_at":"2025-06-26T02:31:47.954178","updated_at":"2025-06-26T02:31:47.954178","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:31:47,975 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:31:47,976 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:31:47,984 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:47,984 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:47,992 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:31:47,992 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:31:47,995 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:31:47,997 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 230a8546-3d6e-4537-9ace-f6a881ca4a88 from decision 5c90f2bd-d4c0-4d28-9e90-cf9b19a1284e
2025-06-25 22:31:47,997 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:31:47,998 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:31:48,006 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:48,006 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:48,014 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:31:48,014 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:31:48,016 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:31:48,018 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade ae9621f9-5cee-43d2-8f21-9470fec77582 from decision 44b1bf96-cecb-4176-9a42-5076740e58d8
2025-06-25 22:31:48,018 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:31:48,020 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:31:48,027 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:48,027 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:48,036 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:31:48,036 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:31:48,039 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:31:48,041 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:31:48,042 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:31:50,056 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:50,056 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:50,062 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:31:50,064 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:31:50,065 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:31:50,078 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:31:50,086 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:31:50,087 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:31:50,092 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:31:50,100 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:31:50,103 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:31:50,108 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:50,108 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:50,112 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:50,113 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:50,114 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:31:50,119 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:50,120 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:50,129 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:50,130 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:50,139 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:50,140 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:50,143 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:31:50,149 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:50,150 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:50,158 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:286 - Verificación de Binance BINANCE_SPOT exitosa.
2025-06-25 22:31:50,165 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:50,166 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:50,170 - ultibot_backend.services.credential_service - ERROR - [MainThread] - credential_service.py:315 - Error de Binance API durante la verificación: Binance Down
2025-06-25 22:31:50,176 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:50,176 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:50,182 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:31:50,186 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:50,187 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:50,193 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:241 - Verificación de Telegram exitosa.
2025-06-25 22:31:50,199 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:72 - Conexión con Binance exitosa.
2025-06-25 22:31:50,205 - ultibot_backend.services.market_data_service - WARNING - [MainThread] - market_data_service.py:52 - Credenciales de Binance no encontradas. Por favor, configúrelas.
2025-06-25 22:31:50,210 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:69 - Fallo en la verificación de conexión con Binance. Revise sus credenciales y permisos.
2025-06-25 22:31:50,216 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:77 - Error al acceder a las credenciales de Binance: Decryption failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 45, in get_binance_connection_status
    binance_credential = await self.credential_service.get_credential(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.CredentialError: Decryption failed
2025-06-25 22:31:50,224 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:81 - Error de la API de Binance: API unavailable
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 61, in get_binance_connection_status
    is_connected = await self.credential_service.verify_credential(binance_credential)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.BinanceAPIError: API unavailable
2025-06-25 22:31:50,229 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:31:50,239 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:121 - Error de la API de Binance al obtener balances: Failed to fetch balances
2025-06-25 22:31:50,242 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2711304846160'>
2025-06-25 22:31:50,244 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317, mode_filter: None
2025-06-25 22:31:50,244 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2711304846160'>
2025-06-25 22:31:50,244 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317 with mode_filter: None
2025-06-25 22:31:50,248 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2711304246160'>
2025-06-25 22:31:50,250 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317, mode_filter: None
2025-06-25 22:31:50,250 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2711304246160'>
2025-06-25 22:31:50,250 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317 with mode_filter: None
2025-06-25 22:31:50,253 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2711304846992'>
2025-06-25 22:31:50,255 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317, mode_filter: OperatingMode.PAPER
2025-06-25 22:31:50,255 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2711304846992'>
2025-06-25 22:31:50,256 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317
2025-06-25 22:31:50,259 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2711304256912'>
2025-06-25 22:31:50,260 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317, mode_filter: OperatingMode.PAPER
2025-06-25 22:31:50,261 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2711304256912'>
2025-06-25 22:31:50,261 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317
2025-06-25 22:31:50,267 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2711303294800'>
2025-06-25 22:31:50,269 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317, mode_filter: OperatingMode.REAL
2025-06-25 22:31:50,269 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2711303294800'>
2025-06-25 22:31:50,270 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317
2025-06-25 22:31:50,273 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2711303740112'>
2025-06-25 22:31:50,274 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317, mode_filter: OperatingMode.PAPER
2025-06-25 22:31:50,274 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2711303740112'>
2025-06-25 22:31:50,275 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317
2025-06-25 22:31:50,278 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2711303705616'>
2025-06-25 22:31:50,280 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317, mode_filter: None
2025-06-25 22:31:50,281 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2711303705616'>
2025-06-25 22:31:50,281 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 2 performance entries for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317
2025-06-25 22:31:50,284 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2711303195408'>
2025-06-25 22:31:50,286 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317, mode_filter: OperatingMode.PAPER
2025-06-25 22:31:50,286 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2711303195408'>
2025-06-25 22:31:50,286 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317
2025-06-25 22:31:50,289 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2711303397712'>
2025-06-25 22:31:50,291 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317, mode_filter: OperatingMode.PAPER
2025-06-25 22:31:50,292 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2711303397712'>
2025-06-25 22:31:50,292 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317 with mode_filter: OperatingMode.PAPER
2025-06-25 22:31:50,296 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2711303202000'>
2025-06-25 22:31:50,297 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317, mode_filter: OperatingMode.PAPER
2025-06-25 22:31:50,298 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2711303202000'>
2025-06-25 22:31:50,298 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317 with mode_filter: OperatingMode.PAPER
2025-06-25 22:31:50,304 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2711304626256'>
2025-06-25 22:31:50,307 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317, mode_filter: OperatingMode.PAPER
2025-06-25 22:31:50,308 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2711304626256'>
2025-06-25 22:31:50,309 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317
2025-06-25 22:31:50,314 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2711303134800'>
2025-06-25 22:31:50,316 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317, mode_filter: OperatingMode.PAPER
2025-06-25 22:31:50,317 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2711303134800'>
2025-06-25 22:31:50,318 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317
2025-06-25 22:31:50,325 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2711304850512'>
2025-06-25 22:31:50,326 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317, mode_filter: OperatingMode.PAPER
2025-06-25 22:31:50,327 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2711304850512'>
2025-06-25 22:31:50,327 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317
2025-06-25 22:31:50,331 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2711304601936'>
2025-06-25 22:31:50,333 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317, mode_filter: OperatingMode.PAPER
2025-06-25 22:31:50,333 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2711304601936'>
2025-06-25 22:31:50,334 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user bcdc3433-f6a0-4d31-8c8f-ec22f4270317
2025-06-25 22:31:50,419 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 7aa8695f-5e83-4931-8aab-9e872d774b0a en modo paper
2025-06-25 22:31:50,430 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 23792981-b867-4b02-86a6-d66dd081764f en modo paper
2025-06-25 22:31:50,441 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario 5f0e4c82-3f9e-42ed-a1f7-10be6dd48ab3 en modo paper
2025-06-25 22:31:50,451 - ultibot_backend.services.trading_report_service - ERROR - [MainThread] - trading_report_service.py:79 - Error al obtener trades cerrados para usuario 245fa7a4-eaf1-4a50-9421-bedb0c5ecac7: Database connection failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_report_service.py", line 65, in get_closed_trades
    trades = await persistence_service.get_closed_trades(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
Exception: Database connection failed
2025-06-25 22:31:50,471 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 67c4fec8-995e-439e-a27a-880cea6b41d9 for symbol BTC/USDT
2025-06-25 22:31:50,476 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 6b1a927f-7e2e-4349-8f88-d61fdaeadf99 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:31:50,477 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 67c4fec8-995e-439e-a27a-880cea6b41d9 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:31:50,479 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 67c4fec8-995e-439e-a27a-880cea6b41d9
2025-06-25 22:31:50,488 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 40519b5e-2c29-429a-9852-1a14d2d0c49a for symbol BTC/USDT
2025-06-25 22:31:50,490 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 1e97bb9a-7424-4014-862c-094b48be8d4b can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:31:50,490 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 40519b5e-2c29-429a-9852-1a14d2d0c49a status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:31:50,492 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 40519b5e-2c29-429a-9852-1a14d2d0c49a
2025-06-25 22:31:50,506 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity ee3e9e41-5ea3-4779-8d31-8e1b2e049a24 for symbol BTC/USDT
2025-06-25 22:31:50,508 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 77f026cb-d675-4b49-ba42-c1b8e5a0a8c2 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:31:50,508 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity ee3e9e41-5ea3-4779-8d31-8e1b2e049a24 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:31:50,509 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity ee3e9e41-5ea3-4779-8d31-8e1b2e049a24
2025-06-25 22:31:50,523 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 69d8d603-6610-404d-9e76-fc8c79534e98 for symbol BTC/USDT
2025-06-25 22:31:50,524 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 8a162ad6-bed6-469f-807d-0ca48ed099f2 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:31:50,525 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 69d8d603-6610-404d-9e76-fc8c79534e98 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:31:50,643 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 69d8d603-6610-404d-9e76-fc8c79534e98
2025-06-25 22:31:50,657 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 178e0151-c4f3-474d-a11c-2e2fd2935a43 for symbol BTC/USDT
2025-06-25 22:31:50,657 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:639 - Unknown strategy type 'CUSTOM_UNKNOWN_TYPE' for strategy 094cea2a-5ee7-4212-8507-f81c06eb13a7. Recommending investigation.
2025-06-25 22:31:50,658 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 178e0151-c4f3-474d-a11c-2e2fd2935a43 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:31:50,659 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 178e0151-c4f3-474d-a11c-2e2fd2935a43
2025-06-25 22:31:50,670 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity 015469a6-e014-4ed4-aded-a28c1f7bbfe4 for symbol BTC/USDT
2025-06-25 22:31:50,671 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 2e365ae4-1686-462a-921e-3c9615b94fc4 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:31:50,672 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity 015469a6-e014-4ed4-aded-a28c1f7bbfe4 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:31:50,672 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity 015469a6-e014-4ed4-aded-a28c1f7bbfe4
2025-06-25 22:31:50,693 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:557 - Processing opportunity a67d0f70-9712-4540-b74a-c79beba1a6c6 for symbol BTC/USDT
2025-06-25 22:31:50,697 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:710 - Strategy 72880b9c-65fa-4307-aab5-87936ae87a58 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:31:50,697 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:532 - Updated opportunity a67d0f70-9712-4540-b74a-c79beba1a6c6 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:31:50,699 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:539 - Persisted status update for opportunity a67d0f70-9712-4540-b74a-c79beba1a6c6
2025-06-25 22:31:51,016 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:31:51,018 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:31:51,039 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:31:51,040 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:31:51,041 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:31:51,042 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:31:51,042 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:31:51,042 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:31:51,043 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:31:51,084 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:31:51,272 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:31:51,273 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:31:51,455 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:31:51,459 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:51,459 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:51,460 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:31:51,473 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:31:51,474 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000022F27F1F190>
2025-06-25 22:31:51,474 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:31:51,474 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:31:51,475 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:31:56,307 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:31:56,308 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:31:56,326 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:31:56,327 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:31:56,329 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:31:56,329 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:31:56,330 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:31:56,330 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:31:56,330 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:31:56,368 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:31:56,550 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:31:56,551 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:31:56,729 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:31:56,732 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:31:56,732 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:31:56,732 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:31:56,746 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:31:56,746 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001F5A13A4810>
2025-06-25 22:31:56,747 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:31:56,747 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:31:56,748 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:33:25,835 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:33:25,836 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:33:25,852 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:33:25,853 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:33:26,002 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:33:26,002 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:33:26,020 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:33:26,020 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:33:26,703 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:33:26,703 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:33:26,725 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:33:26,739 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:33:26,741 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:33:26,744 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:33:26,745 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:33:26,754 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:33:26,755 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:33:26,771 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:33:26,775 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:33:26,776 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:33:26,784 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:33:26,785 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:33:26,802 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:33:26,805 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:33:26,806 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:33:26,814 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:33:26,814 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:33:26,831 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:33:26,834 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:33:26,835 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:33:26,843 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:33:26,843 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:33:26,862 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:33:26,864 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:33:26,866 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:33:26,874 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:33:26,874 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:33:26,892 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:33:26,893 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:33:26,894 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:33:26,894 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:33:26,894 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:33:26,895 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:33:26,916 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:33:27,092 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:33:27,093 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:33:27,269 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:33:27,269 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:27,270 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:27,270 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:33:27,286 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:33:27,286 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000017E12309AD0>
2025-06-25 22:33:27,286 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:33:27,286 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:33:27,287 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 422
2025-06-25 22:33:27,296 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:33:27,296 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:33:27,404 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:33:27,405 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:33:27,406 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:33:27,406 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:33:27,577 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:33:27,578 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:33:27,753 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:33:27,754 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:27,754 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:27,754 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:33:27,756 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:33:27,756 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000017E12370910>
2025-06-25 22:33:27,756 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:33:27,757 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:33:27,765 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:33:27,773 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:33:27,773 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:33:27,782 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:33:27,783 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:33:27,802 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:33:27,804 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:33:27,804 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:33:27,804 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:33:27,976 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:33:27,977 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:33:28,158 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:33:28,158 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:28,158 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:28,158 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:33:28,163 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:33:28,163 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000017E120196D0>
2025-06-25 22:33:28,164 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:33:28,164 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:33:28,168 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:33:28,174 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:33:28,174 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:33:28,176 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:33:28,182 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:33:28,183 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:33:28,184 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:33:28,184 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:33:28,193 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:33:28,193 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:33:28,213 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:33:28,214 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:33:28,215 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:33:28,215 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:33:28,386 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:33:28,387 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:33:28,561 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:33:28,562 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:28,562 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:28,563 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:33:28,565 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:33:28,566 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000017E1201BF90>
2025-06-25 22:33:28,566 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:33:28,566 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:33:28,570 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:33:28,576 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:33:28,576 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:33:28,578 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:33:28,584 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:33:28,584 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:33:28,592 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:33:28,593 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:33:28,611 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:33:28,613 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:33:28,613 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:33:28,613 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:33:28,787 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:33:28,787 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:33:28,961 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:33:28,961 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:28,961 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:28,961 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:33:28,965 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:33:28,965 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000017E12099AD0>
2025-06-25 22:33:28,965 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:33:28,966 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:33:28,971 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:33:28,977 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:33:28,978 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:33:28,979 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:33:28,984 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:33:28,984 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:33:28,993 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:33:28,993 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:33:29,013 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:33:29,014 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:33:29,015 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:33:29,015 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:33:29,188 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:33:29,189 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:33:29,361 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:33:29,361 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:29,361 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:29,361 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:33:29,365 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:33:29,365 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000017E1201A810>
2025-06-25 22:33:29,366 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:33:29,366 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:33:29,367 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 422
2025-06-25 22:33:29,385 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity a8eab4f0-8b59-4dcc-8794-369de022b659
2025-06-25 22:33:29,386 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:152 - User configuration saved after initializing last_daily_reset for user 034a1368-5694-47d2-a348-772ce700c7e3.
2025-06-25 22:33:29,386 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 200.000
2025-06-25 22:33:29,386 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity a8eab4f0-8b59-4dcc-8794-369de022b659
2025-06-25 22:33:29,386 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:463 - Created trade 86b9fafe-cf23-418c-8be7-e983760cb996 from decision 053ea353-9be4-4048-b2fe-86b07dc1c48d
2025-06-25 22:33:29,388 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:286 - Successfully executed trade 86b9fafe-cf23-418c-8be7-e983760cb996 from confirmed opportunity.
2025-06-25 22:33:29,389 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:310 - Trade side: TradeSide.BUY, OCO side calculated: sell
2025-06-25 22:33:29,389 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:325 - Successfully created OCO order for trade 86b9fafe-cf23-418c-8be7-e983760cb996. OCO List ID: oco_list_123
2025-06-25 22:33:29,390 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:360 - Capital arriesgado actualizado para usuario 034a1368-5694-47d2-a348-772ce700c7e3: 200.0000000000000000000000000 (anterior: 0.0, valor trade: 200.0000000000000000000000000)
2025-06-25 22:33:29,390 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:367 - Updated daily_capital_risked_usd for user 034a1368-5694-47d2-a348-772ce700c7e3 to 200.0000000000000000000000000.
2025-06-25 22:33:29,391 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:551 - Updated opportunity a8eab4f0-8b59-4dcc-8794-369de022b659 status to converted_to_trade_real: Trade 86b9fafe-cf23-418c-8be7-e983760cb996 executed based on user confirmation.
2025-06-25 22:33:29,392 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:558 - Persisted status update for opportunity a8eab4f0-8b59-4dcc-8794-369de022b659
2025-06-25 22:33:29,400 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 10769f12-2237-489e-8efd-210f5b55a898
2025-06-25 22:33:29,401 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 4800.0, Riesgo Potencial Trade USD: 300.000
2025-06-25 22:33:29,401 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:191 - Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:33:29,402 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:551 - Updated opportunity 10769f12-2237-489e-8efd-210f5b55a898 status to error_in_processing: Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:33:29,402 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:558 - Persisted status update for opportunity 10769f12-2237-489e-8efd-210f5b55a898
2025-06-25 22:33:29,416 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 720bc420-86db-4d39-a264-50c53f0890f8
2025-06-25 22:33:29,416 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:143 - Daily capital reset triggered for user 7b7fe7de-ef62-4255-b752-4cd52741d4dc. Resetting daily_capital_risked_usd.
2025-06-25 22:33:29,417 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:147 - User configuration saved after daily capital reset for user 7b7fe7de-ef62-4255-b752-4cd52741d4dc.
2025-06-25 22:33:29,417 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 2500.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 100.000
2025-06-25 22:33:29,417 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity 720bc420-86db-4d39-a264-50c53f0890f8
2025-06-25 22:33:29,419 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:463 - Created trade 2f52be2b-e38a-4587-8079-9a8b55152323 from decision 2087a26c-2663-44ca-b870-f732f9387e1c
2025-06-25 22:33:29,419 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:286 - Successfully executed trade 2f52be2b-e38a-4587-8079-9a8b55152323 from confirmed opportunity.
2025-06-25 22:33:29,422 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:310 - Trade side: TradeSide.BUY, OCO side calculated: sell
2025-06-25 22:33:29,422 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:325 - Successfully created OCO order for trade 2f52be2b-e38a-4587-8079-9a8b55152323. OCO List ID: oco_reset_test
2025-06-25 22:33:29,423 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:360 - Capital arriesgado actualizado para usuario 7b7fe7de-ef62-4255-b752-4cd52741d4dc: 100.000 (anterior: 0.0, valor trade: 100.000)
2025-06-25 22:33:29,423 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:367 - Updated daily_capital_risked_usd for user 7b7fe7de-ef62-4255-b752-4cd52741d4dc to 100.000.
2025-06-25 22:33:29,424 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:551 - Updated opportunity 720bc420-86db-4d39-a264-50c53f0890f8 status to converted_to_trade_real: Trade 2f52be2b-e38a-4587-8079-9a8b55152323 executed based on user confirmation.
2025-06-25 22:33:29,424 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:558 - Persisted status update for opportunity 720bc420-86db-4d39-a264-50c53f0890f8
2025-06-25 22:33:29,440 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:33:29,440 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:33:29,459 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:33:29,461 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 22:33:29,462 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:33:29,462 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:33:29,634 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:33:29,634 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:33:29,811 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:33:29,812 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:29,812 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:29,812 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:33:29,816 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:33:29,816 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000017E120F1AD0>
2025-06-25 22:33:29,816 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:33:29,816 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:33:29,816 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 22:33:29,821 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"dbd72c21-beca-4b30-8f40-5589a3c67845","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:33:29.430145Z","submittedAt":"2025-06-26T02:33:29.430145Z","fillTimestamp":"2025-06-26T02:33:29.430145Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:33:29.430145Z","opened_at":"2025-06-26T02:33:29.430145Z","updated_at":"2025-06-26T02:33:29.430145Z","closed_at":"2025-06-26T02:33:29.430145Z"}
2025-06-25 22:33:29,821 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': 'dbd72c21-beca-4b30-8f40-5589a3c67845', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:33:29.430145Z', 'submittedAt': '2025-06-26T02:33:29.430145Z', 'fillTimestamp': '2025-06-26T02:33:29.430145Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:33:29.430145Z', 'opened_at': '2025-06-26T02:33:29.430145Z', 'updated_at': '2025-06-26T02:33:29.430145Z', 'closed_at': '2025-06-26T02:33:29.430145Z'}
2025-06-25 22:33:29,821 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"efbd4042-c02a-42ef-bff2-359a1b715c69","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:33:29.430145Z","submittedAt":"2025-06-26T02:33:29.430145Z","fillTimestamp":"2025-06-26T02:33:29.430145Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:33:29.430145Z","opened_at":"2025-06-26T02:33:29.430145Z","updated_at":"2025-06-26T02:33:29.430145Z","closed_at":"2025-06-26T02:33:29.430145Z"}
2025-06-25 22:33:29,822 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': 'efbd4042-c02a-42ef-bff2-359a1b715c69', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:33:29.430145Z', 'submittedAt': '2025-06-26T02:33:29.430145Z', 'fillTimestamp': '2025-06-26T02:33:29.430145Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:33:29.430145Z', 'opened_at': '2025-06-26T02:33:29.430145Z', 'updated_at': '2025-06-26T02:33:29.430145Z', 'closed_at': '2025-06-26T02:33:29.430145Z'}
2025-06-25 22:33:29,822 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"19f17e95-1c93-4066-b4c3-a0cf8e67cd15","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:33:29.430145Z","submittedAt":"2025-06-26T02:33:29.430145Z","fillTimestamp":"2025-06-26T02:33:29.430145Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:33:29.430145Z","opened_at":"2025-06-26T02:33:29.430145Z","updated_at":"2025-06-26T02:33:29.430145Z","closed_at":"2025-06-26T02:33:29.430145Z"}
2025-06-25 22:33:29,822 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '19f17e95-1c93-4066-b4c3-a0cf8e67cd15', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:33:29.430145Z', 'submittedAt': '2025-06-26T02:33:29.430145Z', 'fillTimestamp': '2025-06-26T02:33:29.430145Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:33:29.430145Z', 'opened_at': '2025-06-26T02:33:29.430145Z', 'updated_at': '2025-06-26T02:33:29.430145Z', 'closed_at': '2025-06-26T02:33:29.430145Z'}
2025-06-25 22:33:29,822 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 3
2025-06-25 22:33:29,822 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:33:29,823 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 22:33:29,841 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:33:29,841 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:33:29,859 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:33:29,860 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 22:33:29,861 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:33:29,861 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:33:30,038 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:33:30,039 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:33:30,213 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:33:30,213 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:30,214 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:30,214 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:33:30,216 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:33:30,216 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000017E12656010>
2025-06-25 22:33:30,217 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:33:30,217 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:33:30,217 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: BTCUSDT, start_date: None, end_date: None
2025-06-25 22:33:30,222 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"9189a504-4e4d-44a7-adfb-1339da1c4b96","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:33:29.832167Z","submittedAt":"2025-06-26T02:33:29.832167Z","fillTimestamp":"2025-06-26T02:33:29.832167Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:33:29.832167Z","opened_at":"2025-06-26T02:33:29.832167Z","updated_at":"2025-06-26T02:33:29.832167Z","closed_at":"2025-06-26T02:33:29.832167Z"}
2025-06-25 22:33:30,223 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '9189a504-4e4d-44a7-adfb-1339da1c4b96', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:33:29.832167Z', 'submittedAt': '2025-06-26T02:33:29.832167Z', 'fillTimestamp': '2025-06-26T02:33:29.832167Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:33:29.832167Z', 'opened_at': '2025-06-26T02:33:29.832167Z', 'updated_at': '2025-06-26T02:33:29.832167Z', 'closed_at': '2025-06-26T02:33:29.832167Z'}
2025-06-25 22:33:30,223 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 1
2025-06-25 22:33:30,224 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 1 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:33:30,224 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 22:33:30,241 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:33:30,242 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:33:30,261 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:33:30,263 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 22:33:30,263 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:33:30,264 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:33:30,437 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:33:30,437 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:33:30,620 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:33:30,620 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:30,620 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:30,620 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:33:30,623 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:33:30,623 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000017E12099AD0>
2025-06-25 22:33:30,624 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:33:30,624 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:33:30,624 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 22:33:30,626 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"1c3a8206-1f3a-4a51-941b-bd99067d2d8f","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:33:30.233286Z","submittedAt":"2025-06-26T02:33:30.233286Z","fillTimestamp":"2025-06-26T02:33:30.233286Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:33:30.233286Z","opened_at":"2025-06-26T02:33:30.233286Z","updated_at":"2025-06-26T02:33:30.233286Z","closed_at":"2025-06-26T02:33:30.233286Z"}
2025-06-25 22:33:30,627 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '1c3a8206-1f3a-4a51-941b-bd99067d2d8f', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:33:30.233286Z', 'submittedAt': '2025-06-26T02:33:30.233286Z', 'fillTimestamp': '2025-06-26T02:33:30.233286Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:33:30.233286Z', 'opened_at': '2025-06-26T02:33:30.233286Z', 'updated_at': '2025-06-26T02:33:30.233286Z', 'closed_at': '2025-06-26T02:33:30.233286Z'}
2025-06-25 22:33:30,627 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"b0584588-77f5-4abe-9af2-cada164cefa3","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:33:30.234292Z","submittedAt":"2025-06-26T02:33:30.234292Z","fillTimestamp":"2025-06-26T02:33:30.234292Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:33:30.234292Z","opened_at":"2025-06-26T02:33:30.234292Z","updated_at":"2025-06-26T02:33:30.234292Z","closed_at":"2025-06-26T02:33:30.234292Z"}
2025-06-25 22:33:30,627 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': 'b0584588-77f5-4abe-9af2-cada164cefa3', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:33:30.234292Z', 'submittedAt': '2025-06-26T02:33:30.234292Z', 'fillTimestamp': '2025-06-26T02:33:30.234292Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:33:30.234292Z', 'opened_at': '2025-06-26T02:33:30.234292Z', 'updated_at': '2025-06-26T02:33:30.234292Z', 'closed_at': '2025-06-26T02:33:30.234292Z'}
2025-06-25 22:33:30,627 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"e332aaf9-78ce-46f6-85d2-b4bc9d0b0dac","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:33:30.234292Z","submittedAt":"2025-06-26T02:33:30.234292Z","fillTimestamp":"2025-06-26T02:33:30.234292Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:33:30.234292Z","opened_at":"2025-06-26T02:33:30.234292Z","updated_at":"2025-06-26T02:33:30.234292Z","closed_at":"2025-06-26T02:33:30.234292Z"}
2025-06-25 22:33:30,628 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': 'e332aaf9-78ce-46f6-85d2-b4bc9d0b0dac', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:33:30.234292Z', 'submittedAt': '2025-06-26T02:33:30.234292Z', 'fillTimestamp': '2025-06-26T02:33:30.234292Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:33:30.234292Z', 'opened_at': '2025-06-26T02:33:30.234292Z', 'updated_at': '2025-06-26T02:33:30.234292Z', 'closed_at': '2025-06-26T02:33:30.234292Z'}
2025-06-25 22:33:30,628 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 3
2025-06-25 22:33:30,628 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:33:30,629 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 22:33:30,645 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:33:30,645 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:33:30,663 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:33:30,665 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 22:33:30,666 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:33:30,666 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:33:30,847 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:33:30,848 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:33:31,018 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:33:31,018 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:31,018 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:31,020 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:33:31,022 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:33:31,023 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000017E136B3990>
2025-06-25 22:33:31,023 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:33:31,023 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:33:31,023 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: 2025-06-27 02:33:30.664326+00:00, end_date: None
2025-06-25 22:33:31,026 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 0
2025-06-25 22:33:31,028 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:33:31,028 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 22:33:31,075 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:576 - Processing opportunity aa4b3557-97d6-4808-8805-bf45f794f160 for symbol BTCUSDT
2025-06-25 22:33:31,075 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 65af4fb8-e54d-45c4-a0a5-65232e4f554c
2025-06-25 22:33:31,076 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:729 - Strategy ed83b857-cd5a-4e80-a2d4-f4e3e34d6e34 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:33:31,086 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:576 - Processing opportunity 6500f3db-fde0-4d8f-88d0-034173de4a28 for symbol BTCUSDT
2025-06-25 22:33:31,087 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:729 - Strategy 65c6c989-2b79-4a9d-886b-fa07f0706674 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:33:31,094 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:576 - Processing opportunity 4df879c8-85ea-442b-918e-d27a2a2e15fe for symbol ETHUSDT
2025-06-25 22:33:31,094 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 75f5c894-ba0d-4ca9-bd9b-0b8035545dcb
2025-06-25 22:33:31,096 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:609 - No active and applicable strategies found for opportunity 4df879c8-85ea-442b-918e-d27a2a2e15fe with symbol ETHUSDT.
2025-06-25 22:33:31,096 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:551 - Updated opportunity 4df879c8-85ea-442b-918e-d27a2a2e15fe status to rejected_by_system: No active strategies are applicable to this opportunity's symbol.
2025-06-25 22:33:31,098 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:558 - Persisted status update for opportunity 4df879c8-85ea-442b-918e-d27a2a2e15fe
2025-06-25 22:33:31,107 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:576 - Processing opportunity d01961eb-1cf9-4e8f-befb-32389509f5aa for symbol BTCUSDT
2025-06-25 22:33:31,107 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: ddd97864-c8eb-49d1-8b8c-f97ec3189cc1
2025-06-25 22:33:31,108 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:722 - AI confidence 0.65 for strategy bf51bd1d-fd3a-415e-a104-3c274e17a47f is below threshold 0.8.
2025-06-25 22:33:31,109 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:737 - Strategy bf51bd1d-fd3a-415e-a104-3c274e17a47f did not produce a decision for opportunity d01961eb-1cf9-4e8f-befb-32389509f5aa.
2025-06-25 22:33:31,110 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:628 - No affirmative trading decisions made for opportunity d01961eb-1cf9-4e8f-befb-32389509f5aa.
2025-06-25 22:33:31,121 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:576 - Processing opportunity 81126ae6-f61d-4041-91e5-59bd85465d92 for symbol BTCUSDT
2025-06-25 22:33:31,121 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: c07b2562-3985-448f-87e8-f5c9c1835e4f
2025-06-25 22:33:31,128 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:576 - Processing opportunity 70106160-70cd-42d5-be6d-474dbb585c22 for symbol BTCUSDT
2025-06-25 22:33:31,129 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 47809dea-3038-4fad-890d-a3ed72f5efa2
2025-06-25 22:33:31,137 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:463 - Created trade deb77336-06ae-4b7e-95c2-19410aee9aae from decision 9435c0ba-e40f-4a1c-b6b5-12d7ced823aa
2025-06-25 22:33:31,143 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:463 - Created trade 51a93975-6715-40a0-8829-bdf5ac5babf0 from decision d57e7375-698f-4438-8546-35434f296da8
2025-06-25 22:33:31,143 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:463 - Created trade 71889701-ed40-446d-8ec0-7fe5c695a096 from decision d57e7375-698f-4438-8546-35434f296da8
2025-06-25 22:33:31,150 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:31,151 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:31,159 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:33:31,160 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:33:31,162 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:33:31,164 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity f0a031c1-8633-40da-9ad8-4fb82629ceee
2025-06-25 22:33:31,167 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id eb654594-cb38-4cd5-ab43-bcf9b7996a1b. Creando y guardando configuración por defecto.
2025-06-25 22:33:31,170 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:33:31,173 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for eb654594-cb38-4cd5-ab43-bcf9b7996a1b. Using default values.
2025-06-25 22:33:31,173 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for eb654594-cb38-4cd5-ab43-bcf9b7996a1b with capital: 10000.0
2025-06-25 22:33:31,174 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:33:31,175 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:33:31,175 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:33:31,175 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity f0a031c1-8633-40da-9ad8-4fb82629ceee
2025-06-25 22:33:31,176 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:463 - Created trade f7fe2dfb-c25e-4ff3-9389-57401075b1a1 from decision c4dff184-f222-4db7-9b8f-588e52e3ef8e
2025-06-25 22:33:31,176 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:286 - Successfully executed trade f7fe2dfb-c25e-4ff3-9389-57401075b1a1 from confirmed opportunity.
2025-06-25 22:33:31,177 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:310 - Trade side: TradeSide.BUY, OCO side calculated: sell
2025-06-25 22:33:31,178 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:329 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('1260c04a-7b23-45d3-a46d-67e60e437ff9') orderId_exchange='mock_exchange_oco_id_860c893e-879c-4317-8c00-1fbe40450336' clientOrderId_exchange='mock_client_oco_id_46f8bb0a-174c-4137-a25f-133662f8661f' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 33, 31, 178267) submittedAt=datetime.datetime(2025, 6, 26, 2, 33, 31, 178267, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 33, 31, 178267, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 118364887520787574911566135112608467799, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_ac033f9c-1d87-41e4-a812-efd6b7abac25', 'transactionTime': 1750905211178, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='118364887520787574911566135112608467799' price=None stopPrice=None timeInForce=None
2025-06-25 22:33:31,178 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:360 - Capital arriesgado actualizado para usuario eb654594-cb38-4cd5-ab43-bcf9b7996a1b: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:33:31,181 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('f7fe2dfb-c25e-4ff3-9389-57401075b1a1'), 'c9cb9485-1c49-4c2e-9903-c74b49ec2fc6', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:33:31.176269', '2025-06-26 02:33:31.176269', None, '{"id":"f7fe2dfb-c25e-4ff3-9389-57401075b1a1","user_id":"c9cb9485-1c49-4c2e-9903-c74b49ec2fc6","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:33:31.176269","opened_at":"2025-06-26T02:33:31.176269","updated_at":"2025-06-26T02:33:31.176269","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('f7fe2dfb-c25e-4ff3-9389-57401075b1a1'), 'c9cb9485-1c49-4c2e-9903-c74b49ec2fc6', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:33:31.176269', '2025-06-26 02:33:31.176269', None, '{"id":"f7fe2dfb-c25e-4ff3-9389-57401075b1a1","user_id":"c9cb9485-1c49-4c2e-9903-c74b49ec2fc6","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:33:31.176269","opened_at":"2025-06-26T02:33:31.176269","updated_at":"2025-06-26T02:33:31.176269","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:33:31,188 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:377 - Failed to execute trade for opportunity f0a031c1-8633-40da-9ad8-4fb82629ceee: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('f7fe2dfb-c25e-4ff3-9389-57401075b1a1'), 'c9cb9485-1c49-4c2e-9903-c74b49ec2fc6', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:33:31.176269', '2025-06-26 02:33:31.176269', None, '{"id":"f7fe2dfb-c25e-4ff3-9389-57401075b1a1","user_id":"c9cb9485-1c49-4c2e-9903-c74b49ec2fc6","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:33:31.176269","opened_at":"2025-06-26T02:33:31.176269","updated_at":"2025-06-26T02:33:31.176269","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 366, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:33:31,191 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:551 - Updated opportunity f0a031c1-8633-40da-9ad8-4fb82629ceee status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:33:31,191 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:560 - Failed to persist status update for opportunity f0a031c1-8633-40da-9ad8-4fb82629ceee: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('f7fe2dfb-c25e-4ff3-9389-57401075b1a1'), 'c9cb9485-1c49-4c2e-9903-c74b49ec2fc6', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:33:31.176269', '2025-06-26 02:33:31.176269', None, '{"id":"f7fe2dfb-c25e-4ff3-9389-57401075b1a1","user_id":"c9cb9485-1c49-4c2e-9903-c74b49ec2fc6","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:33:31.176269","opened_at":"2025-06-26T02:33:31.176269","updated_at":"2025-06-26T02:33:31.176269","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 553, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('f7fe2dfb-c25e-4ff3-9389-57401075b1a1'), 'c9cb9485-1c49-4c2e-9903-c74b49ec2fc6', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:33:31.176269', '2025-06-26 02:33:31.176269', None, '{"id":"f7fe2dfb-c25e-4ff3-9389-57401075b1a1","user_id":"c9cb9485-1c49-4c2e-9903-c74b49ec2fc6","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:33:31.176269","opened_at":"2025-06-26T02:33:31.176269","updated_at":"2025-06-26T02:33:31.176269","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:33:31,473 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:33:31,474 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:33:31,482 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:31,483 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:31,491 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:33:31,491 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:33:31,493 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:33:31,496 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:33:31,496 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:33:31,505 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:31,506 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:31,514 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:33:31,515 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:33:31,517 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:33:31,519 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:576 - Processing opportunity ac21ff0d-4c39-4680-bfc3-3eea844fe3e1 for symbol BTC/USDT
2025-06-25 22:33:31,522 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 9898df4a-9bfc-4900-9b0c-00b12bcf2c5b. Creando y guardando configuración por defecto.
2025-06-25 22:33:31,525 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:33:31,526 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:677 - AI profile 'ai-profile-scalping-1' for strategy 01c80d6f-0f9a-4b38-a789-f2b51a681668 not found. Skipping AI analysis.
2025-06-25 22:33:31,526 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:729 - Strategy 01c80d6f-0f9a-4b38-a789-f2b51a681668 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:33:31,526 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:551 - Updated opportunity ac21ff0d-4c39-4680-bfc3-3eea844fe3e1 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:33:31,535 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:558 - Persisted status update for opportunity ac21ff0d-4c39-4680-bfc3-3eea844fe3e1
2025-06-25 22:33:31,536 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:33:31,536 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:33:31,546 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:31,546 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:31,554 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:33:31,554 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:33:31,556 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:33:31,558 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 026a6d6e-ad65-4440-900d-efd2b4db4c2b
2025-06-25 22:33:31,561 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id cb004c30-bc17-47df-bd7e-d3a567ecd372. Creando y guardando configuración por defecto.
2025-06-25 22:33:31,564 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:33:31,567 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for cb004c30-bc17-47df-bd7e-d3a567ecd372. Using default values.
2025-06-25 22:33:31,567 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for cb004c30-bc17-47df-bd7e-d3a567ecd372 with capital: 10000.0
2025-06-25 22:33:31,569 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:33:31,570 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:33:31,570 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:33:31,571 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Autonomous Scalping' as context for confirmed opportunity 026a6d6e-ad65-4440-900d-efd2b4db4c2b
2025-06-25 22:33:31,571 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:463 - Created trade 277783fd-e60a-4419-927d-06b829f9d10c from decision 574d5997-caba-427f-a58c-dae1ff25b479
2025-06-25 22:33:31,572 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:286 - Successfully executed trade 277783fd-e60a-4419-927d-06b829f9d10c from confirmed opportunity.
2025-06-25 22:33:31,573 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:310 - Trade side: TradeSide.BUY, OCO side calculated: sell
2025-06-25 22:33:31,573 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:329 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('b8beea08-e58b-40d7-85d2-7b7b77f42cef') orderId_exchange='mock_exchange_oco_id_bdbc3f6d-5452-49f2-b931-0e1c1ecf675e' clientOrderId_exchange='mock_client_oco_id_18a9286d-c5ad-4119-9393-83c840024eac' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 33, 31, 573060) submittedAt=datetime.datetime(2025, 6, 26, 2, 33, 31, 573060, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 33, 31, 573060, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 45940472726072434343388904922597438067, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_a988358d-bf02-4586-a83e-08807ba86344', 'transactionTime': 1750905211573, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='45940472726072434343388904922597438067' price=None stopPrice=None timeInForce=None
2025-06-25 22:33:31,574 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:360 - Capital arriesgado actualizado para usuario cb004c30-bc17-47df-bd7e-d3a567ecd372: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:33:31,576 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('277783fd-e60a-4419-927d-06b829f9d10c'), '3f0f2aed-1903-4279-8a00-81e1eb825523', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:33:31.571060', '2025-06-26 02:33:31.571060', None, '{"id":"277783fd-e60a-4419-927d-06b829f9d10c","user_id":"3f0f2aed-1903-4279-8a00-81e1eb825523","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:33:31.571060","opened_at":"2025-06-26T02:33:31.571060","updated_at":"2025-06-26T02:33:31.571060","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('277783fd-e60a-4419-927d-06b829f9d10c'), '3f0f2aed-1903-4279-8a00-81e1eb825523', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:33:31.571060', '2025-06-26 02:33:31.571060', None, '{"id":"277783fd-e60a-4419-927d-06b829f9d10c","user_id":"3f0f2aed-1903-4279-8a00-81e1eb825523","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:33:31.571060","opened_at":"2025-06-26T02:33:31.571060","updated_at":"2025-06-26T02:33:31.571060","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:33:31,578 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:377 - Failed to execute trade for opportunity 026a6d6e-ad65-4440-900d-efd2b4db4c2b: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('277783fd-e60a-4419-927d-06b829f9d10c'), '3f0f2aed-1903-4279-8a00-81e1eb825523', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:33:31.571060', '2025-06-26 02:33:31.571060', None, '{"id":"277783fd-e60a-4419-927d-06b829f9d10c","user_id":"3f0f2aed-1903-4279-8a00-81e1eb825523","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:33:31.571060","opened_at":"2025-06-26T02:33:31.571060","updated_at":"2025-06-26T02:33:31.571060","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 366, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:33:31,580 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:551 - Updated opportunity 026a6d6e-ad65-4440-900d-efd2b4db4c2b status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:33:31,581 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:560 - Failed to persist status update for opportunity 026a6d6e-ad65-4440-900d-efd2b4db4c2b: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('277783fd-e60a-4419-927d-06b829f9d10c'), '3f0f2aed-1903-4279-8a00-81e1eb825523', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:33:31.571060', '2025-06-26 02:33:31.571060', None, '{"id":"277783fd-e60a-4419-927d-06b829f9d10c","user_id":"3f0f2aed-1903-4279-8a00-81e1eb825523","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:33:31.571060","opened_at":"2025-06-26T02:33:31.571060","updated_at":"2025-06-26T02:33:31.571060","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 553, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('277783fd-e60a-4419-927d-06b829f9d10c'), '3f0f2aed-1903-4279-8a00-81e1eb825523', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:33:31.571060', '2025-06-26 02:33:31.571060', None, '{"id":"277783fd-e60a-4419-927d-06b829f9d10c","user_id":"3f0f2aed-1903-4279-8a00-81e1eb825523","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:33:31.571060","opened_at":"2025-06-26T02:33:31.571060","updated_at":"2025-06-26T02:33:31.571060","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:33:31,591 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:33:31,592 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:33:31,600 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:31,601 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:31,608 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:33:31,608 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:33:31,611 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:33:31,612 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity e614f260-ca2a-42cb-9a40-884f0963be86
2025-06-25 22:33:31,616 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 617bebe1-2d82-4ab5-917b-b875e880114f. Creando y guardando configuración por defecto.
2025-06-25 22:33:31,619 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:33:31,622 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 617bebe1-2d82-4ab5-917b-b875e880114f. Using default values.
2025-06-25 22:33:31,622 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 617bebe1-2d82-4ab5-917b-b875e880114f with capital: 10000.0
2025-06-25 22:33:31,623 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:33:31,624 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:33:31,624 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:33:31,624 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity e614f260-ca2a-42cb-9a40-884f0963be86
2025-06-25 22:33:31,624 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:463 - Created trade ff8bcbbe-0338-4a65-9b77-75011a52bf77 from decision 1cd6150a-0da2-4581-b9e5-855fa29b9404
2025-06-25 22:33:31,625 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:286 - Successfully executed trade ff8bcbbe-0338-4a65-9b77-75011a52bf77 from confirmed opportunity.
2025-06-25 22:33:31,626 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:310 - Trade side: TradeSide.BUY, OCO side calculated: sell
2025-06-25 22:33:31,626 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:329 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('90648e82-0821-4cf9-a613-f2f4483e02a2') orderId_exchange='mock_exchange_oco_id_e2c3f43b-526c-4c0c-a425-fdcedeccac34' clientOrderId_exchange='mock_client_oco_id_582c4134-ce34-45d5-9ca3-2845e52ef3c4' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 33, 31, 626935) submittedAt=datetime.datetime(2025, 6, 26, 2, 33, 31, 626935, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 33, 31, 626935, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 142084508632547159579499488793576606844, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_d2d411b6-0a12-44a7-8eaf-e6519a8b9cda', 'transactionTime': 1750905211626, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='142084508632547159579499488793576606844' price=None stopPrice=None timeInForce=None
2025-06-25 22:33:31,627 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:360 - Capital arriesgado actualizado para usuario 617bebe1-2d82-4ab5-917b-b875e880114f: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:33:31,630 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('ff8bcbbe-0338-4a65-9b77-75011a52bf77'), '47af424a-6083-4562-b13e-5ca608e13f65', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:33:31.624935', '2025-06-26 02:33:31.624935', None, '{"id":"ff8bcbbe-0338-4a65-9b77-75011a52bf77","user_id":"47af424a-6083-4562-b13e-5ca608e13f65","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:33:31.624935","opened_at":"2025-06-26T02:33:31.624935","updated_at":"2025-06-26T02:33:31.624935","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('ff8bcbbe-0338-4a65-9b77-75011a52bf77'), '47af424a-6083-4562-b13e-5ca608e13f65', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:33:31.624935', '2025-06-26 02:33:31.624935', None, '{"id":"ff8bcbbe-0338-4a65-9b77-75011a52bf77","user_id":"47af424a-6083-4562-b13e-5ca608e13f65","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:33:31.624935","opened_at":"2025-06-26T02:33:31.624935","updated_at":"2025-06-26T02:33:31.624935","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:33:31,632 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:377 - Failed to execute trade for opportunity e614f260-ca2a-42cb-9a40-884f0963be86: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('ff8bcbbe-0338-4a65-9b77-75011a52bf77'), '47af424a-6083-4562-b13e-5ca608e13f65', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:33:31.624935', '2025-06-26 02:33:31.624935', None, '{"id":"ff8bcbbe-0338-4a65-9b77-75011a52bf77","user_id":"47af424a-6083-4562-b13e-5ca608e13f65","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:33:31.624935","opened_at":"2025-06-26T02:33:31.624935","updated_at":"2025-06-26T02:33:31.624935","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 366, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:33:31,635 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:551 - Updated opportunity e614f260-ca2a-42cb-9a40-884f0963be86 status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:33:31,636 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:560 - Failed to persist status update for opportunity e614f260-ca2a-42cb-9a40-884f0963be86: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('ff8bcbbe-0338-4a65-9b77-75011a52bf77'), '47af424a-6083-4562-b13e-5ca608e13f65', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:33:31.624935', '2025-06-26 02:33:31.624935', None, '{"id":"ff8bcbbe-0338-4a65-9b77-75011a52bf77","user_id":"47af424a-6083-4562-b13e-5ca608e13f65","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:33:31.624935","opened_at":"2025-06-26T02:33:31.624935","updated_at":"2025-06-26T02:33:31.624935","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 553, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('ff8bcbbe-0338-4a65-9b77-75011a52bf77'), '47af424a-6083-4562-b13e-5ca608e13f65', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:33:31.624935', '2025-06-26 02:33:31.624935', None, '{"id":"ff8bcbbe-0338-4a65-9b77-75011a52bf77","user_id":"47af424a-6083-4562-b13e-5ca608e13f65","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:33:31.624935","opened_at":"2025-06-26T02:33:31.624935","updated_at":"2025-06-26T02:33:31.624935","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:33:31,646 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:33:31,648 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:33:31,656 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:31,656 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:31,664 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:33:31,664 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:33:31,668 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:33:31,670 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 436536f8-7a6c-420a-a6ae-cdff976f6e8e
2025-06-25 22:33:31,673 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 728395b0-e0ed-4a08-b505-0ea2abb11e8d. Creando y guardando configuración por defecto.
2025-06-25 22:33:31,676 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:33:31,679 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 728395b0-e0ed-4a08-b505-0ea2abb11e8d. Using default values.
2025-06-25 22:33:31,679 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 728395b0-e0ed-4a08-b505-0ea2abb11e8d with capital: 10000.0
2025-06-25 22:33:31,682 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:33:31,683 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:33:31,683 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:33:31,683 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Day Trading Strategy' as context for confirmed opportunity 436536f8-7a6c-420a-a6ae-cdff976f6e8e
2025-06-25 22:33:31,684 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:463 - Created trade 629f671e-eb75-489e-90e2-20a9fb4f956e from decision 72296f7e-e5f9-4965-958a-d05945b87f20
2025-06-25 22:33:31,685 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:286 - Successfully executed trade 629f671e-eb75-489e-90e2-20a9fb4f956e from confirmed opportunity.
2025-06-25 22:33:31,687 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:310 - Trade side: TradeSide.BUY, OCO side calculated: sell
2025-06-25 22:33:31,688 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:329 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('529b7d17-30f1-4209-99ef-e9f15201973c') orderId_exchange='mock_exchange_oco_id_6efe1d96-56ed-4ad3-aa64-b312874266f1' clientOrderId_exchange='mock_client_oco_id_2b109536-0afb-4d02-96cf-9e1f825427b6' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 33, 31, 688099) submittedAt=datetime.datetime(2025, 6, 26, 2, 33, 31, 688099, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 33, 31, 688099, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 291647857281109632726502653144418927511, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_cdccb348-0269-42e4-9f1f-117192f3783b', 'transactionTime': 1750905211688, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='291647857281109632726502653144418927511' price=None stopPrice=None timeInForce=None
2025-06-25 22:33:31,688 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:360 - Capital arriesgado actualizado para usuario 728395b0-e0ed-4a08-b505-0ea2abb11e8d: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:33:31,692 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('629f671e-eb75-489e-90e2-20a9fb4f956e'), '2076564e-5d1f-43c2-bf2d-f145e2edbced', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:33:31.684095', '2025-06-26 02:33:31.684095', None, '{"id":"629f671e-eb75-489e-90e2-20a9fb4f956e","user_id":"2076564e-5d1f-43c2-bf2d-f145e2edbced","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:33:31.684095","opened_at":"2025-06-26T02:33:31.684095","updated_at":"2025-06-26T02:33:31.684095","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('629f671e-eb75-489e-90e2-20a9fb4f956e'), '2076564e-5d1f-43c2-bf2d-f145e2edbced', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:33:31.684095', '2025-06-26 02:33:31.684095', None, '{"id":"629f671e-eb75-489e-90e2-20a9fb4f956e","user_id":"2076564e-5d1f-43c2-bf2d-f145e2edbced","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:33:31.684095","opened_at":"2025-06-26T02:33:31.684095","updated_at":"2025-06-26T02:33:31.684095","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:33:31,694 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:377 - Failed to execute trade for opportunity 436536f8-7a6c-420a-a6ae-cdff976f6e8e: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('629f671e-eb75-489e-90e2-20a9fb4f956e'), '2076564e-5d1f-43c2-bf2d-f145e2edbced', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:33:31.684095', '2025-06-26 02:33:31.684095', None, '{"id":"629f671e-eb75-489e-90e2-20a9fb4f956e","user_id":"2076564e-5d1f-43c2-bf2d-f145e2edbced","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:33:31.684095","opened_at":"2025-06-26T02:33:31.684095","updated_at":"2025-06-26T02:33:31.684095","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 366, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:33:31,696 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:551 - Updated opportunity 436536f8-7a6c-420a-a6ae-cdff976f6e8e status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:33:31,698 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:560 - Failed to persist status update for opportunity 436536f8-7a6c-420a-a6ae-cdff976f6e8e: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('629f671e-eb75-489e-90e2-20a9fb4f956e'), '2076564e-5d1f-43c2-bf2d-f145e2edbced', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:33:31.684095', '2025-06-26 02:33:31.684095', None, '{"id":"629f671e-eb75-489e-90e2-20a9fb4f956e","user_id":"2076564e-5d1f-43c2-bf2d-f145e2edbced","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:33:31.684095","opened_at":"2025-06-26T02:33:31.684095","updated_at":"2025-06-26T02:33:31.684095","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 553, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('629f671e-eb75-489e-90e2-20a9fb4f956e'), '2076564e-5d1f-43c2-bf2d-f145e2edbced', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:33:31.684095', '2025-06-26 02:33:31.684095', None, '{"id":"629f671e-eb75-489e-90e2-20a9fb4f956e","user_id":"2076564e-5d1f-43c2-bf2d-f145e2edbced","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:33:31.684095","opened_at":"2025-06-26T02:33:31.684095","updated_at":"2025-06-26T02:33:31.684095","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:33:31,707 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:33:31,708 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:33:31,719 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:31,719 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:31,726 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:33:31,727 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:33:31,729 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:33:31,731 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:463 - Created trade dc3f103a-6b7d-4471-973b-4ab0b526a12e from decision 4da00bad-77e7-4aba-9de2-19a497cdbca0
2025-06-25 22:33:31,732 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:33:31,733 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:33:31,742 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:31,742 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:31,750 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:33:31,750 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:33:31,754 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:33:31,755 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:463 - Created trade 7a19e533-d78d-4d1d-b55f-f501ec489c5d from decision e1df5050-a788-4c63-a14a-adfd944ff707
2025-06-25 22:33:31,756 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:33:31,757 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:33:31,766 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:31,766 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:31,777 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:33:31,777 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:33:31,782 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:33:31,784 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:33:31,786 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:33:33,606 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:33,606 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:33,612 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:33:33,613 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:33:33,615 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:33:33,622 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:33:33,626 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:33:33,627 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:33:33,631 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:33:33,639 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:33:33,642 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:33:33,645 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:33,646 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:33,650 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:33,651 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:33,652 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:33:33,655 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:33,655 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:33,662 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:33,663 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:33,670 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:33,671 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:33,674 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:33:33,678 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:33,678 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:33,683 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:286 - Verificación de Binance BINANCE_SPOT exitosa.
2025-06-25 22:33:33,687 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:33,688 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:33,691 - ultibot_backend.services.credential_service - ERROR - [MainThread] - credential_service.py:315 - Error de Binance API durante la verificación: Binance Down
2025-06-25 22:33:33,696 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:33,696 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:33,702 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:33:33,706 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:33:33,707 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:33:33,710 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:241 - Verificación de Telegram exitosa.
2025-06-25 22:33:33,716 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:72 - Conexión con Binance exitosa.
2025-06-25 22:33:33,722 - ultibot_backend.services.market_data_service - WARNING - [MainThread] - market_data_service.py:52 - Credenciales de Binance no encontradas. Por favor, configúrelas.
2025-06-25 22:33:33,726 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:69 - Fallo en la verificación de conexión con Binance. Revise sus credenciales y permisos.
2025-06-25 22:33:33,733 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:77 - Error al acceder a las credenciales de Binance: Decryption failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 45, in get_binance_connection_status
    binance_credential = await self.credential_service.get_credential(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.CredentialError: Decryption failed
2025-06-25 22:33:33,739 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:81 - Error de la API de Binance: API unavailable
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 61, in get_binance_connection_status
    is_connected = await self.credential_service.verify_credential(binance_credential)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.BinanceAPIError: API unavailable
2025-06-25 22:33:33,744 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:33:33,753 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:121 - Error de la API de Binance al obtener balances: Failed to fetch balances
2025-06-25 22:33:33,756 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1641010057936'>
2025-06-25 22:33:33,758 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 38cc249c-8d46-4265-a72d-7a5e914380b4, mode_filter: None
2025-06-25 22:33:33,758 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1641010057936'>
2025-06-25 22:33:33,758 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 38cc249c-8d46-4265-a72d-7a5e914380b4 with mode_filter: None
2025-06-25 22:33:33,762 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1641010158800'>
2025-06-25 22:33:33,763 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 38cc249c-8d46-4265-a72d-7a5e914380b4, mode_filter: None
2025-06-25 22:33:33,763 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1641010158800'>
2025-06-25 22:33:33,764 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 38cc249c-8d46-4265-a72d-7a5e914380b4 with mode_filter: None
2025-06-25 22:33:33,769 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1641010154832'>
2025-06-25 22:33:33,770 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 38cc249c-8d46-4265-a72d-7a5e914380b4, mode_filter: OperatingMode.PAPER
2025-06-25 22:33:33,770 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1641010154832'>
2025-06-25 22:33:33,771 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 38cc249c-8d46-4265-a72d-7a5e914380b4
2025-06-25 22:33:33,773 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1641010141264'>
2025-06-25 22:33:33,775 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 38cc249c-8d46-4265-a72d-7a5e914380b4, mode_filter: OperatingMode.PAPER
2025-06-25 22:33:33,775 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1641010141264'>
2025-06-25 22:33:33,776 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 38cc249c-8d46-4265-a72d-7a5e914380b4
2025-06-25 22:33:33,779 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1641010107536'>
2025-06-25 22:33:33,780 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 38cc249c-8d46-4265-a72d-7a5e914380b4, mode_filter: OperatingMode.REAL
2025-06-25 22:33:33,780 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1641010107536'>
2025-06-25 22:33:33,781 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 38cc249c-8d46-4265-a72d-7a5e914380b4
2025-06-25 22:33:33,785 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1641010117968'>
2025-06-25 22:33:33,786 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 38cc249c-8d46-4265-a72d-7a5e914380b4, mode_filter: OperatingMode.PAPER
2025-06-25 22:33:33,786 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1641010117968'>
2025-06-25 22:33:33,787 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 38cc249c-8d46-4265-a72d-7a5e914380b4
2025-06-25 22:33:33,790 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1641010074832'>
2025-06-25 22:33:33,792 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 38cc249c-8d46-4265-a72d-7a5e914380b4, mode_filter: None
2025-06-25 22:33:33,792 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1641010074832'>
2025-06-25 22:33:33,792 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 2 performance entries for user 38cc249c-8d46-4265-a72d-7a5e914380b4
2025-06-25 22:33:33,796 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1641009952528'>
2025-06-25 22:33:33,797 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 38cc249c-8d46-4265-a72d-7a5e914380b4, mode_filter: OperatingMode.PAPER
2025-06-25 22:33:33,797 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1641009952528'>
2025-06-25 22:33:33,797 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 38cc249c-8d46-4265-a72d-7a5e914380b4
2025-06-25 22:33:33,802 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1641009527120'>
2025-06-25 22:33:33,803 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 38cc249c-8d46-4265-a72d-7a5e914380b4, mode_filter: OperatingMode.PAPER
2025-06-25 22:33:33,803 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1641009527120'>
2025-06-25 22:33:33,804 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 38cc249c-8d46-4265-a72d-7a5e914380b4 with mode_filter: OperatingMode.PAPER
2025-06-25 22:33:33,807 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1641009522512'>
2025-06-25 22:33:33,808 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 38cc249c-8d46-4265-a72d-7a5e914380b4, mode_filter: OperatingMode.PAPER
2025-06-25 22:33:33,809 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1641009522512'>
2025-06-25 22:33:33,809 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 38cc249c-8d46-4265-a72d-7a5e914380b4 with mode_filter: OperatingMode.PAPER
2025-06-25 22:33:33,812 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1641008722192'>
2025-06-25 22:33:33,813 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 38cc249c-8d46-4265-a72d-7a5e914380b4, mode_filter: OperatingMode.PAPER
2025-06-25 22:33:33,814 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1641008722192'>
2025-06-25 22:33:33,814 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 38cc249c-8d46-4265-a72d-7a5e914380b4
2025-06-25 22:33:33,817 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1641009239952'>
2025-06-25 22:33:33,819 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 38cc249c-8d46-4265-a72d-7a5e914380b4, mode_filter: OperatingMode.PAPER
2025-06-25 22:33:33,819 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1641009239952'>
2025-06-25 22:33:33,820 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 38cc249c-8d46-4265-a72d-7a5e914380b4
2025-06-25 22:33:33,823 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1641009632144'>
2025-06-25 22:33:33,825 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 38cc249c-8d46-4265-a72d-7a5e914380b4, mode_filter: OperatingMode.PAPER
2025-06-25 22:33:33,825 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1641009632144'>
2025-06-25 22:33:33,825 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 38cc249c-8d46-4265-a72d-7a5e914380b4
2025-06-25 22:33:33,829 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1641009240848'>
2025-06-25 22:33:33,830 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 38cc249c-8d46-4265-a72d-7a5e914380b4, mode_filter: OperatingMode.PAPER
2025-06-25 22:33:33,830 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1641009240848'>
2025-06-25 22:33:33,830 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 38cc249c-8d46-4265-a72d-7a5e914380b4
2025-06-25 22:33:33,880 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 84dbaf3f-0c6f-44ae-9639-ae45acdd5456 en modo paper
2025-06-25 22:33:33,888 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 394b21c5-4647-480e-a637-7bf52f8aeb69 en modo paper
2025-06-25 22:33:33,893 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario b287a969-2971-4d72-ab14-c3d93c3770d9 en modo paper
2025-06-25 22:33:33,897 - ultibot_backend.services.trading_report_service - ERROR - [MainThread] - trading_report_service.py:79 - Error al obtener trades cerrados para usuario 42ff9c52-9c69-4189-a36f-fb6b8145765c: Database connection failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_report_service.py", line 65, in get_closed_trades
    trades = await persistence_service.get_closed_trades(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
Exception: Database connection failed
2025-06-25 22:33:33,907 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:576 - Processing opportunity cff9bc3d-b5e7-48b8-96a5-963962972dd4 for symbol BTC/USDT
2025-06-25 22:33:33,909 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:729 - Strategy 7be1cab5-73de-4429-a8f7-e0f324259485 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:33:33,909 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:551 - Updated opportunity cff9bc3d-b5e7-48b8-96a5-963962972dd4 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:33:33,910 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:558 - Persisted status update for opportunity cff9bc3d-b5e7-48b8-96a5-963962972dd4
2025-06-25 22:33:33,920 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:576 - Processing opportunity 73a02a2c-8de5-491a-8526-1a59ce48c320 for symbol BTC/USDT
2025-06-25 22:33:33,922 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:729 - Strategy f3d483dc-76c6-4039-98b3-e92fd90a4c7d can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:33:33,922 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:551 - Updated opportunity 73a02a2c-8de5-491a-8526-1a59ce48c320 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:33:33,924 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:558 - Persisted status update for opportunity 73a02a2c-8de5-491a-8526-1a59ce48c320
2025-06-25 22:33:33,934 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:576 - Processing opportunity eef1cb5d-9ef4-4f68-a106-b8e1e13a9210 for symbol BTC/USDT
2025-06-25 22:33:33,936 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:729 - Strategy e1c8b04f-bcaf-41d1-b305-8104cd6fc873 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:33:33,936 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:551 - Updated opportunity eef1cb5d-9ef4-4f68-a106-b8e1e13a9210 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:33:33,938 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:558 - Persisted status update for opportunity eef1cb5d-9ef4-4f68-a106-b8e1e13a9210
2025-06-25 22:33:33,948 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:576 - Processing opportunity 8c2d467b-c7c7-4871-9b3c-8c7f4ef0359c for symbol BTC/USDT
2025-06-25 22:33:33,950 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:729 - Strategy 68621e24-465d-43da-afae-cbd75909b8f6 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:33:33,950 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:551 - Updated opportunity 8c2d467b-c7c7-4871-9b3c-8c7f4ef0359c status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:33:33,951 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:558 - Persisted status update for opportunity 8c2d467b-c7c7-4871-9b3c-8c7f4ef0359c
2025-06-25 22:33:33,962 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:576 - Processing opportunity 8cdf80b4-bb61-4008-93db-0bf92295941f for symbol BTC/USDT
2025-06-25 22:33:33,963 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:658 - Unknown strategy type 'CUSTOM_UNKNOWN_TYPE' for strategy aa08b1a7-bfcc-413b-bc20-11142d9346af. Recommending investigation.
2025-06-25 22:33:33,963 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:551 - Updated opportunity 8cdf80b4-bb61-4008-93db-0bf92295941f status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:33:33,964 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:558 - Persisted status update for opportunity 8cdf80b4-bb61-4008-93db-0bf92295941f
2025-06-25 22:33:33,978 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:576 - Processing opportunity c21fe001-ed74-4823-860d-00efb95f97e7 for symbol BTC/USDT
2025-06-25 22:33:33,980 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:729 - Strategy 82305eb1-337c-4cbf-9d9a-bcfa20399aa0 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:33:33,980 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:551 - Updated opportunity c21fe001-ed74-4823-860d-00efb95f97e7 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:33:33,981 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:558 - Persisted status update for opportunity c21fe001-ed74-4823-860d-00efb95f97e7
2025-06-25 22:33:34,005 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:576 - Processing opportunity 386f8c39-8c8f-40f0-b59b-5c670f24a6e7 for symbol BTC/USDT
2025-06-25 22:33:34,007 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:729 - Strategy 6115fc7c-5ac3-49e5-bee7-c89a28e7e8a1 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:33:34,007 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:551 - Updated opportunity 386f8c39-8c8f-40f0-b59b-5c670f24a6e7 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:33:34,008 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:558 - Persisted status update for opportunity 386f8c39-8c8f-40f0-b59b-5c670f24a6e7
2025-06-25 22:34:32,949 - ultibot_backend - INFO - [MainThread] - main.py:104 - Apagando UltiBot Backend (lifespan)...
2025-06-25 22:34:32,949 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:189 - Shutting down dependency container...
2025-06-25 22:34:32,953 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:40 - Redis client closed.
2025-06-25 22:34:32,954 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:196 - Dependency container shut down.
2025-06-25 22:34:32,954 - ultibot_backend - INFO - [MainThread] - main.py:107 - Recursos liberados y aplicación apagada (lifespan).
2025-06-25 22:34:37,651 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:34:37,651 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:34:37,671 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:34:37,672 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:34:37,673 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:34:37,674 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:34:37,674 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:34:37,674 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:34:37,675 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:34:37,717 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:34:37,895 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:34:37,896 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:34:38,080 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:34:38,084 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:34:38,084 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:34:38,085 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:34:38,097 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:34:38,097 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000002171663C510>
2025-06-25 22:34:38,098 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:34:38,098 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:34:38,099 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:34:42,895 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:34:42,896 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:34:42,913 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:34:42,914 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:34:42,915 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:34:42,915 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:34:42,915 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:34:42,917 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:34:42,917 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:34:42,957 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:34:43,133 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:34:43,134 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:34:43,322 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:34:43,325 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:34:43,326 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:34:43,326 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:34:43,339 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:34:43,339 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000002751CC25390>
2025-06-25 22:34:43,340 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:34:43,340 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:34:43,340 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:34:48,012 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:34:48,012 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:34:48,033 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:34:48,034 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:34:48,035 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:34:48,036 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:34:48,036 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:34:48,036 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:34:48,037 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:34:48,076 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:34:48,266 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:34:48,267 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:34:48,452 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:34:48,455 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:34:48,456 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:34:48,456 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:34:48,470 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:34:48,470 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000174E4FC2450>
2025-06-25 22:34:48,470 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:34:48,470 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:34:48,471 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:34:53,052 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:34:53,053 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:34:53,073 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:34:53,073 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:34:53,074 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:34:53,075 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:34:53,075 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:34:53,076 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:34:53,076 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:34:53,113 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:34:53,298 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:34:53,299 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:34:53,483 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:34:53,486 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:34:53,486 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:34:53,488 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:34:53,501 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:34:53,501 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000019B3865CE90>
2025-06-25 22:34:53,502 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:34:53,502 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:34:53,503 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:35:34,042 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:35:34,043 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:35:34,060 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:35:34,061 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:35:34,215 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:35:34,215 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:35:34,234 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:35:34,234 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:35:34,921 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:35:34,922 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:35:34,941 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:35:34,957 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:35:34,958 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:35:34,961 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:35:34,962 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:35:34,970 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:35:34,971 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:35:34,987 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:35:34,990 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:35:34,992 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:35:35,000 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:35:35,000 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:35:35,017 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:35:35,020 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:35:35,022 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:35:35,028 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:35:35,029 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:35:35,047 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:35:35,050 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:35:35,051 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:35:35,059 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:35:35,059 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:35:35,078 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:35:35,080 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:35:35,082 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:35:35,089 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:35:35,090 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:35:35,106 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:35:35,108 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:35:35,108 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:35:35,109 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:35:35,109 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:35:35,110 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:35:35,129 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:35:35,304 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:35:35,305 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:35:35,480 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:35:35,481 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:35,481 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:35,481 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:35:35,497 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:35:35,497 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000028BCDA19AD0>
2025-06-25 22:35:35,498 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:35:35,498 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:35:35,499 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 422
2025-06-25 22:35:35,509 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:35:35,509 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:35:35,616 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:35:35,619 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:35:35,619 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:35:35,619 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:35:35,796 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:35:35,797 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:35:35,976 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:35:35,976 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:35,976 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:35,976 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:35:35,980 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:35:35,981 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000028BCDA2D710>
2025-06-25 22:35:35,981 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:35:35,981 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:35:35,991 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:35:35,999 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:35:36,000 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:35:36,009 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:35:36,010 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:35:36,028 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:35:36,029 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:35:36,029 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:35:36,030 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:35:36,204 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:35:36,204 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:35:36,380 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:35:36,381 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:36,381 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:36,381 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:35:36,385 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:35:36,385 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000028BCD823650>
2025-06-25 22:35:36,385 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:35:36,386 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:35:36,389 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:35:36,396 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:35:36,396 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:35:36,398 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:35:36,403 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:35:36,404 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:35:36,405 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:35:36,405 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:35:36,414 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:35:36,415 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:35:36,434 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:35:36,436 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:35:36,436 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:35:36,436 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:35:36,612 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:35:36,612 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:35:36,786 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:35:36,786 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:36,786 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:36,786 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:35:36,789 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:35:36,790 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000028BCDA7FF50>
2025-06-25 22:35:36,790 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:35:36,790 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:35:36,794 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:35:36,802 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:35:36,802 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:35:36,803 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:35:36,809 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:35:36,810 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:35:36,818 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:35:36,819 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:35:36,836 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:35:36,838 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:35:36,838 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:35:36,839 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:35:37,012 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:35:37,012 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:35:37,190 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:35:37,190 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:37,190 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:37,192 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:35:37,194 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:35:37,194 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000028BCAF89950>
2025-06-25 22:35:37,195 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:35:37,195 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:35:37,198 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:35:37,206 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:35:37,206 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:35:37,207 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:35:37,212 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:35:37,212 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:35:37,222 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:35:37,223 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:35:37,241 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:35:37,242 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:35:37,243 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:35:37,244 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:35:37,416 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:35:37,418 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:35:37,594 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:35:37,595 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:37,595 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:37,595 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:35:37,599 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:35:37,599 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000028BCDA75250>
2025-06-25 22:35:37,600 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:35:37,600 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:35:37,600 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 422
2025-06-25 22:35:37,618 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 304eda9b-4325-4c77-8324-bd2f962b567e
2025-06-25 22:35:37,619 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:152 - User configuration saved after initializing last_daily_reset for user b30be3dc-a1b6-49bb-9cb3-bc7f39142681.
2025-06-25 22:35:37,619 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 200.000
2025-06-25 22:35:37,620 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity 304eda9b-4325-4c77-8324-bd2f962b567e
2025-06-25 22:35:37,620 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 8e2464a4-2a78-401a-978d-c0d242bc0c58 from decision 39d20848-0295-4663-9bdf-485b40994d95
2025-06-25 22:35:37,621 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 8e2464a4-2a78-401a-978d-c0d242bc0c58 from confirmed opportunity.
2025-06-25 22:35:37,622 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:35:37,622 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:310 - Successfully created OCO order for trade 8e2464a4-2a78-401a-978d-c0d242bc0c58. OCO List ID: oco_list_123
2025-06-25 22:35:37,623 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario b30be3dc-a1b6-49bb-9cb3-bc7f39142681: 200.0000000000000000000000000 (anterior: 0.0, valor trade: 200.0000000000000000000000000)
2025-06-25 22:35:37,623 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user b30be3dc-a1b6-49bb-9cb3-bc7f39142681 to 200.0000000000000000000000000.
2025-06-25 22:35:37,624 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 304eda9b-4325-4c77-8324-bd2f962b567e status to converted_to_trade_real: Trade 8e2464a4-2a78-401a-978d-c0d242bc0c58 executed based on user confirmation.
2025-06-25 22:35:37,625 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 304eda9b-4325-4c77-8324-bd2f962b567e
2025-06-25 22:35:37,635 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 95f2cb04-9ec2-4aa2-ba5e-e2785820ee29
2025-06-25 22:35:37,636 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 4800.0, Riesgo Potencial Trade USD: 300.000
2025-06-25 22:35:37,636 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:191 - Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:35:37,636 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 95f2cb04-9ec2-4aa2-ba5e-e2785820ee29 status to error_in_processing: Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:35:37,637 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 95f2cb04-9ec2-4aa2-ba5e-e2785820ee29
2025-06-25 22:35:37,651 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 7744c636-c93e-424e-a589-35cd14b1b4f6
2025-06-25 22:35:37,652 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:143 - Daily capital reset triggered for user 11b25479-cdda-4b80-a7ae-97043ffa734a. Resetting daily_capital_risked_usd.
2025-06-25 22:35:37,652 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:147 - User configuration saved after daily capital reset for user 11b25479-cdda-4b80-a7ae-97043ffa734a.
2025-06-25 22:35:37,652 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 2500.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 100.000
2025-06-25 22:35:37,653 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity 7744c636-c93e-424e-a589-35cd14b1b4f6
2025-06-25 22:35:37,653 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade c2b3cf93-296a-4f39-84b6-0b2b2ad1d23b from decision 79e8e843-d6f5-4665-bd53-4d433df9663d
2025-06-25 22:35:37,653 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade c2b3cf93-296a-4f39-84b6-0b2b2ad1d23b from confirmed opportunity.
2025-06-25 22:35:37,656 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:35:37,656 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:310 - Successfully created OCO order for trade c2b3cf93-296a-4f39-84b6-0b2b2ad1d23b. OCO List ID: oco_reset_test
2025-06-25 22:35:37,657 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 11b25479-cdda-4b80-a7ae-97043ffa734a: 100.000 (anterior: 0.0, valor trade: 100.000)
2025-06-25 22:35:37,657 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user 11b25479-cdda-4b80-a7ae-97043ffa734a to 100.000.
2025-06-25 22:35:37,658 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 7744c636-c93e-424e-a589-35cd14b1b4f6 status to converted_to_trade_real: Trade c2b3cf93-296a-4f39-84b6-0b2b2ad1d23b executed based on user confirmation.
2025-06-25 22:35:37,658 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 7744c636-c93e-424e-a589-35cd14b1b4f6
2025-06-25 22:35:37,673 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:35:37,674 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:35:37,691 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:35:37,693 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 22:35:37,693 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:35:37,694 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:35:37,869 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:35:37,870 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:35:38,050 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:35:38,050 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:38,051 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:38,051 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:35:38,053 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:35:38,054 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000028BCD6EB490>
2025-06-25 22:35:38,054 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:35:38,054 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:35:38,055 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 22:35:38,060 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"2f61e286-d10a-4f28-b131-8b2ff2e090fb","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:35:37.663901Z","submittedAt":"2025-06-26T02:35:37.663901Z","fillTimestamp":"2025-06-26T02:35:37.663901Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:35:37.663901Z","opened_at":"2025-06-26T02:35:37.663901Z","updated_at":"2025-06-26T02:35:37.663901Z","closed_at":"2025-06-26T02:35:37.663901Z"}
2025-06-25 22:35:38,061 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '2f61e286-d10a-4f28-b131-8b2ff2e090fb', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:35:37.663901Z', 'submittedAt': '2025-06-26T02:35:37.663901Z', 'fillTimestamp': '2025-06-26T02:35:37.663901Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:35:37.663901Z', 'opened_at': '2025-06-26T02:35:37.663901Z', 'updated_at': '2025-06-26T02:35:37.663901Z', 'closed_at': '2025-06-26T02:35:37.663901Z'}
2025-06-25 22:35:38,061 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"72f870f6-b209-4a1b-bae9-0f6d9a1cd13a","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:35:37.663901Z","submittedAt":"2025-06-26T02:35:37.663901Z","fillTimestamp":"2025-06-26T02:35:37.663901Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:35:37.663901Z","opened_at":"2025-06-26T02:35:37.663901Z","updated_at":"2025-06-26T02:35:37.663901Z","closed_at":"2025-06-26T02:35:37.663901Z"}
2025-06-25 22:35:38,061 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': '72f870f6-b209-4a1b-bae9-0f6d9a1cd13a', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:35:37.663901Z', 'submittedAt': '2025-06-26T02:35:37.663901Z', 'fillTimestamp': '2025-06-26T02:35:37.663901Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:35:37.663901Z', 'opened_at': '2025-06-26T02:35:37.663901Z', 'updated_at': '2025-06-26T02:35:37.663901Z', 'closed_at': '2025-06-26T02:35:37.663901Z'}
2025-06-25 22:35:38,062 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"2f587600-56ea-4f28-bc8c-f021a66bf096","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:35:37.663901Z","submittedAt":"2025-06-26T02:35:37.663901Z","fillTimestamp":"2025-06-26T02:35:37.663901Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:35:37.663901Z","opened_at":"2025-06-26T02:35:37.663901Z","updated_at":"2025-06-26T02:35:37.663901Z","closed_at":"2025-06-26T02:35:37.663901Z"}
2025-06-25 22:35:38,062 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '2f587600-56ea-4f28-bc8c-f021a66bf096', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:35:37.663901Z', 'submittedAt': '2025-06-26T02:35:37.663901Z', 'fillTimestamp': '2025-06-26T02:35:37.663901Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:35:37.663901Z', 'opened_at': '2025-06-26T02:35:37.663901Z', 'updated_at': '2025-06-26T02:35:37.663901Z', 'closed_at': '2025-06-26T02:35:37.663901Z'}
2025-06-25 22:35:38,062 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 3
2025-06-25 22:35:38,062 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:35:38,063 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 22:35:38,080 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:35:38,081 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:35:38,096 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:35:38,099 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 22:35:38,100 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:35:38,100 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:35:38,275 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:35:38,275 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:35:38,452 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:35:38,452 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:38,452 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:38,452 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:35:38,455 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:35:38,455 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000028BCED72FD0>
2025-06-25 22:35:38,455 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:35:38,456 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:35:38,456 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: BTCUSDT, start_date: None, end_date: None
2025-06-25 22:35:38,461 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"52b37a36-bc01-48de-8168-09db89999bc5","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:35:38.072633Z","submittedAt":"2025-06-26T02:35:38.072633Z","fillTimestamp":"2025-06-26T02:35:38.072633Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:35:38.072633Z","opened_at":"2025-06-26T02:35:38.072633Z","updated_at":"2025-06-26T02:35:38.072633Z","closed_at":"2025-06-26T02:35:38.072633Z"}
2025-06-25 22:35:38,461 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '52b37a36-bc01-48de-8168-09db89999bc5', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:35:38.072633Z', 'submittedAt': '2025-06-26T02:35:38.072633Z', 'fillTimestamp': '2025-06-26T02:35:38.072633Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:35:38.072633Z', 'opened_at': '2025-06-26T02:35:38.072633Z', 'updated_at': '2025-06-26T02:35:38.072633Z', 'closed_at': '2025-06-26T02:35:38.072633Z'}
2025-06-25 22:35:38,462 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 1
2025-06-25 22:35:38,462 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 1 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:35:38,463 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 22:35:38,481 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:35:38,481 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:35:38,499 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:35:38,500 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 22:35:38,501 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:35:38,501 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:35:38,675 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:35:38,675 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:35:38,851 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:35:38,852 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:38,852 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:38,852 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:35:38,855 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:35:38,855 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000028BCDBF1A90>
2025-06-25 22:35:38,855 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:35:38,855 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:35:38,856 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 22:35:38,859 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"ebeb6f77-3550-49ab-910f-703dbfbc3108","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:35:38.473818Z","submittedAt":"2025-06-26T02:35:38.473818Z","fillTimestamp":"2025-06-26T02:35:38.473818Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:35:38.473818Z","opened_at":"2025-06-26T02:35:38.473818Z","updated_at":"2025-06-26T02:35:38.473818Z","closed_at":"2025-06-26T02:35:38.473818Z"}
2025-06-25 22:35:38,859 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': 'ebeb6f77-3550-49ab-910f-703dbfbc3108', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:35:38.473818Z', 'submittedAt': '2025-06-26T02:35:38.473818Z', 'fillTimestamp': '2025-06-26T02:35:38.473818Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:35:38.473818Z', 'opened_at': '2025-06-26T02:35:38.473818Z', 'updated_at': '2025-06-26T02:35:38.473818Z', 'closed_at': '2025-06-26T02:35:38.473818Z'}
2025-06-25 22:35:38,860 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"907c374a-1621-452f-aed4-6c748abc31a2","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:35:38.473818Z","submittedAt":"2025-06-26T02:35:38.473818Z","fillTimestamp":"2025-06-26T02:35:38.473818Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:35:38.473818Z","opened_at":"2025-06-26T02:35:38.473818Z","updated_at":"2025-06-26T02:35:38.473818Z","closed_at":"2025-06-26T02:35:38.473818Z"}
2025-06-25 22:35:38,860 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': '907c374a-1621-452f-aed4-6c748abc31a2', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:35:38.473818Z', 'submittedAt': '2025-06-26T02:35:38.473818Z', 'fillTimestamp': '2025-06-26T02:35:38.473818Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:35:38.473818Z', 'opened_at': '2025-06-26T02:35:38.473818Z', 'updated_at': '2025-06-26T02:35:38.473818Z', 'closed_at': '2025-06-26T02:35:38.473818Z'}
2025-06-25 22:35:38,860 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"66a943e7-ae8e-4288-9606-a0610d830251","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:35:38.473818Z","submittedAt":"2025-06-26T02:35:38.473818Z","fillTimestamp":"2025-06-26T02:35:38.473818Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:35:38.473818Z","opened_at":"2025-06-26T02:35:38.473818Z","updated_at":"2025-06-26T02:35:38.473818Z","closed_at":"2025-06-26T02:35:38.473818Z"}
2025-06-25 22:35:38,860 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '66a943e7-ae8e-4288-9606-a0610d830251', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:35:38.473818Z', 'submittedAt': '2025-06-26T02:35:38.473818Z', 'fillTimestamp': '2025-06-26T02:35:38.473818Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:35:38.473818Z', 'opened_at': '2025-06-26T02:35:38.473818Z', 'updated_at': '2025-06-26T02:35:38.473818Z', 'closed_at': '2025-06-26T02:35:38.473818Z'}
2025-06-25 22:35:38,861 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 3
2025-06-25 22:35:38,861 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:35:38,861 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 22:35:38,880 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:35:38,880 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:35:38,898 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:35:38,900 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 22:35:38,901 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:35:38,901 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:35:39,088 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:35:39,089 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:35:39,268 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:35:39,268 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:39,268 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:39,269 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:35:39,271 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:35:39,271 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000028BCEDE3890>
2025-06-25 22:35:39,272 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:35:39,272 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:35:39,272 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: 2025-06-27 02:35:38.900928+00:00, end_date: None
2025-06-25 22:35:39,277 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 0
2025-06-25 22:35:39,277 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:35:39,278 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 22:35:39,326 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity a5a44cbb-ff44-4889-8655-7cac67746ce7 for symbol BTCUSDT
2025-06-25 22:35:39,328 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: ad6211ce-025a-4aa2-b610-3a5e2ceeea75
2025-06-25 22:35:39,328 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 37ac3961-18d5-46a6-a425-9ef43b8fc0d7 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:35:39,336 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 1f466811-c67f-451b-9ec3-cea40aebb370 for symbol BTCUSDT
2025-06-25 22:35:39,337 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy e197e970-7553-42a8-a603-2935a73546e3 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:35:39,343 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity f9466d1d-9109-4f85-b075-e23d1fb2c849 for symbol ETHUSDT
2025-06-25 22:35:39,344 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 0d493ee5-5a3e-40b4-a95e-328c36597b1e
2025-06-25 22:35:39,345 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:604 - No active and applicable strategies found for opportunity f9466d1d-9109-4f85-b075-e23d1fb2c849 with symbol ETHUSDT.
2025-06-25 22:35:39,346 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity f9466d1d-9109-4f85-b075-e23d1fb2c849 status to rejected_by_system: No active strategies are applicable to this opportunity's symbol.
2025-06-25 22:35:39,346 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity f9466d1d-9109-4f85-b075-e23d1fb2c849
2025-06-25 22:35:39,355 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity cd624c80-6aed-4219-a072-812ab9c795e8 for symbol BTCUSDT
2025-06-25 22:35:39,356 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 871adef8-e60f-4a5c-9b49-2ae67e5a29f9
2025-06-25 22:35:39,356 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:717 - AI confidence 0.65 for strategy 83d70972-9890-4296-a36f-e5f9272c74e1 is below threshold 0.8.
2025-06-25 22:35:39,358 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy 83d70972-9890-4296-a36f-e5f9272c74e1 did not produce a decision for opportunity cd624c80-6aed-4219-a072-812ab9c795e8.
2025-06-25 22:35:39,358 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:623 - No affirmative trading decisions made for opportunity cd624c80-6aed-4219-a072-812ab9c795e8.
2025-06-25 22:35:39,368 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 8eebb128-fec9-4628-91a4-6e1b8bf29450 for symbol BTCUSDT
2025-06-25 22:35:39,368 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: c3f2b953-b48b-41d6-b606-bfaadfd29ade
2025-06-25 22:35:39,377 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity d63256ae-5a1b-47b0-ad31-f7a09880e89b for symbol BTCUSDT
2025-06-25 22:35:39,377 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 9c128d70-e31d-446c-a38e-8fd291d259cb
2025-06-25 22:35:39,383 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 1b3fe130-7125-4473-9932-1cb477cb15f6 from decision e9d96594-7c96-4958-9a39-2c2184be46eb
2025-06-25 22:35:39,390 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade fb096bf0-5ffe-432f-aa22-3971ea36f151 from decision 3c33a91b-2ade-4e1b-a208-a8189d7f51e4
2025-06-25 22:35:39,390 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 55c50e7a-4678-4b64-bf4f-2c5192b21116 from decision 3c33a91b-2ade-4e1b-a208-a8189d7f51e4
2025-06-25 22:35:39,396 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:39,397 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:39,406 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:35:39,406 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:35:39,409 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:35:39,410 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 7ac27134-e9b3-4850-bf85-ac595cefe3c3
2025-06-25 22:35:39,414 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id e535b254-c378-4042-9be9-228d4ec6f123. Creando y guardando configuración por defecto.
2025-06-25 22:35:39,416 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:35:39,419 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for e535b254-c378-4042-9be9-228d4ec6f123. Using default values.
2025-06-25 22:35:39,419 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for e535b254-c378-4042-9be9-228d4ec6f123 with capital: 10000.0
2025-06-25 22:35:39,420 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:35:39,420 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:35:39,421 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:35:39,421 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity 7ac27134-e9b3-4850-bf85-ac595cefe3c3
2025-06-25 22:35:39,421 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 6f11fe36-a661-4877-a246-841092566379 from decision cebbaf9f-34f8-437d-89f9-b413fb25bb01
2025-06-25 22:35:39,422 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 6f11fe36-a661-4877-a246-841092566379 from confirmed opportunity.
2025-06-25 22:35:39,423 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:35:39,423 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('2fbaf109-7d02-4e6a-afa0-c34f25e392f9') orderId_exchange='mock_exchange_oco_id_da23f2ee-1f21-49f9-87cc-d6a70f26cf53' clientOrderId_exchange='mock_client_oco_id_a23bc424-c37b-4e76-a7c0-eaa28255fb1e' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 35, 39, 423945) submittedAt=datetime.datetime(2025, 6, 26, 2, 35, 39, 423945, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 35, 39, 423945, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 67575531140298499578221817652780270512, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_e837c567-4f41-4036-a108-6d1da99a4aa0', 'transactionTime': 1750905339423, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='67575531140298499578221817652780270512' price=None stopPrice=None timeInForce=None
2025-06-25 22:35:39,424 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario e535b254-c378-4042-9be9-228d4ec6f123: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:35:39,427 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('6f11fe36-a661-4877-a246-841092566379'), '9a75d3c7-b380-4c92-a0b8-bf142049902b', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:35:39.421949', '2025-06-26 02:35:39.421949', None, '{"id":"6f11fe36-a661-4877-a246-841092566379","user_id":"9a75d3c7-b380-4c92-a0b8-bf142049902b","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:35:39.421949","opened_at":"2025-06-26T02:35:39.421949","updated_at":"2025-06-26T02:35:39.421949","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('6f11fe36-a661-4877-a246-841092566379'), '9a75d3c7-b380-4c92-a0b8-bf142049902b', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:35:39.421949', '2025-06-26 02:35:39.421949', None, '{"id":"6f11fe36-a661-4877-a246-841092566379","user_id":"9a75d3c7-b380-4c92-a0b8-bf142049902b","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:35:39.421949","opened_at":"2025-06-26T02:35:39.421949","updated_at":"2025-06-26T02:35:39.421949","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:35:39,435 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 7ac27134-e9b3-4850-bf85-ac595cefe3c3: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('6f11fe36-a661-4877-a246-841092566379'), '9a75d3c7-b380-4c92-a0b8-bf142049902b', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:35:39.421949', '2025-06-26 02:35:39.421949', None, '{"id":"6f11fe36-a661-4877-a246-841092566379","user_id":"9a75d3c7-b380-4c92-a0b8-bf142049902b","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:35:39.421949","opened_at":"2025-06-26T02:35:39.421949","updated_at":"2025-06-26T02:35:39.421949","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:35:39,438 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 7ac27134-e9b3-4850-bf85-ac595cefe3c3 status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:35:39,438 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:544 - Failed to persist status update for opportunity 7ac27134-e9b3-4850-bf85-ac595cefe3c3: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('6f11fe36-a661-4877-a246-841092566379'), '9a75d3c7-b380-4c92-a0b8-bf142049902b', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:35:39.421949', '2025-06-26 02:35:39.421949', None, '{"id":"6f11fe36-a661-4877-a246-841092566379","user_id":"9a75d3c7-b380-4c92-a0b8-bf142049902b","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:35:39.421949","opened_at":"2025-06-26T02:35:39.421949","updated_at":"2025-06-26T02:35:39.421949","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 537, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('6f11fe36-a661-4877-a246-841092566379'), '9a75d3c7-b380-4c92-a0b8-bf142049902b', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:35:39.421949', '2025-06-26 02:35:39.421949', None, '{"id":"6f11fe36-a661-4877-a246-841092566379","user_id":"9a75d3c7-b380-4c92-a0b8-bf142049902b","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:35:39.421949","opened_at":"2025-06-26T02:35:39.421949","updated_at":"2025-06-26T02:35:39.421949","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:35:39,746 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:35:39,749 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:35:39,756 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:39,757 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:39,764 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:35:39,764 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:35:39,768 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:35:39,770 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:35:39,771 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:35:39,778 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:39,778 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:39,786 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:35:39,786 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:35:39,789 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:35:39,791 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity a23e6e9a-2bc1-4cb4-a371-91df862c20a4 for symbol BTC/USDT
2025-06-25 22:35:39,794 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id b98f9cf0-ce34-421f-9439-f44c880036d0. Creando y guardando configuración por defecto.
2025-06-25 22:35:39,797 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:35:39,798 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:672 - AI profile 'ai-profile-scalping-1' for strategy 9335067c-3ff4-4222-8faf-0084485522a2 not found. Skipping AI analysis.
2025-06-25 22:35:39,799 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 9335067c-3ff4-4222-8faf-0084485522a2 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:35:39,799 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity a23e6e9a-2bc1-4cb4-a371-91df862c20a4 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:35:39,806 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity a23e6e9a-2bc1-4cb4-a371-91df862c20a4
2025-06-25 22:35:39,808 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:35:39,810 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:35:39,817 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:39,817 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:39,825 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:35:39,825 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:35:39,828 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:35:39,829 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 5cd8bda0-2a5a-43cb-8209-4b439b31a290
2025-06-25 22:35:39,833 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 4c1e3560-0bc1-4f4a-8978-e4e7e21833bd. Creando y guardando configuración por defecto.
2025-06-25 22:35:39,835 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:35:39,838 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 4c1e3560-0bc1-4f4a-8978-e4e7e21833bd. Using default values.
2025-06-25 22:35:39,838 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 4c1e3560-0bc1-4f4a-8978-e4e7e21833bd with capital: 10000.0
2025-06-25 22:35:39,840 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:35:39,840 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:35:39,840 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:35:39,841 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Autonomous Scalping' as context for confirmed opportunity 5cd8bda0-2a5a-43cb-8209-4b439b31a290
2025-06-25 22:35:39,841 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 5ed820e1-703a-4038-a181-c33e5f638a43 from decision e497e576-c2be-4e89-bea7-9530996e1ddf
2025-06-25 22:35:39,842 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 5ed820e1-703a-4038-a181-c33e5f638a43 from confirmed opportunity.
2025-06-25 22:35:39,842 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:35:39,843 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('488fee29-1a5c-4964-a910-b917d463cd58') orderId_exchange='mock_exchange_oco_id_046d0fab-9160-402d-b56d-82d1887ac462' clientOrderId_exchange='mock_client_oco_id_807347d5-a9b8-47d0-b399-c460282e630a' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 35, 39, 842105) submittedAt=datetime.datetime(2025, 6, 26, 2, 35, 39, 842105, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 35, 39, 842105, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 86500463117653588562508544946856562570, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_6a890960-2a63-4170-9e97-6ac2fedc6b7a', 'transactionTime': 1750905339842, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='86500463117653588562508544946856562570' price=None stopPrice=None timeInForce=None
2025-06-25 22:35:39,843 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 4c1e3560-0bc1-4f4a-8978-e4e7e21833bd: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:35:39,846 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('5ed820e1-703a-4038-a181-c33e5f638a43'), '2d9a4d66-a3e7-4602-a161-d5c49aa42c23', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:35:39.841096', '2025-06-26 02:35:39.841096', None, '{"id":"5ed820e1-703a-4038-a181-c33e5f638a43","user_id":"2d9a4d66-a3e7-4602-a161-d5c49aa42c23","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:35:39.841096","opened_at":"2025-06-26T02:35:39.841096","updated_at":"2025-06-26T02:35:39.841096","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('5ed820e1-703a-4038-a181-c33e5f638a43'), '2d9a4d66-a3e7-4602-a161-d5c49aa42c23', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:35:39.841096', '2025-06-26 02:35:39.841096', None, '{"id":"5ed820e1-703a-4038-a181-c33e5f638a43","user_id":"2d9a4d66-a3e7-4602-a161-d5c49aa42c23","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:35:39.841096","opened_at":"2025-06-26T02:35:39.841096","updated_at":"2025-06-26T02:35:39.841096","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:35:39,848 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 5cd8bda0-2a5a-43cb-8209-4b439b31a290: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('5ed820e1-703a-4038-a181-c33e5f638a43'), '2d9a4d66-a3e7-4602-a161-d5c49aa42c23', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:35:39.841096', '2025-06-26 02:35:39.841096', None, '{"id":"5ed820e1-703a-4038-a181-c33e5f638a43","user_id":"2d9a4d66-a3e7-4602-a161-d5c49aa42c23","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:35:39.841096","opened_at":"2025-06-26T02:35:39.841096","updated_at":"2025-06-26T02:35:39.841096","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:35:39,850 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 5cd8bda0-2a5a-43cb-8209-4b439b31a290 status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:35:39,851 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:544 - Failed to persist status update for opportunity 5cd8bda0-2a5a-43cb-8209-4b439b31a290: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('5ed820e1-703a-4038-a181-c33e5f638a43'), '2d9a4d66-a3e7-4602-a161-d5c49aa42c23', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:35:39.841096', '2025-06-26 02:35:39.841096', None, '{"id":"5ed820e1-703a-4038-a181-c33e5f638a43","user_id":"2d9a4d66-a3e7-4602-a161-d5c49aa42c23","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:35:39.841096","opened_at":"2025-06-26T02:35:39.841096","updated_at":"2025-06-26T02:35:39.841096","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 537, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('5ed820e1-703a-4038-a181-c33e5f638a43'), '2d9a4d66-a3e7-4602-a161-d5c49aa42c23', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:35:39.841096', '2025-06-26 02:35:39.841096', None, '{"id":"5ed820e1-703a-4038-a181-c33e5f638a43","user_id":"2d9a4d66-a3e7-4602-a161-d5c49aa42c23","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:35:39.841096","opened_at":"2025-06-26T02:35:39.841096","updated_at":"2025-06-26T02:35:39.841096","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:35:39,861 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:35:39,862 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:35:39,869 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:39,870 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:39,877 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:35:39,878 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:35:39,880 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:35:39,881 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 39c49525-5556-4dd7-be93-53ca2353fdb4
2025-06-25 22:35:39,884 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 058397d5-88d9-4207-973a-0de3b6dbc793. Creando y guardando configuración por defecto.
2025-06-25 22:35:39,887 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:35:39,890 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 058397d5-88d9-4207-973a-0de3b6dbc793. Using default values.
2025-06-25 22:35:39,890 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 058397d5-88d9-4207-973a-0de3b6dbc793 with capital: 10000.0
2025-06-25 22:35:39,891 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:35:39,892 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:35:39,892 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:35:39,892 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity 39c49525-5556-4dd7-be93-53ca2353fdb4
2025-06-25 22:35:39,893 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 66834626-976c-44ac-b254-7aad73fdf929 from decision f7858fd3-115f-4fad-a715-473c222835e4
2025-06-25 22:35:39,893 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 66834626-976c-44ac-b254-7aad73fdf929 from confirmed opportunity.
2025-06-25 22:35:39,894 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:35:39,895 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('60e621eb-fccd-4cbc-98fc-4f2852531e79') orderId_exchange='mock_exchange_oco_id_d180872f-3397-49cb-bcad-38eda1638989' clientOrderId_exchange='mock_client_oco_id_9fa68802-e6c9-432f-b45b-d5461ef69ed3' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 35, 39, 895455) submittedAt=datetime.datetime(2025, 6, 26, 2, 35, 39, 895455, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 35, 39, 895455, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 127276653534018977057185749838308013187, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_9eeb12e5-a38e-41a3-bce0-b16ee3677ad1', 'transactionTime': 1750905339895, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='127276653534018977057185749838308013187' price=None stopPrice=None timeInForce=None
2025-06-25 22:35:39,895 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 058397d5-88d9-4207-973a-0de3b6dbc793: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:35:39,898 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('66834626-976c-44ac-b254-7aad73fdf929'), '3df19979-ddfb-4ea4-a26e-675427482232', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:35:39.893450', '2025-06-26 02:35:39.893450', None, '{"id":"66834626-976c-44ac-b254-7aad73fdf929","user_id":"3df19979-ddfb-4ea4-a26e-675427482232","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:35:39.893450","opened_at":"2025-06-26T02:35:39.893450","updated_at":"2025-06-26T02:35:39.893450","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('66834626-976c-44ac-b254-7aad73fdf929'), '3df19979-ddfb-4ea4-a26e-675427482232', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:35:39.893450', '2025-06-26 02:35:39.893450', None, '{"id":"66834626-976c-44ac-b254-7aad73fdf929","user_id":"3df19979-ddfb-4ea4-a26e-675427482232","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:35:39.893450","opened_at":"2025-06-26T02:35:39.893450","updated_at":"2025-06-26T02:35:39.893450","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:35:39,900 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 39c49525-5556-4dd7-be93-53ca2353fdb4: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('66834626-976c-44ac-b254-7aad73fdf929'), '3df19979-ddfb-4ea4-a26e-675427482232', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:35:39.893450', '2025-06-26 02:35:39.893450', None, '{"id":"66834626-976c-44ac-b254-7aad73fdf929","user_id":"3df19979-ddfb-4ea4-a26e-675427482232","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:35:39.893450","opened_at":"2025-06-26T02:35:39.893450","updated_at":"2025-06-26T02:35:39.893450","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:35:39,902 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 39c49525-5556-4dd7-be93-53ca2353fdb4 status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:35:39,903 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:544 - Failed to persist status update for opportunity 39c49525-5556-4dd7-be93-53ca2353fdb4: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('66834626-976c-44ac-b254-7aad73fdf929'), '3df19979-ddfb-4ea4-a26e-675427482232', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:35:39.893450', '2025-06-26 02:35:39.893450', None, '{"id":"66834626-976c-44ac-b254-7aad73fdf929","user_id":"3df19979-ddfb-4ea4-a26e-675427482232","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:35:39.893450","opened_at":"2025-06-26T02:35:39.893450","updated_at":"2025-06-26T02:35:39.893450","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 537, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('66834626-976c-44ac-b254-7aad73fdf929'), '3df19979-ddfb-4ea4-a26e-675427482232', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:35:39.893450', '2025-06-26 02:35:39.893450', None, '{"id":"66834626-976c-44ac-b254-7aad73fdf929","user_id":"3df19979-ddfb-4ea4-a26e-675427482232","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:35:39.893450","opened_at":"2025-06-26T02:35:39.893450","updated_at":"2025-06-26T02:35:39.893450","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:35:39,913 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:35:39,914 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:35:39,922 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:39,922 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:39,929 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:35:39,929 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:35:39,932 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:35:39,934 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity b94186eb-e46e-4e98-9330-e22bc5cedf1f
2025-06-25 22:35:39,937 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 99797631-8e81-403c-8952-7a5feba58e45. Creando y guardando configuración por defecto.
2025-06-25 22:35:39,940 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:35:39,944 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 99797631-8e81-403c-8952-7a5feba58e45. Using default values.
2025-06-25 22:35:39,944 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 99797631-8e81-403c-8952-7a5feba58e45 with capital: 10000.0
2025-06-25 22:35:39,945 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:35:39,945 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:35:39,946 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:35:39,946 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Day Trading Strategy' as context for confirmed opportunity b94186eb-e46e-4e98-9330-e22bc5cedf1f
2025-06-25 22:35:39,946 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade d9eaa1c4-f36e-4617-b6d4-e5112e6bfed0 from decision c109d1a9-4e36-474e-9faf-ed4e91d20525
2025-06-25 22:35:39,947 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade d9eaa1c4-f36e-4617-b6d4-e5112e6bfed0 from confirmed opportunity.
2025-06-25 22:35:39,948 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:35:39,949 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('18078912-5255-4627-bc83-18b3447002b5') orderId_exchange='mock_exchange_oco_id_dab27fec-a097-4e8c-ac9c-896af7a3166c' clientOrderId_exchange='mock_client_oco_id_ae3c2639-aeec-4482-86a9-6d858c6725f4' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 35, 39, 949636) submittedAt=datetime.datetime(2025, 6, 26, 2, 35, 39, 949636, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 35, 39, 949636, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 312502071757403516140491960068442453637, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_a7b4f2e4-da3c-49e7-803e-ce3b920929c1', 'transactionTime': 1750905339949, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='312502071757403516140491960068442453637' price=None stopPrice=None timeInForce=None
2025-06-25 22:35:39,949 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 99797631-8e81-403c-8952-7a5feba58e45: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:35:39,952 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('d9eaa1c4-f36e-4617-b6d4-e5112e6bfed0'), '7e054e98-1906-4ca6-8b31-a6d13ffb612d', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:35:39.946261', '2025-06-26 02:35:39.946261', None, '{"id":"d9eaa1c4-f36e-4617-b6d4-e5112e6bfed0","user_id":"7e054e98-1906-4ca6-8b31-a6d13ffb612d","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:35:39.946261","opened_at":"2025-06-26T02:35:39.946261","updated_at":"2025-06-26T02:35:39.946261","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('d9eaa1c4-f36e-4617-b6d4-e5112e6bfed0'), '7e054e98-1906-4ca6-8b31-a6d13ffb612d', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:35:39.946261', '2025-06-26 02:35:39.946261', None, '{"id":"d9eaa1c4-f36e-4617-b6d4-e5112e6bfed0","user_id":"7e054e98-1906-4ca6-8b31-a6d13ffb612d","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:35:39.946261","opened_at":"2025-06-26T02:35:39.946261","updated_at":"2025-06-26T02:35:39.946261","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:35:39,954 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity b94186eb-e46e-4e98-9330-e22bc5cedf1f: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('d9eaa1c4-f36e-4617-b6d4-e5112e6bfed0'), '7e054e98-1906-4ca6-8b31-a6d13ffb612d', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:35:39.946261', '2025-06-26 02:35:39.946261', None, '{"id":"d9eaa1c4-f36e-4617-b6d4-e5112e6bfed0","user_id":"7e054e98-1906-4ca6-8b31-a6d13ffb612d","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:35:39.946261","opened_at":"2025-06-26T02:35:39.946261","updated_at":"2025-06-26T02:35:39.946261","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:35:39,956 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity b94186eb-e46e-4e98-9330-e22bc5cedf1f status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:35:39,958 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:544 - Failed to persist status update for opportunity b94186eb-e46e-4e98-9330-e22bc5cedf1f: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('d9eaa1c4-f36e-4617-b6d4-e5112e6bfed0'), '7e054e98-1906-4ca6-8b31-a6d13ffb612d', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:35:39.946261', '2025-06-26 02:35:39.946261', None, '{"id":"d9eaa1c4-f36e-4617-b6d4-e5112e6bfed0","user_id":"7e054e98-1906-4ca6-8b31-a6d13ffb612d","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:35:39.946261","opened_at":"2025-06-26T02:35:39.946261","updated_at":"2025-06-26T02:35:39.946261","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 537, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('d9eaa1c4-f36e-4617-b6d4-e5112e6bfed0'), '7e054e98-1906-4ca6-8b31-a6d13ffb612d', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:35:39.946261', '2025-06-26 02:35:39.946261', None, '{"id":"d9eaa1c4-f36e-4617-b6d4-e5112e6bfed0","user_id":"7e054e98-1906-4ca6-8b31-a6d13ffb612d","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:35:39.946261","opened_at":"2025-06-26T02:35:39.946261","updated_at":"2025-06-26T02:35:39.946261","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:35:39,968 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:35:39,969 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:35:39,977 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:39,978 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:39,986 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:35:39,986 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:35:39,990 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:35:39,991 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 87ca8d30-909d-4ddf-865c-84bd2610f63c from decision e88d1575-6f2f-4b99-aec6-1c9ddf44d403
2025-06-25 22:35:39,992 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:35:39,993 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:35:40,002 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:40,003 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:40,010 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:35:40,011 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:35:40,013 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:35:40,015 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade dcdb1ba9-1b7f-4e37-8410-9437847a24e5 from decision 53cbbede-2ada-4e87-bc1a-48f344d21624
2025-06-25 22:35:40,016 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:35:40,017 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:35:40,025 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:40,025 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:40,033 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:35:40,033 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:35:40,036 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:35:40,038 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:35:40,039 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:35:41,886 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:41,887 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:41,892 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:35:41,894 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:35:41,895 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:35:41,905 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:35:41,909 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:35:41,910 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:35:41,913 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:35:41,920 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:35:41,923 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:35:41,927 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:41,928 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:41,931 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:41,932 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:41,933 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:35:41,936 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:41,937 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:41,943 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:41,944 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:41,951 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:41,951 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:41,955 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:35:41,958 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:41,958 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:41,961 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:286 - Verificación de Binance BINANCE_SPOT exitosa.
2025-06-25 22:35:41,965 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:41,966 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:41,969 - ultibot_backend.services.credential_service - ERROR - [MainThread] - credential_service.py:315 - Error de Binance API durante la verificación: Binance Down
2025-06-25 22:35:41,973 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:41,973 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:41,977 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:35:41,981 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:35:41,981 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:35:41,989 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:241 - Verificación de Telegram exitosa.
2025-06-25 22:35:41,995 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:72 - Conexión con Binance exitosa.
2025-06-25 22:35:42,000 - ultibot_backend.services.market_data_service - WARNING - [MainThread] - market_data_service.py:52 - Credenciales de Binance no encontradas. Por favor, configúrelas.
2025-06-25 22:35:42,005 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:69 - Fallo en la verificación de conexión con Binance. Revise sus credenciales y permisos.
2025-06-25 22:35:42,010 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:77 - Error al acceder a las credenciales de Binance: Decryption failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 45, in get_binance_connection_status
    binance_credential = await self.credential_service.get_credential(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.CredentialError: Decryption failed
2025-06-25 22:35:42,017 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:81 - Error de la API de Binance: API unavailable
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 61, in get_binance_connection_status
    is_connected = await self.credential_service.verify_credential(binance_credential)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.BinanceAPIError: API unavailable
2025-06-25 22:35:42,023 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:35:42,032 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:121 - Error de la API de Binance al obtener balances: Failed to fetch balances
2025-06-25 22:35:42,036 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2799501152528'>
2025-06-25 22:35:42,038 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 6c37daf4-cb17-4754-84e4-571e3635023d, mode_filter: None
2025-06-25 22:35:42,038 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2799501152528'>
2025-06-25 22:35:42,038 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 6c37daf4-cb17-4754-84e4-571e3635023d with mode_filter: None
2025-06-25 22:35:42,041 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2799501538960'>
2025-06-25 22:35:42,043 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 6c37daf4-cb17-4754-84e4-571e3635023d, mode_filter: None
2025-06-25 22:35:42,043 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2799501538960'>
2025-06-25 22:35:42,043 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 6c37daf4-cb17-4754-84e4-571e3635023d with mode_filter: None
2025-06-25 22:35:42,047 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2799499953872'>
2025-06-25 22:35:42,048 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 6c37daf4-cb17-4754-84e4-571e3635023d, mode_filter: OperatingMode.PAPER
2025-06-25 22:35:42,049 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2799499953872'>
2025-06-25 22:35:42,049 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 6c37daf4-cb17-4754-84e4-571e3635023d
2025-06-25 22:35:42,053 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2799501532048'>
2025-06-25 22:35:42,054 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 6c37daf4-cb17-4754-84e4-571e3635023d, mode_filter: OperatingMode.PAPER
2025-06-25 22:35:42,054 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2799501532048'>
2025-06-25 22:35:42,055 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 6c37daf4-cb17-4754-84e4-571e3635023d
2025-06-25 22:35:42,058 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2799500729168'>
2025-06-25 22:35:42,059 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 6c37daf4-cb17-4754-84e4-571e3635023d, mode_filter: OperatingMode.REAL
2025-06-25 22:35:42,060 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2799500729168'>
2025-06-25 22:35:42,060 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 6c37daf4-cb17-4754-84e4-571e3635023d
2025-06-25 22:35:42,063 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2799501242960'>
2025-06-25 22:35:42,064 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 6c37daf4-cb17-4754-84e4-571e3635023d, mode_filter: OperatingMode.PAPER
2025-06-25 22:35:42,064 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2799501242960'>
2025-06-25 22:35:42,065 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 6c37daf4-cb17-4754-84e4-571e3635023d
2025-06-25 22:35:42,069 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2799501305744'>
2025-06-25 22:35:42,070 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 6c37daf4-cb17-4754-84e4-571e3635023d, mode_filter: None
2025-06-25 22:35:42,071 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2799501305744'>
2025-06-25 22:35:42,071 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 2 performance entries for user 6c37daf4-cb17-4754-84e4-571e3635023d
2025-06-25 22:35:42,074 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2799501311504'>
2025-06-25 22:35:42,077 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 6c37daf4-cb17-4754-84e4-571e3635023d, mode_filter: OperatingMode.PAPER
2025-06-25 22:35:42,077 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2799501311504'>
2025-06-25 22:35:42,078 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 6c37daf4-cb17-4754-84e4-571e3635023d
2025-06-25 22:35:42,080 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2799501440720'>
2025-06-25 22:35:42,082 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 6c37daf4-cb17-4754-84e4-571e3635023d, mode_filter: OperatingMode.PAPER
2025-06-25 22:35:42,082 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2799501440720'>
2025-06-25 22:35:42,082 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 6c37daf4-cb17-4754-84e4-571e3635023d with mode_filter: OperatingMode.PAPER
2025-06-25 22:35:42,086 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2799501280592'>
2025-06-25 22:35:42,087 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 6c37daf4-cb17-4754-84e4-571e3635023d, mode_filter: OperatingMode.PAPER
2025-06-25 22:35:42,087 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2799501280592'>
2025-06-25 22:35:42,089 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 6c37daf4-cb17-4754-84e4-571e3635023d with mode_filter: OperatingMode.PAPER
2025-06-25 22:35:42,092 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2799501435856'>
2025-06-25 22:35:42,094 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 6c37daf4-cb17-4754-84e4-571e3635023d, mode_filter: OperatingMode.PAPER
2025-06-25 22:35:42,094 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2799501435856'>
2025-06-25 22:35:42,094 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 6c37daf4-cb17-4754-84e4-571e3635023d
2025-06-25 22:35:42,097 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2799501143888'>
2025-06-25 22:35:42,099 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 6c37daf4-cb17-4754-84e4-571e3635023d, mode_filter: OperatingMode.PAPER
2025-06-25 22:35:42,099 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2799501143888'>
2025-06-25 22:35:42,099 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 6c37daf4-cb17-4754-84e4-571e3635023d
2025-06-25 22:35:42,104 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2799499951248'>
2025-06-25 22:35:42,105 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 6c37daf4-cb17-4754-84e4-571e3635023d, mode_filter: OperatingMode.PAPER
2025-06-25 22:35:42,106 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2799499951248'>
2025-06-25 22:35:42,106 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 6c37daf4-cb17-4754-84e4-571e3635023d
2025-06-25 22:35:42,109 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2799501139024'>
2025-06-25 22:35:42,110 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 6c37daf4-cb17-4754-84e4-571e3635023d, mode_filter: OperatingMode.PAPER
2025-06-25 22:35:42,111 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2799501139024'>
2025-06-25 22:35:42,111 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 6c37daf4-cb17-4754-84e4-571e3635023d
2025-06-25 22:35:42,158 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario abf05d00-bd58-4e7e-a0d4-bee0671a716c en modo paper
2025-06-25 22:35:42,162 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario de78eb87-ffb2-48c3-b441-f996c083f465 en modo paper
2025-06-25 22:35:42,167 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario f9c019de-0982-4965-b676-ffd94db6bca2 en modo paper
2025-06-25 22:35:42,173 - ultibot_backend.services.trading_report_service - ERROR - [MainThread] - trading_report_service.py:79 - Error al obtener trades cerrados para usuario d590e23f-299e-4ac3-8ace-1f1e228048b7: Database connection failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_report_service.py", line 65, in get_closed_trades
    trades = await persistence_service.get_closed_trades(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
Exception: Database connection failed
2025-06-25 22:35:42,182 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 64c38a2a-1555-484e-839f-4ee6cef125d5 for symbol BTC/USDT
2025-06-25 22:35:42,184 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 7617b6ab-f57e-4254-880b-8355a3e73eb7 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:35:42,184 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 64c38a2a-1555-484e-839f-4ee6cef125d5 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:35:42,185 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 64c38a2a-1555-484e-839f-4ee6cef125d5
2025-06-25 22:35:42,194 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 2478a987-c914-4c16-9f8c-130d0e627d9b for symbol BTC/USDT
2025-06-25 22:35:42,195 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy b2645fa8-1068-4856-8fd2-e669e14daaf9 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:35:42,196 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 2478a987-c914-4c16-9f8c-130d0e627d9b status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:35:42,197 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 2478a987-c914-4c16-9f8c-130d0e627d9b
2025-06-25 22:35:42,206 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity bab08116-335a-426b-b7d7-c3c165c946f7 for symbol BTC/USDT
2025-06-25 22:35:42,208 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 3ae6b81e-18e9-4863-803d-487181ae9971 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:35:42,209 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity bab08116-335a-426b-b7d7-c3c165c946f7 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:35:42,210 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity bab08116-335a-426b-b7d7-c3c165c946f7
2025-06-25 22:35:42,219 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 297c217c-6dfa-4e1c-97dc-33a4fc007082 for symbol BTC/USDT
2025-06-25 22:35:42,221 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 17fdb9e2-b56c-411d-99ed-6464712c12f1 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:35:42,221 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 297c217c-6dfa-4e1c-97dc-33a4fc007082 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:35:42,222 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 297c217c-6dfa-4e1c-97dc-33a4fc007082
2025-06-25 22:35:42,232 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity aaf33be2-e674-4240-83f5-722942e05611 for symbol BTC/USDT
2025-06-25 22:35:42,233 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:653 - Unknown strategy type 'CUSTOM_UNKNOWN_TYPE' for strategy 3f33bcc1-255e-44a1-b6be-5bfa85455283. Recommending investigation.
2025-06-25 22:35:42,233 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity aaf33be2-e674-4240-83f5-722942e05611 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:35:42,234 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity aaf33be2-e674-4240-83f5-722942e05611
2025-06-25 22:35:42,243 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity d9a54d03-de46-49e9-aea7-95043b35efbd for symbol BTC/USDT
2025-06-25 22:35:42,246 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 78955ded-cd44-4151-9692-818c40d21fe1 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:35:42,246 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity d9a54d03-de46-49e9-aea7-95043b35efbd status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:35:42,247 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity d9a54d03-de46-49e9-aea7-95043b35efbd
2025-06-25 22:35:42,267 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 040c52b2-7af7-4174-9d4c-5b16f2fc8ee4 for symbol BTC/USDT
2025-06-25 22:35:42,268 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 99d1844e-034d-4194-a281-82cf33b4da31 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:35:42,269 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 040c52b2-7af7-4174-9d4c-5b16f2fc8ee4 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:35:42,270 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 040c52b2-7af7-4174-9d4c-5b16f2fc8ee4
2025-06-25 22:36:59,729 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:36:59,729 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:36:59,746 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:36:59,747 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:36:59,919 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:36:59,920 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:36:59,940 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:36:59,941 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:37:00,704 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:37:00,704 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:37:00,726 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:37:00,745 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:37:00,747 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:37:00,751 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:37:00,753 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:37:00,766 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:37:00,766 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:37:00,789 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:37:00,794 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:37:00,796 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:37:00,808 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:37:00,809 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:37:00,835 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:37:00,838 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:37:00,839 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:37:00,850 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:37:00,850 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:37:00,878 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:37:00,880 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:37:00,882 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:37:00,890 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:37:00,890 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:37:00,912 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:37:00,915 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:37:00,916 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:37:00,926 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:37:00,926 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:37:00,946 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:37:00,949 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:37:00,949 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:37:00,949 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:37:00,950 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:37:00,950 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:37:00,972 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:37:01,151 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:37:01,152 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:37:01,330 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:37:01,331 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:01,331 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:01,331 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:37:01,347 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:37:01,348 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000220B4E70D10>
2025-06-25 22:37:01,348 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:37:01,349 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:37:01,349 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 422
2025-06-25 22:37:01,359 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:37:01,359 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:37:01,471 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:37:01,473 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:37:01,473 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:37:01,473 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:37:01,648 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:37:01,648 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:37:01,827 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:37:01,828 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:01,828 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:01,828 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:37:01,831 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:37:01,831 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000220B50ADE90>
2025-06-25 22:37:01,831 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:37:01,832 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:37:01,841 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:37:01,850 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:37:01,850 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:37:01,860 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:37:01,860 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:37:01,880 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:37:01,882 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:37:01,882 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:37:01,883 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:37:02,067 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:37:02,068 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:37:02,244 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:37:02,244 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:02,245 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:02,245 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:37:02,248 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:37:02,248 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000220B4DFEBD0>
2025-06-25 22:37:02,248 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:37:02,248 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:37:02,253 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:37:02,261 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:37:02,261 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:37:02,262 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:37:02,269 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:37:02,269 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:37:02,270 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:37:02,271 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:37:02,280 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:37:02,280 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:37:02,301 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:37:02,302 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:37:02,303 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:37:02,303 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:37:02,484 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:37:02,485 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:37:02,660 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:37:02,660 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:02,660 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:02,660 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:37:02,664 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:37:02,664 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000220B4E0DA10>
2025-06-25 22:37:02,664 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:37:02,665 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:37:02,668 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:37:02,675 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:37:02,677 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:37:02,677 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:37:02,684 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:37:02,684 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:37:02,694 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:37:02,694 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:37:02,715 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:37:02,716 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:37:02,717 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:37:02,717 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:37:02,903 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:37:02,904 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:37:03,094 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:37:03,095 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:03,095 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:03,095 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:37:03,099 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:37:03,099 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000220B4E69AD0>
2025-06-25 22:37:03,099 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:37:03,099 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:37:03,104 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:37:03,111 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:37:03,111 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:37:03,112 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:37:03,118 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:37:03,119 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:37:03,129 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:37:03,129 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:37:03,152 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:37:03,154 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:37:03,155 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:37:03,155 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:37:03,340 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:37:03,341 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:37:03,524 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:37:03,525 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:03,525 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:03,526 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:37:03,528 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:37:03,529 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000220B4E31ED0>
2025-06-25 22:37:03,529 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:37:03,529 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:37:03,530 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 422
2025-06-25 22:37:03,552 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity cf8fa2ba-a1a2-4813-a05d-6514d8407333
2025-06-25 22:37:03,553 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:152 - User configuration saved after initializing last_daily_reset for user 6a22a7a7-c743-4c11-b3cf-f3507f351a73.
2025-06-25 22:37:03,554 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 200.000
2025-06-25 22:37:03,554 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity cf8fa2ba-a1a2-4813-a05d-6514d8407333
2025-06-25 22:37:03,554 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 6d2ed1d9-dbf6-40fb-9c81-f5cc5802368e from decision 8bab1bbc-c873-4f01-a867-ce699c3e466a
2025-06-25 22:37:03,555 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 6d2ed1d9-dbf6-40fb-9c81-f5cc5802368e from confirmed opportunity.
2025-06-25 22:37:03,556 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:37:03,556 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:310 - Successfully created OCO order for trade 6d2ed1d9-dbf6-40fb-9c81-f5cc5802368e. OCO List ID: oco_list_123
2025-06-25 22:37:03,557 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 6a22a7a7-c743-4c11-b3cf-f3507f351a73: 200.0000000000000000000000000 (anterior: 0.0, valor trade: 200.0000000000000000000000000)
2025-06-25 22:37:03,557 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user 6a22a7a7-c743-4c11-b3cf-f3507f351a73 to 200.0000000000000000000000000.
2025-06-25 22:37:03,558 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity cf8fa2ba-a1a2-4813-a05d-6514d8407333 status to converted_to_trade_real: Trade 6d2ed1d9-dbf6-40fb-9c81-f5cc5802368e executed based on user confirmation.
2025-06-25 22:37:03,558 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity cf8fa2ba-a1a2-4813-a05d-6514d8407333
2025-06-25 22:37:03,569 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity ab24463d-f836-4d36-9628-63c829b87d29
2025-06-25 22:37:03,569 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 4800.0, Riesgo Potencial Trade USD: 300.000
2025-06-25 22:37:03,570 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:191 - Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:37:03,570 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity ab24463d-f836-4d36-9628-63c829b87d29 status to error_in_processing: Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:37:03,571 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity ab24463d-f836-4d36-9628-63c829b87d29
2025-06-25 22:37:03,584 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity ba6ef057-9bfb-4d25-82c5-d58ecd736b28
2025-06-25 22:37:03,585 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:143 - Daily capital reset triggered for user 84a47008-7ce1-4540-9f05-c4bc9343be4e. Resetting daily_capital_risked_usd.
2025-06-25 22:37:03,586 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:147 - User configuration saved after daily capital reset for user 84a47008-7ce1-4540-9f05-c4bc9343be4e.
2025-06-25 22:37:03,586 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 2500.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 100.000
2025-06-25 22:37:03,586 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity ba6ef057-9bfb-4d25-82c5-d58ecd736b28
2025-06-25 22:37:03,586 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 49a60806-bc19-4c97-a9a9-da2eda2ba5f2 from decision 69d06612-d72b-4a85-9d71-08143682bd65
2025-06-25 22:37:03,588 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 49a60806-bc19-4c97-a9a9-da2eda2ba5f2 from confirmed opportunity.
2025-06-25 22:37:03,590 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:37:03,591 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:310 - Successfully created OCO order for trade 49a60806-bc19-4c97-a9a9-da2eda2ba5f2. OCO List ID: oco_reset_test
2025-06-25 22:37:03,592 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 84a47008-7ce1-4540-9f05-c4bc9343be4e: 100.000 (anterior: 0.0, valor trade: 100.000)
2025-06-25 22:37:03,592 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user 84a47008-7ce1-4540-9f05-c4bc9343be4e to 100.000.
2025-06-25 22:37:03,592 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity ba6ef057-9bfb-4d25-82c5-d58ecd736b28 status to converted_to_trade_real: Trade 49a60806-bc19-4c97-a9a9-da2eda2ba5f2 executed based on user confirmation.
2025-06-25 22:37:03,593 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity ba6ef057-9bfb-4d25-82c5-d58ecd736b28
2025-06-25 22:37:03,610 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:37:03,610 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:37:03,629 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:37:03,631 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 22:37:03,632 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:37:03,632 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:37:03,821 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:37:03,822 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:37:04,007 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:37:04,007 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:04,007 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:04,008 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:37:04,011 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:37:04,012 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000220B502AED0>
2025-06-25 22:37:04,012 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:37:04,012 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:37:04,013 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 22:37:04,018 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"b6c640cd-beab-45bd-aaee-f7f12c5cc8b6","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:37:03.599297Z","submittedAt":"2025-06-26T02:37:03.599297Z","fillTimestamp":"2025-06-26T02:37:03.599297Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:37:03.599297Z","opened_at":"2025-06-26T02:37:03.599297Z","updated_at":"2025-06-26T02:37:03.599297Z","closed_at":"2025-06-26T02:37:03.599297Z"}
2025-06-25 22:37:04,018 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': 'b6c640cd-beab-45bd-aaee-f7f12c5cc8b6', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:37:03.599297Z', 'submittedAt': '2025-06-26T02:37:03.599297Z', 'fillTimestamp': '2025-06-26T02:37:03.599297Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:37:03.599297Z', 'opened_at': '2025-06-26T02:37:03.599297Z', 'updated_at': '2025-06-26T02:37:03.599297Z', 'closed_at': '2025-06-26T02:37:03.599297Z'}
2025-06-25 22:37:04,019 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"76ab392c-2dc0-4cb9-9a94-533753757e16","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:37:03.599297Z","submittedAt":"2025-06-26T02:37:03.599297Z","fillTimestamp":"2025-06-26T02:37:03.599297Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:37:03.599297Z","opened_at":"2025-06-26T02:37:03.599297Z","updated_at":"2025-06-26T02:37:03.599297Z","closed_at":"2025-06-26T02:37:03.599297Z"}
2025-06-25 22:37:04,019 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': '76ab392c-2dc0-4cb9-9a94-533753757e16', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:37:03.599297Z', 'submittedAt': '2025-06-26T02:37:03.599297Z', 'fillTimestamp': '2025-06-26T02:37:03.599297Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:37:03.599297Z', 'opened_at': '2025-06-26T02:37:03.599297Z', 'updated_at': '2025-06-26T02:37:03.599297Z', 'closed_at': '2025-06-26T02:37:03.599297Z'}
2025-06-25 22:37:04,019 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"332ee5ec-2297-4250-99e9-c594cbefdde4","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:37:03.599297Z","submittedAt":"2025-06-26T02:37:03.599297Z","fillTimestamp":"2025-06-26T02:37:03.599297Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:37:03.599297Z","opened_at":"2025-06-26T02:37:03.599297Z","updated_at":"2025-06-26T02:37:03.599297Z","closed_at":"2025-06-26T02:37:03.599297Z"}
2025-06-25 22:37:04,020 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '332ee5ec-2297-4250-99e9-c594cbefdde4', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:37:03.599297Z', 'submittedAt': '2025-06-26T02:37:03.599297Z', 'fillTimestamp': '2025-06-26T02:37:03.599297Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:37:03.599297Z', 'opened_at': '2025-06-26T02:37:03.599297Z', 'updated_at': '2025-06-26T02:37:03.599297Z', 'closed_at': '2025-06-26T02:37:03.599297Z'}
2025-06-25 22:37:04,020 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 3
2025-06-25 22:37:04,020 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:37:04,021 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 22:37:04,041 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:37:04,042 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:37:04,061 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:37:04,063 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 22:37:04,064 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:37:04,064 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:37:04,254 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:37:04,254 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:37:04,441 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:37:04,441 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:04,441 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:04,441 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:37:04,444 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:37:04,444 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000220B63B32D0>
2025-06-25 22:37:04,445 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:37:04,445 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:37:04,445 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: BTCUSDT, start_date: None, end_date: None
2025-06-25 22:37:04,451 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"8487a1b9-0f4e-4143-9747-8e296f12ba38","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:37:04.029984Z","submittedAt":"2025-06-26T02:37:04.029984Z","fillTimestamp":"2025-06-26T02:37:04.029984Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:37:04.029984Z","opened_at":"2025-06-26T02:37:04.029984Z","updated_at":"2025-06-26T02:37:04.029984Z","closed_at":"2025-06-26T02:37:04.029984Z"}
2025-06-25 22:37:04,451 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '8487a1b9-0f4e-4143-9747-8e296f12ba38', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:37:04.029984Z', 'submittedAt': '2025-06-26T02:37:04.029984Z', 'fillTimestamp': '2025-06-26T02:37:04.029984Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:37:04.029984Z', 'opened_at': '2025-06-26T02:37:04.029984Z', 'updated_at': '2025-06-26T02:37:04.029984Z', 'closed_at': '2025-06-26T02:37:04.029984Z'}
2025-06-25 22:37:04,452 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 1
2025-06-25 22:37:04,452 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 1 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:37:04,453 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 22:37:04,472 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:37:04,473 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:37:04,491 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:37:04,493 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 22:37:04,494 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:37:04,494 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:37:04,678 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:37:04,679 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:37:04,864 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:37:04,864 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:04,865 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:04,865 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:37:04,869 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:37:04,870 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000220B4E68350>
2025-06-25 22:37:04,870 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:37:04,870 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:37:04,871 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 22:37:04,874 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"f00f6ed6-73d0-4aa5-b055-9eb025d144ae","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:37:04.462400Z","submittedAt":"2025-06-26T02:37:04.462400Z","fillTimestamp":"2025-06-26T02:37:04.462400Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:37:04.462400Z","opened_at":"2025-06-26T02:37:04.462400Z","updated_at":"2025-06-26T02:37:04.462400Z","closed_at":"2025-06-26T02:37:04.462400Z"}
2025-06-25 22:37:04,874 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': 'f00f6ed6-73d0-4aa5-b055-9eb025d144ae', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:37:04.462400Z', 'submittedAt': '2025-06-26T02:37:04.462400Z', 'fillTimestamp': '2025-06-26T02:37:04.462400Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:37:04.462400Z', 'opened_at': '2025-06-26T02:37:04.462400Z', 'updated_at': '2025-06-26T02:37:04.462400Z', 'closed_at': '2025-06-26T02:37:04.462400Z'}
2025-06-25 22:37:04,874 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"725e227a-1ea8-441f-b7cb-6e42e985a367","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:37:04.462400Z","submittedAt":"2025-06-26T02:37:04.462400Z","fillTimestamp":"2025-06-26T02:37:04.462400Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:37:04.462400Z","opened_at":"2025-06-26T02:37:04.462400Z","updated_at":"2025-06-26T02:37:04.462400Z","closed_at":"2025-06-26T02:37:04.462400Z"}
2025-06-25 22:37:04,874 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': '725e227a-1ea8-441f-b7cb-6e42e985a367', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:37:04.462400Z', 'submittedAt': '2025-06-26T02:37:04.462400Z', 'fillTimestamp': '2025-06-26T02:37:04.462400Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:37:04.462400Z', 'opened_at': '2025-06-26T02:37:04.462400Z', 'updated_at': '2025-06-26T02:37:04.462400Z', 'closed_at': '2025-06-26T02:37:04.462400Z'}
2025-06-25 22:37:04,875 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"94009826-7809-422c-b514-2b2b8ae2c058","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:37:04.462400Z","submittedAt":"2025-06-26T02:37:04.462400Z","fillTimestamp":"2025-06-26T02:37:04.462400Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:37:04.462400Z","opened_at":"2025-06-26T02:37:04.462400Z","updated_at":"2025-06-26T02:37:04.462400Z","closed_at":"2025-06-26T02:37:04.462400Z"}
2025-06-25 22:37:04,875 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '94009826-7809-422c-b514-2b2b8ae2c058', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:37:04.462400Z', 'submittedAt': '2025-06-26T02:37:04.462400Z', 'fillTimestamp': '2025-06-26T02:37:04.462400Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:37:04.462400Z', 'opened_at': '2025-06-26T02:37:04.462400Z', 'updated_at': '2025-06-26T02:37:04.462400Z', 'closed_at': '2025-06-26T02:37:04.462400Z'}
2025-06-25 22:37:04,875 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 3
2025-06-25 22:37:04,876 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:37:04,876 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 22:37:04,895 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:37:04,897 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:37:04,923 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:37:04,925 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 22:37:04,925 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:37:04,925 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:37:05,118 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:37:05,119 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:37:05,308 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:37:05,308 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:05,308 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:05,309 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:37:05,311 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:37:05,312 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000220B6423C10>
2025-06-25 22:37:05,312 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:37:05,313 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:37:05,313 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: 2025-06-27 02:37:04.924974+00:00, end_date: None
2025-06-25 22:37:05,318 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 0
2025-06-25 22:37:05,319 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:37:05,320 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 22:37:05,374 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 6522e6be-55e9-474e-a970-ffeeec3ddcab for symbol BTCUSDT
2025-06-25 22:37:05,375 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 48782786-c731-4607-b996-c0af900e2cfb
2025-06-25 22:37:05,375 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy a051e2bf-142b-498d-9867-cde78191104b can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:37:05,385 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 061204a1-19cd-4c90-bee1-36e33ccd1141 for symbol BTCUSDT
2025-06-25 22:37:05,385 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy bec2c645-9710-4d92-9a00-6986416b4f99 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:37:05,392 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity ee41340f-b957-4c93-bee6-6ee878c3afaf for symbol ETHUSDT
2025-06-25 22:37:05,392 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 50c2fdfb-a530-46fc-99cd-7b3ca0d2a3fa
2025-06-25 22:37:05,394 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:604 - No active and applicable strategies found for opportunity ee41340f-b957-4c93-bee6-6ee878c3afaf with symbol ETHUSDT.
2025-06-25 22:37:05,394 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity ee41340f-b957-4c93-bee6-6ee878c3afaf status to rejected_by_system: No active strategies are applicable to this opportunity's symbol.
2025-06-25 22:37:05,395 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity ee41340f-b957-4c93-bee6-6ee878c3afaf
2025-06-25 22:37:05,403 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity bc358c94-217b-45f2-9c3a-1f41d56cedbf for symbol BTCUSDT
2025-06-25 22:37:05,404 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: cb9cf4e0-519b-4655-9c4b-e4b48d72ea92
2025-06-25 22:37:05,404 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:717 - AI confidence 0.65 for strategy a373d3c6-7736-4588-90bb-a109fe9b4a45 is below threshold 0.8.
2025-06-25 22:37:05,405 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy a373d3c6-7736-4588-90bb-a109fe9b4a45 did not produce a decision for opportunity bc358c94-217b-45f2-9c3a-1f41d56cedbf.
2025-06-25 22:37:05,406 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:623 - No affirmative trading decisions made for opportunity bc358c94-217b-45f2-9c3a-1f41d56cedbf.
2025-06-25 22:37:05,414 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 3f8b3a42-016d-4011-a48f-1a9ebaff4c96 for symbol BTCUSDT
2025-06-25 22:37:05,415 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 7ab1b249-2b70-4ae5-9f59-dca78ffa53d7
2025-06-25 22:37:05,424 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 3e9b1cf8-7870-48ba-afae-918259c1e063 for symbol BTCUSDT
2025-06-25 22:37:05,424 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 914839e7-ff24-4af4-9212-6d2311afc4be
2025-06-25 22:37:05,430 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade ba455ec7-9c00-42d6-a8c5-a3f8ad8bd259 from decision 08cfe0f8-846e-497d-a410-e94738c39fa9
2025-06-25 22:37:05,437 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 486746e7-b986-4b6b-8e48-7213b970b16c from decision 115a3fb9-5839-49c2-890a-a487c1b58b07
2025-06-25 22:37:05,437 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade d92ed7b0-db22-4af4-ac05-d3dc94ef3e5b from decision 115a3fb9-5839-49c2-890a-a487c1b58b07
2025-06-25 22:37:05,445 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:05,445 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:05,456 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:37:05,457 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:37:05,461 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:37:05,463 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 77a01d94-1455-43b9-bfd7-79367f502f6b
2025-06-25 22:37:05,468 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 65602721-9f5b-4416-ab67-b2f3a1a6ae4f. Creando y guardando configuración por defecto.
2025-06-25 22:37:05,472 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:37:05,475 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 65602721-9f5b-4416-ab67-b2f3a1a6ae4f. Using default values.
2025-06-25 22:37:05,476 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 65602721-9f5b-4416-ab67-b2f3a1a6ae4f with capital: 10000.0
2025-06-25 22:37:05,477 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:37:05,477 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:37:05,478 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:37:05,478 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity 77a01d94-1455-43b9-bfd7-79367f502f6b
2025-06-25 22:37:05,478 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 7bc8eb00-4ae2-452f-a944-6c8facade416 from decision 494faa4c-865f-44f0-89e5-053e8500d562
2025-06-25 22:37:05,479 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 7bc8eb00-4ae2-452f-a944-6c8facade416 from confirmed opportunity.
2025-06-25 22:37:05,480 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:37:05,480 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('833d3344-0d7d-42cd-91ae-d196ac9ba467') orderId_exchange='mock_exchange_oco_id_b0b02680-eb50-4767-b147-a87f37543375' clientOrderId_exchange='mock_client_oco_id_a7aaf3a4-0f1e-4562-8a53-5de88a6899ef' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 37, 5, 480218) submittedAt=datetime.datetime(2025, 6, 26, 2, 37, 5, 480218, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 37, 5, 480218, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 94387185093764699870955627472059301796, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_7d71c980-c242-4b95-a8b1-f16ca9566f6c', 'transactionTime': 1750905425480, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='94387185093764699870955627472059301796' price=None stopPrice=None timeInForce=None
2025-06-25 22:37:05,481 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 65602721-9f5b-4416-ab67-b2f3a1a6ae4f: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:37:05,484 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('7bc8eb00-4ae2-452f-a944-6c8facade416'), '4ee17fdd-74b9-4904-b7de-081e587c19f3', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:37:05.478126', '2025-06-26 02:37:05.478126', None, '{"id":"7bc8eb00-4ae2-452f-a944-6c8facade416","user_id":"4ee17fdd-74b9-4904-b7de-081e587c19f3","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:37:05.478126","opened_at":"2025-06-26T02:37:05.478126","updated_at":"2025-06-26T02:37:05.478126","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('7bc8eb00-4ae2-452f-a944-6c8facade416'), '4ee17fdd-74b9-4904-b7de-081e587c19f3', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:37:05.478126', '2025-06-26 02:37:05.478126', None, '{"id":"7bc8eb00-4ae2-452f-a944-6c8facade416","user_id":"4ee17fdd-74b9-4904-b7de-081e587c19f3","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:37:05.478126","opened_at":"2025-06-26T02:37:05.478126","updated_at":"2025-06-26T02:37:05.478126","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:37:05,491 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 77a01d94-1455-43b9-bfd7-79367f502f6b: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('7bc8eb00-4ae2-452f-a944-6c8facade416'), '4ee17fdd-74b9-4904-b7de-081e587c19f3', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:37:05.478126', '2025-06-26 02:37:05.478126', None, '{"id":"7bc8eb00-4ae2-452f-a944-6c8facade416","user_id":"4ee17fdd-74b9-4904-b7de-081e587c19f3","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:37:05.478126","opened_at":"2025-06-26T02:37:05.478126","updated_at":"2025-06-26T02:37:05.478126","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:37:05,493 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 77a01d94-1455-43b9-bfd7-79367f502f6b status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:37:05,494 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:544 - Failed to persist status update for opportunity 77a01d94-1455-43b9-bfd7-79367f502f6b: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('7bc8eb00-4ae2-452f-a944-6c8facade416'), '4ee17fdd-74b9-4904-b7de-081e587c19f3', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:37:05.478126', '2025-06-26 02:37:05.478126', None, '{"id":"7bc8eb00-4ae2-452f-a944-6c8facade416","user_id":"4ee17fdd-74b9-4904-b7de-081e587c19f3","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:37:05.478126","opened_at":"2025-06-26T02:37:05.478126","updated_at":"2025-06-26T02:37:05.478126","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 537, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('7bc8eb00-4ae2-452f-a944-6c8facade416'), '4ee17fdd-74b9-4904-b7de-081e587c19f3', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:37:05.478126', '2025-06-26 02:37:05.478126', None, '{"id":"7bc8eb00-4ae2-452f-a944-6c8facade416","user_id":"4ee17fdd-74b9-4904-b7de-081e587c19f3","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:37:05.478126","opened_at":"2025-06-26T02:37:05.478126","updated_at":"2025-06-26T02:37:05.478126","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:37:05,779 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:37:05,780 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:37:05,789 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:05,789 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:05,797 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:37:05,797 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:37:05,799 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:37:05,801 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:37:05,803 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:37:05,810 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:05,811 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:05,820 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:37:05,820 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:37:05,822 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:37:05,824 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 5e8ace97-6524-4870-a191-d5834cb542b0 for symbol BTC/USDT
2025-06-25 22:37:05,827 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id fd0e44d8-b1f3-4908-ac21-eef013a28050. Creando y guardando configuración por defecto.
2025-06-25 22:37:05,831 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:37:05,832 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:672 - AI profile 'ai-profile-scalping-1' for strategy 2cfbc5be-74ab-446a-8fc4-2fbe0f95460b not found. Skipping AI analysis.
2025-06-25 22:37:05,832 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 2cfbc5be-74ab-446a-8fc4-2fbe0f95460b can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:37:05,832 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 5e8ace97-6524-4870-a191-d5834cb542b0 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:37:05,840 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 5e8ace97-6524-4870-a191-d5834cb542b0
2025-06-25 22:37:05,841 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:37:05,842 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:37:05,851 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:05,852 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:05,859 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:37:05,859 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:37:05,862 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:37:05,864 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 6c769261-eaef-42b4-8631-f089c2d6fc56
2025-06-25 22:37:05,868 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id ea997c07-80dc-4725-a482-242a16e8b3fa. Creando y guardando configuración por defecto.
2025-06-25 22:37:05,871 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:37:05,874 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for ea997c07-80dc-4725-a482-242a16e8b3fa. Using default values.
2025-06-25 22:37:05,874 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for ea997c07-80dc-4725-a482-242a16e8b3fa with capital: 10000.0
2025-06-25 22:37:05,875 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:37:05,876 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:37:05,876 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:37:05,876 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Autonomous Scalping' as context for confirmed opportunity 6c769261-eaef-42b4-8631-f089c2d6fc56
2025-06-25 22:37:05,876 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 628e48ab-0bb1-43fd-80de-4667beb78ebf from decision d8914ff4-31c2-4bfc-8044-008a5ce6a784
2025-06-25 22:37:05,877 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 628e48ab-0bb1-43fd-80de-4667beb78ebf from confirmed opportunity.
2025-06-25 22:37:05,878 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:37:05,879 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('7f207d10-80e9-4780-9b57-3e52cc8fc4bf') orderId_exchange='mock_exchange_oco_id_5bc6e295-8ca4-4da3-9135-f4ead42bbb99' clientOrderId_exchange='mock_client_oco_id_65af34e1-c827-4ef3-990a-ebe53c0f4885' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 37, 5, 879328) submittedAt=datetime.datetime(2025, 6, 26, 2, 37, 5, 879328, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 37, 5, 879328, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 299820756686346365441052943729662750362, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_5c875608-be4b-4606-99a4-8c30860243a1', 'transactionTime': 1750905425879, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='299820756686346365441052943729662750362' price=None stopPrice=None timeInForce=None
2025-06-25 22:37:05,879 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario ea997c07-80dc-4725-a482-242a16e8b3fa: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:37:05,882 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('628e48ab-0bb1-43fd-80de-4667beb78ebf'), '5f012389-4f8e-4456-8c08-c498fc8de3e6', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:37:05.876138', '2025-06-26 02:37:05.876138', None, '{"id":"628e48ab-0bb1-43fd-80de-4667beb78ebf","user_id":"5f012389-4f8e-4456-8c08-c498fc8de3e6","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:37:05.876138","opened_at":"2025-06-26T02:37:05.876138","updated_at":"2025-06-26T02:37:05.876138","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('628e48ab-0bb1-43fd-80de-4667beb78ebf'), '5f012389-4f8e-4456-8c08-c498fc8de3e6', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:37:05.876138', '2025-06-26 02:37:05.876138', None, '{"id":"628e48ab-0bb1-43fd-80de-4667beb78ebf","user_id":"5f012389-4f8e-4456-8c08-c498fc8de3e6","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:37:05.876138","opened_at":"2025-06-26T02:37:05.876138","updated_at":"2025-06-26T02:37:05.876138","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:37:05,884 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 6c769261-eaef-42b4-8631-f089c2d6fc56: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('628e48ab-0bb1-43fd-80de-4667beb78ebf'), '5f012389-4f8e-4456-8c08-c498fc8de3e6', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:37:05.876138', '2025-06-26 02:37:05.876138', None, '{"id":"628e48ab-0bb1-43fd-80de-4667beb78ebf","user_id":"5f012389-4f8e-4456-8c08-c498fc8de3e6","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:37:05.876138","opened_at":"2025-06-26T02:37:05.876138","updated_at":"2025-06-26T02:37:05.876138","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:37:05,886 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 6c769261-eaef-42b4-8631-f089c2d6fc56 status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:37:05,887 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:544 - Failed to persist status update for opportunity 6c769261-eaef-42b4-8631-f089c2d6fc56: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('628e48ab-0bb1-43fd-80de-4667beb78ebf'), '5f012389-4f8e-4456-8c08-c498fc8de3e6', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:37:05.876138', '2025-06-26 02:37:05.876138', None, '{"id":"628e48ab-0bb1-43fd-80de-4667beb78ebf","user_id":"5f012389-4f8e-4456-8c08-c498fc8de3e6","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:37:05.876138","opened_at":"2025-06-26T02:37:05.876138","updated_at":"2025-06-26T02:37:05.876138","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 537, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('628e48ab-0bb1-43fd-80de-4667beb78ebf'), '5f012389-4f8e-4456-8c08-c498fc8de3e6', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:37:05.876138', '2025-06-26 02:37:05.876138', None, '{"id":"628e48ab-0bb1-43fd-80de-4667beb78ebf","user_id":"5f012389-4f8e-4456-8c08-c498fc8de3e6","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:37:05.876138","opened_at":"2025-06-26T02:37:05.876138","updated_at":"2025-06-26T02:37:05.876138","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:37:05,897 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:37:05,898 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:37:05,906 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:05,906 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:05,913 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:37:05,913 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:37:05,916 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:37:05,918 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity a4bed815-d028-40b6-8755-89fa9ad3bc0b
2025-06-25 22:37:05,921 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 3843261c-83c2-4218-85de-0781700c62b7. Creando y guardando configuración por defecto.
2025-06-25 22:37:05,924 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:37:05,928 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 3843261c-83c2-4218-85de-0781700c62b7. Using default values.
2025-06-25 22:37:05,928 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 3843261c-83c2-4218-85de-0781700c62b7 with capital: 10000.0
2025-06-25 22:37:05,929 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:37:05,930 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:37:05,930 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:37:05,930 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity a4bed815-d028-40b6-8755-89fa9ad3bc0b
2025-06-25 22:37:05,931 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade a4726785-9edb-4b4f-ba99-47f36935b1dd from decision 68b083a5-5775-44d9-97b8-56f49d69b194
2025-06-25 22:37:05,931 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade a4726785-9edb-4b4f-ba99-47f36935b1dd from confirmed opportunity.
2025-06-25 22:37:05,932 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:37:05,933 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('308ebc7d-2516-4cb4-9318-a76ab95d9f11') orderId_exchange='mock_exchange_oco_id_4c011c8b-dde0-4bec-ab9a-16400bfd1945' clientOrderId_exchange='mock_client_oco_id_6da10ed5-8c21-4608-9725-008ee2ee6301' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 37, 5, 933257) submittedAt=datetime.datetime(2025, 6, 26, 2, 37, 5, 933257, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 37, 5, 933257, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 334453155439844187196275739363239624445, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_87d619a3-dc39-4efe-9ea7-ff06733609c8', 'transactionTime': 1750905425933, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='334453155439844187196275739363239624445' price=None stopPrice=None timeInForce=None
2025-06-25 22:37:05,933 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 3843261c-83c2-4218-85de-0781700c62b7: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:37:05,936 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('a4726785-9edb-4b4f-ba99-47f36935b1dd'), '54f79b8a-cb37-458c-99f5-9de649104192', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:37:05.931258', '2025-06-26 02:37:05.931258', None, '{"id":"a4726785-9edb-4b4f-ba99-47f36935b1dd","user_id":"54f79b8a-cb37-458c-99f5-9de649104192","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:37:05.931258","opened_at":"2025-06-26T02:37:05.931258","updated_at":"2025-06-26T02:37:05.931258","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('a4726785-9edb-4b4f-ba99-47f36935b1dd'), '54f79b8a-cb37-458c-99f5-9de649104192', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:37:05.931258', '2025-06-26 02:37:05.931258', None, '{"id":"a4726785-9edb-4b4f-ba99-47f36935b1dd","user_id":"54f79b8a-cb37-458c-99f5-9de649104192","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:37:05.931258","opened_at":"2025-06-26T02:37:05.931258","updated_at":"2025-06-26T02:37:05.931258","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:37:05,938 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity a4bed815-d028-40b6-8755-89fa9ad3bc0b: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('a4726785-9edb-4b4f-ba99-47f36935b1dd'), '54f79b8a-cb37-458c-99f5-9de649104192', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:37:05.931258', '2025-06-26 02:37:05.931258', None, '{"id":"a4726785-9edb-4b4f-ba99-47f36935b1dd","user_id":"54f79b8a-cb37-458c-99f5-9de649104192","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:37:05.931258","opened_at":"2025-06-26T02:37:05.931258","updated_at":"2025-06-26T02:37:05.931258","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:37:05,941 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity a4bed815-d028-40b6-8755-89fa9ad3bc0b status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:37:05,941 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:544 - Failed to persist status update for opportunity a4bed815-d028-40b6-8755-89fa9ad3bc0b: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('a4726785-9edb-4b4f-ba99-47f36935b1dd'), '54f79b8a-cb37-458c-99f5-9de649104192', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:37:05.931258', '2025-06-26 02:37:05.931258', None, '{"id":"a4726785-9edb-4b4f-ba99-47f36935b1dd","user_id":"54f79b8a-cb37-458c-99f5-9de649104192","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:37:05.931258","opened_at":"2025-06-26T02:37:05.931258","updated_at":"2025-06-26T02:37:05.931258","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 537, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('a4726785-9edb-4b4f-ba99-47f36935b1dd'), '54f79b8a-cb37-458c-99f5-9de649104192', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:37:05.931258', '2025-06-26 02:37:05.931258', None, '{"id":"a4726785-9edb-4b4f-ba99-47f36935b1dd","user_id":"54f79b8a-cb37-458c-99f5-9de649104192","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:37:05.931258","opened_at":"2025-06-26T02:37:05.931258","updated_at":"2025-06-26T02:37:05.931258","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:37:05,951 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:37:05,952 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:37:05,960 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:05,961 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:05,969 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:37:05,969 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:37:05,972 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:37:05,973 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 0de9e2d7-bdc9-4237-95ea-bdb5b9f4748e
2025-06-25 22:37:05,976 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id c872dcbf-705a-4d32-bb95-e5d5ac2ff0e1. Creando y guardando configuración por defecto.
2025-06-25 22:37:05,978 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:37:05,981 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for c872dcbf-705a-4d32-bb95-e5d5ac2ff0e1. Using default values.
2025-06-25 22:37:05,981 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for c872dcbf-705a-4d32-bb95-e5d5ac2ff0e1 with capital: 10000.0
2025-06-25 22:37:05,983 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:37:05,983 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:37:05,984 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:37:05,984 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Day Trading Strategy' as context for confirmed opportunity 0de9e2d7-bdc9-4237-95ea-bdb5b9f4748e
2025-06-25 22:37:05,985 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade b5e610df-5163-4372-9077-979c159dd592 from decision 7d190701-42d3-471f-a934-05a050581ed2
2025-06-25 22:37:05,986 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade b5e610df-5163-4372-9077-979c159dd592 from confirmed opportunity.
2025-06-25 22:37:05,988 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:37:05,988 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('2effc736-3c66-47c3-b906-4f3123a772dc') orderId_exchange='mock_exchange_oco_id_ffcec271-dd15-433c-8fb5-9d46441781ee' clientOrderId_exchange='mock_client_oco_id_b2412fad-285e-4e71-ba67-78f33dfa2f32' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 37, 5, 988025) submittedAt=datetime.datetime(2025, 6, 26, 2, 37, 5, 988025, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 37, 5, 988025, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 210409445516664277827363815710770641417, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_4d988ffa-1339-46a7-9aa4-d3ab0443cb19', 'transactionTime': 1750905425988, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='210409445516664277827363815710770641417' price=None stopPrice=None timeInForce=None
2025-06-25 22:37:05,989 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario c872dcbf-705a-4d32-bb95-e5d5ac2ff0e1: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:37:05,992 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('b5e610df-5163-4372-9077-979c159dd592'), 'f71c067b-935c-496a-be55-6a4d0ce08e8c', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:37:05.985506', '2025-06-26 02:37:05.985506', None, '{"id":"b5e610df-5163-4372-9077-979c159dd592","user_id":"f71c067b-935c-496a-be55-6a4d0ce08e8c","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:37:05.985506","opened_at":"2025-06-26T02:37:05.985506","updated_at":"2025-06-26T02:37:05.985506","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('b5e610df-5163-4372-9077-979c159dd592'), 'f71c067b-935c-496a-be55-6a4d0ce08e8c', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:37:05.985506', '2025-06-26 02:37:05.985506', None, '{"id":"b5e610df-5163-4372-9077-979c159dd592","user_id":"f71c067b-935c-496a-be55-6a4d0ce08e8c","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:37:05.985506","opened_at":"2025-06-26T02:37:05.985506","updated_at":"2025-06-26T02:37:05.985506","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:37:05,994 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 0de9e2d7-bdc9-4237-95ea-bdb5b9f4748e: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('b5e610df-5163-4372-9077-979c159dd592'), 'f71c067b-935c-496a-be55-6a4d0ce08e8c', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:37:05.985506', '2025-06-26 02:37:05.985506', None, '{"id":"b5e610df-5163-4372-9077-979c159dd592","user_id":"f71c067b-935c-496a-be55-6a4d0ce08e8c","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:37:05.985506","opened_at":"2025-06-26T02:37:05.985506","updated_at":"2025-06-26T02:37:05.985506","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:37:05,996 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 0de9e2d7-bdc9-4237-95ea-bdb5b9f4748e status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:37:05,997 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:544 - Failed to persist status update for opportunity 0de9e2d7-bdc9-4237-95ea-bdb5b9f4748e: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('b5e610df-5163-4372-9077-979c159dd592'), 'f71c067b-935c-496a-be55-6a4d0ce08e8c', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:37:05.985506', '2025-06-26 02:37:05.985506', None, '{"id":"b5e610df-5163-4372-9077-979c159dd592","user_id":"f71c067b-935c-496a-be55-6a4d0ce08e8c","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:37:05.985506","opened_at":"2025-06-26T02:37:05.985506","updated_at":"2025-06-26T02:37:05.985506","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 537, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('b5e610df-5163-4372-9077-979c159dd592'), 'f71c067b-935c-496a-be55-6a4d0ce08e8c', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:37:05.985506', '2025-06-26 02:37:05.985506', None, '{"id":"b5e610df-5163-4372-9077-979c159dd592","user_id":"f71c067b-935c-496a-be55-6a4d0ce08e8c","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:37:05.985506","opened_at":"2025-06-26T02:37:05.985506","updated_at":"2025-06-26T02:37:05.985506","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:37:06,006 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:37:06,008 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:37:06,015 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:06,015 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:06,024 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:37:06,024 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:37:06,027 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:37:06,028 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 9941ef7a-6a95-4015-b537-a99ece2f03f0 from decision 253e814e-de05-4ace-a3e9-e14a00d8c74b
2025-06-25 22:37:06,028 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:37:06,030 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:37:06,038 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:06,038 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:06,045 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:37:06,045 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:37:06,048 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:37:06,049 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade e626db2f-0197-4896-b07a-7122b157e82c from decision 7507d6d2-dc9a-40bd-b31d-866609452fc0
2025-06-25 22:37:06,050 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:37:06,051 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:37:06,059 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:06,059 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:06,067 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:37:06,067 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:37:06,071 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:37:06,072 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:37:06,074 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:37:07,953 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:07,953 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:07,959 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:37:07,961 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:37:07,962 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:37:07,970 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:37:07,974 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:37:07,975 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:37:07,979 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:37:07,990 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:37:07,994 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:37:07,997 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:07,998 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:08,002 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:08,003 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:08,004 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:37:08,007 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:08,007 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:08,015 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:08,015 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:08,026 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:08,026 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:08,035 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:37:08,041 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:08,042 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:08,046 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:286 - Verificación de Binance BINANCE_SPOT exitosa.
2025-06-25 22:37:08,050 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:08,050 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:08,055 - ultibot_backend.services.credential_service - ERROR - [MainThread] - credential_service.py:315 - Error de Binance API durante la verificación: Binance Down
2025-06-25 22:37:08,060 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:08,060 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:08,063 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:37:08,072 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:08,073 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:08,080 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:241 - Verificación de Telegram exitosa.
2025-06-25 22:37:08,090 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:72 - Conexión con Binance exitosa.
2025-06-25 22:37:08,098 - ultibot_backend.services.market_data_service - WARNING - [MainThread] - market_data_service.py:52 - Credenciales de Binance no encontradas. Por favor, configúrelas.
2025-06-25 22:37:08,106 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:69 - Fallo en la verificación de conexión con Binance. Revise sus credenciales y permisos.
2025-06-25 22:37:08,113 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:77 - Error al acceder a las credenciales de Binance: Decryption failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 45, in get_binance_connection_status
    binance_credential = await self.credential_service.get_credential(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.CredentialError: Decryption failed
2025-06-25 22:37:08,120 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:81 - Error de la API de Binance: API unavailable
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 61, in get_binance_connection_status
    is_connected = await self.credential_service.verify_credential(binance_credential)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.BinanceAPIError: API unavailable
2025-06-25 22:37:08,125 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:37:08,135 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:121 - Error de la API de Binance al obtener balances: Failed to fetch balances
2025-06-25 22:37:08,139 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2339525274576'>
2025-06-25 22:37:08,141 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user e7f3aefa-4902-4ef8-9a96-4464ab09d474, mode_filter: None
2025-06-25 22:37:08,141 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2339525274576'>
2025-06-25 22:37:08,141 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user e7f3aefa-4902-4ef8-9a96-4464ab09d474 with mode_filter: None
2025-06-25 22:37:08,145 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2339527020944'>
2025-06-25 22:37:08,146 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user e7f3aefa-4902-4ef8-9a96-4464ab09d474, mode_filter: None
2025-06-25 22:37:08,146 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2339527020944'>
2025-06-25 22:37:08,146 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user e7f3aefa-4902-4ef8-9a96-4464ab09d474 with mode_filter: None
2025-06-25 22:37:08,151 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2339525270928'>
2025-06-25 22:37:08,153 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user e7f3aefa-4902-4ef8-9a96-4464ab09d474, mode_filter: OperatingMode.PAPER
2025-06-25 22:37:08,153 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2339525270928'>
2025-06-25 22:37:08,153 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user e7f3aefa-4902-4ef8-9a96-4464ab09d474
2025-06-25 22:37:08,156 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2339525769936'>
2025-06-25 22:37:08,158 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user e7f3aefa-4902-4ef8-9a96-4464ab09d474, mode_filter: OperatingMode.PAPER
2025-06-25 22:37:08,159 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2339525769936'>
2025-06-25 22:37:08,159 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user e7f3aefa-4902-4ef8-9a96-4464ab09d474
2025-06-25 22:37:08,162 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2339527164112'>
2025-06-25 22:37:08,164 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user e7f3aefa-4902-4ef8-9a96-4464ab09d474, mode_filter: OperatingMode.REAL
2025-06-25 22:37:08,164 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2339527164112'>
2025-06-25 22:37:08,164 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user e7f3aefa-4902-4ef8-9a96-4464ab09d474
2025-06-25 22:37:08,168 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2339527165456'>
2025-06-25 22:37:08,170 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user e7f3aefa-4902-4ef8-9a96-4464ab09d474, mode_filter: OperatingMode.PAPER
2025-06-25 22:37:08,170 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2339527165456'>
2025-06-25 22:37:08,171 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user e7f3aefa-4902-4ef8-9a96-4464ab09d474
2025-06-25 22:37:08,176 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2339526322128'>
2025-06-25 22:37:08,177 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user e7f3aefa-4902-4ef8-9a96-4464ab09d474, mode_filter: None
2025-06-25 22:37:08,177 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2339526322128'>
2025-06-25 22:37:08,178 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 2 performance entries for user e7f3aefa-4902-4ef8-9a96-4464ab09d474
2025-06-25 22:37:08,181 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2339526316624'>
2025-06-25 22:37:08,182 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user e7f3aefa-4902-4ef8-9a96-4464ab09d474, mode_filter: OperatingMode.PAPER
2025-06-25 22:37:08,183 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2339526316624'>
2025-06-25 22:37:08,183 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user e7f3aefa-4902-4ef8-9a96-4464ab09d474
2025-06-25 22:37:08,187 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2339525762640'>
2025-06-25 22:37:08,189 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user e7f3aefa-4902-4ef8-9a96-4464ab09d474, mode_filter: OperatingMode.PAPER
2025-06-25 22:37:08,189 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2339525762640'>
2025-06-25 22:37:08,189 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user e7f3aefa-4902-4ef8-9a96-4464ab09d474 with mode_filter: OperatingMode.PAPER
2025-06-25 22:37:08,194 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2339526318736'>
2025-06-25 22:37:08,197 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user e7f3aefa-4902-4ef8-9a96-4464ab09d474, mode_filter: OperatingMode.PAPER
2025-06-25 22:37:08,197 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2339526318736'>
2025-06-25 22:37:08,197 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user e7f3aefa-4902-4ef8-9a96-4464ab09d474 with mode_filter: OperatingMode.PAPER
2025-06-25 22:37:08,201 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2339526413776'>
2025-06-25 22:37:08,202 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user e7f3aefa-4902-4ef8-9a96-4464ab09d474, mode_filter: OperatingMode.PAPER
2025-06-25 22:37:08,203 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2339526413776'>
2025-06-25 22:37:08,203 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user e7f3aefa-4902-4ef8-9a96-4464ab09d474
2025-06-25 22:37:08,206 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2339525771472'>
2025-06-25 22:37:08,207 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user e7f3aefa-4902-4ef8-9a96-4464ab09d474, mode_filter: OperatingMode.PAPER
2025-06-25 22:37:08,209 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2339525771472'>
2025-06-25 22:37:08,209 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user e7f3aefa-4902-4ef8-9a96-4464ab09d474
2025-06-25 22:37:08,212 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2339525272464'>
2025-06-25 22:37:08,213 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user e7f3aefa-4902-4ef8-9a96-4464ab09d474, mode_filter: OperatingMode.PAPER
2025-06-25 22:37:08,214 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2339525272464'>
2025-06-25 22:37:08,214 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user e7f3aefa-4902-4ef8-9a96-4464ab09d474
2025-06-25 22:37:08,216 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2339525781968'>
2025-06-25 22:37:08,221 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user e7f3aefa-4902-4ef8-9a96-4464ab09d474, mode_filter: OperatingMode.PAPER
2025-06-25 22:37:08,221 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2339525781968'>
2025-06-25 22:37:08,221 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user e7f3aefa-4902-4ef8-9a96-4464ab09d474
2025-06-25 22:37:08,270 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario bf9ab8fb-72ed-4028-aca4-6d7f65772ef8 en modo paper
2025-06-25 22:37:08,275 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 02768aa1-3388-4057-9fbc-327e6da7bc97 en modo paper
2025-06-25 22:37:08,279 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario 0092645e-594f-4f26-96bf-66fdc92153de en modo paper
2025-06-25 22:37:08,285 - ultibot_backend.services.trading_report_service - ERROR - [MainThread] - trading_report_service.py:79 - Error al obtener trades cerrados para usuario b1ade904-c1b9-4a9e-a5f3-323f5e77de28: Database connection failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_report_service.py", line 65, in get_closed_trades
    trades = await persistence_service.get_closed_trades(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
Exception: Database connection failed
2025-06-25 22:37:08,294 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity c9cb827d-c656-4190-8dea-bba67464a607 for symbol BTC/USDT
2025-06-25 22:37:08,296 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 3f0f647d-6ff3-419b-983b-dd09959d8fed can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:37:08,296 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity c9cb827d-c656-4190-8dea-bba67464a607 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:37:08,296 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity c9cb827d-c656-4190-8dea-bba67464a607
2025-06-25 22:37:08,306 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity a1cbd3d8-7551-4c17-8bc4-be8576c6f5a6 for symbol BTC/USDT
2025-06-25 22:37:08,308 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy b70c7ba8-1201-4323-8ea1-17c785448cb9 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:37:08,308 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity a1cbd3d8-7551-4c17-8bc4-be8576c6f5a6 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:37:08,309 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity a1cbd3d8-7551-4c17-8bc4-be8576c6f5a6
2025-06-25 22:37:08,319 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity ad0f3da4-8b54-4479-9cc8-bc1430539886 for symbol BTC/USDT
2025-06-25 22:37:08,322 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 3a949b81-076d-4a9d-9080-dd066af91bb5 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:37:08,322 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity ad0f3da4-8b54-4479-9cc8-bc1430539886 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:37:08,323 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity ad0f3da4-8b54-4479-9cc8-bc1430539886
2025-06-25 22:37:08,333 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity c81892fc-cc35-4de7-9994-757080385c84 for symbol BTC/USDT
2025-06-25 22:37:08,335 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 94cb5e1d-d21a-449d-9478-c708b2349d18 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:37:08,335 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity c81892fc-cc35-4de7-9994-757080385c84 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:37:08,336 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity c81892fc-cc35-4de7-9994-757080385c84
2025-06-25 22:37:08,345 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 5662178c-32b0-49a4-8947-ecaf8404999b for symbol BTC/USDT
2025-06-25 22:37:08,346 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:653 - Unknown strategy type 'CUSTOM_UNKNOWN_TYPE' for strategy 18324038-d9e6-4098-b113-351cf3235172. Recommending investigation.
2025-06-25 22:37:08,346 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 5662178c-32b0-49a4-8947-ecaf8404999b status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:37:08,348 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 5662178c-32b0-49a4-8947-ecaf8404999b
2025-06-25 22:37:08,356 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 865c2c19-acf6-483c-9a27-95893ea7be56 for symbol BTC/USDT
2025-06-25 22:37:08,360 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 2b6844e1-c4ed-42d5-aa44-3064616721b6 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:37:08,360 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 865c2c19-acf6-483c-9a27-95893ea7be56 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:37:08,361 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 865c2c19-acf6-483c-9a27-95893ea7be56
2025-06-25 22:37:08,381 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity c44b8f83-bb4b-461a-8095-c97b28bf3c95 for symbol BTC/USDT
2025-06-25 22:37:08,382 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 7f8058b5-957c-4ab6-a2bb-a348c6d1031d can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:37:08,383 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity c44b8f83-bb4b-461a-8095-c97b28bf3c95 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:37:08,384 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity c44b8f83-bb4b-461a-8095-c97b28bf3c95
2025-06-25 22:37:15,230 - ultibot_backend - INFO - [MainThread] - main.py:104 - Apagando UltiBot Backend (lifespan)...
2025-06-25 22:37:15,230 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:189 - Shutting down dependency container...
2025-06-25 22:37:15,234 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:40 - Redis client closed.
2025-06-25 22:37:15,235 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:196 - Dependency container shut down.
2025-06-25 22:37:15,235 - ultibot_backend - INFO - [MainThread] - main.py:107 - Recursos liberados y aplicación apagada (lifespan).
2025-06-25 22:37:19,821 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:37:19,822 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:37:19,841 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:37:19,842 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:37:19,844 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:37:19,844 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:37:19,844 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:37:19,845 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:37:19,845 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:37:19,891 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:37:20,071 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:37:20,072 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:37:20,254 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:37:20,257 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:20,257 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:20,257 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:37:20,271 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:37:20,272 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000014CCC2B01D0>
2025-06-25 22:37:20,272 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:37:20,272 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:37:20,273 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:37:24,920 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:37:24,921 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:37:24,941 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:37:24,942 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:37:24,944 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:37:24,945 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:37:24,945 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:37:24,946 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:37:24,946 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:37:24,982 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:37:25,162 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:37:25,163 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:37:25,345 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:37:25,348 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:37:25,348 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:37:25,348 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:37:25,362 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:37:25,362 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001620B9A4B90>
2025-06-25 22:37:25,363 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:37:25,363 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:37:25,363 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:38:30,392 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:38:30,393 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:38:30,411 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:38:30,411 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:38:30,576 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:38:30,577 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:38:30,595 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:38:30,595 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:38:31,281 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:38:31,281 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:38:31,303 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:38:31,317 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:38:31,320 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:38:31,324 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:38:31,325 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:38:31,333 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:38:31,334 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:38:31,352 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:38:31,357 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:38:31,358 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:38:31,365 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:38:31,365 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:38:31,386 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:38:31,388 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:38:31,390 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:38:31,398 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:38:31,398 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:38:31,415 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:38:31,419 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:38:31,420 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:38:31,427 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:38:31,428 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:38:31,448 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:38:31,451 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:38:31,452 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:38:31,460 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:38:31,461 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:38:31,479 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:38:31,480 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:38:31,481 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:38:31,481 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:38:31,481 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:38:31,481 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:38:31,505 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:38:31,689 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:38:31,690 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:38:31,876 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:38:31,877 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:31,877 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:31,877 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:38:31,893 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:38:31,894 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001F1E6D36610>
2025-06-25 22:38:31,894 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:38:31,894 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:38:31,895 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 422
2025-06-25 22:38:31,904 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:38:31,904 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:38:32,023 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:38:32,025 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:38:32,025 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:38:32,025 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:38:32,204 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:38:32,205 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:38:32,385 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:38:32,386 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:32,386 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:32,386 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:38:32,390 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:38:32,391 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001F1E6DC1DD0>
2025-06-25 22:38:32,391 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:38:32,391 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:38:32,399 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:38:32,407 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:38:32,408 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:38:32,416 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:38:32,416 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:38:32,434 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:38:32,436 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:38:32,437 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:38:32,437 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:38:32,613 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:38:32,614 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:38:32,792 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:38:32,792 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:32,792 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:32,793 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:38:32,795 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:38:32,795 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001F1E6AC89D0>
2025-06-25 22:38:32,796 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:38:32,796 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:38:32,800 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:38:32,808 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:38:32,808 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:38:32,809 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:38:32,815 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:38:32,816 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:38:32,817 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:38:32,817 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:38:32,826 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:38:32,826 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:38:32,846 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:38:32,847 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:38:32,848 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:38:32,848 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:38:33,028 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:38:33,029 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:38:33,206 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:38:33,207 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:33,208 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:33,208 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:38:33,210 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:38:33,211 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001F1E6D60A90>
2025-06-25 22:38:33,211 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:38:33,211 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:38:33,215 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:38:33,221 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:38:33,222 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:38:33,223 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:38:33,228 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:38:33,229 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:38:33,238 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:38:33,239 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:38:33,258 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:38:33,259 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:38:33,260 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:38:33,260 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:38:33,440 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:38:33,440 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:38:33,617 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:38:33,617 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:33,617 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:33,618 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:38:33,622 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:38:33,622 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001F1E6DC3ED0>
2025-06-25 22:38:33,623 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:38:33,623 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:38:33,626 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:38:33,631 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:38:33,632 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:38:33,633 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:38:33,641 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:38:33,641 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:38:33,651 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:38:33,651 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:38:33,672 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:38:33,673 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:38:33,674 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:38:33,674 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:38:33,851 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:38:33,852 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:38:34,031 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:38:34,032 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:34,032 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:34,032 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:38:34,036 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:38:34,037 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001F1E6D28A90>
2025-06-25 22:38:34,037 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:38:34,037 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:38:34,039 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 422
2025-06-25 22:38:34,058 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 5f95ec9e-0db5-498a-99da-a7e0b6e29f81
2025-06-25 22:38:34,059 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:152 - User configuration saved after initializing last_daily_reset for user fd4103e2-9eec-4fd5-80ed-0ad532eb5e8e.
2025-06-25 22:38:34,060 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 200.000
2025-06-25 22:38:34,060 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity 5f95ec9e-0db5-498a-99da-a7e0b6e29f81
2025-06-25 22:38:34,061 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 71433e61-75cb-469d-9cb1-1289850acc22 from decision df61e116-fca3-42aa-81b3-d807d242bf2f
2025-06-25 22:38:34,061 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 71433e61-75cb-469d-9cb1-1289850acc22 from confirmed opportunity.
2025-06-25 22:38:34,062 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:38:34,063 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:310 - Successfully created OCO order for trade 71433e61-75cb-469d-9cb1-1289850acc22. OCO List ID: oco_list_123
2025-06-25 22:38:34,063 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario fd4103e2-9eec-4fd5-80ed-0ad532eb5e8e: 200.0000000000000000000000000 (anterior: 0.0, valor trade: 200.0000000000000000000000000)
2025-06-25 22:38:34,064 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user fd4103e2-9eec-4fd5-80ed-0ad532eb5e8e to 200.0000000000000000000000000.
2025-06-25 22:38:34,064 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 5f95ec9e-0db5-498a-99da-a7e0b6e29f81 status to converted_to_trade_real: Trade 71433e61-75cb-469d-9cb1-1289850acc22 executed based on user confirmation.
2025-06-25 22:38:34,065 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 5f95ec9e-0db5-498a-99da-a7e0b6e29f81
2025-06-25 22:38:34,074 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity c3bfd19e-9fd5-49a7-bfa6-2d569be70e42
2025-06-25 22:38:34,075 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 4800.0, Riesgo Potencial Trade USD: 300.000
2025-06-25 22:38:34,075 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:191 - Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:38:34,075 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity c3bfd19e-9fd5-49a7-bfa6-2d569be70e42 status to error_in_processing: Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:38:34,076 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity c3bfd19e-9fd5-49a7-bfa6-2d569be70e42
2025-06-25 22:38:34,090 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 2648554c-cb51-4d66-8a91-935a97c5af1d
2025-06-25 22:38:34,090 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:143 - Daily capital reset triggered for user 9555bbd2-98ff-465a-8a6d-7b323e630251. Resetting daily_capital_risked_usd.
2025-06-25 22:38:34,091 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:147 - User configuration saved after daily capital reset for user 9555bbd2-98ff-465a-8a6d-7b323e630251.
2025-06-25 22:38:34,091 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 2500.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 100.000
2025-06-25 22:38:34,091 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity 2648554c-cb51-4d66-8a91-935a97c5af1d
2025-06-25 22:38:34,092 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 6dc7bb9d-9439-4930-a5fa-861ff48758af from decision 9086650e-7928-44f6-a6df-a00078f06667
2025-06-25 22:38:34,092 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 6dc7bb9d-9439-4930-a5fa-861ff48758af from confirmed opportunity.
2025-06-25 22:38:34,094 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:38:34,095 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:310 - Successfully created OCO order for trade 6dc7bb9d-9439-4930-a5fa-861ff48758af. OCO List ID: oco_reset_test
2025-06-25 22:38:34,096 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 9555bbd2-98ff-465a-8a6d-7b323e630251: 100.000 (anterior: 0.0, valor trade: 100.000)
2025-06-25 22:38:34,096 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user 9555bbd2-98ff-465a-8a6d-7b323e630251 to 100.000.
2025-06-25 22:38:34,096 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 2648554c-cb51-4d66-8a91-935a97c5af1d status to converted_to_trade_real: Trade 6dc7bb9d-9439-4930-a5fa-861ff48758af executed based on user confirmation.
2025-06-25 22:38:34,097 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 2648554c-cb51-4d66-8a91-935a97c5af1d
2025-06-25 22:38:34,112 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:38:34,113 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:38:34,131 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:38:34,133 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 22:38:34,133 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:38:34,133 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:38:34,309 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:38:34,309 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:38:34,490 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:38:34,490 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:34,491 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:34,491 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:38:34,494 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:38:34,494 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001F1E6D85A10>
2025-06-25 22:38:34,494 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:38:34,495 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:38:34,495 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 22:38:34,500 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"8034c04f-c3f4-487f-831c-68d4a1b69139","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:38:34.103729Z","submittedAt":"2025-06-26T02:38:34.103729Z","fillTimestamp":"2025-06-26T02:38:34.103729Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:38:34.103729Z","opened_at":"2025-06-26T02:38:34.103729Z","updated_at":"2025-06-26T02:38:34.103729Z","closed_at":"2025-06-26T02:38:34.103729Z"}
2025-06-25 22:38:34,500 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '8034c04f-c3f4-487f-831c-68d4a1b69139', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:38:34.103729Z', 'submittedAt': '2025-06-26T02:38:34.103729Z', 'fillTimestamp': '2025-06-26T02:38:34.103729Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:38:34.103729Z', 'opened_at': '2025-06-26T02:38:34.103729Z', 'updated_at': '2025-06-26T02:38:34.103729Z', 'closed_at': '2025-06-26T02:38:34.103729Z'}
2025-06-25 22:38:34,501 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"430d8104-13b1-4eb0-bc79-fcd975e119ed","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:38:34.103729Z","submittedAt":"2025-06-26T02:38:34.103729Z","fillTimestamp":"2025-06-26T02:38:34.103729Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:38:34.103729Z","opened_at":"2025-06-26T02:38:34.103729Z","updated_at":"2025-06-26T02:38:34.103729Z","closed_at":"2025-06-26T02:38:34.103729Z"}
2025-06-25 22:38:34,501 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': '430d8104-13b1-4eb0-bc79-fcd975e119ed', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:38:34.103729Z', 'submittedAt': '2025-06-26T02:38:34.103729Z', 'fillTimestamp': '2025-06-26T02:38:34.103729Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:38:34.103729Z', 'opened_at': '2025-06-26T02:38:34.103729Z', 'updated_at': '2025-06-26T02:38:34.103729Z', 'closed_at': '2025-06-26T02:38:34.103729Z'}
2025-06-25 22:38:34,502 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"c0908dc2-e194-4104-8f52-fee0c0c2373e","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:38:34.103729Z","submittedAt":"2025-06-26T02:38:34.103729Z","fillTimestamp":"2025-06-26T02:38:34.103729Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:38:34.103729Z","opened_at":"2025-06-26T02:38:34.103729Z","updated_at":"2025-06-26T02:38:34.103729Z","closed_at":"2025-06-26T02:38:34.103729Z"}
2025-06-25 22:38:34,502 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': 'c0908dc2-e194-4104-8f52-fee0c0c2373e', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:38:34.103729Z', 'submittedAt': '2025-06-26T02:38:34.103729Z', 'fillTimestamp': '2025-06-26T02:38:34.103729Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:38:34.103729Z', 'opened_at': '2025-06-26T02:38:34.103729Z', 'updated_at': '2025-06-26T02:38:34.103729Z', 'closed_at': '2025-06-26T02:38:34.103729Z'}
2025-06-25 22:38:34,503 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 3
2025-06-25 22:38:34,503 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:38:34,504 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 22:38:34,522 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:38:34,522 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:38:34,541 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:38:34,542 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 22:38:34,543 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:38:34,543 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:38:34,722 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:38:34,723 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:38:34,896 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:38:34,896 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:34,898 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:34,898 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:38:34,901 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:38:34,901 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001F1E807EED0>
2025-06-25 22:38:34,902 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:38:34,902 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:38:34,903 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: BTCUSDT, start_date: None, end_date: None
2025-06-25 22:38:34,909 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"4dd22c5a-cb4c-4380-ad2b-dabb58342e97","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:38:34.512952Z","submittedAt":"2025-06-26T02:38:34.512952Z","fillTimestamp":"2025-06-26T02:38:34.512952Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:38:34.512952Z","opened_at":"2025-06-26T02:38:34.512952Z","updated_at":"2025-06-26T02:38:34.512952Z","closed_at":"2025-06-26T02:38:34.512952Z"}
2025-06-25 22:38:34,909 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '4dd22c5a-cb4c-4380-ad2b-dabb58342e97', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:38:34.512952Z', 'submittedAt': '2025-06-26T02:38:34.512952Z', 'fillTimestamp': '2025-06-26T02:38:34.512952Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:38:34.512952Z', 'opened_at': '2025-06-26T02:38:34.512952Z', 'updated_at': '2025-06-26T02:38:34.512952Z', 'closed_at': '2025-06-26T02:38:34.512952Z'}
2025-06-25 22:38:34,909 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 1
2025-06-25 22:38:34,910 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 1 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:38:34,910 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 22:38:34,928 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:38:34,928 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:38:34,948 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:38:34,949 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 22:38:34,949 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:38:34,950 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:38:35,126 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:38:35,126 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:38:35,307 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:38:35,309 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:35,309 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:35,310 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:38:35,313 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:38:35,313 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001F1E6F00390>
2025-06-25 22:38:35,313 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:38:35,314 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:38:35,314 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 22:38:35,317 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"8395c4ed-65a7-4b4c-8b0a-0a0c10d2d85a","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:38:34.920071Z","submittedAt":"2025-06-26T02:38:34.920071Z","fillTimestamp":"2025-06-26T02:38:34.920071Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:38:34.920071Z","opened_at":"2025-06-26T02:38:34.920071Z","updated_at":"2025-06-26T02:38:34.920071Z","closed_at":"2025-06-26T02:38:34.920071Z"}
2025-06-25 22:38:35,317 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '8395c4ed-65a7-4b4c-8b0a-0a0c10d2d85a', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:38:34.920071Z', 'submittedAt': '2025-06-26T02:38:34.920071Z', 'fillTimestamp': '2025-06-26T02:38:34.920071Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:38:34.920071Z', 'opened_at': '2025-06-26T02:38:34.920071Z', 'updated_at': '2025-06-26T02:38:34.920071Z', 'closed_at': '2025-06-26T02:38:34.920071Z'}
2025-06-25 22:38:35,318 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"e578bdd9-3f94-45d0-9c56-8351c077f35a","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:38:34.920071Z","submittedAt":"2025-06-26T02:38:34.920071Z","fillTimestamp":"2025-06-26T02:38:34.920071Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:38:34.920071Z","opened_at":"2025-06-26T02:38:34.920071Z","updated_at":"2025-06-26T02:38:34.920071Z","closed_at":"2025-06-26T02:38:34.920071Z"}
2025-06-25 22:38:35,318 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': 'e578bdd9-3f94-45d0-9c56-8351c077f35a', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:38:34.920071Z', 'submittedAt': '2025-06-26T02:38:34.920071Z', 'fillTimestamp': '2025-06-26T02:38:34.920071Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:38:34.920071Z', 'opened_at': '2025-06-26T02:38:34.920071Z', 'updated_at': '2025-06-26T02:38:34.920071Z', 'closed_at': '2025-06-26T02:38:34.920071Z'}
2025-06-25 22:38:35,320 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"0e3a2546-8c33-4c05-9f61-97ad8aca7715","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:38:34.920071Z","submittedAt":"2025-06-26T02:38:34.920071Z","fillTimestamp":"2025-06-26T02:38:34.920071Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:38:34.920071Z","opened_at":"2025-06-26T02:38:34.920071Z","updated_at":"2025-06-26T02:38:34.920071Z","closed_at":"2025-06-26T02:38:34.920071Z"}
2025-06-25 22:38:35,320 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '0e3a2546-8c33-4c05-9f61-97ad8aca7715', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:38:34.920071Z', 'submittedAt': '2025-06-26T02:38:34.920071Z', 'fillTimestamp': '2025-06-26T02:38:34.920071Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:38:34.920071Z', 'opened_at': '2025-06-26T02:38:34.920071Z', 'updated_at': '2025-06-26T02:38:34.920071Z', 'closed_at': '2025-06-26T02:38:34.920071Z'}
2025-06-25 22:38:35,320 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 3
2025-06-25 22:38:35,321 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:38:35,321 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 22:38:35,339 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:38:35,339 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:38:35,358 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:38:35,360 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 22:38:35,361 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:38:35,361 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:38:35,538 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:38:35,539 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:38:35,715 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:38:35,716 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:35,716 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:35,716 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:38:35,720 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:38:35,720 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001F1E80F1AD0>
2025-06-25 22:38:35,720 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:38:35,720 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:38:35,721 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: 2025-06-27 02:38:35.360503+00:00, end_date: None
2025-06-25 22:38:35,724 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 0
2025-06-25 22:38:35,725 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:38:35,725 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 22:38:35,770 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity ddf62c80-1c76-4b30-b77f-1f127919d18b for symbol BTCUSDT
2025-06-25 22:38:35,771 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 9b92cf24-70bf-4067-9d76-19cd6d5089eb
2025-06-25 22:38:35,771 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 02e46e76-395f-4733-8ad6-22d0434b4637 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:38:35,781 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 74283b1a-deb6-4ab3-a8a3-4bd9b5c731ce for symbol BTCUSDT
2025-06-25 22:38:35,781 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy e223dfd3-2c51-429d-b625-d64f4844d45f can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:38:35,791 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 4ffa15d9-eef8-461c-8818-69d07d815da6 for symbol ETHUSDT
2025-06-25 22:38:35,791 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: df7c9587-1ff5-450e-933a-989397e87f0e
2025-06-25 22:38:35,794 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:604 - No active and applicable strategies found for opportunity 4ffa15d9-eef8-461c-8818-69d07d815da6 with symbol ETHUSDT.
2025-06-25 22:38:35,794 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 4ffa15d9-eef8-461c-8818-69d07d815da6 status to rejected_by_system: No active strategies are applicable to this opportunity's symbol.
2025-06-25 22:38:35,795 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 4ffa15d9-eef8-461c-8818-69d07d815da6
2025-06-25 22:38:35,804 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity f5a7d0e4-53ed-4cef-9df5-1cff9c333632 for symbol BTCUSDT
2025-06-25 22:38:35,804 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: e38546c9-d451-4b38-8616-a9cac26f4fc8
2025-06-25 22:38:35,805 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:717 - AI confidence 0.65 for strategy 96f8c6f7-5d6d-4a7b-98b8-58821e08e95d is below threshold 0.8.
2025-06-25 22:38:35,807 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy 96f8c6f7-5d6d-4a7b-98b8-58821e08e95d did not produce a decision for opportunity f5a7d0e4-53ed-4cef-9df5-1cff9c333632.
2025-06-25 22:38:35,807 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:623 - No affirmative trading decisions made for opportunity f5a7d0e4-53ed-4cef-9df5-1cff9c333632.
2025-06-25 22:38:35,817 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 77278d09-e85e-4fa9-8bae-74eebf581d2e for symbol BTCUSDT
2025-06-25 22:38:35,818 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: b1b1857b-6907-4e52-9d1c-12d64d1ea40d
2025-06-25 22:38:35,826 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 21e746a6-4fec-48d3-bbdf-952cfe22f18e for symbol BTCUSDT
2025-06-25 22:38:35,826 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: e817907d-5629-455e-82c1-76373eace9a1
2025-06-25 22:38:35,834 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade e7887f71-1a5e-4b42-9770-c65a7706b7b3 from decision 6b6f9928-f3ba-4679-b320-82c25db95609
2025-06-25 22:38:35,840 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade a49fd214-16b1-4921-9f8a-c7730af03ad0 from decision f0d135ef-b90b-4bac-b59f-c3648dcee1d8
2025-06-25 22:38:35,840 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 0e31ab16-1899-4035-8ae3-f8215ddd1318 from decision f0d135ef-b90b-4bac-b59f-c3648dcee1d8
2025-06-25 22:38:35,846 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:35,847 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:35,857 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:38:35,857 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:38:35,860 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:38:35,862 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity c917c683-e481-4f8f-98a0-53c4884656af
2025-06-25 22:38:35,864 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 82547a41-bed0-46c0-978c-23c9fe891e90. Creando y guardando configuración por defecto.
2025-06-25 22:38:35,867 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:38:35,871 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 82547a41-bed0-46c0-978c-23c9fe891e90. Using default values.
2025-06-25 22:38:35,871 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 82547a41-bed0-46c0-978c-23c9fe891e90 with capital: 10000.0
2025-06-25 22:38:35,873 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:38:35,873 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:38:35,873 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:38:35,873 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity c917c683-e481-4f8f-98a0-53c4884656af
2025-06-25 22:38:35,874 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade b6e24739-b97e-4944-b81f-34cdf9e63365 from decision 458803d9-a2ed-48d4-a1b1-e8374d652b45
2025-06-25 22:38:35,874 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade b6e24739-b97e-4944-b81f-34cdf9e63365 from confirmed opportunity.
2025-06-25 22:38:35,875 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:38:35,876 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('47cd8e4d-00ab-45a5-b119-7650f173d324') orderId_exchange='mock_exchange_oco_id_f1037aa7-d4db-4b83-aa31-47ea23ca6fe9' clientOrderId_exchange='mock_client_oco_id_2948b925-deb4-48c8-9da7-deeb9c372b32' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 38, 35, 876521) submittedAt=datetime.datetime(2025, 6, 26, 2, 38, 35, 876521, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 38, 35, 876521, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 82427386819136005407277699144411317548, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_f97155da-aade-42c1-b17b-2656fb66ad29', 'transactionTime': 1750905515876, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='82427386819136005407277699144411317548' price=None stopPrice=None timeInForce=None
2025-06-25 22:38:35,876 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 82547a41-bed0-46c0-978c-23c9fe891e90: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:38:35,880 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('b6e24739-b97e-4944-b81f-34cdf9e63365'), 'a2f0e09c-e3c5-4f05-9ce3-c2ca64edaced', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:38:35.874514', '2025-06-26 02:38:35.874514', None, '{"id":"b6e24739-b97e-4944-b81f-34cdf9e63365","user_id":"a2f0e09c-e3c5-4f05-9ce3-c2ca64edaced","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:38:35.874514","opened_at":"2025-06-26T02:38:35.874514","updated_at":"2025-06-26T02:38:35.874514","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('b6e24739-b97e-4944-b81f-34cdf9e63365'), 'a2f0e09c-e3c5-4f05-9ce3-c2ca64edaced', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:38:35.874514', '2025-06-26 02:38:35.874514', None, '{"id":"b6e24739-b97e-4944-b81f-34cdf9e63365","user_id":"a2f0e09c-e3c5-4f05-9ce3-c2ca64edaced","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:38:35.874514","opened_at":"2025-06-26T02:38:35.874514","updated_at":"2025-06-26T02:38:35.874514","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:38:35,888 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity c917c683-e481-4f8f-98a0-53c4884656af: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('b6e24739-b97e-4944-b81f-34cdf9e63365'), 'a2f0e09c-e3c5-4f05-9ce3-c2ca64edaced', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:38:35.874514', '2025-06-26 02:38:35.874514', None, '{"id":"b6e24739-b97e-4944-b81f-34cdf9e63365","user_id":"a2f0e09c-e3c5-4f05-9ce3-c2ca64edaced","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:38:35.874514","opened_at":"2025-06-26T02:38:35.874514","updated_at":"2025-06-26T02:38:35.874514","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:38:35,890 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity c917c683-e481-4f8f-98a0-53c4884656af status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:38:35,891 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:544 - Failed to persist status update for opportunity c917c683-e481-4f8f-98a0-53c4884656af: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('b6e24739-b97e-4944-b81f-34cdf9e63365'), 'a2f0e09c-e3c5-4f05-9ce3-c2ca64edaced', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:38:35.874514', '2025-06-26 02:38:35.874514', None, '{"id":"b6e24739-b97e-4944-b81f-34cdf9e63365","user_id":"a2f0e09c-e3c5-4f05-9ce3-c2ca64edaced","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:38:35.874514","opened_at":"2025-06-26T02:38:35.874514","updated_at":"2025-06-26T02:38:35.874514","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 537, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('b6e24739-b97e-4944-b81f-34cdf9e63365'), 'a2f0e09c-e3c5-4f05-9ce3-c2ca64edaced', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:38:35.874514', '2025-06-26 02:38:35.874514', None, '{"id":"b6e24739-b97e-4944-b81f-34cdf9e63365","user_id":"a2f0e09c-e3c5-4f05-9ce3-c2ca64edaced","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:38:35.874514","opened_at":"2025-06-26T02:38:35.874514","updated_at":"2025-06-26T02:38:35.874514","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:38:36,172 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:38:36,173 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:38:36,182 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:36,182 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:36,191 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:38:36,191 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:38:36,193 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:38:36,195 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:38:36,196 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:38:36,204 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:36,204 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:36,212 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:38:36,212 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:38:36,214 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:38:36,216 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 262e94f1-c4fa-4552-ad0f-a6b608b8614c for symbol BTC/USDT
2025-06-25 22:38:36,221 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 764b5188-6dbb-4870-b0a3-ac16ece8c7fd. Creando y guardando configuración por defecto.
2025-06-25 22:38:36,225 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:38:36,226 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:672 - AI profile 'ai-profile-scalping-1' for strategy 9083883b-d571-4a32-999f-abbd8dd64343 not found. Skipping AI analysis.
2025-06-25 22:38:36,226 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 9083883b-d571-4a32-999f-abbd8dd64343 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:38:36,227 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 262e94f1-c4fa-4552-ad0f-a6b608b8614c status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:38:36,233 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 262e94f1-c4fa-4552-ad0f-a6b608b8614c
2025-06-25 22:38:36,234 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:38:36,235 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:38:36,243 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:36,244 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:36,250 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:38:36,251 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:38:36,254 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:38:36,257 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity bfe85b4d-3a1b-4523-8dce-a64a8de9f0bf
2025-06-25 22:38:36,259 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id f4ff1a74-57f8-4bfb-ac8f-911971e33ec3. Creando y guardando configuración por defecto.
2025-06-25 22:38:36,262 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:38:36,264 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for f4ff1a74-57f8-4bfb-ac8f-911971e33ec3. Using default values.
2025-06-25 22:38:36,265 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for f4ff1a74-57f8-4bfb-ac8f-911971e33ec3 with capital: 10000.0
2025-06-25 22:38:36,266 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:38:36,266 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:38:36,266 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:38:36,267 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Autonomous Scalping' as context for confirmed opportunity bfe85b4d-3a1b-4523-8dce-a64a8de9f0bf
2025-06-25 22:38:36,267 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade ea26f0e4-e5fe-4768-b41b-2ae0b44a8bfb from decision 57ceeca8-e322-4750-aad9-4f2f6a8d11eb
2025-06-25 22:38:36,268 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade ea26f0e4-e5fe-4768-b41b-2ae0b44a8bfb from confirmed opportunity.
2025-06-25 22:38:36,269 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:38:36,269 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('007b2b5d-4261-46e3-90d5-2db07b795fc1') orderId_exchange='mock_exchange_oco_id_56b0b4de-5f3c-4b0e-b93e-c31441a98782' clientOrderId_exchange='mock_client_oco_id_fcccc1c7-a60e-4a6b-a571-897b50485d8a' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 38, 36, 269654) submittedAt=datetime.datetime(2025, 6, 26, 2, 38, 36, 269654, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 38, 36, 269654, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 129420943921261658241390309156897279127, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_35e9e7db-f632-49bd-944b-941810f27c3f', 'transactionTime': 1750905516269, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='129420943921261658241390309156897279127' price=None stopPrice=None timeInForce=None
2025-06-25 22:38:36,271 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario f4ff1a74-57f8-4bfb-ac8f-911971e33ec3: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:38:36,273 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('ea26f0e4-e5fe-4768-b41b-2ae0b44a8bfb'), '9d54c921-e614-4abd-80c9-408ba4106f45', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:38:36.267292', '2025-06-26 02:38:36.267292', None, '{"id":"ea26f0e4-e5fe-4768-b41b-2ae0b44a8bfb","user_id":"9d54c921-e614-4abd-80c9-408ba4106f45","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:38:36.267292","opened_at":"2025-06-26T02:38:36.267292","updated_at":"2025-06-26T02:38:36.267292","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('ea26f0e4-e5fe-4768-b41b-2ae0b44a8bfb'), '9d54c921-e614-4abd-80c9-408ba4106f45', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:38:36.267292', '2025-06-26 02:38:36.267292', None, '{"id":"ea26f0e4-e5fe-4768-b41b-2ae0b44a8bfb","user_id":"9d54c921-e614-4abd-80c9-408ba4106f45","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:38:36.267292","opened_at":"2025-06-26T02:38:36.267292","updated_at":"2025-06-26T02:38:36.267292","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:38:36,276 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity bfe85b4d-3a1b-4523-8dce-a64a8de9f0bf: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('ea26f0e4-e5fe-4768-b41b-2ae0b44a8bfb'), '9d54c921-e614-4abd-80c9-408ba4106f45', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:38:36.267292', '2025-06-26 02:38:36.267292', None, '{"id":"ea26f0e4-e5fe-4768-b41b-2ae0b44a8bfb","user_id":"9d54c921-e614-4abd-80c9-408ba4106f45","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:38:36.267292","opened_at":"2025-06-26T02:38:36.267292","updated_at":"2025-06-26T02:38:36.267292","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:38:36,278 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity bfe85b4d-3a1b-4523-8dce-a64a8de9f0bf status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:38:36,278 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:544 - Failed to persist status update for opportunity bfe85b4d-3a1b-4523-8dce-a64a8de9f0bf: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('ea26f0e4-e5fe-4768-b41b-2ae0b44a8bfb'), '9d54c921-e614-4abd-80c9-408ba4106f45', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:38:36.267292', '2025-06-26 02:38:36.267292', None, '{"id":"ea26f0e4-e5fe-4768-b41b-2ae0b44a8bfb","user_id":"9d54c921-e614-4abd-80c9-408ba4106f45","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:38:36.267292","opened_at":"2025-06-26T02:38:36.267292","updated_at":"2025-06-26T02:38:36.267292","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 537, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('ea26f0e4-e5fe-4768-b41b-2ae0b44a8bfb'), '9d54c921-e614-4abd-80c9-408ba4106f45', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:38:36.267292', '2025-06-26 02:38:36.267292', None, '{"id":"ea26f0e4-e5fe-4768-b41b-2ae0b44a8bfb","user_id":"9d54c921-e614-4abd-80c9-408ba4106f45","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:38:36.267292","opened_at":"2025-06-26T02:38:36.267292","updated_at":"2025-06-26T02:38:36.267292","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:38:36,288 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:38:36,289 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:38:36,296 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:36,297 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:36,304 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:38:36,305 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:38:36,307 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:38:36,309 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity b7144521-c54a-4c53-96fd-437ffa079e5e
2025-06-25 22:38:36,312 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 379927cf-64a7-4a1f-83b8-3cf0ad947c71. Creando y guardando configuración por defecto.
2025-06-25 22:38:36,314 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:38:36,316 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 379927cf-64a7-4a1f-83b8-3cf0ad947c71. Using default values.
2025-06-25 22:38:36,316 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 379927cf-64a7-4a1f-83b8-3cf0ad947c71 with capital: 10000.0
2025-06-25 22:38:36,319 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:38:36,320 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:38:36,321 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:38:36,321 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity b7144521-c54a-4c53-96fd-437ffa079e5e
2025-06-25 22:38:36,321 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade e37bab1e-bf04-44da-b485-95957fd74cae from decision 2efb009d-9356-402f-82c2-6378ac032b44
2025-06-25 22:38:36,321 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade e37bab1e-bf04-44da-b485-95957fd74cae from confirmed opportunity.
2025-06-25 22:38:36,323 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:38:36,323 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('42970db3-559c-4053-8b0e-a44850139c8d') orderId_exchange='mock_exchange_oco_id_adbfd862-659a-4f02-8d9e-1b273ab7afc1' clientOrderId_exchange='mock_client_oco_id_ff5c8d2f-19ea-426f-97da-045b7f0e5f91' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 38, 36, 323866) submittedAt=datetime.datetime(2025, 6, 26, 2, 38, 36, 323866, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 38, 36, 323866, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 280275415567790403350560172572840728670, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_62b841cf-8cc4-40fe-9f63-e75bf6f9ffae', 'transactionTime': 1750905516323, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='280275415567790403350560172572840728670' price=None stopPrice=None timeInForce=None
2025-06-25 22:38:36,324 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 379927cf-64a7-4a1f-83b8-3cf0ad947c71: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:38:36,326 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('e37bab1e-bf04-44da-b485-95957fd74cae'), 'e1a64902-458f-4300-93d0-b7397069c101', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:38:36.321367', '2025-06-26 02:38:36.321367', None, '{"id":"e37bab1e-bf04-44da-b485-95957fd74cae","user_id":"e1a64902-458f-4300-93d0-b7397069c101","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:38:36.321367","opened_at":"2025-06-26T02:38:36.321367","updated_at":"2025-06-26T02:38:36.321367","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('e37bab1e-bf04-44da-b485-95957fd74cae'), 'e1a64902-458f-4300-93d0-b7397069c101', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:38:36.321367', '2025-06-26 02:38:36.321367', None, '{"id":"e37bab1e-bf04-44da-b485-95957fd74cae","user_id":"e1a64902-458f-4300-93d0-b7397069c101","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:38:36.321367","opened_at":"2025-06-26T02:38:36.321367","updated_at":"2025-06-26T02:38:36.321367","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:38:36,329 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity b7144521-c54a-4c53-96fd-437ffa079e5e: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('e37bab1e-bf04-44da-b485-95957fd74cae'), 'e1a64902-458f-4300-93d0-b7397069c101', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:38:36.321367', '2025-06-26 02:38:36.321367', None, '{"id":"e37bab1e-bf04-44da-b485-95957fd74cae","user_id":"e1a64902-458f-4300-93d0-b7397069c101","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:38:36.321367","opened_at":"2025-06-26T02:38:36.321367","updated_at":"2025-06-26T02:38:36.321367","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:38:36,331 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity b7144521-c54a-4c53-96fd-437ffa079e5e status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:38:36,332 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:544 - Failed to persist status update for opportunity b7144521-c54a-4c53-96fd-437ffa079e5e: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('e37bab1e-bf04-44da-b485-95957fd74cae'), 'e1a64902-458f-4300-93d0-b7397069c101', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:38:36.321367', '2025-06-26 02:38:36.321367', None, '{"id":"e37bab1e-bf04-44da-b485-95957fd74cae","user_id":"e1a64902-458f-4300-93d0-b7397069c101","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:38:36.321367","opened_at":"2025-06-26T02:38:36.321367","updated_at":"2025-06-26T02:38:36.321367","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 537, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('e37bab1e-bf04-44da-b485-95957fd74cae'), 'e1a64902-458f-4300-93d0-b7397069c101', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:38:36.321367', '2025-06-26 02:38:36.321367', None, '{"id":"e37bab1e-bf04-44da-b485-95957fd74cae","user_id":"e1a64902-458f-4300-93d0-b7397069c101","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:38:36.321367","opened_at":"2025-06-26T02:38:36.321367","updated_at":"2025-06-26T02:38:36.321367","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:38:36,341 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:38:36,343 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:38:36,349 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:36,350 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:36,359 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:38:36,360 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:38:36,362 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:38:36,364 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity a31c1ac5-533b-4c26-89d9-9f6cc2f10f00
2025-06-25 22:38:36,366 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 92385918-4a3c-4637-9457-f8dbaa929208. Creando y guardando configuración por defecto.
2025-06-25 22:38:36,369 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:38:36,371 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 92385918-4a3c-4637-9457-f8dbaa929208. Using default values.
2025-06-25 22:38:36,371 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 92385918-4a3c-4637-9457-f8dbaa929208 with capital: 10000.0
2025-06-25 22:38:36,373 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:38:36,373 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:38:36,374 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:38:36,374 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Day Trading Strategy' as context for confirmed opportunity a31c1ac5-533b-4c26-89d9-9f6cc2f10f00
2025-06-25 22:38:36,374 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 34bd8af2-f208-425d-880c-93e3d65c8b9b from decision 7f36d46e-dc6c-4bad-bfd9-10b4b8b5b22e
2025-06-25 22:38:36,375 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 34bd8af2-f208-425d-880c-93e3d65c8b9b from confirmed opportunity.
2025-06-25 22:38:36,376 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:38:36,376 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('90841942-6f94-42b5-a36d-40ee1f1ea44f') orderId_exchange='mock_exchange_oco_id_b5731304-e257-401a-b96f-74100200e6d1' clientOrderId_exchange='mock_client_oco_id_02a98f02-ae3b-483b-81ca-015f2a4f6167' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 38, 36, 376738) submittedAt=datetime.datetime(2025, 6, 26, 2, 38, 36, 376738, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 38, 36, 376738, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 226279633402780204307230692207191898710, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_35dfbd39-0667-4241-8b92-fd0ba015bd9c', 'transactionTime': 1750905516376, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='226279633402780204307230692207191898710' price=None stopPrice=None timeInForce=None
2025-06-25 22:38:36,378 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 92385918-4a3c-4637-9457-f8dbaa929208: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:38:36,380 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('34bd8af2-f208-425d-880c-93e3d65c8b9b'), 'd04c241b-f773-4f11-8b21-7ba899e25878', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:38:36.374739', '2025-06-26 02:38:36.374739', None, '{"id":"34bd8af2-f208-425d-880c-93e3d65c8b9b","user_id":"d04c241b-f773-4f11-8b21-7ba899e25878","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:38:36.374739","opened_at":"2025-06-26T02:38:36.374739","updated_at":"2025-06-26T02:38:36.374739","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('34bd8af2-f208-425d-880c-93e3d65c8b9b'), 'd04c241b-f773-4f11-8b21-7ba899e25878', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:38:36.374739', '2025-06-26 02:38:36.374739', None, '{"id":"34bd8af2-f208-425d-880c-93e3d65c8b9b","user_id":"d04c241b-f773-4f11-8b21-7ba899e25878","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:38:36.374739","opened_at":"2025-06-26T02:38:36.374739","updated_at":"2025-06-26T02:38:36.374739","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:38:36,382 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity a31c1ac5-533b-4c26-89d9-9f6cc2f10f00: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('34bd8af2-f208-425d-880c-93e3d65c8b9b'), 'd04c241b-f773-4f11-8b21-7ba899e25878', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:38:36.374739', '2025-06-26 02:38:36.374739', None, '{"id":"34bd8af2-f208-425d-880c-93e3d65c8b9b","user_id":"d04c241b-f773-4f11-8b21-7ba899e25878","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:38:36.374739","opened_at":"2025-06-26T02:38:36.374739","updated_at":"2025-06-26T02:38:36.374739","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:38:36,384 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity a31c1ac5-533b-4c26-89d9-9f6cc2f10f00 status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:38:36,385 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:544 - Failed to persist status update for opportunity a31c1ac5-533b-4c26-89d9-9f6cc2f10f00: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('34bd8af2-f208-425d-880c-93e3d65c8b9b'), 'd04c241b-f773-4f11-8b21-7ba899e25878', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:38:36.374739', '2025-06-26 02:38:36.374739', None, '{"id":"34bd8af2-f208-425d-880c-93e3d65c8b9b","user_id":"d04c241b-f773-4f11-8b21-7ba899e25878","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:38:36.374739","opened_at":"2025-06-26T02:38:36.374739","updated_at":"2025-06-26T02:38:36.374739","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 537, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('34bd8af2-f208-425d-880c-93e3d65c8b9b'), 'd04c241b-f773-4f11-8b21-7ba899e25878', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:38:36.374739', '2025-06-26 02:38:36.374739', None, '{"id":"34bd8af2-f208-425d-880c-93e3d65c8b9b","user_id":"d04c241b-f773-4f11-8b21-7ba899e25878","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:38:36.374739","opened_at":"2025-06-26T02:38:36.374739","updated_at":"2025-06-26T02:38:36.374739","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:38:36,394 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:38:36,395 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:38:36,404 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:36,404 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:36,412 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:38:36,412 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:38:36,414 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:38:36,415 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 3dec9a3a-813e-45c9-87a3-192f22ac2c79 from decision e17e9d31-fb72-41e8-9d47-4fb43233f43a
2025-06-25 22:38:36,416 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:38:36,418 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:38:36,426 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:36,426 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:36,434 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:38:36,434 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:38:36,437 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:38:36,439 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 1c06ac5a-2825-4145-8c74-8858ce85a1a3 from decision 85cbd412-122f-41d6-934d-f5eeaad820cc
2025-06-25 22:38:36,440 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:38:36,441 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:38:36,447 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:36,448 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:36,457 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:38:36,457 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:38:36,460 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:38:36,462 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:38:36,463 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:38:38,332 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:38,332 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:38,341 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:38:38,344 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:38:38,344 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:38:38,353 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:38:38,356 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:38:38,358 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:38:38,361 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:38:38,366 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:38:38,371 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:38:38,375 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:38,375 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:38,378 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:38,379 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:38,380 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:38:38,383 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:38,383 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:38,391 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:38,392 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:38,398 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:38,398 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:38,401 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:38:38,405 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:38,405 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:38,409 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:286 - Verificación de Binance BINANCE_SPOT exitosa.
2025-06-25 22:38:38,413 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:38,414 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:38,416 - ultibot_backend.services.credential_service - ERROR - [MainThread] - credential_service.py:315 - Error de Binance API durante la verificación: Binance Down
2025-06-25 22:38:38,423 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:38,424 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:38,427 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:38:38,432 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:38:38,432 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:38:38,437 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:241 - Verificación de Telegram exitosa.
2025-06-25 22:38:38,445 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:72 - Conexión con Binance exitosa.
2025-06-25 22:38:38,449 - ultibot_backend.services.market_data_service - WARNING - [MainThread] - market_data_service.py:52 - Credenciales de Binance no encontradas. Por favor, configúrelas.
2025-06-25 22:38:38,454 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:69 - Fallo en la verificación de conexión con Binance. Revise sus credenciales y permisos.
2025-06-25 22:38:38,460 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:77 - Error al acceder a las credenciales de Binance: Decryption failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 45, in get_binance_connection_status
    binance_credential = await self.credential_service.get_credential(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.CredentialError: Decryption failed
2025-06-25 22:38:38,465 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:81 - Error de la API de Binance: API unavailable
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 61, in get_binance_connection_status
    is_connected = await self.credential_service.verify_credential(binance_credential)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.BinanceAPIError: API unavailable
2025-06-25 22:38:38,470 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:38:38,481 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:121 - Error de la API de Binance al obtener balances: Failed to fetch balances
2025-06-25 22:38:38,484 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2138499173712'>
2025-06-25 22:38:38,486 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fe302531-42d5-4141-b833-a85e99c01208, mode_filter: None
2025-06-25 22:38:38,486 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2138499173712'>
2025-06-25 22:38:38,487 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user fe302531-42d5-4141-b833-a85e99c01208 with mode_filter: None
2025-06-25 22:38:38,490 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2138499282384'>
2025-06-25 22:38:38,491 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fe302531-42d5-4141-b833-a85e99c01208, mode_filter: None
2025-06-25 22:38:38,492 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2138499282384'>
2025-06-25 22:38:38,492 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user fe302531-42d5-4141-b833-a85e99c01208 with mode_filter: None
2025-06-25 22:38:38,495 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2138499185744'>
2025-06-25 22:38:38,496 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fe302531-42d5-4141-b833-a85e99c01208, mode_filter: OperatingMode.PAPER
2025-06-25 22:38:38,496 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2138499185744'>
2025-06-25 22:38:38,498 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user fe302531-42d5-4141-b833-a85e99c01208
2025-06-25 22:38:38,500 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2138499272080'>
2025-06-25 22:38:38,502 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fe302531-42d5-4141-b833-a85e99c01208, mode_filter: OperatingMode.PAPER
2025-06-25 22:38:38,502 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2138499272080'>
2025-06-25 22:38:38,503 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user fe302531-42d5-4141-b833-a85e99c01208
2025-06-25 22:38:38,506 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2138499239440'>
2025-06-25 22:38:38,508 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fe302531-42d5-4141-b833-a85e99c01208, mode_filter: OperatingMode.REAL
2025-06-25 22:38:38,508 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2138499239440'>
2025-06-25 22:38:38,508 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user fe302531-42d5-4141-b833-a85e99c01208
2025-06-25 22:38:38,513 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2138499243920'>
2025-06-25 22:38:38,514 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fe302531-42d5-4141-b833-a85e99c01208, mode_filter: OperatingMode.PAPER
2025-06-25 22:38:38,514 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2138499243920'>
2025-06-25 22:38:38,515 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user fe302531-42d5-4141-b833-a85e99c01208
2025-06-25 22:38:38,517 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2138499282128'>
2025-06-25 22:38:38,519 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fe302531-42d5-4141-b833-a85e99c01208, mode_filter: None
2025-06-25 22:38:38,520 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2138499282128'>
2025-06-25 22:38:38,520 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 2 performance entries for user fe302531-42d5-4141-b833-a85e99c01208
2025-06-25 22:38:38,524 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2138499174608'>
2025-06-25 22:38:38,525 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fe302531-42d5-4141-b833-a85e99c01208, mode_filter: OperatingMode.PAPER
2025-06-25 22:38:38,525 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2138499174608'>
2025-06-25 22:38:38,526 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user fe302531-42d5-4141-b833-a85e99c01208
2025-06-25 22:38:38,529 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2138499003088'>
2025-06-25 22:38:38,530 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fe302531-42d5-4141-b833-a85e99c01208, mode_filter: OperatingMode.PAPER
2025-06-25 22:38:38,530 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2138499003088'>
2025-06-25 22:38:38,531 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user fe302531-42d5-4141-b833-a85e99c01208 with mode_filter: OperatingMode.PAPER
2025-06-25 22:38:38,533 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2138499240784'>
2025-06-25 22:38:38,535 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fe302531-42d5-4141-b833-a85e99c01208, mode_filter: OperatingMode.PAPER
2025-06-25 22:38:38,536 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2138499240784'>
2025-06-25 22:38:38,536 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user fe302531-42d5-4141-b833-a85e99c01208 with mode_filter: OperatingMode.PAPER
2025-06-25 22:38:38,540 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2138497389264'>
2025-06-25 22:38:38,542 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fe302531-42d5-4141-b833-a85e99c01208, mode_filter: OperatingMode.PAPER
2025-06-25 22:38:38,543 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2138497389264'>
2025-06-25 22:38:38,543 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user fe302531-42d5-4141-b833-a85e99c01208
2025-06-25 22:38:38,546 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2138499258512'>
2025-06-25 22:38:38,547 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fe302531-42d5-4141-b833-a85e99c01208, mode_filter: OperatingMode.PAPER
2025-06-25 22:38:38,548 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2138499258512'>
2025-06-25 22:38:38,548 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user fe302531-42d5-4141-b833-a85e99c01208
2025-06-25 22:38:38,551 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2138498914448'>
2025-06-25 22:38:38,553 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fe302531-42d5-4141-b833-a85e99c01208, mode_filter: OperatingMode.PAPER
2025-06-25 22:38:38,553 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2138498914448'>
2025-06-25 22:38:38,553 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user fe302531-42d5-4141-b833-a85e99c01208
2025-06-25 22:38:38,557 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2138499260048'>
2025-06-25 22:38:38,558 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fe302531-42d5-4141-b833-a85e99c01208, mode_filter: OperatingMode.PAPER
2025-06-25 22:38:38,558 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2138499260048'>
2025-06-25 22:38:38,559 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user fe302531-42d5-4141-b833-a85e99c01208
2025-06-25 22:38:38,605 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario ab774284-dd3e-4e5b-89c9-6898953f0dc2 en modo paper
2025-06-25 22:38:38,610 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario fdf3c5aa-3288-4067-bebc-06b217f49e81 en modo paper
2025-06-25 22:38:38,614 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario 34ba5901-c9f2-4e87-bbf7-df9796264500 en modo paper
2025-06-25 22:38:38,619 - ultibot_backend.services.trading_report_service - ERROR - [MainThread] - trading_report_service.py:79 - Error al obtener trades cerrados para usuario 08bcd4d2-7975-4ffb-b3aa-bed7fc11f253: Database connection failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_report_service.py", line 65, in get_closed_trades
    trades = await persistence_service.get_closed_trades(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
Exception: Database connection failed
2025-06-25 22:38:38,629 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity c745abdb-1d85-453f-9f10-212563f3cfea for symbol BTC/USDT
2025-06-25 22:38:38,630 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 36ee96d9-2f6a-432d-867d-dec116c6d2bc can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:38:38,631 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity c745abdb-1d85-453f-9f10-212563f3cfea status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:38:38,631 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity c745abdb-1d85-453f-9f10-212563f3cfea
2025-06-25 22:38:38,641 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity e59e3e36-2860-45e2-8466-5bbbca566778 for symbol BTC/USDT
2025-06-25 22:38:38,643 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 98c83cbe-c488-4de9-8cfc-f6334a1fae4d can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:38:38,643 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity e59e3e36-2860-45e2-8466-5bbbca566778 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:38:38,644 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity e59e3e36-2860-45e2-8466-5bbbca566778
2025-06-25 22:38:38,654 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity b8dcd636-fa51-4777-ad08-e11a6151fb31 for symbol BTC/USDT
2025-06-25 22:38:38,656 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 3498b3e9-e838-44e7-a03c-313914ae2f1b can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:38:38,656 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity b8dcd636-fa51-4777-ad08-e11a6151fb31 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:38:38,658 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity b8dcd636-fa51-4777-ad08-e11a6151fb31
2025-06-25 22:38:38,667 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 1aa8472e-8a16-48ba-9bb5-240133f94168 for symbol BTC/USDT
2025-06-25 22:38:38,668 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy a48e4965-dceb-4a91-b01f-75720d242b10 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:38:38,669 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 1aa8472e-8a16-48ba-9bb5-240133f94168 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:38:38,670 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 1aa8472e-8a16-48ba-9bb5-240133f94168
2025-06-25 22:38:38,679 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 93ddb48f-ee9f-4623-9a07-9d97a257740c for symbol BTC/USDT
2025-06-25 22:38:38,680 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:653 - Unknown strategy type 'CUSTOM_UNKNOWN_TYPE' for strategy 6ac3ebe0-6288-49fb-9e09-bc3197684d88. Recommending investigation.
2025-06-25 22:38:38,680 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 93ddb48f-ee9f-4623-9a07-9d97a257740c status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:38:38,681 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 93ddb48f-ee9f-4623-9a07-9d97a257740c
2025-06-25 22:38:38,692 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 955915a4-2797-47e3-9cc4-b79b63a6cfb7 for symbol BTC/USDT
2025-06-25 22:38:38,693 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy ed262f4b-bb70-441f-b640-914372f9d661 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:38:38,694 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 955915a4-2797-47e3-9cc4-b79b63a6cfb7 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:38:38,695 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 955915a4-2797-47e3-9cc4-b79b63a6cfb7
2025-06-25 22:38:38,714 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 724a65d5-2c2f-4d89-b5d6-fdb4a6eff2bf for symbol BTC/USDT
2025-06-25 22:38:38,716 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 4117ecb9-7d2b-43be-b94a-8805d420acf7 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:38:38,716 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 724a65d5-2c2f-4d89-b5d6-fdb4a6eff2bf status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:38:38,717 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 724a65d5-2c2f-4d89-b5d6-fdb4a6eff2bf
2025-06-25 22:39:43,702 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:39:43,703 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:39:43,721 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:39:43,722 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:39:43,879 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:39:43,879 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:39:43,899 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:39:43,900 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:39:44,572 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:39:44,572 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:39:44,593 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:39:44,606 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:39:44,608 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:39:44,611 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:39:44,612 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:39:44,623 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:39:44,624 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:39:44,643 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:39:44,646 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:39:44,647 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:39:44,656 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:39:44,657 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:39:44,678 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:39:44,681 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:39:44,682 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:39:44,692 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:39:44,692 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:39:44,709 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:39:44,711 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:39:44,713 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:39:44,721 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:39:44,722 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:39:44,739 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:39:44,745 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:39:44,747 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:39:44,753 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:39:44,754 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:39:44,772 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:39:44,773 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:39:44,774 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:39:44,774 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:39:44,775 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:39:44,775 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:39:44,796 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:39:44,973 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:39:44,974 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:39:45,155 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:39:45,156 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:45,156 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:45,156 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:39:45,172 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:39:45,172 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000246EBCFCC90>
2025-06-25 22:39:45,172 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:39:45,172 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:39:45,174 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 422
2025-06-25 22:39:45,182 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:39:45,183 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:39:45,201 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:39:45,203 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:39:45,203 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:39:45,204 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:39:45,387 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:39:45,388 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:39:45,572 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:39:45,572 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:45,572 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:45,573 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:39:45,575 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:39:45,576 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000246EC0F8C10>
2025-06-25 22:39:45,576 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:39:45,576 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:39:45,672 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:39:45,681 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:39:45,682 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:39:45,692 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:39:45,692 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:39:45,711 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:39:45,712 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:39:45,712 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:39:45,714 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:39:45,892 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:39:45,892 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:39:46,064 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:39:46,064 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:46,065 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:46,065 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:39:46,068 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:39:46,068 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000246EBF2F6D0>
2025-06-25 22:39:46,068 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:39:46,068 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:39:46,072 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:39:46,079 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:39:46,079 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:39:46,080 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:39:46,086 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:39:46,087 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:39:46,087 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:39:46,089 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:39:46,098 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:39:46,098 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:39:46,118 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:39:46,119 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:39:46,119 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:39:46,120 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:39:46,298 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:39:46,299 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:39:46,475 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:39:46,476 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:46,476 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:46,476 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:39:46,479 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:39:46,480 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000246EBF78C10>
2025-06-25 22:39:46,480 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:39:46,480 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:39:46,484 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:39:46,491 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:39:46,491 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:39:46,492 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:39:46,498 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:39:46,498 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:39:46,506 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:39:46,506 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:39:46,525 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:39:46,526 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:39:46,526 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:39:46,526 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:39:46,702 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:39:46,703 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:39:46,880 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:39:46,880 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:46,880 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:46,881 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:39:46,883 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:39:46,884 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000246E947B790>
2025-06-25 22:39:46,884 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:39:46,884 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:39:46,890 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:39:46,897 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:39:46,897 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:39:46,899 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:39:46,906 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:39:46,906 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:39:46,916 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:39:46,917 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:39:46,935 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:39:46,938 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:39:46,939 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:39:46,939 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:39:47,116 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:39:47,117 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:39:47,293 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:39:47,293 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:47,294 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:47,294 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:39:47,297 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:39:47,297 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000246EBC9F850>
2025-06-25 22:39:47,297 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:39:47,297 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:39:47,298 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 422
2025-06-25 22:39:47,317 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 5e3590ba-ba6c-4d2b-854b-2d2f3607b086
2025-06-25 22:39:47,319 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:152 - User configuration saved after initializing last_daily_reset for user b29e63cc-cc27-40a9-b9e5-80a4852ba16e.
2025-06-25 22:39:47,319 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 200.000
2025-06-25 22:39:47,319 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity 5e3590ba-ba6c-4d2b-854b-2d2f3607b086
2025-06-25 22:39:47,319 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade f9227137-ad2b-43b9-b00a-5c7b9d9d1684 from decision 89a9feb6-8ff0-4966-be20-dc87524fcd25
2025-06-25 22:39:47,320 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade f9227137-ad2b-43b9-b00a-5c7b9d9d1684 from confirmed opportunity.
2025-06-25 22:39:47,322 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:39:47,322 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:310 - Successfully created OCO order for trade f9227137-ad2b-43b9-b00a-5c7b9d9d1684. OCO List ID: oco_list_123
2025-06-25 22:39:47,323 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario b29e63cc-cc27-40a9-b9e5-80a4852ba16e: 200.0000000000000000000000000 (anterior: 0.0, valor trade: 200.0000000000000000000000000)
2025-06-25 22:39:47,323 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user b29e63cc-cc27-40a9-b9e5-80a4852ba16e to 200.0000000000000000000000000.
2025-06-25 22:39:47,324 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 5e3590ba-ba6c-4d2b-854b-2d2f3607b086 status to converted_to_trade_real: Trade f9227137-ad2b-43b9-b00a-5c7b9d9d1684 executed based on user confirmation.
2025-06-25 22:39:47,325 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 5e3590ba-ba6c-4d2b-854b-2d2f3607b086
2025-06-25 22:39:47,335 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity b9af2499-f62c-48d5-a167-5d586122de8b
2025-06-25 22:39:47,335 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 4800.0, Riesgo Potencial Trade USD: 300.000
2025-06-25 22:39:47,335 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:191 - Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:39:47,336 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity b9af2499-f62c-48d5-a167-5d586122de8b status to error_in_processing: Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:39:47,336 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity b9af2499-f62c-48d5-a167-5d586122de8b
2025-06-25 22:39:47,350 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 3de4ca1e-2056-43da-b109-249b40736649
2025-06-25 22:39:47,350 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:143 - Daily capital reset triggered for user 5714188d-b789-4e02-99ea-e47e24929f23. Resetting daily_capital_risked_usd.
2025-06-25 22:39:47,351 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:147 - User configuration saved after daily capital reset for user 5714188d-b789-4e02-99ea-e47e24929f23.
2025-06-25 22:39:47,351 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 2500.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 100.000
2025-06-25 22:39:47,351 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity 3de4ca1e-2056-43da-b109-249b40736649
2025-06-25 22:39:47,352 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 9c8a8e37-abdc-4399-b686-586e542c67b0 from decision 7866fe1f-4114-4881-afd5-b7406c983541
2025-06-25 22:39:47,352 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 9c8a8e37-abdc-4399-b686-586e542c67b0 from confirmed opportunity.
2025-06-25 22:39:47,353 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:39:47,354 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:310 - Successfully created OCO order for trade 9c8a8e37-abdc-4399-b686-586e542c67b0. OCO List ID: oco_reset_test
2025-06-25 22:39:47,355 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 5714188d-b789-4e02-99ea-e47e24929f23: 100.000 (anterior: 0.0, valor trade: 100.000)
2025-06-25 22:39:47,356 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user 5714188d-b789-4e02-99ea-e47e24929f23 to 100.000.
2025-06-25 22:39:47,356 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 3de4ca1e-2056-43da-b109-249b40736649 status to converted_to_trade_real: Trade 9c8a8e37-abdc-4399-b686-586e542c67b0 executed based on user confirmation.
2025-06-25 22:39:47,358 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 3de4ca1e-2056-43da-b109-249b40736649
2025-06-25 22:39:47,371 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:39:47,371 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:39:47,389 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:39:47,391 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 22:39:47,392 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:39:47,392 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:39:47,573 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:39:47,574 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:39:47,750 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:39:47,750 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:47,750 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:47,750 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:39:47,755 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:39:47,755 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000246EBEFE710>
2025-06-25 22:39:47,756 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:39:47,756 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:39:47,756 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 22:39:47,760 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"1bad9d7c-3969-49d5-96bd-f88c18cd891f","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:39:47.362869Z","submittedAt":"2025-06-26T02:39:47.362869Z","fillTimestamp":"2025-06-26T02:39:47.362869Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:39:47.362869Z","opened_at":"2025-06-26T02:39:47.362869Z","updated_at":"2025-06-26T02:39:47.362869Z","closed_at":"2025-06-26T02:39:47.362869Z"}
2025-06-25 22:39:47,760 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '1bad9d7c-3969-49d5-96bd-f88c18cd891f', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:39:47.362869Z', 'submittedAt': '2025-06-26T02:39:47.362869Z', 'fillTimestamp': '2025-06-26T02:39:47.362869Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:39:47.362869Z', 'opened_at': '2025-06-26T02:39:47.362869Z', 'updated_at': '2025-06-26T02:39:47.362869Z', 'closed_at': '2025-06-26T02:39:47.362869Z'}
2025-06-25 22:39:47,761 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"de541635-531c-419c-8773-4b062e65aa5f","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:39:47.362869Z","submittedAt":"2025-06-26T02:39:47.362869Z","fillTimestamp":"2025-06-26T02:39:47.362869Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:39:47.362869Z","opened_at":"2025-06-26T02:39:47.362869Z","updated_at":"2025-06-26T02:39:47.362869Z","closed_at":"2025-06-26T02:39:47.362869Z"}
2025-06-25 22:39:47,761 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': 'de541635-531c-419c-8773-4b062e65aa5f', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:39:47.362869Z', 'submittedAt': '2025-06-26T02:39:47.362869Z', 'fillTimestamp': '2025-06-26T02:39:47.362869Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:39:47.362869Z', 'opened_at': '2025-06-26T02:39:47.362869Z', 'updated_at': '2025-06-26T02:39:47.362869Z', 'closed_at': '2025-06-26T02:39:47.362869Z'}
2025-06-25 22:39:47,761 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"5ee5a204-ccff-4eab-a0a4-4c7a5ddc8170","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:39:47.362869Z","submittedAt":"2025-06-26T02:39:47.362869Z","fillTimestamp":"2025-06-26T02:39:47.362869Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:39:47.362869Z","opened_at":"2025-06-26T02:39:47.362869Z","updated_at":"2025-06-26T02:39:47.362869Z","closed_at":"2025-06-26T02:39:47.362869Z"}
2025-06-25 22:39:47,762 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '5ee5a204-ccff-4eab-a0a4-4c7a5ddc8170', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:39:47.362869Z', 'submittedAt': '2025-06-26T02:39:47.362869Z', 'fillTimestamp': '2025-06-26T02:39:47.362869Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:39:47.362869Z', 'opened_at': '2025-06-26T02:39:47.362869Z', 'updated_at': '2025-06-26T02:39:47.362869Z', 'closed_at': '2025-06-26T02:39:47.362869Z'}
2025-06-25 22:39:47,762 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 3
2025-06-25 22:39:47,762 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:39:47,763 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 22:39:47,781 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:39:47,781 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:39:47,799 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:39:47,800 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 22:39:47,801 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:39:47,801 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:39:47,977 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:39:47,977 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:39:48,151 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:39:48,151 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:48,151 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:48,152 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:39:48,154 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:39:48,155 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000246ED23C490>
2025-06-25 22:39:48,155 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:39:48,156 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:39:48,156 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: BTCUSDT, start_date: None, end_date: None
2025-06-25 22:39:48,160 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"809b2437-c565-4e3f-a950-dce868f62452","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:39:47.773344Z","submittedAt":"2025-06-26T02:39:47.773344Z","fillTimestamp":"2025-06-26T02:39:47.773344Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:39:47.773344Z","opened_at":"2025-06-26T02:39:47.773344Z","updated_at":"2025-06-26T02:39:47.773344Z","closed_at":"2025-06-26T02:39:47.773344Z"}
2025-06-25 22:39:48,160 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '809b2437-c565-4e3f-a950-dce868f62452', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:39:47.773344Z', 'submittedAt': '2025-06-26T02:39:47.773344Z', 'fillTimestamp': '2025-06-26T02:39:47.773344Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:39:47.773344Z', 'opened_at': '2025-06-26T02:39:47.773344Z', 'updated_at': '2025-06-26T02:39:47.773344Z', 'closed_at': '2025-06-26T02:39:47.773344Z'}
2025-06-25 22:39:48,160 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 1
2025-06-25 22:39:48,161 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 1 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:39:48,161 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 22:39:48,178 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:39:48,179 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:39:48,198 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:39:48,199 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 22:39:48,200 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:39:48,200 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:39:48,373 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:39:48,374 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:39:48,551 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:39:48,551 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:48,552 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:48,552 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:39:48,555 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:39:48,555 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000246ED209AD0>
2025-06-25 22:39:48,556 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:39:48,556 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:39:48,557 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 22:39:48,559 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"ba61baff-e471-4535-80ab-08508fba142f","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:39:48.170303Z","submittedAt":"2025-06-26T02:39:48.170303Z","fillTimestamp":"2025-06-26T02:39:48.170303Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:39:48.170303Z","opened_at":"2025-06-26T02:39:48.170303Z","updated_at":"2025-06-26T02:39:48.170303Z","closed_at":"2025-06-26T02:39:48.170303Z"}
2025-06-25 22:39:48,560 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': 'ba61baff-e471-4535-80ab-08508fba142f', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:39:48.170303Z', 'submittedAt': '2025-06-26T02:39:48.170303Z', 'fillTimestamp': '2025-06-26T02:39:48.170303Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:39:48.170303Z', 'opened_at': '2025-06-26T02:39:48.170303Z', 'updated_at': '2025-06-26T02:39:48.170303Z', 'closed_at': '2025-06-26T02:39:48.170303Z'}
2025-06-25 22:39:48,560 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"17e35753-ceb5-4095-8378-c3500bd3df26","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:39:48.170303Z","submittedAt":"2025-06-26T02:39:48.170303Z","fillTimestamp":"2025-06-26T02:39:48.170303Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:39:48.170303Z","opened_at":"2025-06-26T02:39:48.170303Z","updated_at":"2025-06-26T02:39:48.170303Z","closed_at":"2025-06-26T02:39:48.170303Z"}
2025-06-25 22:39:48,560 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': '17e35753-ceb5-4095-8378-c3500bd3df26', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:39:48.170303Z', 'submittedAt': '2025-06-26T02:39:48.170303Z', 'fillTimestamp': '2025-06-26T02:39:48.170303Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:39:48.170303Z', 'opened_at': '2025-06-26T02:39:48.170303Z', 'updated_at': '2025-06-26T02:39:48.170303Z', 'closed_at': '2025-06-26T02:39:48.170303Z'}
2025-06-25 22:39:48,561 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"778e394f-5c0e-41e7-a15b-f2ef3c7cf9e8","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:39:48.170303Z","submittedAt":"2025-06-26T02:39:48.170303Z","fillTimestamp":"2025-06-26T02:39:48.170303Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:39:48.170303Z","opened_at":"2025-06-26T02:39:48.170303Z","updated_at":"2025-06-26T02:39:48.170303Z","closed_at":"2025-06-26T02:39:48.170303Z"}
2025-06-25 22:39:48,561 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '778e394f-5c0e-41e7-a15b-f2ef3c7cf9e8', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:39:48.170303Z', 'submittedAt': '2025-06-26T02:39:48.170303Z', 'fillTimestamp': '2025-06-26T02:39:48.170303Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:39:48.170303Z', 'opened_at': '2025-06-26T02:39:48.170303Z', 'updated_at': '2025-06-26T02:39:48.170303Z', 'closed_at': '2025-06-26T02:39:48.170303Z'}
2025-06-25 22:39:48,561 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 3
2025-06-25 22:39:48,561 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:39:48,562 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 22:39:48,580 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:39:48,580 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:39:48,598 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:39:48,599 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 22:39:48,599 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:39:48,600 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:39:48,776 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:39:48,776 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:39:48,957 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:39:48,957 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:48,958 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:48,958 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:39:48,960 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:39:48,961 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000246ED2AC650>
2025-06-25 22:39:48,961 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:39:48,961 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:39:48,961 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: 2025-06-27 02:39:48.599525+00:00, end_date: None
2025-06-25 22:39:48,965 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 0
2025-06-25 22:39:48,965 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:39:48,965 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 22:39:49,007 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 47e61c9b-8839-4263-9a05-42207387fbdb for symbol BTCUSDT
2025-06-25 22:39:49,007 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: ee52b250-d89d-419b-8864-47b75bff6483
2025-06-25 22:39:49,009 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 61b15e8c-be5d-4ca8-9488-66610e1e56b2 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:39:49,018 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 18fe65f8-287e-4c03-9870-d9ac21547a1f for symbol BTCUSDT
2025-06-25 22:39:49,018 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy f70d9064-edf2-4465-b8db-dfa6f6d562de can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:39:49,025 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity bcf73643-62d0-4ee9-beb6-9079db3c83d5 for symbol ETHUSDT
2025-06-25 22:39:49,025 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 54fd1a65-a813-44df-afcd-7d5a446521e9
2025-06-25 22:39:49,027 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:604 - No active and applicable strategies found for opportunity bcf73643-62d0-4ee9-beb6-9079db3c83d5 with symbol ETHUSDT.
2025-06-25 22:39:49,027 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity bcf73643-62d0-4ee9-beb6-9079db3c83d5 status to rejected_by_system: No active strategies are applicable to this opportunity's symbol.
2025-06-25 22:39:49,029 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity bcf73643-62d0-4ee9-beb6-9079db3c83d5
2025-06-25 22:39:49,036 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 563945fa-8da5-47df-aadc-abd056958bbb for symbol BTCUSDT
2025-06-25 22:39:49,036 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 9f7372c5-9423-4059-8897-9d1bdbf41c6f
2025-06-25 22:39:49,038 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:717 - AI confidence 0.65 for strategy 9a7613a3-0dba-4662-826b-f310f79d1a29 is below threshold 0.8.
2025-06-25 22:39:49,039 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy 9a7613a3-0dba-4662-826b-f310f79d1a29 did not produce a decision for opportunity 563945fa-8da5-47df-aadc-abd056958bbb.
2025-06-25 22:39:49,040 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:623 - No affirmative trading decisions made for opportunity 563945fa-8da5-47df-aadc-abd056958bbb.
2025-06-25 22:39:49,049 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity b8537836-0a9a-4484-9556-1b78e09e1616 for symbol BTCUSDT
2025-06-25 22:39:49,049 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 054f7079-78bd-47a2-bc2c-2836c167dbe7
2025-06-25 22:39:49,057 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity e0483f4a-b393-4cd2-9213-53299d0ae34a for symbol BTCUSDT
2025-06-25 22:39:49,057 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 0910d99b-25b7-4bd5-bfe5-186a5a5eb23e
2025-06-25 22:39:49,064 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade a287500a-b4ff-41b8-924e-3d3adb3da776 from decision 7a974032-1fae-471c-b144-ea22271a0550
2025-06-25 22:39:49,070 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 5dbb11ad-9478-4777-b0c8-401a3c38bfc2 from decision e74ef458-dc33-4f31-95b9-3dcc0425ac2c
2025-06-25 22:39:49,070 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 82ee15a8-86ff-4f74-aad3-7c2cf76a282d from decision e74ef458-dc33-4f31-95b9-3dcc0425ac2c
2025-06-25 22:39:49,077 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:49,077 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:49,085 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:39:49,085 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:39:49,088 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:39:49,091 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 45312b87-7aad-4040-8868-1208530286fd
2025-06-25 22:39:49,094 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 31055ba5-b681-4cdd-a951-ea6db5090747. Creando y guardando configuración por defecto.
2025-06-25 22:39:49,096 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:39:49,098 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 31055ba5-b681-4cdd-a951-ea6db5090747. Using default values.
2025-06-25 22:39:49,098 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 31055ba5-b681-4cdd-a951-ea6db5090747 with capital: 10000.0
2025-06-25 22:39:49,099 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:39:49,100 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:39:49,100 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:39:49,100 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity 45312b87-7aad-4040-8868-1208530286fd
2025-06-25 22:39:49,100 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 88493b21-b22b-47ef-a424-107b35976a6a from decision a4b0b53d-e418-41a4-9421-8f7269ddf9fc
2025-06-25 22:39:49,101 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 88493b21-b22b-47ef-a424-107b35976a6a from confirmed opportunity.
2025-06-25 22:39:49,102 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:39:49,103 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('eb146914-7552-4038-94fe-96aa0c13bc54') orderId_exchange='mock_exchange_oco_id_d30e861c-2db2-42d8-9ef0-3112acd89a79' clientOrderId_exchange='mock_client_oco_id_39cf9f4d-e0fc-480d-9832-bc501496b1cb' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 39, 49, 103995) submittedAt=datetime.datetime(2025, 6, 26, 2, 39, 49, 103995, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 39, 49, 103995, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 133695972064670088048814488628979220445, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_18c673c0-287f-41ce-8a6e-56612f86d9f8', 'transactionTime': 1750905589103, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='133695972064670088048814488628979220445' price=None stopPrice=None timeInForce=None
2025-06-25 22:39:49,103 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 31055ba5-b681-4cdd-a951-ea6db5090747: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:39:49,107 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('88493b21-b22b-47ef-a424-107b35976a6a'), '60555db3-7f80-41a2-8f92-b94571ed25ec', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:39:49.100992', '2025-06-26 02:39:49.100992', None, '{"id":"88493b21-b22b-47ef-a424-107b35976a6a","user_id":"60555db3-7f80-41a2-8f92-b94571ed25ec","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:39:49.100992","opened_at":"2025-06-26T02:39:49.100992","updated_at":"2025-06-26T02:39:49.100992","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('88493b21-b22b-47ef-a424-107b35976a6a'), '60555db3-7f80-41a2-8f92-b94571ed25ec', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:39:49.100992', '2025-06-26 02:39:49.100992', None, '{"id":"88493b21-b22b-47ef-a424-107b35976a6a","user_id":"60555db3-7f80-41a2-8f92-b94571ed25ec","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:39:49.100992","opened_at":"2025-06-26T02:39:49.100992","updated_at":"2025-06-26T02:39:49.100992","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:39:49,114 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 45312b87-7aad-4040-8868-1208530286fd: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('88493b21-b22b-47ef-a424-107b35976a6a'), '60555db3-7f80-41a2-8f92-b94571ed25ec', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:39:49.100992', '2025-06-26 02:39:49.100992', None, '{"id":"88493b21-b22b-47ef-a424-107b35976a6a","user_id":"60555db3-7f80-41a2-8f92-b94571ed25ec","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:39:49.100992","opened_at":"2025-06-26T02:39:49.100992","updated_at":"2025-06-26T02:39:49.100992","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:39:49,116 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 45312b87-7aad-4040-8868-1208530286fd status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:39:49,117 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:544 - Failed to persist status update for opportunity 45312b87-7aad-4040-8868-1208530286fd: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('88493b21-b22b-47ef-a424-107b35976a6a'), '60555db3-7f80-41a2-8f92-b94571ed25ec', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:39:49.100992', '2025-06-26 02:39:49.100992', None, '{"id":"88493b21-b22b-47ef-a424-107b35976a6a","user_id":"60555db3-7f80-41a2-8f92-b94571ed25ec","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:39:49.100992","opened_at":"2025-06-26T02:39:49.100992","updated_at":"2025-06-26T02:39:49.100992","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 537, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('88493b21-b22b-47ef-a424-107b35976a6a'), '60555db3-7f80-41a2-8f92-b94571ed25ec', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:39:49.100992', '2025-06-26 02:39:49.100992', None, '{"id":"88493b21-b22b-47ef-a424-107b35976a6a","user_id":"60555db3-7f80-41a2-8f92-b94571ed25ec","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:39:49.100992","opened_at":"2025-06-26T02:39:49.100992","updated_at":"2025-06-26T02:39:49.100992","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:39:49,396 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:39:49,396 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:39:49,406 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:49,406 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:49,413 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:39:49,413 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:39:49,415 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:39:49,417 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:39:49,419 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:39:49,427 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:49,427 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:49,434 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:39:49,435 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:39:49,438 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:39:49,440 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 35264a75-f77f-4e66-b452-d0cf3ceec630 for symbol BTC/USDT
2025-06-25 22:39:49,443 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 4319dcb8-9d58-4d95-9e8e-1d3c0b39c9b4. Creando y guardando configuración por defecto.
2025-06-25 22:39:49,446 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:39:49,446 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:672 - AI profile 'ai-profile-scalping-1' for strategy 09059dc0-ba54-45b8-8874-06bff528d089 not found. Skipping AI analysis.
2025-06-25 22:39:49,447 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 09059dc0-ba54-45b8-8874-06bff528d089 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:39:49,447 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 35264a75-f77f-4e66-b452-d0cf3ceec630 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:39:49,455 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 35264a75-f77f-4e66-b452-d0cf3ceec630
2025-06-25 22:39:49,456 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:39:49,457 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:39:49,466 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:49,466 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:49,475 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:39:49,475 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:39:49,478 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:39:49,480 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 8118890d-5bb5-490e-a86c-02d836dc64ca
2025-06-25 22:39:49,483 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id d29d0620-1160-437c-add7-1fa4f8df18a4. Creando y guardando configuración por defecto.
2025-06-25 22:39:49,486 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:39:49,489 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for d29d0620-1160-437c-add7-1fa4f8df18a4. Using default values.
2025-06-25 22:39:49,489 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for d29d0620-1160-437c-add7-1fa4f8df18a4 with capital: 10000.0
2025-06-25 22:39:49,490 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:39:49,491 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:39:49,491 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:39:49,492 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Autonomous Scalping' as context for confirmed opportunity 8118890d-5bb5-490e-a86c-02d836dc64ca
2025-06-25 22:39:49,492 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 4d854a53-9862-4c99-a6b4-4ecd20d42054 from decision 000afe2a-44e5-45ee-87ee-88cc1dadaf47
2025-06-25 22:39:49,493 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 4d854a53-9862-4c99-a6b4-4ecd20d42054 from confirmed opportunity.
2025-06-25 22:39:49,493 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:39:49,494 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('555123c9-9d5b-40b9-ad11-62b38dfd8e23') orderId_exchange='mock_exchange_oco_id_3225c5a4-0490-4a2b-8d28-a1e54a60e6c5' clientOrderId_exchange='mock_client_oco_id_c8637b03-bf54-44a5-bc5e-452969a2dc35' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 39, 49, 494971) submittedAt=datetime.datetime(2025, 6, 26, 2, 39, 49, 494971, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 39, 49, 494971, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 177740181379789188904212426709881445712, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_66ba6100-aec1-472e-ae14-d797e04d2e5f', 'transactionTime': 1750905589494, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='177740181379789188904212426709881445712' price=None stopPrice=None timeInForce=None
2025-06-25 22:39:49,495 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario d29d0620-1160-437c-add7-1fa4f8df18a4: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:39:49,497 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('4d854a53-9862-4c99-a6b4-4ecd20d42054'), 'fd0981e9-c6ed-4d1d-821e-007ad8201895', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:39:49.492967', '2025-06-26 02:39:49.492967', None, '{"id":"4d854a53-9862-4c99-a6b4-4ecd20d42054","user_id":"fd0981e9-c6ed-4d1d-821e-007ad8201895","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:39:49.492967","opened_at":"2025-06-26T02:39:49.492967","updated_at":"2025-06-26T02:39:49.492967","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('4d854a53-9862-4c99-a6b4-4ecd20d42054'), 'fd0981e9-c6ed-4d1d-821e-007ad8201895', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:39:49.492967', '2025-06-26 02:39:49.492967', None, '{"id":"4d854a53-9862-4c99-a6b4-4ecd20d42054","user_id":"fd0981e9-c6ed-4d1d-821e-007ad8201895","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:39:49.492967","opened_at":"2025-06-26T02:39:49.492967","updated_at":"2025-06-26T02:39:49.492967","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:39:49,500 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 8118890d-5bb5-490e-a86c-02d836dc64ca: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('4d854a53-9862-4c99-a6b4-4ecd20d42054'), 'fd0981e9-c6ed-4d1d-821e-007ad8201895', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:39:49.492967', '2025-06-26 02:39:49.492967', None, '{"id":"4d854a53-9862-4c99-a6b4-4ecd20d42054","user_id":"fd0981e9-c6ed-4d1d-821e-007ad8201895","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:39:49.492967","opened_at":"2025-06-26T02:39:49.492967","updated_at":"2025-06-26T02:39:49.492967","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:39:49,502 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 8118890d-5bb5-490e-a86c-02d836dc64ca status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:39:49,503 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:544 - Failed to persist status update for opportunity 8118890d-5bb5-490e-a86c-02d836dc64ca: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('4d854a53-9862-4c99-a6b4-4ecd20d42054'), 'fd0981e9-c6ed-4d1d-821e-007ad8201895', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:39:49.492967', '2025-06-26 02:39:49.492967', None, '{"id":"4d854a53-9862-4c99-a6b4-4ecd20d42054","user_id":"fd0981e9-c6ed-4d1d-821e-007ad8201895","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:39:49.492967","opened_at":"2025-06-26T02:39:49.492967","updated_at":"2025-06-26T02:39:49.492967","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 537, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('4d854a53-9862-4c99-a6b4-4ecd20d42054'), 'fd0981e9-c6ed-4d1d-821e-007ad8201895', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:39:49.492967', '2025-06-26 02:39:49.492967', None, '{"id":"4d854a53-9862-4c99-a6b4-4ecd20d42054","user_id":"fd0981e9-c6ed-4d1d-821e-007ad8201895","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:39:49.492967","opened_at":"2025-06-26T02:39:49.492967","updated_at":"2025-06-26T02:39:49.492967","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:39:49,512 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:39:49,513 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:39:49,521 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:49,521 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:49,530 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:39:49,530 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:39:49,532 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:39:49,534 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 74eb7c89-5d99-4c13-8227-d37407ffc50b
2025-06-25 22:39:49,537 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 9650985a-2164-4057-9c56-2ab488802308. Creando y guardando configuración por defecto.
2025-06-25 22:39:49,540 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:39:49,542 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 9650985a-2164-4057-9c56-2ab488802308. Using default values.
2025-06-25 22:39:49,542 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 9650985a-2164-4057-9c56-2ab488802308 with capital: 10000.0
2025-06-25 22:39:49,543 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:39:49,544 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:39:49,544 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:39:49,545 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity 74eb7c89-5d99-4c13-8227-d37407ffc50b
2025-06-25 22:39:49,545 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 83af82d5-5aa5-4a04-a11f-9e6b63da5e8b from decision 4a7fcc91-1223-4810-8f92-81f354747381
2025-06-25 22:39:49,546 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 83af82d5-5aa5-4a04-a11f-9e6b63da5e8b from confirmed opportunity.
2025-06-25 22:39:49,546 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:39:49,547 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('4f8221fb-a266-4b2d-acbe-49f1b3c94a62') orderId_exchange='mock_exchange_oco_id_64ab83cd-4d8b-48cf-8b44-b971cc243f8c' clientOrderId_exchange='mock_client_oco_id_812a7432-0f7d-4ea2-abc1-cac03a3f63c5' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 39, 49, 547874) submittedAt=datetime.datetime(2025, 6, 26, 2, 39, 49, 547874, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 39, 49, 547874, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 139357229577977432182281753206200570007, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_26e2a751-fa4e-4d6c-8086-934a8993540e', 'transactionTime': 1750905589547, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='139357229577977432182281753206200570007' price=None stopPrice=None timeInForce=None
2025-06-25 22:39:49,547 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 9650985a-2164-4057-9c56-2ab488802308: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:39:49,550 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('83af82d5-5aa5-4a04-a11f-9e6b63da5e8b'), 'b6f5a392-506f-4dd8-a820-a30581878739', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:39:49.545871', '2025-06-26 02:39:49.545871', None, '{"id":"83af82d5-5aa5-4a04-a11f-9e6b63da5e8b","user_id":"b6f5a392-506f-4dd8-a820-a30581878739","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:39:49.545871","opened_at":"2025-06-26T02:39:49.545871","updated_at":"2025-06-26T02:39:49.545871","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('83af82d5-5aa5-4a04-a11f-9e6b63da5e8b'), 'b6f5a392-506f-4dd8-a820-a30581878739', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:39:49.545871', '2025-06-26 02:39:49.545871', None, '{"id":"83af82d5-5aa5-4a04-a11f-9e6b63da5e8b","user_id":"b6f5a392-506f-4dd8-a820-a30581878739","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:39:49.545871","opened_at":"2025-06-26T02:39:49.545871","updated_at":"2025-06-26T02:39:49.545871","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:39:49,552 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 74eb7c89-5d99-4c13-8227-d37407ffc50b: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('83af82d5-5aa5-4a04-a11f-9e6b63da5e8b'), 'b6f5a392-506f-4dd8-a820-a30581878739', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:39:49.545871', '2025-06-26 02:39:49.545871', None, '{"id":"83af82d5-5aa5-4a04-a11f-9e6b63da5e8b","user_id":"b6f5a392-506f-4dd8-a820-a30581878739","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:39:49.545871","opened_at":"2025-06-26T02:39:49.545871","updated_at":"2025-06-26T02:39:49.545871","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:39:49,554 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 74eb7c89-5d99-4c13-8227-d37407ffc50b status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:39:49,555 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:544 - Failed to persist status update for opportunity 74eb7c89-5d99-4c13-8227-d37407ffc50b: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('83af82d5-5aa5-4a04-a11f-9e6b63da5e8b'), 'b6f5a392-506f-4dd8-a820-a30581878739', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:39:49.545871', '2025-06-26 02:39:49.545871', None, '{"id":"83af82d5-5aa5-4a04-a11f-9e6b63da5e8b","user_id":"b6f5a392-506f-4dd8-a820-a30581878739","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:39:49.545871","opened_at":"2025-06-26T02:39:49.545871","updated_at":"2025-06-26T02:39:49.545871","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 537, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('83af82d5-5aa5-4a04-a11f-9e6b63da5e8b'), 'b6f5a392-506f-4dd8-a820-a30581878739', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:39:49.545871', '2025-06-26 02:39:49.545871', None, '{"id":"83af82d5-5aa5-4a04-a11f-9e6b63da5e8b","user_id":"b6f5a392-506f-4dd8-a820-a30581878739","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:39:49.545871","opened_at":"2025-06-26T02:39:49.545871","updated_at":"2025-06-26T02:39:49.545871","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:39:49,564 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:39:49,565 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:39:49,574 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:49,575 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:49,581 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:39:49,581 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:39:49,584 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:39:49,586 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 62062848-48b4-404e-8839-b930e4ef6569
2025-06-25 22:39:49,590 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 582b9c7b-5490-4d44-a8fe-c880e43325ea. Creando y guardando configuración por defecto.
2025-06-25 22:39:49,593 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:39:49,596 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 582b9c7b-5490-4d44-a8fe-c880e43325ea. Using default values.
2025-06-25 22:39:49,596 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 582b9c7b-5490-4d44-a8fe-c880e43325ea with capital: 10000.0
2025-06-25 22:39:49,597 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:39:49,598 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:39:49,598 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:39:49,598 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Day Trading Strategy' as context for confirmed opportunity 62062848-48b4-404e-8839-b930e4ef6569
2025-06-25 22:39:49,598 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 2658293c-5b41-4e0e-b738-9ead4b418976 from decision 0ee68432-01ae-48c0-b341-51560652a9a7
2025-06-25 22:39:49,599 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 2658293c-5b41-4e0e-b738-9ead4b418976 from confirmed opportunity.
2025-06-25 22:39:49,600 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:39:49,601 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('36450623-b293-41e6-a89a-3ef7ff718fb7') orderId_exchange='mock_exchange_oco_id_4b769b47-485e-4760-8f12-abbe91f9e130' clientOrderId_exchange='mock_client_oco_id_e9cf1cb9-943a-4583-b72f-9a8c2ef93f67' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 39, 49, 601216) submittedAt=datetime.datetime(2025, 6, 26, 2, 39, 49, 601216, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 39, 49, 601216, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 120823359503974465529677825233820286498, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_93c8e086-5232-479e-851d-9af09ef2ff18', 'transactionTime': 1750905589601, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='120823359503974465529677825233820286498' price=None stopPrice=None timeInForce=None
2025-06-25 22:39:49,601 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 582b9c7b-5490-4d44-a8fe-c880e43325ea: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:39:49,604 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('2658293c-5b41-4e0e-b738-9ead4b418976'), '8bddf619-fa87-497f-b73f-8ed3b9d20ea6', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:39:49.598087', '2025-06-26 02:39:49.598087', None, '{"id":"2658293c-5b41-4e0e-b738-9ead4b418976","user_id":"8bddf619-fa87-497f-b73f-8ed3b9d20ea6","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:39:49.598087","opened_at":"2025-06-26T02:39:49.598087","updated_at":"2025-06-26T02:39:49.598087","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('2658293c-5b41-4e0e-b738-9ead4b418976'), '8bddf619-fa87-497f-b73f-8ed3b9d20ea6', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:39:49.598087', '2025-06-26 02:39:49.598087', None, '{"id":"2658293c-5b41-4e0e-b738-9ead4b418976","user_id":"8bddf619-fa87-497f-b73f-8ed3b9d20ea6","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:39:49.598087","opened_at":"2025-06-26T02:39:49.598087","updated_at":"2025-06-26T02:39:49.598087","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:39:49,606 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 62062848-48b4-404e-8839-b930e4ef6569: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('2658293c-5b41-4e0e-b738-9ead4b418976'), '8bddf619-fa87-497f-b73f-8ed3b9d20ea6', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:39:49.598087', '2025-06-26 02:39:49.598087', None, '{"id":"2658293c-5b41-4e0e-b738-9ead4b418976","user_id":"8bddf619-fa87-497f-b73f-8ed3b9d20ea6","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:39:49.598087","opened_at":"2025-06-26T02:39:49.598087","updated_at":"2025-06-26T02:39:49.598087","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:39:49,609 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 62062848-48b4-404e-8839-b930e4ef6569 status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:39:49,609 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:544 - Failed to persist status update for opportunity 62062848-48b4-404e-8839-b930e4ef6569: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('2658293c-5b41-4e0e-b738-9ead4b418976'), '8bddf619-fa87-497f-b73f-8ed3b9d20ea6', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:39:49.598087', '2025-06-26 02:39:49.598087', None, '{"id":"2658293c-5b41-4e0e-b738-9ead4b418976","user_id":"8bddf619-fa87-497f-b73f-8ed3b9d20ea6","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:39:49.598087","opened_at":"2025-06-26T02:39:49.598087","updated_at":"2025-06-26T02:39:49.598087","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 537, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('2658293c-5b41-4e0e-b738-9ead4b418976'), '8bddf619-fa87-497f-b73f-8ed3b9d20ea6', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:39:49.598087', '2025-06-26 02:39:49.598087', None, '{"id":"2658293c-5b41-4e0e-b738-9ead4b418976","user_id":"8bddf619-fa87-497f-b73f-8ed3b9d20ea6","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:39:49.598087","opened_at":"2025-06-26T02:39:49.598087","updated_at":"2025-06-26T02:39:49.598087","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:39:49,618 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:39:49,619 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:39:49,628 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:49,629 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:49,636 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:39:49,636 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:39:49,639 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:39:49,641 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 1b9fadae-781b-483d-b49a-3901a909678f from decision d428dbea-2c30-42f8-a14c-40febf605d31
2025-06-25 22:39:49,641 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:39:49,642 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:39:49,649 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:49,649 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:49,657 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:39:49,657 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:39:49,660 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:39:49,661 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 3a5fe25a-68f6-48bb-b9c1-4121014bdaa7 from decision 4763b3a1-264d-452f-9a0f-8704bc3480d3
2025-06-25 22:39:49,662 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:39:49,663 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:39:49,670 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:49,671 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:49,679 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:39:49,679 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:39:49,681 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:39:49,683 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:39:49,684 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:39:51,557 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:51,557 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:51,562 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:39:51,564 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:39:51,565 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:39:51,575 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:39:51,579 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:39:51,580 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:39:51,584 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:39:51,590 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:39:51,593 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:39:51,597 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:51,597 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:51,602 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:51,602 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:51,604 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:39:51,609 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:51,609 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:51,616 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:51,616 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:51,623 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:51,624 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:51,627 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:39:51,629 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:51,630 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:51,633 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:286 - Verificación de Binance BINANCE_SPOT exitosa.
2025-06-25 22:39:51,638 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:51,638 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:51,642 - ultibot_backend.services.credential_service - ERROR - [MainThread] - credential_service.py:315 - Error de Binance API durante la verificación: Binance Down
2025-06-25 22:39:51,647 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:51,647 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:51,650 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:39:51,654 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:39:51,654 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:39:51,659 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:241 - Verificación de Telegram exitosa.
2025-06-25 22:39:51,665 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:72 - Conexión con Binance exitosa.
2025-06-25 22:39:51,670 - ultibot_backend.services.market_data_service - WARNING - [MainThread] - market_data_service.py:52 - Credenciales de Binance no encontradas. Por favor, configúrelas.
2025-06-25 22:39:51,676 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:69 - Fallo en la verificación de conexión con Binance. Revise sus credenciales y permisos.
2025-06-25 22:39:51,681 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:77 - Error al acceder a las credenciales de Binance: Decryption failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 45, in get_binance_connection_status
    binance_credential = await self.credential_service.get_credential(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.CredentialError: Decryption failed
2025-06-25 22:39:51,686 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:81 - Error de la API de Binance: API unavailable
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 61, in get_binance_connection_status
    is_connected = await self.credential_service.verify_credential(binance_credential)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.BinanceAPIError: API unavailable
2025-06-25 22:39:51,692 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:39:51,702 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:121 - Error de la API de Binance al obtener balances: Failed to fetch balances
2025-06-25 22:39:51,705 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2503656309776'>
2025-06-25 22:39:51,707 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user dc243ba7-61d8-4ab2-907a-08527772c1eb, mode_filter: None
2025-06-25 22:39:51,708 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2503656309776'>
2025-06-25 22:39:51,708 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user dc243ba7-61d8-4ab2-907a-08527772c1eb with mode_filter: None
2025-06-25 22:39:51,711 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2503656066640'>
2025-06-25 22:39:51,713 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user dc243ba7-61d8-4ab2-907a-08527772c1eb, mode_filter: None
2025-06-25 22:39:51,713 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2503656066640'>
2025-06-25 22:39:51,713 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user dc243ba7-61d8-4ab2-907a-08527772c1eb with mode_filter: None
2025-06-25 22:39:51,716 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2503655282192'>
2025-06-25 22:39:51,718 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user dc243ba7-61d8-4ab2-907a-08527772c1eb, mode_filter: OperatingMode.PAPER
2025-06-25 22:39:51,718 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2503655282192'>
2025-06-25 22:39:51,718 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user dc243ba7-61d8-4ab2-907a-08527772c1eb
2025-06-25 22:39:51,722 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2503656068432'>
2025-06-25 22:39:51,723 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user dc243ba7-61d8-4ab2-907a-08527772c1eb, mode_filter: OperatingMode.PAPER
2025-06-25 22:39:51,724 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2503656068432'>
2025-06-25 22:39:51,724 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user dc243ba7-61d8-4ab2-907a-08527772c1eb
2025-06-25 22:39:51,727 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2503657465104'>
2025-06-25 22:39:51,729 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user dc243ba7-61d8-4ab2-907a-08527772c1eb, mode_filter: OperatingMode.REAL
2025-06-25 22:39:51,729 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2503657465104'>
2025-06-25 22:39:51,729 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user dc243ba7-61d8-4ab2-907a-08527772c1eb
2025-06-25 22:39:51,732 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2503657465232'>
2025-06-25 22:39:51,733 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user dc243ba7-61d8-4ab2-907a-08527772c1eb, mode_filter: OperatingMode.PAPER
2025-06-25 22:39:51,734 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2503657465232'>
2025-06-25 22:39:51,734 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user dc243ba7-61d8-4ab2-907a-08527772c1eb
2025-06-25 22:39:51,737 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2503655935888'>
2025-06-25 22:39:51,739 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user dc243ba7-61d8-4ab2-907a-08527772c1eb, mode_filter: None
2025-06-25 22:39:51,740 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2503655935888'>
2025-06-25 22:39:51,740 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 2 performance entries for user dc243ba7-61d8-4ab2-907a-08527772c1eb
2025-06-25 22:39:51,744 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2503655564560'>
2025-06-25 22:39:51,745 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user dc243ba7-61d8-4ab2-907a-08527772c1eb, mode_filter: OperatingMode.PAPER
2025-06-25 22:39:51,746 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2503655564560'>
2025-06-25 22:39:51,746 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user dc243ba7-61d8-4ab2-907a-08527772c1eb
2025-06-25 22:39:51,749 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2503657626384'>
2025-06-25 22:39:51,750 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user dc243ba7-61d8-4ab2-907a-08527772c1eb, mode_filter: OperatingMode.PAPER
2025-06-25 22:39:51,750 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2503657626384'>
2025-06-25 22:39:51,751 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user dc243ba7-61d8-4ab2-907a-08527772c1eb with mode_filter: OperatingMode.PAPER
2025-06-25 22:39:51,755 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2503657621456'>
2025-06-25 22:39:51,758 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user dc243ba7-61d8-4ab2-907a-08527772c1eb, mode_filter: OperatingMode.PAPER
2025-06-25 22:39:51,758 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2503657621456'>
2025-06-25 22:39:51,759 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user dc243ba7-61d8-4ab2-907a-08527772c1eb with mode_filter: OperatingMode.PAPER
2025-06-25 22:39:51,761 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2503655188048'>
2025-06-25 22:39:51,763 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user dc243ba7-61d8-4ab2-907a-08527772c1eb, mode_filter: OperatingMode.PAPER
2025-06-25 22:39:51,763 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2503655188048'>
2025-06-25 22:39:51,763 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user dc243ba7-61d8-4ab2-907a-08527772c1eb
2025-06-25 22:39:51,766 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2503657468112'>
2025-06-25 22:39:51,768 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user dc243ba7-61d8-4ab2-907a-08527772c1eb, mode_filter: OperatingMode.PAPER
2025-06-25 22:39:51,768 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2503657468112'>
2025-06-25 22:39:51,768 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user dc243ba7-61d8-4ab2-907a-08527772c1eb
2025-06-25 22:39:51,773 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2503655278160'>
2025-06-25 22:39:51,775 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user dc243ba7-61d8-4ab2-907a-08527772c1eb, mode_filter: OperatingMode.PAPER
2025-06-25 22:39:51,776 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2503655278160'>
2025-06-25 22:39:51,776 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user dc243ba7-61d8-4ab2-907a-08527772c1eb
2025-06-25 22:39:51,779 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2503657550992'>
2025-06-25 22:39:51,780 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user dc243ba7-61d8-4ab2-907a-08527772c1eb, mode_filter: OperatingMode.PAPER
2025-06-25 22:39:51,781 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2503657550992'>
2025-06-25 22:39:51,781 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user dc243ba7-61d8-4ab2-907a-08527772c1eb
2025-06-25 22:39:51,828 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario a93b639d-e220-4336-95bf-2f68011cfeeb en modo paper
2025-06-25 22:39:51,833 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 4605a0d5-5bb1-4514-a160-a3166ee9ad20 en modo paper
2025-06-25 22:39:51,837 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario 59020ecd-01eb-4f20-8c46-5da8813141db en modo paper
2025-06-25 22:39:51,842 - ultibot_backend.services.trading_report_service - ERROR - [MainThread] - trading_report_service.py:79 - Error al obtener trades cerrados para usuario 01a3d38f-5d35-40b1-ae03-0e63fc835c0d: Database connection failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_report_service.py", line 65, in get_closed_trades
    trades = await persistence_service.get_closed_trades(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
Exception: Database connection failed
2025-06-25 22:39:51,852 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 3509ab35-87ef-458c-a614-c35bb0a74ddf for symbol BTC/USDT
2025-06-25 22:39:51,853 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy a53b0ddc-287a-41ce-9ace-aa62887f9f95 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:39:51,853 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 3509ab35-87ef-458c-a614-c35bb0a74ddf status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:39:51,855 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 3509ab35-87ef-458c-a614-c35bb0a74ddf
2025-06-25 22:39:51,863 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity a3e33164-f41c-4b4c-b084-b9b0bbe1f045 for symbol BTC/USDT
2025-06-25 22:39:51,864 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 525c4645-7bf5-4f27-8afc-aab1bb525054 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:39:51,865 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity a3e33164-f41c-4b4c-b084-b9b0bbe1f045 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:39:51,865 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity a3e33164-f41c-4b4c-b084-b9b0bbe1f045
2025-06-25 22:39:51,875 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 13764633-07e6-4768-93e2-3ef2ad52560e for symbol BTC/USDT
2025-06-25 22:39:51,877 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy b039c232-03b7-469e-beb2-8599352de6d9 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:39:51,877 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 13764633-07e6-4768-93e2-3ef2ad52560e status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:39:51,878 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 13764633-07e6-4768-93e2-3ef2ad52560e
2025-06-25 22:39:51,888 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 37658209-fa08-4510-a3ae-778cccdf15c3 for symbol BTC/USDT
2025-06-25 22:39:51,889 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 588959fd-59b8-4675-8bf9-83a122641dea can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:39:51,890 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 37658209-fa08-4510-a3ae-778cccdf15c3 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:39:51,891 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 37658209-fa08-4510-a3ae-778cccdf15c3
2025-06-25 22:39:51,900 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 9ee0d36c-feec-435e-8910-19044b9a2ef5 for symbol BTC/USDT
2025-06-25 22:39:51,900 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:653 - Unknown strategy type 'CUSTOM_UNKNOWN_TYPE' for strategy bb4dc292-c562-4795-966a-9635fad3c1cd. Recommending investigation.
2025-06-25 22:39:51,900 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 9ee0d36c-feec-435e-8910-19044b9a2ef5 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:39:51,901 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 9ee0d36c-feec-435e-8910-19044b9a2ef5
2025-06-25 22:39:51,910 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity f5063ae5-9561-4176-8f65-2613ee1f6e5c for symbol BTC/USDT
2025-06-25 22:39:51,912 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy beb9ed45-3824-4d0d-9f99-b28b1d010768 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:39:51,913 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity f5063ae5-9561-4176-8f65-2613ee1f6e5c status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:39:51,914 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity f5063ae5-9561-4176-8f65-2613ee1f6e5c
2025-06-25 22:39:51,934 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 459cf346-d6d7-4f70-bfd9-54626b506702 for symbol BTC/USDT
2025-06-25 22:39:51,936 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 3de44441-ece7-4a45-897b-41b59e1bfd32 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:39:51,936 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 459cf346-d6d7-4f70-bfd9-54626b506702 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:39:51,937 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 459cf346-d6d7-4f70-bfd9-54626b506702
2025-06-25 22:40:10,360 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:40:10,360 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:40:10,378 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:40:10,379 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:40:10,526 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:40:10,526 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:40:10,548 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:40:10,548 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:40:11,201 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:40:11,202 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:40:11,223 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:40:11,239 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:40:11,241 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:40:11,244 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:40:11,245 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:40:11,252 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:40:11,252 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:40:11,269 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:40:11,272 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:40:11,274 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:40:11,281 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:40:11,282 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:40:11,301 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:40:11,304 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:40:11,306 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:40:11,313 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:40:11,313 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:40:11,331 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:40:11,333 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:40:11,335 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:40:11,343 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:40:11,344 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:40:11,362 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:40:11,366 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:40:11,367 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:40:11,374 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:40:11,375 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:40:11,392 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:40:11,393 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:40:11,394 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:40:11,394 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:40:11,394 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:40:11,395 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:40:11,417 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:40:11,591 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:40:11,592 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:40:11,766 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:40:11,768 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:11,768 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:11,769 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:40:11,784 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:40:11,785 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000015969E36AD0>
2025-06-25 22:40:11,785 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:40:11,785 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:40:11,786 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 422
2025-06-25 22:40:11,795 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:40:11,795 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:40:11,813 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:40:11,815 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:40:11,815 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:40:11,815 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:40:11,991 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:40:11,991 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:40:12,171 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:40:12,172 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:12,172 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:12,172 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:40:12,176 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:40:12,176 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001596A45CC50>
2025-06-25 22:40:12,176 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:40:12,177 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:40:12,273 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:40:12,281 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:40:12,281 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:40:12,290 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:40:12,291 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:40:12,307 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:40:12,309 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:40:12,309 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:40:12,309 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:40:12,489 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:40:12,489 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:40:12,661 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:40:12,661 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:12,661 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:12,661 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:40:12,665 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:40:12,665 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001596A2690D0>
2025-06-25 22:40:12,665 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:40:12,666 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:40:12,669 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:40:12,676 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:40:12,677 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:40:12,678 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:40:12,683 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:40:12,684 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:40:12,684 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:40:12,686 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:40:12,695 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:40:12,695 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:40:12,714 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:40:12,715 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:40:12,716 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:40:12,716 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:40:12,892 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:40:12,892 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:40:13,068 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:40:13,069 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:13,069 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:13,069 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:40:13,072 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:40:13,073 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000015969FDBF90>
2025-06-25 22:40:13,073 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:40:13,073 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:40:13,076 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:40:13,083 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:40:13,083 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:40:13,084 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:40:13,091 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:40:13,091 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:40:13,100 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:40:13,100 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:40:13,118 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:40:13,119 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:40:13,119 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:40:13,120 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:40:13,298 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:40:13,298 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:40:13,473 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:40:13,473 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:13,473 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:13,474 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:40:13,476 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:40:13,477 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000015967741B90>
2025-06-25 22:40:13,478 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:40:13,478 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:40:13,482 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:40:13,489 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:40:13,490 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:40:13,490 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:40:13,497 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:40:13,497 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:40:13,506 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:40:13,508 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:40:13,526 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:40:13,528 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:40:13,528 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:40:13,528 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:40:13,710 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:40:13,711 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:40:13,887 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:40:13,888 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:13,888 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:13,888 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:40:13,891 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:40:13,892 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001596A29A850>
2025-06-25 22:40:13,892 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:40:13,892 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:40:13,892 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 422
2025-06-25 22:40:13,913 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity a573d4fe-6885-4a54-8f50-faa9d08a68c8
2025-06-25 22:40:13,914 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:152 - User configuration saved after initializing last_daily_reset for user 77a3bec0-458d-4aba-805f-5d418e0fcd01.
2025-06-25 22:40:13,914 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 200.000
2025-06-25 22:40:13,914 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity a573d4fe-6885-4a54-8f50-faa9d08a68c8
2025-06-25 22:40:13,914 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade d7da8a9b-c6ab-4e0d-b08d-150c9d9c93ef from decision a6e20e55-c25f-430e-8cfb-b7e3b28135e2
2025-06-25 22:40:13,915 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade d7da8a9b-c6ab-4e0d-b08d-150c9d9c93ef from confirmed opportunity.
2025-06-25 22:40:13,916 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:40:13,916 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:310 - Successfully created OCO order for trade d7da8a9b-c6ab-4e0d-b08d-150c9d9c93ef. OCO List ID: oco_list_123
2025-06-25 22:40:13,918 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 77a3bec0-458d-4aba-805f-5d418e0fcd01: 200.0000000000000000000000000 (anterior: 0.0, valor trade: 200.0000000000000000000000000)
2025-06-25 22:40:13,918 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user 77a3bec0-458d-4aba-805f-5d418e0fcd01 to 200.0000000000000000000000000.
2025-06-25 22:40:13,918 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity a573d4fe-6885-4a54-8f50-faa9d08a68c8 status to converted_to_trade_real: Trade d7da8a9b-c6ab-4e0d-b08d-150c9d9c93ef executed based on user confirmation.
2025-06-25 22:40:13,919 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity a573d4fe-6885-4a54-8f50-faa9d08a68c8
2025-06-25 22:40:13,928 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 114b4ce2-b319-43df-9b1a-1a374ce05251
2025-06-25 22:40:13,929 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 4800.0, Riesgo Potencial Trade USD: 300.000
2025-06-25 22:40:13,929 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:191 - Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:40:13,929 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 114b4ce2-b319-43df-9b1a-1a374ce05251 status to error_in_processing: Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:40:13,930 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 114b4ce2-b319-43df-9b1a-1a374ce05251
2025-06-25 22:40:13,944 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 70860541-0ad4-4f98-ba29-1453046c6672
2025-06-25 22:40:13,945 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:143 - Daily capital reset triggered for user a994d583-0765-49b9-8395-e3f9b08f37d9. Resetting daily_capital_risked_usd.
2025-06-25 22:40:13,945 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:147 - User configuration saved after daily capital reset for user a994d583-0765-49b9-8395-e3f9b08f37d9.
2025-06-25 22:40:13,945 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 2500.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 100.000
2025-06-25 22:40:13,946 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity 70860541-0ad4-4f98-ba29-1453046c6672
2025-06-25 22:40:13,946 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 5352c5ff-d0e6-4dcf-9a3e-59b74361ce06 from decision d9439bd4-d81c-4022-8a19-4c6cd8f96a2e
2025-06-25 22:40:13,946 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 5352c5ff-d0e6-4dcf-9a3e-59b74361ce06 from confirmed opportunity.
2025-06-25 22:40:13,947 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:40:13,948 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:310 - Successfully created OCO order for trade 5352c5ff-d0e6-4dcf-9a3e-59b74361ce06. OCO List ID: oco_reset_test
2025-06-25 22:40:13,948 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario a994d583-0765-49b9-8395-e3f9b08f37d9: 100.000 (anterior: 0.0, valor trade: 100.000)
2025-06-25 22:40:13,949 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user a994d583-0765-49b9-8395-e3f9b08f37d9 to 100.000.
2025-06-25 22:40:13,949 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 70860541-0ad4-4f98-ba29-1453046c6672 status to converted_to_trade_real: Trade 5352c5ff-d0e6-4dcf-9a3e-59b74361ce06 executed based on user confirmation.
2025-06-25 22:40:13,950 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 70860541-0ad4-4f98-ba29-1453046c6672
2025-06-25 22:40:13,965 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:40:13,966 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:40:13,984 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:40:13,986 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 22:40:13,986 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:40:13,987 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:40:14,161 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:40:14,161 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:40:14,341 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:40:14,342 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:14,342 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:14,342 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:40:14,345 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:40:14,345 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000015969F6A310>
2025-06-25 22:40:14,345 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:40:14,345 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:40:14,347 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 22:40:14,351 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"0424aaea-7b69-414d-906b-83ce6b543210","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:40:13.956345Z","submittedAt":"2025-06-26T02:40:13.956345Z","fillTimestamp":"2025-06-26T02:40:13.956345Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:40:13.956345Z","opened_at":"2025-06-26T02:40:13.956345Z","updated_at":"2025-06-26T02:40:13.956345Z","closed_at":"2025-06-26T02:40:13.956345Z"}
2025-06-25 22:40:14,351 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '0424aaea-7b69-414d-906b-83ce6b543210', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:40:13.956345Z', 'submittedAt': '2025-06-26T02:40:13.956345Z', 'fillTimestamp': '2025-06-26T02:40:13.956345Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:40:13.956345Z', 'opened_at': '2025-06-26T02:40:13.956345Z', 'updated_at': '2025-06-26T02:40:13.956345Z', 'closed_at': '2025-06-26T02:40:13.956345Z'}
2025-06-25 22:40:14,351 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"a44fcd55-a5bf-43a2-9cd4-ba2ae546b102","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:40:13.956345Z","submittedAt":"2025-06-26T02:40:13.956345Z","fillTimestamp":"2025-06-26T02:40:13.956345Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:40:13.956345Z","opened_at":"2025-06-26T02:40:13.956345Z","updated_at":"2025-06-26T02:40:13.956345Z","closed_at":"2025-06-26T02:40:13.956345Z"}
2025-06-25 22:40:14,352 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': 'a44fcd55-a5bf-43a2-9cd4-ba2ae546b102', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:40:13.956345Z', 'submittedAt': '2025-06-26T02:40:13.956345Z', 'fillTimestamp': '2025-06-26T02:40:13.956345Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:40:13.956345Z', 'opened_at': '2025-06-26T02:40:13.956345Z', 'updated_at': '2025-06-26T02:40:13.956345Z', 'closed_at': '2025-06-26T02:40:13.956345Z'}
2025-06-25 22:40:14,352 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"32dc6ef9-4a1c-4e22-b42d-74a4256ec617","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:40:13.956345Z","submittedAt":"2025-06-26T02:40:13.956345Z","fillTimestamp":"2025-06-26T02:40:13.956345Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:40:13.956345Z","opened_at":"2025-06-26T02:40:13.956345Z","updated_at":"2025-06-26T02:40:13.956345Z","closed_at":"2025-06-26T02:40:13.956345Z"}
2025-06-25 22:40:14,352 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '32dc6ef9-4a1c-4e22-b42d-74a4256ec617', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:40:13.956345Z', 'submittedAt': '2025-06-26T02:40:13.956345Z', 'fillTimestamp': '2025-06-26T02:40:13.956345Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:40:13.956345Z', 'opened_at': '2025-06-26T02:40:13.956345Z', 'updated_at': '2025-06-26T02:40:13.956345Z', 'closed_at': '2025-06-26T02:40:13.956345Z'}
2025-06-25 22:40:14,352 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 3
2025-06-25 22:40:14,353 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:40:14,353 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 22:40:14,369 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:40:14,370 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:40:14,390 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:40:14,391 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 22:40:14,392 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:40:14,392 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:40:14,564 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:40:14,564 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:40:14,736 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:40:14,737 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:14,737 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:14,737 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:40:14,740 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:40:14,741 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001596B598310>
2025-06-25 22:40:14,741 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:40:14,741 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:40:14,741 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: BTCUSDT, start_date: None, end_date: None
2025-06-25 22:40:14,745 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"73385342-eebb-426b-89b7-6ad43776e324","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:40:14.362837Z","submittedAt":"2025-06-26T02:40:14.362837Z","fillTimestamp":"2025-06-26T02:40:14.362837Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:40:14.362837Z","opened_at":"2025-06-26T02:40:14.362837Z","updated_at":"2025-06-26T02:40:14.362837Z","closed_at":"2025-06-26T02:40:14.362837Z"}
2025-06-25 22:40:14,745 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '73385342-eebb-426b-89b7-6ad43776e324', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:40:14.362837Z', 'submittedAt': '2025-06-26T02:40:14.362837Z', 'fillTimestamp': '2025-06-26T02:40:14.362837Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:40:14.362837Z', 'opened_at': '2025-06-26T02:40:14.362837Z', 'updated_at': '2025-06-26T02:40:14.362837Z', 'closed_at': '2025-06-26T02:40:14.362837Z'}
2025-06-25 22:40:14,745 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 1
2025-06-25 22:40:14,746 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 1 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:40:14,746 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 22:40:14,766 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:40:14,768 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:40:14,789 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:40:14,790 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 22:40:14,791 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:40:14,791 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:40:14,965 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:40:14,965 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:40:15,138 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:40:15,139 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:15,140 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:15,140 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:40:15,143 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:40:15,143 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001596A467390>
2025-06-25 22:40:15,143 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:40:15,144 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:40:15,144 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 22:40:15,147 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"c035cdab-ba18-45ab-8c15-e7e2707231d7","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:40:14.757204Z","submittedAt":"2025-06-26T02:40:14.757204Z","fillTimestamp":"2025-06-26T02:40:14.757204Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:40:14.757204Z","opened_at":"2025-06-26T02:40:14.757204Z","updated_at":"2025-06-26T02:40:14.757204Z","closed_at":"2025-06-26T02:40:14.757204Z"}
2025-06-25 22:40:15,147 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': 'c035cdab-ba18-45ab-8c15-e7e2707231d7', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:40:14.757204Z', 'submittedAt': '2025-06-26T02:40:14.757204Z', 'fillTimestamp': '2025-06-26T02:40:14.757204Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:40:14.757204Z', 'opened_at': '2025-06-26T02:40:14.757204Z', 'updated_at': '2025-06-26T02:40:14.757204Z', 'closed_at': '2025-06-26T02:40:14.757204Z'}
2025-06-25 22:40:15,147 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"0ff4d552-7a18-4f9f-94a3-68b0b268086a","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:40:14.757204Z","submittedAt":"2025-06-26T02:40:14.757204Z","fillTimestamp":"2025-06-26T02:40:14.757204Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:40:14.757204Z","opened_at":"2025-06-26T02:40:14.757204Z","updated_at":"2025-06-26T02:40:14.757204Z","closed_at":"2025-06-26T02:40:14.757204Z"}
2025-06-25 22:40:15,147 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': '0ff4d552-7a18-4f9f-94a3-68b0b268086a', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:40:14.757204Z', 'submittedAt': '2025-06-26T02:40:14.757204Z', 'fillTimestamp': '2025-06-26T02:40:14.757204Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:40:14.757204Z', 'opened_at': '2025-06-26T02:40:14.757204Z', 'updated_at': '2025-06-26T02:40:14.757204Z', 'closed_at': '2025-06-26T02:40:14.757204Z'}
2025-06-25 22:40:15,149 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"bb78fbef-54b7-4d97-a46f-a5806925ea27","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:40:14.757204Z","submittedAt":"2025-06-26T02:40:14.757204Z","fillTimestamp":"2025-06-26T02:40:14.757204Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:40:14.757204Z","opened_at":"2025-06-26T02:40:14.757204Z","updated_at":"2025-06-26T02:40:14.757204Z","closed_at":"2025-06-26T02:40:14.757204Z"}
2025-06-25 22:40:15,149 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': 'bb78fbef-54b7-4d97-a46f-a5806925ea27', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:40:14.757204Z', 'submittedAt': '2025-06-26T02:40:14.757204Z', 'fillTimestamp': '2025-06-26T02:40:14.757204Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:40:14.757204Z', 'opened_at': '2025-06-26T02:40:14.757204Z', 'updated_at': '2025-06-26T02:40:14.757204Z', 'closed_at': '2025-06-26T02:40:14.757204Z'}
2025-06-25 22:40:15,149 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 3
2025-06-25 22:40:15,149 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:40:15,150 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 22:40:15,168 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:40:15,168 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:40:15,185 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:40:15,186 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 22:40:15,187 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:40:15,188 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:40:15,364 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:40:15,365 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:40:15,535 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:40:15,536 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:15,536 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:15,537 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:40:15,540 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:40:15,540 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001596B60C2D0>
2025-06-25 22:40:15,541 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:40:15,541 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:40:15,541 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: 2025-06-27 02:40:15.186931+00:00, end_date: None
2025-06-25 22:40:15,545 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 0
2025-06-25 22:40:15,545 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:40:15,546 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 22:40:15,589 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity b26fabdf-094d-4935-9fa3-36a35c22f6c9 for symbol BTCUSDT
2025-06-25 22:40:15,590 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: f619441d-c4d6-49a6-a3f9-f40d4688556c
2025-06-25 22:40:15,590 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 10ebe1c9-8e7b-457a-ab57-862bf15afeb6 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:40:15,600 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 3e7e5778-9941-46c1-8b22-3129acc65ea9 for symbol BTCUSDT
2025-06-25 22:40:15,600 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy a89bcc25-41f0-4149-ac4e-91b4ec853a84 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:40:15,609 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity e1502512-8aee-4974-94d8-edf368b3ac23 for symbol ETHUSDT
2025-06-25 22:40:15,610 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 3bb2b2b4-a1cb-4687-8e63-1e07a8093842
2025-06-25 22:40:15,612 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:604 - No active and applicable strategies found for opportunity e1502512-8aee-4974-94d8-edf368b3ac23 with symbol ETHUSDT.
2025-06-25 22:40:15,612 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity e1502512-8aee-4974-94d8-edf368b3ac23 status to rejected_by_system: No active strategies are applicable to this opportunity's symbol.
2025-06-25 22:40:15,613 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity e1502512-8aee-4974-94d8-edf368b3ac23
2025-06-25 22:40:15,620 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 558be92b-bb83-4344-a46a-6b23552e0943 for symbol BTCUSDT
2025-06-25 22:40:15,620 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: f66838f7-8115-4b5d-b876-a0fd3d1f8a67
2025-06-25 22:40:15,621 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:717 - AI confidence 0.65 for strategy a239b4d7-69d1-454f-99b3-9b3f210599e8 is below threshold 0.8.
2025-06-25 22:40:15,624 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy a239b4d7-69d1-454f-99b3-9b3f210599e8 did not produce a decision for opportunity 558be92b-bb83-4344-a46a-6b23552e0943.
2025-06-25 22:40:15,624 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:623 - No affirmative trading decisions made for opportunity 558be92b-bb83-4344-a46a-6b23552e0943.
2025-06-25 22:40:15,632 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity d3e87b5f-9599-44c6-9acf-015346464388 for symbol BTCUSDT
2025-06-25 22:40:15,632 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 40f8f60c-45f2-4adf-8779-13f0507e8238
2025-06-25 22:40:15,641 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 042557f3-98ed-47d2-8cd8-89200d1f9daa for symbol BTCUSDT
2025-06-25 22:40:15,642 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 7dd64927-4d2a-44bd-a70a-067e938a09e1
2025-06-25 22:40:15,649 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade c5b0ec80-09f9-4c0a-9245-da367ceed4fb from decision 4b9044a5-1502-4ca9-b394-0f1e57e8c09d
2025-06-25 22:40:15,654 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 918fd46b-986a-4229-b67c-e5fe258d82c5 from decision d83dd261-0790-42af-bedb-4f28bddd0eeb
2025-06-25 22:40:15,655 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 3b7f304f-2a6f-4618-b675-1ebfd8a7f3d2 from decision d83dd261-0790-42af-bedb-4f28bddd0eeb
2025-06-25 22:40:15,662 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:15,662 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:15,670 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:40:15,670 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:40:15,673 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:40:15,676 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 91becf4d-0d1a-406f-9c60-c0a0d64d0add
2025-06-25 22:40:15,680 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 1dccab20-571a-4478-a047-696b9cc6c643. Creando y guardando configuración por defecto.
2025-06-25 22:40:15,683 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:40:15,685 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 1dccab20-571a-4478-a047-696b9cc6c643. Using default values.
2025-06-25 22:40:15,685 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 1dccab20-571a-4478-a047-696b9cc6c643 with capital: 10000.0
2025-06-25 22:40:15,686 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:40:15,687 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:40:15,687 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:40:15,687 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity 91becf4d-0d1a-406f-9c60-c0a0d64d0add
2025-06-25 22:40:15,688 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 5459d985-08e5-4c3a-aec0-cbb37850fafa from decision 50bf06a2-e5c7-4bcd-b9d3-2c3ac748ff72
2025-06-25 22:40:15,688 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 5459d985-08e5-4c3a-aec0-cbb37850fafa from confirmed opportunity.
2025-06-25 22:40:15,689 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:40:15,690 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('d4ff26b9-5bf1-44e1-ac8f-ce9507f42c18') orderId_exchange='mock_exchange_oco_id_bd86e8d3-6076-4a52-a04a-fd49b6879111' clientOrderId_exchange='mock_client_oco_id_f4597f8c-ff2d-497a-9898-c7d3f366acde' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 40, 15, 690656) submittedAt=datetime.datetime(2025, 6, 26, 2, 40, 15, 690656, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 40, 15, 690656, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 286372571935553682933331969415255697628, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_d43052d4-524c-44be-a968-45b01d375ff9', 'transactionTime': 1750905615690, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='286372571935553682933331969415255697628' price=None stopPrice=None timeInForce=None
2025-06-25 22:40:15,690 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 1dccab20-571a-4478-a047-696b9cc6c643: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:40:15,694 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('5459d985-08e5-4c3a-aec0-cbb37850fafa'), '0c7c4947-fd16-4acf-b477-87e15f38b9c5', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:40:15.688146', '2025-06-26 02:40:15.688146', None, '{"id":"5459d985-08e5-4c3a-aec0-cbb37850fafa","user_id":"0c7c4947-fd16-4acf-b477-87e15f38b9c5","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:40:15.688146","opened_at":"2025-06-26T02:40:15.688146","updated_at":"2025-06-26T02:40:15.688146","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('5459d985-08e5-4c3a-aec0-cbb37850fafa'), '0c7c4947-fd16-4acf-b477-87e15f38b9c5', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:40:15.688146', '2025-06-26 02:40:15.688146', None, '{"id":"5459d985-08e5-4c3a-aec0-cbb37850fafa","user_id":"0c7c4947-fd16-4acf-b477-87e15f38b9c5","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:40:15.688146","opened_at":"2025-06-26T02:40:15.688146","updated_at":"2025-06-26T02:40:15.688146","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:40:15,701 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 91becf4d-0d1a-406f-9c60-c0a0d64d0add: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('5459d985-08e5-4c3a-aec0-cbb37850fafa'), '0c7c4947-fd16-4acf-b477-87e15f38b9c5', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:40:15.688146', '2025-06-26 02:40:15.688146', None, '{"id":"5459d985-08e5-4c3a-aec0-cbb37850fafa","user_id":"0c7c4947-fd16-4acf-b477-87e15f38b9c5","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:40:15.688146","opened_at":"2025-06-26T02:40:15.688146","updated_at":"2025-06-26T02:40:15.688146","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:40:15,703 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 91becf4d-0d1a-406f-9c60-c0a0d64d0add status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:40:15,704 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:544 - Failed to persist status update for opportunity 91becf4d-0d1a-406f-9c60-c0a0d64d0add: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('5459d985-08e5-4c3a-aec0-cbb37850fafa'), '0c7c4947-fd16-4acf-b477-87e15f38b9c5', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:40:15.688146', '2025-06-26 02:40:15.688146', None, '{"id":"5459d985-08e5-4c3a-aec0-cbb37850fafa","user_id":"0c7c4947-fd16-4acf-b477-87e15f38b9c5","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:40:15.688146","opened_at":"2025-06-26T02:40:15.688146","updated_at":"2025-06-26T02:40:15.688146","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 537, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('5459d985-08e5-4c3a-aec0-cbb37850fafa'), '0c7c4947-fd16-4acf-b477-87e15f38b9c5', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:40:15.688146', '2025-06-26 02:40:15.688146', None, '{"id":"5459d985-08e5-4c3a-aec0-cbb37850fafa","user_id":"0c7c4947-fd16-4acf-b477-87e15f38b9c5","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:40:15.688146","opened_at":"2025-06-26T02:40:15.688146","updated_at":"2025-06-26T02:40:15.688146","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:40:15,995 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:40:15,996 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:40:16,004 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:16,004 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:16,011 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:40:16,011 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:40:16,014 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:40:16,016 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:40:16,016 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:40:16,025 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:16,025 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:16,031 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:40:16,031 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:40:16,034 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:40:16,036 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 0938112a-1b87-42f6-ac5b-524f31bbdf4e for symbol BTC/USDT
2025-06-25 22:40:16,039 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 536a5383-119d-473b-8ded-b8f46447325f. Creando y guardando configuración por defecto.
2025-06-25 22:40:16,041 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:40:16,043 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:672 - AI profile 'ai-profile-scalping-1' for strategy 1e9e3af1-f02a-4f53-8205-3086d6c08c90 not found. Skipping AI analysis.
2025-06-25 22:40:16,043 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 1e9e3af1-f02a-4f53-8205-3086d6c08c90 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:40:16,043 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 0938112a-1b87-42f6-ac5b-524f31bbdf4e status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:40:16,050 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 0938112a-1b87-42f6-ac5b-524f31bbdf4e
2025-06-25 22:40:16,051 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:40:16,052 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:40:16,060 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:16,061 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:16,069 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:40:16,069 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:40:16,071 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:40:16,073 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 756cf530-37a6-4b8e-9fc4-19c13e36046b
2025-06-25 22:40:16,076 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id be5c1fbd-5f83-4f46-b3aa-4b6b2bd363e9. Creando y guardando configuración por defecto.
2025-06-25 22:40:16,078 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:40:16,081 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for be5c1fbd-5f83-4f46-b3aa-4b6b2bd363e9. Using default values.
2025-06-25 22:40:16,081 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for be5c1fbd-5f83-4f46-b3aa-4b6b2bd363e9 with capital: 10000.0
2025-06-25 22:40:16,082 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:40:16,082 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:40:16,083 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:40:16,083 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Autonomous Scalping' as context for confirmed opportunity 756cf530-37a6-4b8e-9fc4-19c13e36046b
2025-06-25 22:40:16,083 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade a8c23c45-0c40-49ed-ba96-4fd8796951bf from decision 6ad297f9-4049-4b7b-bb03-bc97ad81c2d5
2025-06-25 22:40:16,084 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade a8c23c45-0c40-49ed-ba96-4fd8796951bf from confirmed opportunity.
2025-06-25 22:40:16,085 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:40:16,085 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('46517da6-6031-4e9b-80d6-43b861f8b491') orderId_exchange='mock_exchange_oco_id_812ba350-8844-4137-876e-063a847f5917' clientOrderId_exchange='mock_client_oco_id_a9000b2d-7404-4f62-8d46-a8d6406dcd9f' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 40, 16, 85571) submittedAt=datetime.datetime(2025, 6, 26, 2, 40, 16, 85571, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 40, 16, 85571, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 271324527105438654302461091194061292488, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_4d55b20f-1bd0-4cfa-be0d-a4ead5ea70b9', 'transactionTime': 1750905616085, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='271324527105438654302461091194061292488' price=None stopPrice=None timeInForce=None
2025-06-25 22:40:16,086 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario be5c1fbd-5f83-4f46-b3aa-4b6b2bd363e9: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:40:16,089 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('a8c23c45-0c40-49ed-ba96-4fd8796951bf'), '93a9a7f7-4c47-47f3-a5db-ffa366bdc013', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:40:16.083570', '2025-06-26 02:40:16.083570', None, '{"id":"a8c23c45-0c40-49ed-ba96-4fd8796951bf","user_id":"93a9a7f7-4c47-47f3-a5db-ffa366bdc013","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:40:16.083570","opened_at":"2025-06-26T02:40:16.083570","updated_at":"2025-06-26T02:40:16.083570","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('a8c23c45-0c40-49ed-ba96-4fd8796951bf'), '93a9a7f7-4c47-47f3-a5db-ffa366bdc013', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:40:16.083570', '2025-06-26 02:40:16.083570', None, '{"id":"a8c23c45-0c40-49ed-ba96-4fd8796951bf","user_id":"93a9a7f7-4c47-47f3-a5db-ffa366bdc013","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:40:16.083570","opened_at":"2025-06-26T02:40:16.083570","updated_at":"2025-06-26T02:40:16.083570","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:40:16,091 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 756cf530-37a6-4b8e-9fc4-19c13e36046b: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('a8c23c45-0c40-49ed-ba96-4fd8796951bf'), '93a9a7f7-4c47-47f3-a5db-ffa366bdc013', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:40:16.083570', '2025-06-26 02:40:16.083570', None, '{"id":"a8c23c45-0c40-49ed-ba96-4fd8796951bf","user_id":"93a9a7f7-4c47-47f3-a5db-ffa366bdc013","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:40:16.083570","opened_at":"2025-06-26T02:40:16.083570","updated_at":"2025-06-26T02:40:16.083570","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:40:16,094 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 756cf530-37a6-4b8e-9fc4-19c13e36046b status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:40:16,094 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:544 - Failed to persist status update for opportunity 756cf530-37a6-4b8e-9fc4-19c13e36046b: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('a8c23c45-0c40-49ed-ba96-4fd8796951bf'), '93a9a7f7-4c47-47f3-a5db-ffa366bdc013', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:40:16.083570', '2025-06-26 02:40:16.083570', None, '{"id":"a8c23c45-0c40-49ed-ba96-4fd8796951bf","user_id":"93a9a7f7-4c47-47f3-a5db-ffa366bdc013","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:40:16.083570","opened_at":"2025-06-26T02:40:16.083570","updated_at":"2025-06-26T02:40:16.083570","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 537, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('a8c23c45-0c40-49ed-ba96-4fd8796951bf'), '93a9a7f7-4c47-47f3-a5db-ffa366bdc013', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:40:16.083570', '2025-06-26 02:40:16.083570', None, '{"id":"a8c23c45-0c40-49ed-ba96-4fd8796951bf","user_id":"93a9a7f7-4c47-47f3-a5db-ffa366bdc013","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:40:16.083570","opened_at":"2025-06-26T02:40:16.083570","updated_at":"2025-06-26T02:40:16.083570","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:40:16,102 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:40:16,103 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:40:16,111 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:16,111 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:16,119 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:40:16,119 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:40:16,122 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:40:16,124 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity d6066d17-6f09-4b18-9cc9-a82f9ff3ccc2
2025-06-25 22:40:16,128 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id e2071db4-08ed-4a4e-93e1-4c830e0d3af3. Creando y guardando configuración por defecto.
2025-06-25 22:40:16,130 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:40:16,133 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for e2071db4-08ed-4a4e-93e1-4c830e0d3af3. Using default values.
2025-06-25 22:40:16,133 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for e2071db4-08ed-4a4e-93e1-4c830e0d3af3 with capital: 10000.0
2025-06-25 22:40:16,134 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:40:16,134 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:40:16,135 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:40:16,135 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity d6066d17-6f09-4b18-9cc9-a82f9ff3ccc2
2025-06-25 22:40:16,135 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 187edca9-4718-4ab0-8d8d-2f3538e56105 from decision 756969e9-40f4-44b7-b269-8dc6d7fa16bd
2025-06-25 22:40:16,136 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 187edca9-4718-4ab0-8d8d-2f3538e56105 from confirmed opportunity.
2025-06-25 22:40:16,136 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:40:16,137 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('ad06874f-6aeb-45a5-8e05-8f14b19048a8') orderId_exchange='mock_exchange_oco_id_499ebfe6-fc32-4b29-bcb2-6285af0cd745' clientOrderId_exchange='mock_client_oco_id_8b111f3f-0038-4bcc-88ca-056b0a871c4b' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 40, 16, 137245) submittedAt=datetime.datetime(2025, 6, 26, 2, 40, 16, 137245, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 40, 16, 137245, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 89069771079663819357738943507190943664, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_429e52d3-fbf2-4e78-850f-289d9f82ce7f', 'transactionTime': 1750905616137, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='89069771079663819357738943507190943664' price=None stopPrice=None timeInForce=None
2025-06-25 22:40:16,138 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario e2071db4-08ed-4a4e-93e1-4c830e0d3af3: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:40:16,141 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('187edca9-4718-4ab0-8d8d-2f3538e56105'), 'a6cba27c-890a-4148-ba89-608117db587e', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:40:16.135058', '2025-06-26 02:40:16.135058', None, '{"id":"187edca9-4718-4ab0-8d8d-2f3538e56105","user_id":"a6cba27c-890a-4148-ba89-608117db587e","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:40:16.135058","opened_at":"2025-06-26T02:40:16.135058","updated_at":"2025-06-26T02:40:16.135058","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('187edca9-4718-4ab0-8d8d-2f3538e56105'), 'a6cba27c-890a-4148-ba89-608117db587e', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:40:16.135058', '2025-06-26 02:40:16.135058', None, '{"id":"187edca9-4718-4ab0-8d8d-2f3538e56105","user_id":"a6cba27c-890a-4148-ba89-608117db587e","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:40:16.135058","opened_at":"2025-06-26T02:40:16.135058","updated_at":"2025-06-26T02:40:16.135058","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:40:16,143 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity d6066d17-6f09-4b18-9cc9-a82f9ff3ccc2: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('187edca9-4718-4ab0-8d8d-2f3538e56105'), 'a6cba27c-890a-4148-ba89-608117db587e', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:40:16.135058', '2025-06-26 02:40:16.135058', None, '{"id":"187edca9-4718-4ab0-8d8d-2f3538e56105","user_id":"a6cba27c-890a-4148-ba89-608117db587e","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:40:16.135058","opened_at":"2025-06-26T02:40:16.135058","updated_at":"2025-06-26T02:40:16.135058","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:40:16,146 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity d6066d17-6f09-4b18-9cc9-a82f9ff3ccc2 status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:40:16,146 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:544 - Failed to persist status update for opportunity d6066d17-6f09-4b18-9cc9-a82f9ff3ccc2: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('187edca9-4718-4ab0-8d8d-2f3538e56105'), 'a6cba27c-890a-4148-ba89-608117db587e', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:40:16.135058', '2025-06-26 02:40:16.135058', None, '{"id":"187edca9-4718-4ab0-8d8d-2f3538e56105","user_id":"a6cba27c-890a-4148-ba89-608117db587e","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:40:16.135058","opened_at":"2025-06-26T02:40:16.135058","updated_at":"2025-06-26T02:40:16.135058","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 537, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('187edca9-4718-4ab0-8d8d-2f3538e56105'), 'a6cba27c-890a-4148-ba89-608117db587e', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:40:16.135058', '2025-06-26 02:40:16.135058', None, '{"id":"187edca9-4718-4ab0-8d8d-2f3538e56105","user_id":"a6cba27c-890a-4148-ba89-608117db587e","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:40:16.135058","opened_at":"2025-06-26T02:40:16.135058","updated_at":"2025-06-26T02:40:16.135058","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:40:16,157 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:40:16,158 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:40:16,165 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:16,165 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:16,174 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:40:16,174 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:40:16,176 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:40:16,178 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity d0c5910a-a361-45b7-af35-7feae1a36436
2025-06-25 22:40:16,181 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 90aa281d-ac03-40fc-ad40-2a57e07ea1c3. Creando y guardando configuración por defecto.
2025-06-25 22:40:16,184 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:40:16,188 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 90aa281d-ac03-40fc-ad40-2a57e07ea1c3. Using default values.
2025-06-25 22:40:16,188 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 90aa281d-ac03-40fc-ad40-2a57e07ea1c3 with capital: 10000.0
2025-06-25 22:40:16,189 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:40:16,190 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:40:16,190 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:40:16,190 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Day Trading Strategy' as context for confirmed opportunity d0c5910a-a361-45b7-af35-7feae1a36436
2025-06-25 22:40:16,190 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade b75f4ac9-ccb1-4647-8874-813e8e7f08b5 from decision f0d32276-9522-49c7-850a-81f25ef8d012
2025-06-25 22:40:16,191 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade b75f4ac9-ccb1-4647-8874-813e8e7f08b5 from confirmed opportunity.
2025-06-25 22:40:16,192 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:40:16,192 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('c9a34b5c-b020-4e11-99fb-2b591d051d35') orderId_exchange='mock_exchange_oco_id_a04d8299-b91a-4639-b203-fab1e2c0721a' clientOrderId_exchange='mock_client_oco_id_6a30b7c2-8bbe-4300-a6df-9f695e0dbb35' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 40, 16, 192406) submittedAt=datetime.datetime(2025, 6, 26, 2, 40, 16, 192406, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 40, 16, 192406, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 118173412469616883239045840135083003181, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_3a8d483d-97e1-407c-845a-00b79aad3610', 'transactionTime': 1750905616192, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='118173412469616883239045840135083003181' price=None stopPrice=None timeInForce=None
2025-06-25 22:40:16,193 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 90aa281d-ac03-40fc-ad40-2a57e07ea1c3: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:40:16,196 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('b75f4ac9-ccb1-4647-8874-813e8e7f08b5'), 'f3df12fb-3750-44e2-ba69-7ee631851c87', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:40:16.190406', '2025-06-26 02:40:16.190406', None, '{"id":"b75f4ac9-ccb1-4647-8874-813e8e7f08b5","user_id":"f3df12fb-3750-44e2-ba69-7ee631851c87","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:40:16.190406","opened_at":"2025-06-26T02:40:16.190406","updated_at":"2025-06-26T02:40:16.190406","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('b75f4ac9-ccb1-4647-8874-813e8e7f08b5'), 'f3df12fb-3750-44e2-ba69-7ee631851c87', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:40:16.190406', '2025-06-26 02:40:16.190406', None, '{"id":"b75f4ac9-ccb1-4647-8874-813e8e7f08b5","user_id":"f3df12fb-3750-44e2-ba69-7ee631851c87","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:40:16.190406","opened_at":"2025-06-26T02:40:16.190406","updated_at":"2025-06-26T02:40:16.190406","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:40:16,197 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity d0c5910a-a361-45b7-af35-7feae1a36436: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('b75f4ac9-ccb1-4647-8874-813e8e7f08b5'), 'f3df12fb-3750-44e2-ba69-7ee631851c87', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:40:16.190406', '2025-06-26 02:40:16.190406', None, '{"id":"b75f4ac9-ccb1-4647-8874-813e8e7f08b5","user_id":"f3df12fb-3750-44e2-ba69-7ee631851c87","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:40:16.190406","opened_at":"2025-06-26T02:40:16.190406","updated_at":"2025-06-26T02:40:16.190406","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:40:16,199 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity d0c5910a-a361-45b7-af35-7feae1a36436 status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:40:16,200 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:544 - Failed to persist status update for opportunity d0c5910a-a361-45b7-af35-7feae1a36436: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('b75f4ac9-ccb1-4647-8874-813e8e7f08b5'), 'f3df12fb-3750-44e2-ba69-7ee631851c87', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:40:16.190406', '2025-06-26 02:40:16.190406', None, '{"id":"b75f4ac9-ccb1-4647-8874-813e8e7f08b5","user_id":"f3df12fb-3750-44e2-ba69-7ee631851c87","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:40:16.190406","opened_at":"2025-06-26T02:40:16.190406","updated_at":"2025-06-26T02:40:16.190406","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 537, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('b75f4ac9-ccb1-4647-8874-813e8e7f08b5'), 'f3df12fb-3750-44e2-ba69-7ee631851c87', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:40:16.190406', '2025-06-26 02:40:16.190406', None, '{"id":"b75f4ac9-ccb1-4647-8874-813e8e7f08b5","user_id":"f3df12fb-3750-44e2-ba69-7ee631851c87","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:40:16.190406","opened_at":"2025-06-26T02:40:16.190406","updated_at":"2025-06-26T02:40:16.190406","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:40:16,211 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:40:16,212 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:40:16,220 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:16,220 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:16,228 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:40:16,228 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:40:16,230 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:40:16,232 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade 4a16e1f5-af4c-453f-aa5b-a062350441e6 from decision 91c443e9-cccf-4298-ba1d-91819e2a1e7d
2025-06-25 22:40:16,233 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:40:16,234 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:40:16,242 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:16,242 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:16,250 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:40:16,250 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:40:16,252 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:40:16,253 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:447 - Created trade c89b4401-f115-40cd-809d-517e39568ba8 from decision e5657db1-edde-456a-ae00-b28c51480c8a
2025-06-25 22:40:16,254 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:40:16,255 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:40:16,265 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:16,265 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:16,273 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:40:16,273 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:40:16,276 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:40:16,278 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:40:16,278 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:40:18,141 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:18,141 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:18,147 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:40:18,148 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:40:18,149 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:40:18,158 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:40:18,162 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:40:18,163 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:40:18,167 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:40:18,173 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:40:18,177 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:40:18,181 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:18,181 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:18,185 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:18,185 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:18,187 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:40:18,191 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:18,191 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:18,198 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:18,199 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:18,205 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:18,205 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:18,209 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:40:18,212 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:18,213 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:18,216 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:286 - Verificación de Binance BINANCE_SPOT exitosa.
2025-06-25 22:40:18,221 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:18,222 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:18,226 - ultibot_backend.services.credential_service - ERROR - [MainThread] - credential_service.py:315 - Error de Binance API durante la verificación: Binance Down
2025-06-25 22:40:18,229 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:18,230 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:18,233 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:40:18,238 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:40:18,238 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:40:18,242 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:241 - Verificación de Telegram exitosa.
2025-06-25 22:40:18,249 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:72 - Conexión con Binance exitosa.
2025-06-25 22:40:18,254 - ultibot_backend.services.market_data_service - WARNING - [MainThread] - market_data_service.py:52 - Credenciales de Binance no encontradas. Por favor, configúrelas.
2025-06-25 22:40:18,259 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:69 - Fallo en la verificación de conexión con Binance. Revise sus credenciales y permisos.
2025-06-25 22:40:18,263 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:77 - Error al acceder a las credenciales de Binance: Decryption failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 45, in get_binance_connection_status
    binance_credential = await self.credential_service.get_credential(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.CredentialError: Decryption failed
2025-06-25 22:40:18,268 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:81 - Error de la API de Binance: API unavailable
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 61, in get_binance_connection_status
    is_connected = await self.credential_service.verify_credential(binance_credential)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.BinanceAPIError: API unavailable
2025-06-25 22:40:18,275 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:40:18,283 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:121 - Error de la API de Binance al obtener balances: Failed to fetch balances
2025-06-25 22:40:18,288 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1483571565200'>
2025-06-25 22:40:18,289 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1209400f-2b92-45e5-a112-9b0d3acc845d, mode_filter: None
2025-06-25 22:40:18,290 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1483571565200'>
2025-06-25 22:40:18,290 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 1209400f-2b92-45e5-a112-9b0d3acc845d with mode_filter: None
2025-06-25 22:40:18,293 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1483570921872'>
2025-06-25 22:40:18,295 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1209400f-2b92-45e5-a112-9b0d3acc845d, mode_filter: None
2025-06-25 22:40:18,295 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1483570921872'>
2025-06-25 22:40:18,295 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 1209400f-2b92-45e5-a112-9b0d3acc845d with mode_filter: None
2025-06-25 22:40:18,298 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1483571423504'>
2025-06-25 22:40:18,299 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1209400f-2b92-45e5-a112-9b0d3acc845d, mode_filter: OperatingMode.PAPER
2025-06-25 22:40:18,299 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1483571423504'>
2025-06-25 22:40:18,299 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 1209400f-2b92-45e5-a112-9b0d3acc845d
2025-06-25 22:40:18,302 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1483570936976'>
2025-06-25 22:40:18,304 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1209400f-2b92-45e5-a112-9b0d3acc845d, mode_filter: OperatingMode.PAPER
2025-06-25 22:40:18,305 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1483570936976'>
2025-06-25 22:40:18,305 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 1209400f-2b92-45e5-a112-9b0d3acc845d
2025-06-25 22:40:18,309 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1483572882640'>
2025-06-25 22:40:18,311 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1209400f-2b92-45e5-a112-9b0d3acc845d, mode_filter: OperatingMode.REAL
2025-06-25 22:40:18,311 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1483572882640'>
2025-06-25 22:40:18,311 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 1209400f-2b92-45e5-a112-9b0d3acc845d
2025-06-25 22:40:18,314 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1483570931984'>
2025-06-25 22:40:18,316 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1209400f-2b92-45e5-a112-9b0d3acc845d, mode_filter: OperatingMode.PAPER
2025-06-25 22:40:18,316 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1483570931984'>
2025-06-25 22:40:18,316 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 1209400f-2b92-45e5-a112-9b0d3acc845d
2025-06-25 22:40:18,320 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1483571381968'>
2025-06-25 22:40:18,322 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1209400f-2b92-45e5-a112-9b0d3acc845d, mode_filter: None
2025-06-25 22:40:18,323 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1483571381968'>
2025-06-25 22:40:18,323 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 2 performance entries for user 1209400f-2b92-45e5-a112-9b0d3acc845d
2025-06-25 22:40:18,327 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1483571306768'>
2025-06-25 22:40:18,328 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1209400f-2b92-45e5-a112-9b0d3acc845d, mode_filter: OperatingMode.PAPER
2025-06-25 22:40:18,328 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1483571306768'>
2025-06-25 22:40:18,329 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 1209400f-2b92-45e5-a112-9b0d3acc845d
2025-06-25 22:40:18,331 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1483572837264'>
2025-06-25 22:40:18,333 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1209400f-2b92-45e5-a112-9b0d3acc845d, mode_filter: OperatingMode.PAPER
2025-06-25 22:40:18,333 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1483572837264'>
2025-06-25 22:40:18,333 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 1209400f-2b92-45e5-a112-9b0d3acc845d with mode_filter: OperatingMode.PAPER
2025-06-25 22:40:18,337 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1483572825616'>
2025-06-25 22:40:18,339 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1209400f-2b92-45e5-a112-9b0d3acc845d, mode_filter: OperatingMode.PAPER
2025-06-25 22:40:18,339 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1483572825616'>
2025-06-25 22:40:18,340 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 1209400f-2b92-45e5-a112-9b0d3acc845d with mode_filter: OperatingMode.PAPER
2025-06-25 22:40:18,343 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1483572342992'>
2025-06-25 22:40:18,344 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1209400f-2b92-45e5-a112-9b0d3acc845d, mode_filter: OperatingMode.PAPER
2025-06-25 22:40:18,344 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1483572342992'>
2025-06-25 22:40:18,345 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 1209400f-2b92-45e5-a112-9b0d3acc845d
2025-06-25 22:40:18,348 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1483572884432'>
2025-06-25 22:40:18,349 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1209400f-2b92-45e5-a112-9b0d3acc845d, mode_filter: OperatingMode.PAPER
2025-06-25 22:40:18,349 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1483572884432'>
2025-06-25 22:40:18,350 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 1209400f-2b92-45e5-a112-9b0d3acc845d
2025-06-25 22:40:18,353 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1483572339280'>
2025-06-25 22:40:18,355 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1209400f-2b92-45e5-a112-9b0d3acc845d, mode_filter: OperatingMode.PAPER
2025-06-25 22:40:18,355 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1483572339280'>
2025-06-25 22:40:18,355 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 1209400f-2b92-45e5-a112-9b0d3acc845d
2025-06-25 22:40:18,360 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1483570934160'>
2025-06-25 22:40:18,361 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 1209400f-2b92-45e5-a112-9b0d3acc845d, mode_filter: OperatingMode.PAPER
2025-06-25 22:40:18,361 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1483570934160'>
2025-06-25 22:40:18,362 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 1209400f-2b92-45e5-a112-9b0d3acc845d
2025-06-25 22:40:18,406 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario f9d1bcad-346c-4c1e-87a0-f36be5329545 en modo paper
2025-06-25 22:40:18,411 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario ff61075d-37a7-480c-96d8-972d18ac4f38 en modo paper
2025-06-25 22:40:18,416 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario f45d4e73-9b12-4d3f-a3a0-a01110ed268c en modo paper
2025-06-25 22:40:18,420 - ultibot_backend.services.trading_report_service - ERROR - [MainThread] - trading_report_service.py:79 - Error al obtener trades cerrados para usuario 69e2d0ce-79c2-48df-9990-7b5044b03271: Database connection failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_report_service.py", line 65, in get_closed_trades
    trades = await persistence_service.get_closed_trades(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
Exception: Database connection failed
2025-06-25 22:40:18,431 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 00be59cc-c2dc-4e9e-ab19-c7de0853c418 for symbol BTC/USDT
2025-06-25 22:40:18,432 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy db849b93-f544-4236-9d85-58c1b4fa3f17 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:40:18,432 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 00be59cc-c2dc-4e9e-ab19-c7de0853c418 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:40:18,433 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 00be59cc-c2dc-4e9e-ab19-c7de0853c418
2025-06-25 22:40:18,442 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 1f4d0ec1-ccec-44f9-bb37-e73bb0bc5a56 for symbol BTC/USDT
2025-06-25 22:40:18,443 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy c79d14cd-224c-4ef6-bc92-9f668352e789 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:40:18,444 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 1f4d0ec1-ccec-44f9-bb37-e73bb0bc5a56 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:40:18,445 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 1f4d0ec1-ccec-44f9-bb37-e73bb0bc5a56
2025-06-25 22:40:18,453 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity dd06e2fa-041f-424c-96db-272cb03e3a03 for symbol BTC/USDT
2025-06-25 22:40:18,455 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 7be06678-6a29-4a9f-b4e6-0d264cb17edb can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:40:18,455 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity dd06e2fa-041f-424c-96db-272cb03e3a03 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:40:18,456 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity dd06e2fa-041f-424c-96db-272cb03e3a03
2025-06-25 22:40:18,466 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity cb22471a-f15c-4285-bd4f-f2145b53f210 for symbol BTC/USDT
2025-06-25 22:40:18,468 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 5045c709-2031-4574-8786-bfca23cc9917 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:40:18,468 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity cb22471a-f15c-4285-bd4f-f2145b53f210 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:40:18,469 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity cb22471a-f15c-4285-bd4f-f2145b53f210
2025-06-25 22:40:18,480 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity be2303ed-37ea-4362-9d04-908dc3712e60 for symbol BTC/USDT
2025-06-25 22:40:18,481 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:653 - Unknown strategy type 'CUSTOM_UNKNOWN_TYPE' for strategy 7af0b556-56c7-431e-9293-d60258a0a36d. Recommending investigation.
2025-06-25 22:40:18,481 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity be2303ed-37ea-4362-9d04-908dc3712e60 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:40:18,482 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity be2303ed-37ea-4362-9d04-908dc3712e60
2025-06-25 22:40:18,491 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity 916c6cc4-f93e-4bc5-b64a-69eba531f079 for symbol BTC/USDT
2025-06-25 22:40:18,493 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy a457090d-9b13-4d98-8b8a-457605dcb23d can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:40:18,493 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity 916c6cc4-f93e-4bc5-b64a-69eba531f079 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:40:18,495 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity 916c6cc4-f93e-4bc5-b64a-69eba531f079
2025-06-25 22:40:18,516 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:571 - Processing opportunity e6bafa0f-3b7d-48ac-a2fa-87ca1899806a for symbol BTC/USDT
2025-06-25 22:40:18,517 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:724 - Strategy 35083395-62fb-43cd-927e-c0523858e268 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:40:18,518 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:535 - Updated opportunity e6bafa0f-3b7d-48ac-a2fa-87ca1899806a status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:40:18,518 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:542 - Persisted status update for opportunity e6bafa0f-3b7d-48ac-a2fa-87ca1899806a
2025-06-25 22:41:32,943 - ultibot_backend - INFO - [MainThread] - main.py:104 - Apagando UltiBot Backend (lifespan)...
2025-06-25 22:41:32,943 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:189 - Shutting down dependency container...
2025-06-25 22:41:32,949 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:40 - Redis client closed.
2025-06-25 22:41:32,949 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:196 - Dependency container shut down.
2025-06-25 22:41:32,949 - ultibot_backend - INFO - [MainThread] - main.py:107 - Recursos liberados y aplicación apagada (lifespan).
2025-06-25 22:41:37,346 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:41:37,347 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:41:37,365 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:41:37,365 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:41:37,367 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:41:37,367 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:41:37,367 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:41:37,369 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:41:37,369 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:41:37,407 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:41:37,579 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:41:37,580 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:41:37,752 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:41:37,757 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:41:37,757 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:41:37,758 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:41:37,771 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:41:37,771 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000019C55452890>
2025-06-25 22:41:37,771 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:41:37,772 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:41:37,772 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:41:42,140 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:41:42,141 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:41:42,161 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:41:42,162 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:41:42,162 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:41:42,164 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:41:42,164 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:41:42,164 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:41:42,164 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:41:42,201 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:41:42,373 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:41:42,374 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:41:42,546 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:41:42,550 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:41:42,551 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:41:42,551 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:41:42,563 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:41:42,563 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000154CFE809D0>
2025-06-25 22:41:42,564 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:41:42,564 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:41:42,564 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:45:47,916 - ultibot_backend - INFO - [MainThread] - main.py:104 - Apagando UltiBot Backend (lifespan)...
2025-06-25 22:45:47,916 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:189 - Shutting down dependency container...
2025-06-25 22:45:47,922 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:40 - Redis client closed.
2025-06-25 22:45:47,922 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:196 - Dependency container shut down.
2025-06-25 22:45:47,923 - ultibot_backend - INFO - [MainThread] - main.py:107 - Recursos liberados y aplicación apagada (lifespan).
2025-06-25 22:45:52,692 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:45:52,693 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:45:52,712 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:45:52,712 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:45:52,713 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:45:52,714 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:45:52,714 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:45:52,714 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:45:52,714 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:45:52,751 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:45:52,930 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:45:52,931 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:45:53,114 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:45:53,118 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:45:53,118 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:45:53,119 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:45:53,132 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:45:53,132 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001ED90C92450>
2025-06-25 22:45:53,133 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:45:53,133 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:45:53,133 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:46:09,402 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:46:09,402 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:46:09,421 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:46:09,421 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:46:09,581 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:46:09,582 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:46:09,603 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:46:09,603 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:46:10,295 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:46:10,296 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:46:10,317 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:46:10,332 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:46:10,334 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:46:10,337 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:46:10,338 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:46:10,346 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:46:10,347 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:46:10,365 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:46:10,368 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:46:10,369 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:46:10,376 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:46:10,376 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:46:10,395 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:46:10,397 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:46:10,398 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:46:10,405 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:46:10,406 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:46:10,425 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:46:10,428 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:46:10,430 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:46:10,437 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:46:10,437 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:46:10,457 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:46:10,459 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:46:10,460 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:46:10,468 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:46:10,468 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:46:10,486 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:46:10,487 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:46:10,487 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:46:10,489 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:46:10,489 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:46:10,489 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:46:10,508 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:46:10,683 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:46:10,685 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:46:10,866 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:46:10,867 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:10,867 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:10,868 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:46:10,883 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:46:10,885 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001881A635D90>
2025-06-25 22:46:10,885 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:46:10,885 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:46:10,886 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 422
2025-06-25 22:46:10,896 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:46:10,896 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:46:11,004 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:46:11,006 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:46:11,006 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:46:11,006 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:46:11,183 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:46:11,183 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:46:11,363 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:46:11,363 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:11,363 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:11,364 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:46:11,367 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:46:11,367 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001881A5C31D0>
2025-06-25 22:46:11,367 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:46:11,367 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:46:11,375 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:46:11,384 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:46:11,384 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:46:11,393 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:46:11,393 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:46:11,411 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:46:11,413 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:46:11,414 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:46:11,414 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:46:11,596 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:46:11,596 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:46:11,774 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:46:11,775 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:11,775 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:11,775 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:46:11,778 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:46:11,778 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001881A35C290>
2025-06-25 22:46:11,779 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:46:11,779 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:46:11,782 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:46:11,789 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:46:11,789 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:46:11,791 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:46:11,797 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:46:11,797 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:46:11,798 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:46:11,798 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:46:11,807 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:46:11,808 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:46:11,827 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:46:11,828 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:46:11,829 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:46:11,829 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:46:12,006 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:46:12,006 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:46:12,189 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:46:12,189 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:12,190 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:12,190 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:46:12,193 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:46:12,194 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001881A5F1AD0>
2025-06-25 22:46:12,194 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:46:12,194 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:46:12,199 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:46:12,206 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:46:12,208 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:46:12,209 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:46:12,216 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:46:12,216 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:46:12,225 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:46:12,226 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:46:12,244 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:46:12,245 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:46:12,246 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:46:12,246 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:46:12,420 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:46:12,421 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:46:12,599 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:46:12,600 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:12,600 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:12,600 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:46:12,603 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:46:12,604 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000188178BFE10>
2025-06-25 22:46:12,604 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:46:12,604 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:46:12,608 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:46:12,615 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:46:12,616 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:46:12,616 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:46:12,621 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:46:12,623 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:46:12,631 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:46:12,631 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:46:12,650 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:46:12,653 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:46:12,654 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:46:12,655 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:46:12,830 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:46:12,831 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:46:13,013 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:46:13,013 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:13,013 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:13,013 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:46:13,016 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:46:13,016 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001881A35ED50>
2025-06-25 22:46:13,016 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:46:13,016 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:46:13,017 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 422
2025-06-25 22:46:13,034 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity a692722e-2a5d-4e05-b1f2-6ee1acb141ff
2025-06-25 22:46:13,036 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:152 - User configuration saved after initializing last_daily_reset for user 6f7b186d-8c6f-4925-b41e-76e6d24adbc1.
2025-06-25 22:46:13,036 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 200.000
2025-06-25 22:46:13,036 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity a692722e-2a5d-4e05-b1f2-6ee1acb141ff
2025-06-25 22:46:13,036 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:46:13,038 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 104f5acb-26fa-4ad4-8c8f-0155f9380983 from decision e44d53bc-500e-4762-8de8-f98c7dcc105d
2025-06-25 22:46:13,038 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 104f5acb-26fa-4ad4-8c8f-0155f9380983 from confirmed opportunity.
2025-06-25 22:46:13,039 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:46:13,039 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:310 - Successfully created OCO order for trade 104f5acb-26fa-4ad4-8c8f-0155f9380983. OCO List ID: oco_list_123
2025-06-25 22:46:13,040 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 6f7b186d-8c6f-4925-b41e-76e6d24adbc1: 200.0000000000000000000000000 (anterior: 0.0, valor trade: 200.0000000000000000000000000)
2025-06-25 22:46:13,040 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user 6f7b186d-8c6f-4925-b41e-76e6d24adbc1 to 200.0000000000000000000000000.
2025-06-25 22:46:13,041 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity a692722e-2a5d-4e05-b1f2-6ee1acb141ff status to converted_to_trade_real: Trade 104f5acb-26fa-4ad4-8c8f-0155f9380983 executed based on user confirmation.
2025-06-25 22:46:13,042 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity a692722e-2a5d-4e05-b1f2-6ee1acb141ff
2025-06-25 22:46:13,052 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 77cbf63b-f065-42da-b8ed-d24d9b15bdcb
2025-06-25 22:46:13,052 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 4800.0, Riesgo Potencial Trade USD: 300.000
2025-06-25 22:46:13,052 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:191 - Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:46:13,053 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 77cbf63b-f065-42da-b8ed-d24d9b15bdcb status to error_in_processing: Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:46:13,053 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 77cbf63b-f065-42da-b8ed-d24d9b15bdcb
2025-06-25 22:46:13,065 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity c4ae8a01-ecb3-4ec0-9e85-c60e29c5e75f
2025-06-25 22:46:13,066 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:143 - Daily capital reset triggered for user 0b5f8612-110b-4d95-bc35-9ae5ce5da124. Resetting daily_capital_risked_usd.
2025-06-25 22:46:13,066 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:147 - User configuration saved after daily capital reset for user 0b5f8612-110b-4d95-bc35-9ae5ce5da124.
2025-06-25 22:46:13,067 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 2500.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 100.000
2025-06-25 22:46:13,067 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity c4ae8a01-ecb3-4ec0-9e85-c60e29c5e75f
2025-06-25 22:46:13,067 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:46:13,067 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade b289983f-c237-4f62-9990-1f66c1916371 from decision 85e849d1-b8f2-497c-965d-1b34170d37cb
2025-06-25 22:46:13,069 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade b289983f-c237-4f62-9990-1f66c1916371 from confirmed opportunity.
2025-06-25 22:46:13,071 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:46:13,071 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:310 - Successfully created OCO order for trade b289983f-c237-4f62-9990-1f66c1916371. OCO List ID: oco_reset_test
2025-06-25 22:46:13,072 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 0b5f8612-110b-4d95-bc35-9ae5ce5da124: 100.000 (anterior: 0.0, valor trade: 100.000)
2025-06-25 22:46:13,072 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user 0b5f8612-110b-4d95-bc35-9ae5ce5da124 to 100.000.
2025-06-25 22:46:13,072 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity c4ae8a01-ecb3-4ec0-9e85-c60e29c5e75f status to converted_to_trade_real: Trade b289983f-c237-4f62-9990-1f66c1916371 executed based on user confirmation.
2025-06-25 22:46:13,073 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity c4ae8a01-ecb3-4ec0-9e85-c60e29c5e75f
2025-06-25 22:46:13,088 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:46:13,089 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:46:13,106 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:46:13,108 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 22:46:13,109 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:46:13,109 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:46:13,285 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:46:13,286 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:46:13,463 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:46:13,464 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:13,464 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:13,464 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:46:13,468 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:46:13,468 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001881A37DE50>
2025-06-25 22:46:13,468 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:46:13,468 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:46:13,469 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 22:46:13,473 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"a3b35825-3b71-4192-902d-201ccdc59df2","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:46:13.080029Z","submittedAt":"2025-06-26T02:46:13.080029Z","fillTimestamp":"2025-06-26T02:46:13.080029Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:46:13.080029Z","opened_at":"2025-06-26T02:46:13.080029Z","updated_at":"2025-06-26T02:46:13.080029Z","closed_at":"2025-06-26T02:46:13.080029Z"}
2025-06-25 22:46:13,473 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': 'a3b35825-3b71-4192-902d-201ccdc59df2', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:46:13.080029Z', 'submittedAt': '2025-06-26T02:46:13.080029Z', 'fillTimestamp': '2025-06-26T02:46:13.080029Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:46:13.080029Z', 'opened_at': '2025-06-26T02:46:13.080029Z', 'updated_at': '2025-06-26T02:46:13.080029Z', 'closed_at': '2025-06-26T02:46:13.080029Z'}
2025-06-25 22:46:13,474 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"496158b4-cfa1-43c3-a2fe-738cdd195b8d","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:46:13.080029Z","submittedAt":"2025-06-26T02:46:13.080029Z","fillTimestamp":"2025-06-26T02:46:13.080029Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:46:13.080029Z","opened_at":"2025-06-26T02:46:13.080029Z","updated_at":"2025-06-26T02:46:13.080029Z","closed_at":"2025-06-26T02:46:13.080029Z"}
2025-06-25 22:46:13,474 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': '496158b4-cfa1-43c3-a2fe-738cdd195b8d', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:46:13.080029Z', 'submittedAt': '2025-06-26T02:46:13.080029Z', 'fillTimestamp': '2025-06-26T02:46:13.080029Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:46:13.080029Z', 'opened_at': '2025-06-26T02:46:13.080029Z', 'updated_at': '2025-06-26T02:46:13.080029Z', 'closed_at': '2025-06-26T02:46:13.080029Z'}
2025-06-25 22:46:13,474 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"a00b6445-4a2e-4366-ab06-4497c76b452f","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:46:13.080029Z","submittedAt":"2025-06-26T02:46:13.080029Z","fillTimestamp":"2025-06-26T02:46:13.080029Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:46:13.080029Z","opened_at":"2025-06-26T02:46:13.080029Z","updated_at":"2025-06-26T02:46:13.080029Z","closed_at":"2025-06-26T02:46:13.080029Z"}
2025-06-25 22:46:13,474 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': 'a00b6445-4a2e-4366-ab06-4497c76b452f', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:46:13.080029Z', 'submittedAt': '2025-06-26T02:46:13.080029Z', 'fillTimestamp': '2025-06-26T02:46:13.080029Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:46:13.080029Z', 'opened_at': '2025-06-26T02:46:13.080029Z', 'updated_at': '2025-06-26T02:46:13.080029Z', 'closed_at': '2025-06-26T02:46:13.080029Z'}
2025-06-25 22:46:13,475 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 3
2025-06-25 22:46:13,475 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:46:13,476 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 22:46:13,493 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:46:13,493 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:46:13,511 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:46:13,513 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 22:46:13,514 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:46:13,514 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:46:13,701 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:46:13,701 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:46:13,875 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:46:13,875 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:13,876 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:13,876 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:46:13,880 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:46:13,881 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001881B909AD0>
2025-06-25 22:46:13,881 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:46:13,881 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:46:13,881 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: BTCUSDT, start_date: None, end_date: None
2025-06-25 22:46:13,887 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"0e3c7db0-a63f-4f5c-8b14-2813550d86bd","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:46:13.485548Z","submittedAt":"2025-06-26T02:46:13.485548Z","fillTimestamp":"2025-06-26T02:46:13.485548Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:46:13.485548Z","opened_at":"2025-06-26T02:46:13.485548Z","updated_at":"2025-06-26T02:46:13.485548Z","closed_at":"2025-06-26T02:46:13.485548Z"}
2025-06-25 22:46:13,887 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '0e3c7db0-a63f-4f5c-8b14-2813550d86bd', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:46:13.485548Z', 'submittedAt': '2025-06-26T02:46:13.485548Z', 'fillTimestamp': '2025-06-26T02:46:13.485548Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:46:13.485548Z', 'opened_at': '2025-06-26T02:46:13.485548Z', 'updated_at': '2025-06-26T02:46:13.485548Z', 'closed_at': '2025-06-26T02:46:13.485548Z'}
2025-06-25 22:46:13,887 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 1
2025-06-25 22:46:13,887 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 1 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:46:13,888 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 22:46:13,906 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:46:13,906 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:46:13,925 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:46:13,927 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 22:46:13,927 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:46:13,928 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:46:14,105 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:46:14,106 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:46:14,283 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:46:14,283 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:14,283 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:14,284 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:46:14,286 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:46:14,287 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001881A72A390>
2025-06-25 22:46:14,287 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:46:14,288 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:46:14,289 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 22:46:14,292 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"0fbe4eeb-8c99-42da-a2c4-1828c096aec8","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:46:13.898298Z","submittedAt":"2025-06-26T02:46:13.898298Z","fillTimestamp":"2025-06-26T02:46:13.898298Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:46:13.898298Z","opened_at":"2025-06-26T02:46:13.898298Z","updated_at":"2025-06-26T02:46:13.898298Z","closed_at":"2025-06-26T02:46:13.898298Z"}
2025-06-25 22:46:14,292 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '0fbe4eeb-8c99-42da-a2c4-1828c096aec8', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:46:13.898298Z', 'submittedAt': '2025-06-26T02:46:13.898298Z', 'fillTimestamp': '2025-06-26T02:46:13.898298Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:46:13.898298Z', 'opened_at': '2025-06-26T02:46:13.898298Z', 'updated_at': '2025-06-26T02:46:13.898298Z', 'closed_at': '2025-06-26T02:46:13.898298Z'}
2025-06-25 22:46:14,292 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"fba3f13c-1189-431f-b7a7-ef133e6959ad","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:46:13.898298Z","submittedAt":"2025-06-26T02:46:13.898298Z","fillTimestamp":"2025-06-26T02:46:13.898298Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:46:13.898298Z","opened_at":"2025-06-26T02:46:13.898298Z","updated_at":"2025-06-26T02:46:13.898298Z","closed_at":"2025-06-26T02:46:13.898298Z"}
2025-06-25 22:46:14,294 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': 'fba3f13c-1189-431f-b7a7-ef133e6959ad', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:46:13.898298Z', 'submittedAt': '2025-06-26T02:46:13.898298Z', 'fillTimestamp': '2025-06-26T02:46:13.898298Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:46:13.898298Z', 'opened_at': '2025-06-26T02:46:13.898298Z', 'updated_at': '2025-06-26T02:46:13.898298Z', 'closed_at': '2025-06-26T02:46:13.898298Z'}
2025-06-25 22:46:14,294 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:518 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"e2203603-2cf4-4307-963a-c2d69531e78a","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:46:13.898298Z","submittedAt":"2025-06-26T02:46:13.898298Z","fillTimestamp":"2025-06-26T02:46:13.898298Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:46:13.898298Z","opened_at":"2025-06-26T02:46:13.898298Z","updated_at":"2025-06-26T02:46:13.898298Z","closed_at":"2025-06-26T02:46:13.898298Z"}
2025-06-25 22:46:14,294 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': 'e2203603-2cf4-4307-963a-c2d69531e78a', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:46:13.898298Z', 'submittedAt': '2025-06-26T02:46:13.898298Z', 'fillTimestamp': '2025-06-26T02:46:13.898298Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:46:13.898298Z', 'opened_at': '2025-06-26T02:46:13.898298Z', 'updated_at': '2025-06-26T02:46:13.898298Z', 'closed_at': '2025-06-26T02:46:13.898298Z'}
2025-06-25 22:46:14,295 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 3
2025-06-25 22:46:14,295 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:46:14,295 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 22:46:14,312 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:46:14,312 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:46:14,329 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:46:14,331 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 22:46:14,332 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:46:14,332 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:46:14,508 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:46:14,508 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:46:14,686 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:46:14,686 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:14,686 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:14,686 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:46:14,689 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:46:14,690 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001881B983810>
2025-06-25 22:46:14,690 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:46:14,690 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:46:14,690 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:496 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: 2025-06-27 02:46:14.331916+00:00, end_date: None
2025-06-25 22:46:14,695 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:546 - get_closed_trades - Trades recuperados: 0
2025-06-25 22:46:14,695 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:46:14,696 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 22:46:14,741 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 2fe6eb6b-9fb3-4661-a58a-f90dab1d5f2e for symbol BTCUSDT
2025-06-25 22:46:14,741 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 04a31811-b693-4eb4-acbc-18890d778f5b
2025-06-25 22:46:14,742 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy 9cfadd53-0323-4c60-95f7-7ce73911a08f can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:46:14,752 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity bfdaf1d3-7b99-4de8-b62e-387a9cbfd596 for symbol BTCUSDT
2025-06-25 22:46:14,752 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy 268c2033-4f80-4876-b5e1-4eb289a5e6ad can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:46:14,758 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity ee78998d-0412-42e8-9f0b-eeb57f4df49b for symbol ETHUSDT
2025-06-25 22:46:14,759 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 1cd09519-83ed-4418-85de-0f0604189397
2025-06-25 22:46:14,760 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:610 - No active and applicable strategies found for opportunity ee78998d-0412-42e8-9f0b-eeb57f4df49b with symbol ETHUSDT.
2025-06-25 22:46:14,761 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity ee78998d-0412-42e8-9f0b-eeb57f4df49b status to rejected_by_system: No active strategies are applicable to this opportunity's symbol.
2025-06-25 22:46:14,762 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity ee78998d-0412-42e8-9f0b-eeb57f4df49b
2025-06-25 22:46:14,770 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity e464424f-5aa8-4447-b61e-e44bf1429f73 for symbol BTCUSDT
2025-06-25 22:46:14,771 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 93364c53-d98f-4327-9374-85dd44c5f7bb
2025-06-25 22:46:14,771 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:723 - AI confidence 0.65 for strategy 14099c25-83a9-4d79-857b-3842f8f8a905 is below threshold 0.8.
2025-06-25 22:46:14,772 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:738 - Strategy 14099c25-83a9-4d79-857b-3842f8f8a905 did not produce a decision for opportunity e464424f-5aa8-4447-b61e-e44bf1429f73.
2025-06-25 22:46:14,773 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:629 - No affirmative trading decisions made for opportunity e464424f-5aa8-4447-b61e-e44bf1429f73.
2025-06-25 22:46:14,782 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 31bb6a97-1131-4c5b-b7c7-bf35fa70aec6 for symbol BTCUSDT
2025-06-25 22:46:14,782 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 52dbc422-5e05-487f-b19f-7e9a2df40133
2025-06-25 22:46:14,790 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 70acd2d2-e3cd-4875-ae6c-4c5622631e46 for symbol BTCUSDT
2025-06-25 22:46:14,791 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 4b4182d6-1112-4922-ba16-4ec6c685f040
2025-06-25 22:46:14,798 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:46:14,799 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 126ced9b-cf56-463c-9add-c2bf8e0387b7 from decision eb63f7e4-e566-411e-9693-b24dc487e192
2025-06-25 22:46:14,804 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:46:14,804 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade e2f8c141-369a-42b2-a189-60bcf5ba8a22 from decision 95f5fc65-76b9-4a3f-9081-50e3625ea10e
2025-06-25 22:46:14,805 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: sell
2025-06-25 22:46:14,805 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 5f2d8919-676f-457d-bb4b-7e2bd1ee156c from decision 95f5fc65-76b9-4a3f-9081-50e3625ea10e
2025-06-25 22:46:14,811 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:14,811 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:14,820 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:46:14,821 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:46:14,824 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:46:14,825 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 19b7d8de-602a-4bce-a57c-830b74eb8cd6
2025-06-25 22:46:14,829 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 73c22990-ffab-4734-a0da-6d6e60dd7cb4. Creando y guardando configuración por defecto.
2025-06-25 22:46:14,831 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:46:14,834 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 73c22990-ffab-4734-a0da-6d6e60dd7cb4. Using default values.
2025-06-25 22:46:14,834 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 73c22990-ffab-4734-a0da-6d6e60dd7cb4 with capital: 10000.0
2025-06-25 22:46:14,835 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:46:14,836 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:46:14,836 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:46:14,837 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity 19b7d8de-602a-4bce-a57c-830b74eb8cd6
2025-06-25 22:46:14,837 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:46:14,837 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 3b8c8029-600d-4ca4-b4b1-96837633a3b5 from decision 67f37e46-cceb-494f-93b0-f53409821440
2025-06-25 22:46:14,839 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 3b8c8029-600d-4ca4-b4b1-96837633a3b5 from confirmed opportunity.
2025-06-25 22:46:14,840 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:46:14,840 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('8e011581-6bc7-454d-934c-2da127eed978') orderId_exchange='mock_exchange_oco_id_002cd610-a37a-47f8-911b-3bafc9814f39' clientOrderId_exchange='mock_client_oco_id_eda20390-06f8-4937-91c9-aa43e077287c' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 46, 14, 840891) submittedAt=datetime.datetime(2025, 6, 26, 2, 46, 14, 840891, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 46, 14, 840891, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 76417828811011968261122927403693254833, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_74c66efe-f786-47ea-a752-b4e01b5b5b77', 'transactionTime': 1750905974840, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='76417828811011968261122927403693254833' price=None stopPrice=None timeInForce=None
2025-06-25 22:46:14,840 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 73c22990-ffab-4734-a0da-6d6e60dd7cb4: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:46:14,843 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('3b8c8029-600d-4ca4-b4b1-96837633a3b5'), 'dc7d02c6-a998-483d-acee-c8fee24c5917', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:46:14.837896', '2025-06-26 02:46:14.837896', None, '{"id":"3b8c8029-600d-4ca4-b4b1-96837633a3b5","user_id":"dc7d02c6-a998-483d-acee-c8fee24c5917","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:46:14.837896","opened_at":"2025-06-26T02:46:14.837896","updated_at":"2025-06-26T02:46:14.837896","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('3b8c8029-600d-4ca4-b4b1-96837633a3b5'), 'dc7d02c6-a998-483d-acee-c8fee24c5917', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:46:14.837896', '2025-06-26 02:46:14.837896', None, '{"id":"3b8c8029-600d-4ca4-b4b1-96837633a3b5","user_id":"dc7d02c6-a998-483d-acee-c8fee24c5917","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:46:14.837896","opened_at":"2025-06-26T02:46:14.837896","updated_at":"2025-06-26T02:46:14.837896","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:46:14,851 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 19b7d8de-602a-4bce-a57c-830b74eb8cd6: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('3b8c8029-600d-4ca4-b4b1-96837633a3b5'), 'dc7d02c6-a998-483d-acee-c8fee24c5917', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:46:14.837896', '2025-06-26 02:46:14.837896', None, '{"id":"3b8c8029-600d-4ca4-b4b1-96837633a3b5","user_id":"dc7d02c6-a998-483d-acee-c8fee24c5917","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:46:14.837896","opened_at":"2025-06-26T02:46:14.837896","updated_at":"2025-06-26T02:46:14.837896","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:46:14,854 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 19b7d8de-602a-4bce-a57c-830b74eb8cd6 status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:46:14,854 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:550 - Failed to persist status update for opportunity 19b7d8de-602a-4bce-a57c-830b74eb8cd6: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('3b8c8029-600d-4ca4-b4b1-96837633a3b5'), 'dc7d02c6-a998-483d-acee-c8fee24c5917', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:46:14.837896', '2025-06-26 02:46:14.837896', None, '{"id":"3b8c8029-600d-4ca4-b4b1-96837633a3b5","user_id":"dc7d02c6-a998-483d-acee-c8fee24c5917","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:46:14.837896","opened_at":"2025-06-26T02:46:14.837896","updated_at":"2025-06-26T02:46:14.837896","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 543, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('3b8c8029-600d-4ca4-b4b1-96837633a3b5'), 'dc7d02c6-a998-483d-acee-c8fee24c5917', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:46:14.837896', '2025-06-26 02:46:14.837896', None, '{"id":"3b8c8029-600d-4ca4-b4b1-96837633a3b5","user_id":"dc7d02c6-a998-483d-acee-c8fee24c5917","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1207 characters truncated) ... ts":[],"created_at":"2025-06-26T02:46:14.837896","opened_at":"2025-06-26T02:46:14.837896","updated_at":"2025-06-26T02:46:14.837896","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:46:15,146 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:46:15,147 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:46:15,154 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:15,154 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:15,162 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:46:15,164 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:46:15,166 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:46:15,168 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:46:15,169 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:46:15,176 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:15,176 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:15,185 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:46:15,186 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:46:15,188 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:46:15,189 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity f6912e05-661f-45f1-b1d9-7921e2a8a140 for symbol BTC/USDT
2025-06-25 22:46:15,192 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 3c8dfc8c-c1f8-45a5-b488-b0812190f9af. Creando y guardando configuración por defecto.
2025-06-25 22:46:15,196 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:46:15,197 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:678 - AI profile 'ai-profile-scalping-1' for strategy 008bcd85-00f2-465c-85c8-5214a54e6829 not found. Skipping AI analysis.
2025-06-25 22:46:15,198 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy 008bcd85-00f2-465c-85c8-5214a54e6829 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:46:15,198 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity f6912e05-661f-45f1-b1d9-7921e2a8a140 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:46:15,205 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity f6912e05-661f-45f1-b1d9-7921e2a8a140
2025-06-25 22:46:15,206 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:46:15,207 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:46:15,216 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:15,216 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:15,223 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:46:15,223 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:46:15,226 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:46:15,228 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 993d3f90-4945-47b7-b196-770a779fce76
2025-06-25 22:46:15,232 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id ed574435-6f4f-498b-a1d2-3a0a7daa0932. Creando y guardando configuración por defecto.
2025-06-25 22:46:15,235 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:46:15,238 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for ed574435-6f4f-498b-a1d2-3a0a7daa0932. Using default values.
2025-06-25 22:46:15,238 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for ed574435-6f4f-498b-a1d2-3a0a7daa0932 with capital: 10000.0
2025-06-25 22:46:15,239 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:46:15,240 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:46:15,240 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:46:15,240 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Autonomous Scalping' as context for confirmed opportunity 993d3f90-4945-47b7-b196-770a779fce76
2025-06-25 22:46:15,240 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:46:15,241 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 753ad254-3f29-481b-8170-787e8bdbd9db from decision 634c4439-6e03-4550-9418-ed7e04b0048c
2025-06-25 22:46:15,241 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 753ad254-3f29-481b-8170-787e8bdbd9db from confirmed opportunity.
2025-06-25 22:46:15,242 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:46:15,243 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('d9becba9-70eb-4a04-8045-eb156757478f') orderId_exchange='mock_exchange_oco_id_29685426-64e1-43e1-ba31-ae8df9d599f9' clientOrderId_exchange='mock_client_oco_id_47edf55b-d9d0-4429-b5ba-eaee88edaa24' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 46, 15, 243102) submittedAt=datetime.datetime(2025, 6, 26, 2, 46, 15, 243102, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 46, 15, 243102, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 128595301424828964683701939297768435764, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_ba9be6c6-2065-453d-a274-0d0eb4610f84', 'transactionTime': 1750905975243, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='128595301424828964683701939297768435764' price=None stopPrice=None timeInForce=None
2025-06-25 22:46:15,243 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario ed574435-6f4f-498b-a1d2-3a0a7daa0932: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:46:15,246 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('753ad254-3f29-481b-8170-787e8bdbd9db'), '814e8e46-00ab-4c0c-b29f-fa82053d2ec6', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:46:15.241101', '2025-06-26 02:46:15.241101', None, '{"id":"753ad254-3f29-481b-8170-787e8bdbd9db","user_id":"814e8e46-00ab-4c0c-b29f-fa82053d2ec6","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:46:15.241101","opened_at":"2025-06-26T02:46:15.241101","updated_at":"2025-06-26T02:46:15.241101","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('753ad254-3f29-481b-8170-787e8bdbd9db'), '814e8e46-00ab-4c0c-b29f-fa82053d2ec6', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:46:15.241101', '2025-06-26 02:46:15.241101', None, '{"id":"753ad254-3f29-481b-8170-787e8bdbd9db","user_id":"814e8e46-00ab-4c0c-b29f-fa82053d2ec6","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:46:15.241101","opened_at":"2025-06-26T02:46:15.241101","updated_at":"2025-06-26T02:46:15.241101","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:46:15,248 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 993d3f90-4945-47b7-b196-770a779fce76: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('753ad254-3f29-481b-8170-787e8bdbd9db'), '814e8e46-00ab-4c0c-b29f-fa82053d2ec6', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:46:15.241101', '2025-06-26 02:46:15.241101', None, '{"id":"753ad254-3f29-481b-8170-787e8bdbd9db","user_id":"814e8e46-00ab-4c0c-b29f-fa82053d2ec6","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:46:15.241101","opened_at":"2025-06-26T02:46:15.241101","updated_at":"2025-06-26T02:46:15.241101","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:46:15,250 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 993d3f90-4945-47b7-b196-770a779fce76 status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:46:15,250 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:550 - Failed to persist status update for opportunity 993d3f90-4945-47b7-b196-770a779fce76: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('753ad254-3f29-481b-8170-787e8bdbd9db'), '814e8e46-00ab-4c0c-b29f-fa82053d2ec6', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:46:15.241101', '2025-06-26 02:46:15.241101', None, '{"id":"753ad254-3f29-481b-8170-787e8bdbd9db","user_id":"814e8e46-00ab-4c0c-b29f-fa82053d2ec6","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:46:15.241101","opened_at":"2025-06-26T02:46:15.241101","updated_at":"2025-06-26T02:46:15.241101","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 543, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('753ad254-3f29-481b-8170-787e8bdbd9db'), '814e8e46-00ab-4c0c-b29f-fa82053d2ec6', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:46:15.241101', '2025-06-26 02:46:15.241101', None, '{"id":"753ad254-3f29-481b-8170-787e8bdbd9db","user_id":"814e8e46-00ab-4c0c-b29f-fa82053d2ec6","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:46:15.241101","opened_at":"2025-06-26T02:46:15.241101","updated_at":"2025-06-26T02:46:15.241101","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:46:15,260 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:46:15,261 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:46:15,269 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:15,270 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:15,277 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:46:15,278 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:46:15,280 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:46:15,282 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 771860c3-1c17-4ed5-973d-db20f62f83c7
2025-06-25 22:46:15,285 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 2b849442-f70c-4e78-b3ae-6396fa7754df. Creando y guardando configuración por defecto.
2025-06-25 22:46:15,288 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:46:15,290 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 2b849442-f70c-4e78-b3ae-6396fa7754df. Using default values.
2025-06-25 22:46:15,290 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 2b849442-f70c-4e78-b3ae-6396fa7754df with capital: 10000.0
2025-06-25 22:46:15,291 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:46:15,292 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:46:15,292 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:46:15,292 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity 771860c3-1c17-4ed5-973d-db20f62f83c7
2025-06-25 22:46:15,294 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:46:15,294 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade e624cfa2-c15a-44a5-bf55-f15dc925895a from decision f1108cd6-84c4-4b09-9698-ae5a8aa01e95
2025-06-25 22:46:15,295 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade e624cfa2-c15a-44a5-bf55-f15dc925895a from confirmed opportunity.
2025-06-25 22:46:15,296 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:46:15,296 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('e591aedd-86d6-4d20-b296-461db2682c53') orderId_exchange='mock_exchange_oco_id_6cf96c7b-2c34-46ff-9350-50ee378be812' clientOrderId_exchange='mock_client_oco_id_1d5aa1f3-1cb5-4060-90e8-bdd1e2e85382' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 46, 15, 296077) submittedAt=datetime.datetime(2025, 6, 26, 2, 46, 15, 296077, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 46, 15, 296077, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 110685451911394832374349146901851404930, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_ae08b34d-e00e-4e94-91e8-05cb3846b176', 'transactionTime': 1750905975296, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='110685451911394832374349146901851404930' price=None stopPrice=None timeInForce=None
2025-06-25 22:46:15,297 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 2b849442-f70c-4e78-b3ae-6396fa7754df: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:46:15,300 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('e624cfa2-c15a-44a5-bf55-f15dc925895a'), '9e262e66-1e30-4d01-a060-6dbb54ce8e32', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:46:15.294071', '2025-06-26 02:46:15.294071', None, '{"id":"e624cfa2-c15a-44a5-bf55-f15dc925895a","user_id":"9e262e66-1e30-4d01-a060-6dbb54ce8e32","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:46:15.294071","opened_at":"2025-06-26T02:46:15.294071","updated_at":"2025-06-26T02:46:15.294071","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('e624cfa2-c15a-44a5-bf55-f15dc925895a'), '9e262e66-1e30-4d01-a060-6dbb54ce8e32', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:46:15.294071', '2025-06-26 02:46:15.294071', None, '{"id":"e624cfa2-c15a-44a5-bf55-f15dc925895a","user_id":"9e262e66-1e30-4d01-a060-6dbb54ce8e32","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:46:15.294071","opened_at":"2025-06-26T02:46:15.294071","updated_at":"2025-06-26T02:46:15.294071","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:46:15,302 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 771860c3-1c17-4ed5-973d-db20f62f83c7: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('e624cfa2-c15a-44a5-bf55-f15dc925895a'), '9e262e66-1e30-4d01-a060-6dbb54ce8e32', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:46:15.294071', '2025-06-26 02:46:15.294071', None, '{"id":"e624cfa2-c15a-44a5-bf55-f15dc925895a","user_id":"9e262e66-1e30-4d01-a060-6dbb54ce8e32","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:46:15.294071","opened_at":"2025-06-26T02:46:15.294071","updated_at":"2025-06-26T02:46:15.294071","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:46:15,304 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 771860c3-1c17-4ed5-973d-db20f62f83c7 status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:46:15,305 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:550 - Failed to persist status update for opportunity 771860c3-1c17-4ed5-973d-db20f62f83c7: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('e624cfa2-c15a-44a5-bf55-f15dc925895a'), '9e262e66-1e30-4d01-a060-6dbb54ce8e32', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:46:15.294071', '2025-06-26 02:46:15.294071', None, '{"id":"e624cfa2-c15a-44a5-bf55-f15dc925895a","user_id":"9e262e66-1e30-4d01-a060-6dbb54ce8e32","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:46:15.294071","opened_at":"2025-06-26T02:46:15.294071","updated_at":"2025-06-26T02:46:15.294071","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 543, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('e624cfa2-c15a-44a5-bf55-f15dc925895a'), '9e262e66-1e30-4d01-a060-6dbb54ce8e32', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:46:15.294071', '2025-06-26 02:46:15.294071', None, '{"id":"e624cfa2-c15a-44a5-bf55-f15dc925895a","user_id":"9e262e66-1e30-4d01-a060-6dbb54ce8e32","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1206 characters truncated) ... ts":[],"created_at":"2025-06-26T02:46:15.294071","opened_at":"2025-06-26T02:46:15.294071","updated_at":"2025-06-26T02:46:15.294071","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:46:15,314 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:46:15,315 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:46:15,323 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:15,323 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:15,331 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:46:15,332 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:46:15,334 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:46:15,336 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity d0777f4a-204e-4afa-975f-16e1de6772c0
2025-06-25 22:46:15,338 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 71f40079-9fa7-422d-a115-08a655053ff9. Creando y guardando configuración por defecto.
2025-06-25 22:46:15,341 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:46:15,343 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 71f40079-9fa7-422d-a115-08a655053ff9. Using default values.
2025-06-25 22:46:15,343 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 71f40079-9fa7-422d-a115-08a655053ff9 with capital: 10000.0
2025-06-25 22:46:15,344 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:46:15,345 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:46:15,346 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:46:15,346 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Day Trading Strategy' as context for confirmed opportunity d0777f4a-204e-4afa-975f-16e1de6772c0
2025-06-25 22:46:15,346 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:46:15,346 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade eee0427c-74ba-414a-afa5-0b7816281d19 from decision 4815df2e-a4a8-411f-921d-555eefbf6bc5
2025-06-25 22:46:15,348 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade eee0427c-74ba-414a-afa5-0b7816281d19 from confirmed opportunity.
2025-06-25 22:46:15,349 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:46:15,349 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('09181560-08fe-4889-98b8-c007463efbff') orderId_exchange='mock_exchange_oco_id_e99b0912-fe3d-4f0e-846d-eb3831da6727' clientOrderId_exchange='mock_client_oco_id_2d7b8f19-da97-44b4-866f-60707231ae37' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 46, 15, 349110) submittedAt=datetime.datetime(2025, 6, 26, 2, 46, 15, 349110, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 46, 15, 349110, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 145790684291158130304591877294003867908, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_b1b62b7d-2c81-45b6-b4ba-ef29bd2c58bd', 'transactionTime': 1750905975349, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='145790684291158130304591877294003867908' price=None stopPrice=None timeInForce=None
2025-06-25 22:46:15,350 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 71f40079-9fa7-422d-a115-08a655053ff9: 0.0000 (anterior: 0.0, valor trade: 0.0000)
2025-06-25 22:46:15,352 - ultibot_backend.services.config_service - ERROR - [MainThread] - config_service.py:120 - Error al guardar la configuración: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('eee0427c-74ba-414a-afa5-0b7816281d19'), '353eda04-f8ca-4c71-ab46-a14f3d46a45d', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:46:15.346591', '2025-06-26 02:46:15.346591', None, '{"id":"eee0427c-74ba-414a-afa5-0b7816281d19","user_id":"353eda04-f8ca-4c71-ab46-a14f3d46a45d","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:46:15.346591","opened_at":"2025-06-26T02:46:15.346591","updated_at":"2025-06-26T02:46:15.346591","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('eee0427c-74ba-414a-afa5-0b7816281d19'), '353eda04-f8ca-4c71-ab46-a14f3d46a45d', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:46:15.346591', '2025-06-26 02:46:15.346591', None, '{"id":"eee0427c-74ba-414a-afa5-0b7816281d19","user_id":"353eda04-f8ca-4c71-ab46-a14f3d46a45d","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:46:15.346591","opened_at":"2025-06-26T02:46:15.346591","updated_at":"2025-06-26T02:46:15.346591","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2025-06-25 22:46:15,354 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity d0777f4a-204e-4afa-975f-16e1de6772c0: No se pudo guardar la configuración.
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlite3.IntegrityError: NOT NULL constraint failed: trades.side

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 116, in save_user_configuration
    await self.persistence_service.upsert_user_configuration(config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 287, in upsert_user_configuration
    result = await session.execute(
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 577, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3065, in _autoflush
    raise e.with_traceback(sys.exc_info()[2])
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4480, in _flush
    with util.safe_reraise():
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4441, in _flush
    flush_context.execute()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 466, in execute
    rec.execute(self)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\persistence.py", line 1048, in _emit_insert_statements
    result = connection.execute(
             ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1415, in execute
    return meth(
           ^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 523, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1637, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1842, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1982, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2351, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1963, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 943, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 149, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 300, in _handle_exception
    raise error
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 131, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 132, in await_only
    return current.parent.switch(awaitable)  # type: ignore[no-any-return,attr-defined] # noqa: E501
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 196, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 122, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\aiosqlite\core.py", line 105, in run
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.IntegrityError: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('eee0427c-74ba-414a-afa5-0b7816281d19'), '353eda04-f8ca-4c71-ab46-a14f3d46a45d', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:46:15.346591', '2025-06-26 02:46:15.346591', None, '{"id":"eee0427c-74ba-414a-afa5-0b7816281d19","user_id":"353eda04-f8ca-4c71-ab46-a14f3d46a45d","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:46:15.346591","opened_at":"2025-06-26T02:46:15.346591","updated_at":"2025-06-26T02:46:15.346591","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 351, in execute_trade_from_confirmed_opportunity
    await self.configuration_service.save_user_configuration(user_config)
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\config_service.py", line 121, in save_user_configuration
    raise ConfigurationError("No se pudo guardar la configuración.") from e
ultibot_backend.core.exceptions.ConfigurationError: No se pudo guardar la configuración.
2025-06-25 22:46:15,356 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity d0777f4a-204e-4afa-975f-16e1de6772c0 status to error_in_processing: Failed to execute trade: No se pudo guardar la configuración.
2025-06-25 22:46:15,356 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:550 - Failed to persist status update for opportunity d0777f4a-204e-4afa-975f-16e1de6772c0: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('eee0427c-74ba-414a-afa5-0b7816281d19'), '353eda04-f8ca-4c71-ab46-a14f3d46a45d', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:46:15.346591', '2025-06-26 02:46:15.346591', None, '{"id":"eee0427c-74ba-414a-afa5-0b7816281d19","user_id":"353eda04-f8ca-4c71-ab46-a14f3d46a45d","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:46:15.346591","opened_at":"2025-06-26T02:46:15.346591","updated_at":"2025-06-26T02:46:15.346591","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 543, in _update_opportunity_status
    await self.persistence_service.update_opportunity_status(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 449, in update_opportunity_status
    await session.execute(stmt)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 463, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.switch(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2230, in _execute_internal
    ) = compile_state_cls.orm_pre_session_exec(
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\bulk_persistence.py", line 728, in orm_pre_session_exec
    session._autoflush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3054, in _autoflush
    self.flush()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4345, in flush
    self._flush(objects)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 4437, in _flush
    flush_context.transaction = transaction = self._autobegin_t()._begin()
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _begin
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 103, in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 973, in _raise_for_prerequisite_state
    raise sa_exc.PendingRollbackError(
sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (raised as a result of Query-invoked autoflush; consider using a session.no_autoflush block if this flush is occurring prematurely)
(sqlite3.IntegrityError) NOT NULL constraint failed: trades.side
[SQL: INSERT INTO trades (id, user_id, mode, symbol, side, position_status, created_at, updated_at, closed_at, data) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
[parameters: (UUID('eee0427c-74ba-414a-afa5-0b7816281d19'), '353eda04-f8ca-4c71-ab46-a14f3d46a45d', 'real', 'BTC/USDT', None, <PositionStatus.OPEN: 'open'>, '2025-06-26 02:46:15.346591', '2025-06-26 02:46:15.346591', None, '{"id":"eee0427c-74ba-414a-afa5-0b7816281d19","user_id":"353eda04-f8ca-4c71-ab46-a14f3d46a45d","mode":"real","symbol":"BTC/USDT","side":"buy","entryOr ... (1205 characters truncated) ... ts":[],"created_at":"2025-06-26T02:46:15.346591","opened_at":"2025-06-26T02:46:15.346591","updated_at":"2025-06-26T02:46:15.346591","closed_at":null}')]
(Background on this error at: https://sqlalche.me/e/20/gkpj) (Background on this error at: https://sqlalche.me/e/20/7s2a)
2025-06-25 22:46:15,367 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:46:15,368 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:46:15,375 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:15,375 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:15,384 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:46:15,384 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:46:15,386 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:46:15,387 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:46:15,387 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 4496df57-72ae-4c69-bc02-93507be5ffa8 from decision 66fc5ba8-ab73-448e-98f8-5ad79db8e29d
2025-06-25 22:46:15,388 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:46:15,389 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:46:15,397 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:15,397 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:15,404 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:46:15,406 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:46:15,408 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:46:15,408 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:46:15,409 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 5094b45b-cc67-4a19-9da4-7f865905d241 from decision 2bbcb777-bb30-4388-8e8e-a4c6c78c67a0
2025-06-25 22:46:15,410 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:46:15,411 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:46:15,419 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:15,420 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:15,427 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:46:15,427 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:46:15,430 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:46:15,431 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:46:15,433 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:46:17,299 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:17,299 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:17,305 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:46:17,307 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:46:17,308 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:46:17,316 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:46:17,319 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:46:17,321 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:46:17,324 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:46:17,332 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:46:17,336 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:46:17,339 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:17,339 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:17,343 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:17,343 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:17,345 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:46:17,349 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:17,349 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:17,356 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:17,356 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:17,363 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:17,363 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:17,366 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:46:17,371 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:17,371 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:17,374 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:286 - Verificación de Binance BINANCE_SPOT exitosa.
2025-06-25 22:46:17,380 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:17,381 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:17,384 - ultibot_backend.services.credential_service - ERROR - [MainThread] - credential_service.py:315 - Error de Binance API durante la verificación: Binance Down
2025-06-25 22:46:17,389 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:17,390 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:17,392 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:46:17,398 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:46:17,399 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:46:17,403 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:241 - Verificación de Telegram exitosa.
2025-06-25 22:46:17,408 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:72 - Conexión con Binance exitosa.
2025-06-25 22:46:17,416 - ultibot_backend.services.market_data_service - WARNING - [MainThread] - market_data_service.py:52 - Credenciales de Binance no encontradas. Por favor, configúrelas.
2025-06-25 22:46:17,420 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:69 - Fallo en la verificación de conexión con Binance. Revise sus credenciales y permisos.
2025-06-25 22:46:17,425 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:77 - Error al acceder a las credenciales de Binance: Decryption failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 45, in get_binance_connection_status
    binance_credential = await self.credential_service.get_credential(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.CredentialError: Decryption failed
2025-06-25 22:46:17,430 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:81 - Error de la API de Binance: API unavailable
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 61, in get_binance_connection_status
    is_connected = await self.credential_service.verify_credential(binance_credential)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.BinanceAPIError: API unavailable
2025-06-25 22:46:17,436 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:46:17,446 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:121 - Error de la API de Binance al obtener balances: Failed to fetch balances
2025-06-25 22:46:17,449 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1684095517776'>
2025-06-25 22:46:17,451 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e, mode_filter: None
2025-06-25 22:46:17,451 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1684095517776'>
2025-06-25 22:46:17,451 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e with mode_filter: None
2025-06-25 22:46:17,454 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1684097283408'>
2025-06-25 22:46:17,455 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e, mode_filter: None
2025-06-25 22:46:17,456 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1684097283408'>
2025-06-25 22:46:17,456 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e with mode_filter: None
2025-06-25 22:46:17,459 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1684097227600'>
2025-06-25 22:46:17,461 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e, mode_filter: OperatingMode.PAPER
2025-06-25 22:46:17,461 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1684097227600'>
2025-06-25 22:46:17,461 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e
2025-06-25 22:46:17,464 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1684097277200'>
2025-06-25 22:46:17,466 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e, mode_filter: OperatingMode.PAPER
2025-06-25 22:46:17,466 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1684097277200'>
2025-06-25 22:46:17,467 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e
2025-06-25 22:46:17,469 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1684097325456'>
2025-06-25 22:46:17,470 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e, mode_filter: OperatingMode.REAL
2025-06-25 22:46:17,471 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1684097325456'>
2025-06-25 22:46:17,472 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e
2025-06-25 22:46:17,476 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1684097326352'>
2025-06-25 22:46:17,478 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e, mode_filter: OperatingMode.PAPER
2025-06-25 22:46:17,478 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1684097326352'>
2025-06-25 22:46:17,478 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e
2025-06-25 22:46:17,485 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1684097244560'>
2025-06-25 22:46:17,488 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e, mode_filter: None
2025-06-25 22:46:17,488 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1684097244560'>
2025-06-25 22:46:17,489 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 2 performance entries for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e
2025-06-25 22:46:17,491 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1684097216144'>
2025-06-25 22:46:17,493 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e, mode_filter: OperatingMode.PAPER
2025-06-25 22:46:17,493 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1684097216144'>
2025-06-25 22:46:17,493 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e
2025-06-25 22:46:17,498 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1684097087440'>
2025-06-25 22:46:17,501 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e, mode_filter: OperatingMode.PAPER
2025-06-25 22:46:17,502 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1684097087440'>
2025-06-25 22:46:17,502 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e with mode_filter: OperatingMode.PAPER
2025-06-25 22:46:17,506 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1684095529616'>
2025-06-25 22:46:17,507 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e, mode_filter: OperatingMode.PAPER
2025-06-25 22:46:17,508 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1684095529616'>
2025-06-25 22:46:17,508 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e with mode_filter: OperatingMode.PAPER
2025-06-25 22:46:17,511 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1684097159440'>
2025-06-25 22:46:17,513 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e, mode_filter: OperatingMode.PAPER
2025-06-25 22:46:17,514 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1684097159440'>
2025-06-25 22:46:17,514 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e
2025-06-25 22:46:17,518 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1684096441616'>
2025-06-25 22:46:17,520 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e, mode_filter: OperatingMode.PAPER
2025-06-25 22:46:17,520 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1684096441616'>
2025-06-25 22:46:17,520 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e
2025-06-25 22:46:17,524 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1684097114832'>
2025-06-25 22:46:17,525 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e, mode_filter: OperatingMode.PAPER
2025-06-25 22:46:17,525 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1684097114832'>
2025-06-25 22:46:17,526 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e
2025-06-25 22:46:17,530 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1684097046096'>
2025-06-25 22:46:17,531 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e, mode_filter: OperatingMode.PAPER
2025-06-25 22:46:17,532 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1684097046096'>
2025-06-25 22:46:17,532 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user fdac0d01-bfab-49cd-a1e1-8f988d36e18e
2025-06-25 22:46:17,578 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 93d1e0ff-47f2-4524-a336-733c9aca6342 en modo paper
2025-06-25 22:46:17,585 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario d99bc088-5859-438c-81fb-8d4d17394eef en modo paper
2025-06-25 22:46:17,590 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario 787bae55-60ac-43b3-a2aa-07608bcf0f30 en modo paper
2025-06-25 22:46:17,593 - ultibot_backend.services.trading_report_service - ERROR - [MainThread] - trading_report_service.py:79 - Error al obtener trades cerrados para usuario 45393733-a828-4972-a66f-9add95c7330b: Database connection failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_report_service.py", line 65, in get_closed_trades
    trades = await persistence_service.get_closed_trades(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
Exception: Database connection failed
2025-06-25 22:46:17,604 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 36b2ad73-05a6-495a-8714-4126541caa3f for symbol BTC/USDT
2025-06-25 22:46:17,606 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy 5cf9353d-6f5f-4d8b-bda2-6dbbb80f3530 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:46:17,606 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 36b2ad73-05a6-495a-8714-4126541caa3f status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:46:17,606 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 36b2ad73-05a6-495a-8714-4126541caa3f
2025-06-25 22:46:17,617 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity e5d33d71-e87f-4507-a446-1ca23fd4bee1 for symbol BTC/USDT
2025-06-25 22:46:17,619 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy c23b0c61-5266-4451-b681-b7b6ed1a91fa can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:46:17,619 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity e5d33d71-e87f-4507-a446-1ca23fd4bee1 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:46:17,620 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity e5d33d71-e87f-4507-a446-1ca23fd4bee1
2025-06-25 22:46:17,631 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 710157af-4e8a-481b-89b6-a9709a3ba832 for symbol BTC/USDT
2025-06-25 22:46:17,633 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy 38062f1e-9a60-43b7-aaa1-8d6777a11282 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:46:17,633 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 710157af-4e8a-481b-89b6-a9709a3ba832 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:46:17,634 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 710157af-4e8a-481b-89b6-a9709a3ba832
2025-06-25 22:46:17,643 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 39f81ea6-3877-4296-b2b0-b4460ee92330 for symbol BTC/USDT
2025-06-25 22:46:17,645 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy b93cd970-b4d8-4ac3-8358-9bcdc60f6ded can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:46:17,645 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 39f81ea6-3877-4296-b2b0-b4460ee92330 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:46:17,646 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 39f81ea6-3877-4296-b2b0-b4460ee92330
2025-06-25 22:46:17,656 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 33be5a37-998c-404f-96bd-777749d72db6 for symbol BTC/USDT
2025-06-25 22:46:17,656 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:659 - Unknown strategy type 'CUSTOM_UNKNOWN_TYPE' for strategy da7ddcea-f06b-49a1-b4f4-2f60703ce336. Recommending investigation.
2025-06-25 22:46:17,656 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 33be5a37-998c-404f-96bd-777749d72db6 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:46:17,658 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 33be5a37-998c-404f-96bd-777749d72db6
2025-06-25 22:46:17,668 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity f450b385-dab3-4506-90b2-f9a5f59f0fae for symbol BTC/USDT
2025-06-25 22:46:17,670 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy 7f979003-1e34-4c9d-ba50-42c994fa8c8e can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:46:17,670 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity f450b385-dab3-4506-90b2-f9a5f59f0fae status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:46:17,671 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity f450b385-dab3-4506-90b2-f9a5f59f0fae
2025-06-25 22:46:17,693 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 5cbc4a0f-87f0-4c59-80ab-e4ef1721232d for symbol BTC/USDT
2025-06-25 22:46:17,694 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy 8cf48413-957d-4c62-8287-f397fbd8fc44 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:46:17,695 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 5cbc4a0f-87f0-4c59-80ab-e4ef1721232d status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:46:17,696 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 5cbc4a0f-87f0-4c59-80ab-e4ef1721232d
2025-06-25 22:47:34,435 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:47:34,435 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:47:34,456 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:47:34,457 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:47:34,617 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:47:34,618 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:47:34,637 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:47:34,638 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:47:35,322 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:47:35,323 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:47:35,343 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:47:35,358 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:47:35,360 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:47:35,364 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:47:35,366 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:47:35,374 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:47:35,375 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:47:35,393 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:47:35,396 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:47:35,399 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:47:35,406 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:47:35,406 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:47:35,424 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:47:35,427 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:47:35,428 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:47:35,435 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:47:35,436 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:47:35,454 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:47:35,456 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:47:35,459 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:47:35,466 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:47:35,466 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:47:35,485 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:47:35,487 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:47:35,489 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:47:35,496 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:47:35,496 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:47:35,515 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:47:35,516 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:47:35,516 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:47:35,518 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:47:35,518 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:47:35,518 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:47:35,538 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:47:35,722 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:47:35,723 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:47:35,902 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:47:35,902 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:35,903 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:35,903 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:47:35,919 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:47:35,919 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000026861FE0210>
2025-06-25 22:47:35,919 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:47:35,919 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:47:35,920 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 422
2025-06-25 22:47:35,930 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:47:35,930 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:47:36,045 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:47:36,047 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:47:36,048 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:47:36,048 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:47:36,229 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:47:36,229 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:47:36,408 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:47:36,409 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:36,409 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:36,409 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:47:36,412 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:47:36,412 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000026862289AD0>
2025-06-25 22:47:36,413 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:47:36,413 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:47:36,422 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:47:36,429 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:47:36,430 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:47:36,439 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:47:36,440 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:47:36,458 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:47:36,460 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:47:36,460 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:47:36,461 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:47:36,650 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:47:36,650 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:47:36,843 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:47:36,843 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:36,844 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:36,844 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:47:36,849 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:47:36,850 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000026861FE2AD0>
2025-06-25 22:47:36,851 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:47:36,851 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:47:36,855 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:47:36,863 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:47:36,863 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:47:36,864 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:47:36,870 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:47:36,871 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:47:36,872 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:47:36,872 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:47:36,883 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:47:36,883 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:47:36,904 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:47:36,905 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:47:36,906 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:47:36,906 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:47:37,087 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:47:37,088 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:47:37,271 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:47:37,271 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:37,271 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:37,271 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:47:37,274 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:47:37,274 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000026862273ED0>
2025-06-25 22:47:37,274 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:47:37,274 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:47:37,278 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:47:37,286 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:47:37,286 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:47:37,288 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:47:37,293 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:47:37,294 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:47:37,303 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:47:37,303 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:47:37,322 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:47:37,324 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:47:37,324 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:47:37,325 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:47:37,508 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:47:37,508 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:47:37,688 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:47:37,688 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:37,689 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:37,689 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:47:37,693 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:47:37,693 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000002686204BC50>
2025-06-25 22:47:37,693 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:47:37,694 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:47:37,697 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:47:37,706 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:47:37,707 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:47:37,708 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:47:37,712 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:47:37,713 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:47:37,722 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:47:37,722 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:47:37,741 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:47:37,742 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:47:37,743 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:47:37,744 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:47:37,921 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:47:37,922 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:47:38,110 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:47:38,110 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:38,110 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:38,111 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:47:38,113 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:47:38,114 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000026862018250>
2025-06-25 22:47:38,114 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:47:38,115 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:47:38,115 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 422
2025-06-25 22:47:38,133 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity b9bf13a5-4ee8-41cd-bf98-d66323798c4d
2025-06-25 22:47:38,134 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:152 - User configuration saved after initializing last_daily_reset for user 33150243-9965-461b-a7b0-d642caf34244.
2025-06-25 22:47:38,135 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 200.000
2025-06-25 22:47:38,135 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity b9bf13a5-4ee8-41cd-bf98-d66323798c4d
2025-06-25 22:47:38,135 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:47:38,136 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 925a422b-0b22-4ae3-b1d3-f252772afddd from decision dde3e1d9-d8a2-41d4-a6a5-4d7b72fe16b7
2025-06-25 22:47:38,136 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 925a422b-0b22-4ae3-b1d3-f252772afddd from confirmed opportunity.
2025-06-25 22:47:38,138 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:47:38,138 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:310 - Successfully created OCO order for trade 925a422b-0b22-4ae3-b1d3-f252772afddd. OCO List ID: oco_list_123
2025-06-25 22:47:38,139 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 33150243-9965-461b-a7b0-d642caf34244: 200.0000000000000000000000000 (anterior: 0.0, valor trade: 200.0000000000000000000000000)
2025-06-25 22:47:38,140 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user 33150243-9965-461b-a7b0-d642caf34244 to 200.0000000000000000000000000.
2025-06-25 22:47:38,140 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity b9bf13a5-4ee8-41cd-bf98-d66323798c4d status to converted_to_trade_real: Trade 925a422b-0b22-4ae3-b1d3-f252772afddd executed based on user confirmation.
2025-06-25 22:47:38,141 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity b9bf13a5-4ee8-41cd-bf98-d66323798c4d
2025-06-25 22:47:38,150 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity df95b738-678d-4e7c-aae3-c23d99f48852
2025-06-25 22:47:38,150 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 4800.0, Riesgo Potencial Trade USD: 300.000
2025-06-25 22:47:38,151 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:191 - Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:47:38,151 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity df95b738-678d-4e7c-aae3-c23d99f48852 status to error_in_processing: Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:47:38,152 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity df95b738-678d-4e7c-aae3-c23d99f48852
2025-06-25 22:47:38,165 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 47756367-886f-48bd-a5c0-7e665e09c0a3
2025-06-25 22:47:38,165 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:143 - Daily capital reset triggered for user 6db806a9-bb6e-4c4e-8888-1f5e9afcfd65. Resetting daily_capital_risked_usd.
2025-06-25 22:47:38,166 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:147 - User configuration saved after daily capital reset for user 6db806a9-bb6e-4c4e-8888-1f5e9afcfd65.
2025-06-25 22:47:38,166 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 2500.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 100.000
2025-06-25 22:47:38,166 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity 47756367-886f-48bd-a5c0-7e665e09c0a3
2025-06-25 22:47:38,166 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:47:38,166 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 81609ca3-dc59-49b9-80a6-d01b2af852f1 from decision 8e37b36b-aeef-4c34-bbdf-24e5c522fc81
2025-06-25 22:47:38,168 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 81609ca3-dc59-49b9-80a6-d01b2af852f1 from confirmed opportunity.
2025-06-25 22:47:38,170 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:47:38,170 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:310 - Successfully created OCO order for trade 81609ca3-dc59-49b9-80a6-d01b2af852f1. OCO List ID: oco_reset_test
2025-06-25 22:47:38,171 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 6db806a9-bb6e-4c4e-8888-1f5e9afcfd65: 100.000 (anterior: 0.0, valor trade: 100.000)
2025-06-25 22:47:38,172 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user 6db806a9-bb6e-4c4e-8888-1f5e9afcfd65 to 100.000.
2025-06-25 22:47:38,172 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 47756367-886f-48bd-a5c0-7e665e09c0a3 status to converted_to_trade_real: Trade 81609ca3-dc59-49b9-80a6-d01b2af852f1 executed based on user confirmation.
2025-06-25 22:47:38,173 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 47756367-886f-48bd-a5c0-7e665e09c0a3
2025-06-25 22:47:38,188 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:47:38,188 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:47:38,207 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:47:38,208 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 22:47:38,209 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:47:38,210 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:47:38,386 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:47:38,386 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:47:38,570 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:47:38,571 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:38,571 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:38,571 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:47:38,575 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:47:38,575 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000026861FCA5D0>
2025-06-25 22:47:38,575 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:47:38,575 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:47:38,576 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:497 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 22:47:38,579 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"f4db496b-ae30-4d1f-bbe7-3d0f6772f711","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:47:38.178284Z","submittedAt":"2025-06-26T02:47:38.178284Z","fillTimestamp":"2025-06-26T02:47:38.178284Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:47:38.178284Z","opened_at":"2025-06-26T02:47:38.178284Z","updated_at":"2025-06-26T02:47:38.178284Z","closed_at":"2025-06-26T02:47:38.178284Z"}
2025-06-25 22:47:38,580 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': 'f4db496b-ae30-4d1f-bbe7-3d0f6772f711', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:47:38.178284Z', 'submittedAt': '2025-06-26T02:47:38.178284Z', 'fillTimestamp': '2025-06-26T02:47:38.178284Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:47:38.178284Z', 'opened_at': '2025-06-26T02:47:38.178284Z', 'updated_at': '2025-06-26T02:47:38.178284Z', 'closed_at': '2025-06-26T02:47:38.178284Z'}
2025-06-25 22:47:38,580 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"8efd0fb2-b27f-4117-a636-1c3e8e12e446","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:47:38.179293Z","submittedAt":"2025-06-26T02:47:38.179293Z","fillTimestamp":"2025-06-26T02:47:38.179293Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:47:38.179293Z","opened_at":"2025-06-26T02:47:38.179293Z","updated_at":"2025-06-26T02:47:38.179293Z","closed_at":"2025-06-26T02:47:38.179293Z"}
2025-06-25 22:47:38,580 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': '8efd0fb2-b27f-4117-a636-1c3e8e12e446', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:47:38.179293Z', 'submittedAt': '2025-06-26T02:47:38.179293Z', 'fillTimestamp': '2025-06-26T02:47:38.179293Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:47:38.179293Z', 'opened_at': '2025-06-26T02:47:38.179293Z', 'updated_at': '2025-06-26T02:47:38.179293Z', 'closed_at': '2025-06-26T02:47:38.179293Z'}
2025-06-25 22:47:38,581 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"e3f88a56-3c55-4140-9322-effee65b2bb9","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:47:38.179293Z","submittedAt":"2025-06-26T02:47:38.179293Z","fillTimestamp":"2025-06-26T02:47:38.179293Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:47:38.179293Z","opened_at":"2025-06-26T02:47:38.179293Z","updated_at":"2025-06-26T02:47:38.179293Z","closed_at":"2025-06-26T02:47:38.179293Z"}
2025-06-25 22:47:38,581 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': 'e3f88a56-3c55-4140-9322-effee65b2bb9', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:47:38.179293Z', 'submittedAt': '2025-06-26T02:47:38.179293Z', 'fillTimestamp': '2025-06-26T02:47:38.179293Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:47:38.179293Z', 'opened_at': '2025-06-26T02:47:38.179293Z', 'updated_at': '2025-06-26T02:47:38.179293Z', 'closed_at': '2025-06-26T02:47:38.179293Z'}
2025-06-25 22:47:38,581 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:547 - get_closed_trades - Trades recuperados: 3
2025-06-25 22:47:38,581 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:47:38,583 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 22:47:38,601 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:47:38,601 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:47:38,619 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:47:38,620 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 22:47:38,621 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:47:38,621 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:47:38,799 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:47:38,799 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:47:38,980 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:47:38,981 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:38,981 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:38,982 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:47:38,985 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:47:38,985 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000026863569AD0>
2025-06-25 22:47:38,985 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:47:38,985 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:47:38,986 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:497 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: BTCUSDT, start_date: None, end_date: None
2025-06-25 22:47:38,991 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"b02ec76f-edef-4fa6-a32a-7f55a6c269e2","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:47:38.592675Z","submittedAt":"2025-06-26T02:47:38.592675Z","fillTimestamp":"2025-06-26T02:47:38.592675Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:47:38.592675Z","opened_at":"2025-06-26T02:47:38.592675Z","updated_at":"2025-06-26T02:47:38.592675Z","closed_at":"2025-06-26T02:47:38.592675Z"}
2025-06-25 22:47:38,991 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': 'b02ec76f-edef-4fa6-a32a-7f55a6c269e2', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:47:38.592675Z', 'submittedAt': '2025-06-26T02:47:38.592675Z', 'fillTimestamp': '2025-06-26T02:47:38.592675Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:47:38.592675Z', 'opened_at': '2025-06-26T02:47:38.592675Z', 'updated_at': '2025-06-26T02:47:38.592675Z', 'closed_at': '2025-06-26T02:47:38.592675Z'}
2025-06-25 22:47:38,991 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:547 - get_closed_trades - Trades recuperados: 1
2025-06-25 22:47:38,992 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 1 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:47:38,992 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 22:47:39,011 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:47:39,012 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:47:39,031 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:47:39,032 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 22:47:39,033 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:47:39,033 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:47:39,229 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:47:39,230 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:47:39,412 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:47:39,413 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:39,414 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:39,415 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:47:39,417 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:47:39,418 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000268623EDCD0>
2025-06-25 22:47:39,418 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:47:39,418 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:47:39,418 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:497 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 22:47:39,421 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"d24de2e0-c908-4ad9-89eb-be9243be99d8","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:47:39.003287Z","submittedAt":"2025-06-26T02:47:39.003287Z","fillTimestamp":"2025-06-26T02:47:39.003287Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:47:39.003287Z","opened_at":"2025-06-26T02:47:39.003287Z","updated_at":"2025-06-26T02:47:39.003287Z","closed_at":"2025-06-26T02:47:39.003287Z"}
2025-06-25 22:47:39,422 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': 'd24de2e0-c908-4ad9-89eb-be9243be99d8', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:47:39.003287Z', 'submittedAt': '2025-06-26T02:47:39.003287Z', 'fillTimestamp': '2025-06-26T02:47:39.003287Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:47:39.003287Z', 'opened_at': '2025-06-26T02:47:39.003287Z', 'updated_at': '2025-06-26T02:47:39.003287Z', 'closed_at': '2025-06-26T02:47:39.003287Z'}
2025-06-25 22:47:39,422 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"5f214942-81a5-4777-b6c4-6d2ad23a8322","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:47:39.003287Z","submittedAt":"2025-06-26T02:47:39.003287Z","fillTimestamp":"2025-06-26T02:47:39.003287Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:47:39.003287Z","opened_at":"2025-06-26T02:47:39.003287Z","updated_at":"2025-06-26T02:47:39.003287Z","closed_at":"2025-06-26T02:47:39.003287Z"}
2025-06-25 22:47:39,422 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': '5f214942-81a5-4777-b6c4-6d2ad23a8322', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:47:39.003287Z', 'submittedAt': '2025-06-26T02:47:39.003287Z', 'fillTimestamp': '2025-06-26T02:47:39.003287Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:47:39.003287Z', 'opened_at': '2025-06-26T02:47:39.003287Z', 'updated_at': '2025-06-26T02:47:39.003287Z', 'closed_at': '2025-06-26T02:47:39.003287Z'}
2025-06-25 22:47:39,422 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"b646b820-6c7c-4210-8ad7-9bbd2429dd72","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:47:39.003287Z","submittedAt":"2025-06-26T02:47:39.003287Z","fillTimestamp":"2025-06-26T02:47:39.003287Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:47:39.003287Z","opened_at":"2025-06-26T02:47:39.003287Z","updated_at":"2025-06-26T02:47:39.003287Z","closed_at":"2025-06-26T02:47:39.003287Z"}
2025-06-25 22:47:39,423 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': 'b646b820-6c7c-4210-8ad7-9bbd2429dd72', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:47:39.003287Z', 'submittedAt': '2025-06-26T02:47:39.003287Z', 'fillTimestamp': '2025-06-26T02:47:39.003287Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:47:39.003287Z', 'opened_at': '2025-06-26T02:47:39.003287Z', 'updated_at': '2025-06-26T02:47:39.003287Z', 'closed_at': '2025-06-26T02:47:39.003287Z'}
2025-06-25 22:47:39,423 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:547 - get_closed_trades - Trades recuperados: 3
2025-06-25 22:47:39,423 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:47:39,424 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 22:47:39,442 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:47:39,442 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:47:39,461 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:47:39,462 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 22:47:39,463 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:47:39,463 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:47:39,645 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:47:39,645 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:47:39,828 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:47:39,828 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:39,828 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:39,829 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:47:39,831 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:47:39,832 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000026863605E50>
2025-06-25 22:47:39,832 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:47:39,832 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:47:39,832 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:497 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: 2025-06-27 02:47:39.462242+00:00, end_date: None
2025-06-25 22:47:39,836 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:547 - get_closed_trades - Trades recuperados: 0
2025-06-25 22:47:39,836 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:47:39,837 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 22:47:39,893 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity f652101d-e662-478c-99b0-15162b809d9a for symbol BTCUSDT
2025-06-25 22:47:39,893 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 72a99ef0-8518-465a-848b-37ea8dc7746a
2025-06-25 22:47:39,893 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy 8acb4c80-6e07-4be6-bbb7-0acc204642bf can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:47:39,904 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 7e7924bf-dbc4-4b50-9cb4-48aad076c22f for symbol BTCUSDT
2025-06-25 22:47:39,904 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy 723d4ea6-b483-46a2-ac6b-cb857c8508f1 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:47:39,911 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity b0c6b45a-ffc4-4237-823c-4bcb2766630c for symbol ETHUSDT
2025-06-25 22:47:39,911 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 4a94a286-9585-4b25-b17a-636b5534b0d1
2025-06-25 22:47:39,913 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:610 - No active and applicable strategies found for opportunity b0c6b45a-ffc4-4237-823c-4bcb2766630c with symbol ETHUSDT.
2025-06-25 22:47:39,913 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity b0c6b45a-ffc4-4237-823c-4bcb2766630c status to rejected_by_system: No active strategies are applicable to this opportunity's symbol.
2025-06-25 22:47:39,914 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity b0c6b45a-ffc4-4237-823c-4bcb2766630c
2025-06-25 22:47:39,923 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity fe00edd9-fab2-4397-a0a5-546c3df832a9 for symbol BTCUSDT
2025-06-25 22:47:39,923 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: b45c2234-b77a-4089-b041-c1b5a0e6706f
2025-06-25 22:47:39,923 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:723 - AI confidence 0.65 for strategy b472129a-02c8-4c93-959a-cd4599c25793 is below threshold 0.8.
2025-06-25 22:47:39,925 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:738 - Strategy b472129a-02c8-4c93-959a-cd4599c25793 did not produce a decision for opportunity fe00edd9-fab2-4397-a0a5-546c3df832a9.
2025-06-25 22:47:39,925 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:629 - No affirmative trading decisions made for opportunity fe00edd9-fab2-4397-a0a5-546c3df832a9.
2025-06-25 22:47:39,934 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity a9f0fffa-b256-42ce-b2be-ab87b19b8c31 for symbol BTCUSDT
2025-06-25 22:47:39,934 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: b2a242a0-8ab3-48f2-b45a-e0ec80331f19
2025-06-25 22:47:39,942 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity a0db2b80-f5b3-4712-bd0b-2cb0402e68a7 for symbol BTCUSDT
2025-06-25 22:47:39,943 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 58a52eda-43d8-42b6-b4b8-08e3aba17a2f
2025-06-25 22:47:39,949 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:47:39,950 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 4aeb3d4b-d0f3-4666-b7e0-6063f4468028 from decision dbc1afb6-1975-485c-81d3-d6b5c22ef88b
2025-06-25 22:47:39,955 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:47:39,956 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 8b279501-172c-450c-8304-1a7c6bd1dd7a from decision 23eac4e0-78ab-43ef-a510-a42e93f3edc2
2025-06-25 22:47:39,956 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: sell
2025-06-25 22:47:39,956 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 4d8bad45-d3af-412a-a50c-cbad0572d778 from decision 23eac4e0-78ab-43ef-a510-a42e93f3edc2
2025-06-25 22:47:39,962 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:39,963 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:39,972 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:47:39,973 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:47:39,976 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:47:39,977 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity f6d29c27-f687-4fe2-8201-5ed00ffa33c6
2025-06-25 22:47:39,980 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id cc53bcaf-300e-4a5b-a18c-9d722fa11565. Creando y guardando configuración por defecto.
2025-06-25 22:47:39,983 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:47:39,986 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for cc53bcaf-300e-4a5b-a18c-9d722fa11565. Using default values.
2025-06-25 22:47:39,986 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for cc53bcaf-300e-4a5b-a18c-9d722fa11565 with capital: 10000.0
2025-06-25 22:47:39,988 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:47:39,988 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:47:39,989 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:47:39,989 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity f6d29c27-f687-4fe2-8201-5ed00ffa33c6
2025-06-25 22:47:39,989 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:47:39,990 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade fcdaf135-3a66-45f5-a133-09de3efe0ef1 from decision 9fd5033c-996a-4e96-b269-2f193b942f98
2025-06-25 22:47:39,990 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade fcdaf135-3a66-45f5-a133-09de3efe0ef1 from confirmed opportunity.
2025-06-25 22:47:39,991 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:47:39,992 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('845e3629-c432-47d3-8196-2aa15fdd371f') orderId_exchange='mock_exchange_oco_id_dbec1a3b-5458-48a1-b60a-65d678c4e948' clientOrderId_exchange='mock_client_oco_id_e870f78a-47bc-4ba8-923e-f5b71fe550dc' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 47, 39, 991502) submittedAt=datetime.datetime(2025, 6, 26, 2, 47, 39, 991502, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 47, 39, 991502, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 31146280512562954117988050274656390450, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_9e274105-267d-400a-b6dc-e8d5883a5869', 'transactionTime': 1750906059991, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='31146280512562954117988050274656390450' price=None stopPrice=None timeInForce=None
2025-06-25 22:47:39,992 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity f6d29c27-f687-4fe2-8201-5ed00ffa33c6: 'str' object has no attribute 'value'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 325, in execute_trade_from_confirmed_opportunity
    await self.persistence_service.upsert_trade(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 267, in upsert_trade
    side=trade.side.value, # Asegurar que el valor del enum se pase como string
         ^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'value'
2025-06-25 22:47:40,306 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:47:40,306 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:47:40,315 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:40,315 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:40,324 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:47:40,324 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:47:40,326 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:47:40,328 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:47:40,329 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:47:40,341 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:40,342 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:40,352 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:47:40,353 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:47:40,355 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:47:40,357 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 50293e31-aa58-49d5-9f6c-62ab69ba350a for symbol BTC/USDT
2025-06-25 22:47:40,362 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 8dafbbe7-33db-45af-a46f-043bfff56f61. Creando y guardando configuración por defecto.
2025-06-25 22:47:40,366 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:47:40,368 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:678 - AI profile 'ai-profile-scalping-1' for strategy d8b5d66a-add0-410b-8aa7-08095890ddc4 not found. Skipping AI analysis.
2025-06-25 22:47:40,368 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy d8b5d66a-add0-410b-8aa7-08095890ddc4 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:47:40,369 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 50293e31-aa58-49d5-9f6c-62ab69ba350a status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:47:40,378 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 50293e31-aa58-49d5-9f6c-62ab69ba350a
2025-06-25 22:47:40,379 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:47:40,381 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:47:40,390 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:40,391 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:40,399 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:47:40,400 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:47:40,402 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:47:40,405 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 5615a7a1-33b1-408e-8ff2-d04543cac588
2025-06-25 22:47:40,410 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id ecd7efeb-21c0-4056-8aa1-1900424b2a36. Creando y guardando configuración por defecto.
2025-06-25 22:47:40,414 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:47:40,418 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for ecd7efeb-21c0-4056-8aa1-1900424b2a36. Using default values.
2025-06-25 22:47:40,418 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for ecd7efeb-21c0-4056-8aa1-1900424b2a36 with capital: 10000.0
2025-06-25 22:47:40,421 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:47:40,422 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:47:40,422 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:47:40,422 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Autonomous Scalping' as context for confirmed opportunity 5615a7a1-33b1-408e-8ff2-d04543cac588
2025-06-25 22:47:40,422 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:47:40,422 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 79f68c8f-980b-4948-b0ba-04a0db6ea9d7 from decision 42f95612-58c4-44d0-aa9b-c14f6e84ff65
2025-06-25 22:47:40,423 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 79f68c8f-980b-4948-b0ba-04a0db6ea9d7 from confirmed opportunity.
2025-06-25 22:47:40,424 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:47:40,424 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('1308d11b-e29f-44e3-afc1-6c63563581e7') orderId_exchange='mock_exchange_oco_id_7aaf14e1-4d56-4eca-a7bd-c434f57a2001' clientOrderId_exchange='mock_client_oco_id_ae661a9a-7972-4928-8e3d-4eeb04ce9bd9' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 47, 40, 424822) submittedAt=datetime.datetime(2025, 6, 26, 2, 47, 40, 424822, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 47, 40, 424822, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 67198662299254394361711149902335599240, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_71e4bac5-0ebd-4487-ba5c-4e79a41564cd', 'transactionTime': 1750906060424, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='67198662299254394361711149902335599240' price=None stopPrice=None timeInForce=None
2025-06-25 22:47:40,425 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 5615a7a1-33b1-408e-8ff2-d04543cac588: 'str' object has no attribute 'value'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 325, in execute_trade_from_confirmed_opportunity
    await self.persistence_service.upsert_trade(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 267, in upsert_trade
    side=trade.side.value, # Asegurar que el valor del enum se pase como string
         ^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'value'
2025-06-25 22:47:40,455 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:47:40,457 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:47:40,466 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:40,466 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:40,473 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:47:40,473 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:47:40,476 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:47:40,478 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 2c8edf13-2864-4bdd-8eff-95eac2aa411c
2025-06-25 22:47:40,481 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 22705406-c901-4100-97ed-014f873a4e76. Creando y guardando configuración por defecto.
2025-06-25 22:47:40,485 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:47:40,487 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 22705406-c901-4100-97ed-014f873a4e76. Using default values.
2025-06-25 22:47:40,487 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 22705406-c901-4100-97ed-014f873a4e76 with capital: 10000.0
2025-06-25 22:47:40,488 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:47:40,489 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:47:40,489 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:47:40,489 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity 2c8edf13-2864-4bdd-8eff-95eac2aa411c
2025-06-25 22:47:40,490 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:47:40,490 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade f3756c14-5cb1-4a48-bee8-a028274fa9be from decision e3aab644-4e07-4b84-9c77-fc4908f62280
2025-06-25 22:47:40,491 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade f3756c14-5cb1-4a48-bee8-a028274fa9be from confirmed opportunity.
2025-06-25 22:47:40,491 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:47:40,492 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('c54573f8-4b48-4558-98be-77821dec9e61') orderId_exchange='mock_exchange_oco_id_0cd89a6b-c086-43ce-a833-961c8b2fc0e3' clientOrderId_exchange='mock_client_oco_id_58fb6121-723e-44ba-a4cd-f93b350ddf80' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 47, 40, 492958) submittedAt=datetime.datetime(2025, 6, 26, 2, 47, 40, 492958, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 47, 40, 492958, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 309636026641295367805130019766985331781, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_9efd12bf-a12a-493e-9271-79aa35eb8b94', 'transactionTime': 1750906060492, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='309636026641295367805130019766985331781' price=None stopPrice=None timeInForce=None
2025-06-25 22:47:40,492 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 2c8edf13-2864-4bdd-8eff-95eac2aa411c: 'str' object has no attribute 'value'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 325, in execute_trade_from_confirmed_opportunity
    await self.persistence_service.upsert_trade(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 267, in upsert_trade
    side=trade.side.value, # Asegurar que el valor del enum se pase como string
         ^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'value'
2025-06-25 22:47:40,522 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:47:40,523 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:47:40,530 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:40,530 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:40,539 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:47:40,539 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:47:40,640 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:47:40,642 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity e8ddda25-7af3-4e48-af35-bf242d597ae5
2025-06-25 22:47:40,645 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 3f83233f-1131-4e93-8cd5-d20c36915ee1. Creando y guardando configuración por defecto.
2025-06-25 22:47:40,649 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:47:40,652 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 3f83233f-1131-4e93-8cd5-d20c36915ee1. Using default values.
2025-06-25 22:47:40,652 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 3f83233f-1131-4e93-8cd5-d20c36915ee1 with capital: 10000.0
2025-06-25 22:47:40,653 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:47:40,654 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:47:40,654 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:47:40,654 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Day Trading Strategy' as context for confirmed opportunity e8ddda25-7af3-4e48-af35-bf242d597ae5
2025-06-25 22:47:40,654 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:47:40,655 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 0c394890-3482-4183-9e6a-950337175417 from decision 4a298fc6-0072-458e-bf0b-144c07ee5d40
2025-06-25 22:47:40,655 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 0c394890-3482-4183-9e6a-950337175417 from confirmed opportunity.
2025-06-25 22:47:40,656 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: buy, OCO side calculated: sell
2025-06-25 22:47:40,657 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:314 - OCO order result was not a dictionary or was empty: orderId_internal=UUID('db86c2e4-6002-457e-bc35-9fcc6c960290') orderId_exchange='mock_exchange_oco_id_f5492807-7891-4421-93ce-497ab96fe21a' clientOrderId_exchange='mock_client_oco_id_6306e00d-28d8-4545-8832-4eb17f3a1891' orderCategory=<OrderCategory.EXIT: 'exit'> type='OCO' status='filled' requestedPrice=Decimal('30500.0') requestedQuantity=Decimal('0.000') executedQuantity=Decimal('0.000') executedPrice=Decimal('30500.0') cumulativeQuoteQty=Decimal('0.0000') commissions=[] commission=Decimal('0') commissionAsset=None timestamp=datetime.datetime(2025, 6, 26, 2, 47, 40, 657146) submittedAt=datetime.datetime(2025, 6, 26, 2, 47, 40, 657146, tzinfo=datetime.timezone.utc) fillTimestamp=datetime.datetime(2025, 6, 26, 2, 47, 40, 657146, tzinfo=datetime.timezone.utc) rawResponse={'orderListId': 182849943081065869592705426958896093542, 'contingencyType': 'OCO', 'listStatusType': 'ALL_DONE', 'listOrderStatus': 'ALL_DONE', 'listClientOrderId': 'mock_oco_list_id_db59773b-0d95-46f1-8bf1-ad073b285ad7', 'transactionTime': 1750906060657, 'symbol': 'BTC/USDT', 'orders': [], 'orderReports': []} ocoOrderListId='182849943081065869592705426958896093542' price=None stopPrice=None timeInForce=None
2025-06-25 22:47:40,657 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity e8ddda25-7af3-4e48-af35-bf242d597ae5: 'str' object has no attribute 'value'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 325, in execute_trade_from_confirmed_opportunity
    await self.persistence_service.upsert_trade(
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\adapters\persistence_service.py", line 267, in upsert_trade
    side=trade.side.value, # Asegurar que el valor del enum se pase como string
         ^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'value'
2025-06-25 22:47:40,686 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:47:40,688 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:47:40,696 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:40,696 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:40,704 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:47:40,704 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:47:40,706 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:47:40,708 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:47:40,708 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 0ed916e0-4e5d-4f8c-912a-b73bd5127bc3 from decision 7d33f7c6-e6b9-42ed-8880-52f580fce917
2025-06-25 22:47:40,708 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:47:40,709 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:47:40,718 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:40,718 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:40,725 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:47:40,726 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:47:40,728 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:47:40,729 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:47:40,729 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade d21e4e44-5b8a-493e-9778-724def477493 from decision a1d6bbc2-d102-4e0a-8d13-48dbd70dbaa0
2025-06-25 22:47:40,730 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:47:40,731 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:47:40,739 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:40,740 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:40,749 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:47:40,749 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:47:40,751 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:47:40,752 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:47:40,754 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:47:42,758 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:42,758 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:42,764 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:47:42,766 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:47:42,767 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:47:42,774 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:47:42,779 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:47:42,779 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:47:42,783 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:47:42,789 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:47:42,792 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:47:42,796 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:42,797 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:42,801 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:42,801 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:42,803 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:47:42,806 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:42,806 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:42,814 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:42,815 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:42,823 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:42,823 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:42,826 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:47:42,830 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:42,831 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:42,834 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:286 - Verificación de Binance BINANCE_SPOT exitosa.
2025-06-25 22:47:42,838 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:42,839 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:42,842 - ultibot_backend.services.credential_service - ERROR - [MainThread] - credential_service.py:315 - Error de Binance API durante la verificación: Binance Down
2025-06-25 22:47:42,846 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:42,846 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:42,851 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:47:42,856 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:47:42,856 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:47:42,859 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:241 - Verificación de Telegram exitosa.
2025-06-25 22:47:42,866 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:72 - Conexión con Binance exitosa.
2025-06-25 22:47:42,871 - ultibot_backend.services.market_data_service - WARNING - [MainThread] - market_data_service.py:52 - Credenciales de Binance no encontradas. Por favor, configúrelas.
2025-06-25 22:47:42,877 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:69 - Fallo en la verificación de conexión con Binance. Revise sus credenciales y permisos.
2025-06-25 22:47:42,882 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:77 - Error al acceder a las credenciales de Binance: Decryption failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 45, in get_binance_connection_status
    binance_credential = await self.credential_service.get_credential(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.CredentialError: Decryption failed
2025-06-25 22:47:42,888 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:81 - Error de la API de Binance: API unavailable
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 61, in get_binance_connection_status
    is_connected = await self.credential_service.verify_credential(binance_credential)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.BinanceAPIError: API unavailable
2025-06-25 22:47:42,893 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:47:42,904 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:121 - Error de la API de Binance al obtener balances: Failed to fetch balances
2025-06-25 22:47:42,907 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2647366478928'>
2025-06-25 22:47:42,908 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 708817b4-47ac-43b2-b7da-3fdce377398b, mode_filter: None
2025-06-25 22:47:42,908 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2647366478928'>
2025-06-25 22:47:42,909 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 708817b4-47ac-43b2-b7da-3fdce377398b with mode_filter: None
2025-06-25 22:47:42,911 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2647366445008'>
2025-06-25 22:47:42,913 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 708817b4-47ac-43b2-b7da-3fdce377398b, mode_filter: None
2025-06-25 22:47:42,913 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2647366445008'>
2025-06-25 22:47:42,914 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 708817b4-47ac-43b2-b7da-3fdce377398b with mode_filter: None
2025-06-25 22:47:42,918 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2647343654544'>
2025-06-25 22:47:42,920 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 708817b4-47ac-43b2-b7da-3fdce377398b, mode_filter: OperatingMode.PAPER
2025-06-25 22:47:42,921 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2647343654544'>
2025-06-25 22:47:42,921 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 708817b4-47ac-43b2-b7da-3fdce377398b
2025-06-25 22:47:42,924 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2647366443152'>
2025-06-25 22:47:42,925 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 708817b4-47ac-43b2-b7da-3fdce377398b, mode_filter: OperatingMode.PAPER
2025-06-25 22:47:42,925 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2647366443152'>
2025-06-25 22:47:42,926 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 708817b4-47ac-43b2-b7da-3fdce377398b
2025-06-25 22:47:42,929 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2647366968208'>
2025-06-25 22:47:42,930 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 708817b4-47ac-43b2-b7da-3fdce377398b, mode_filter: OperatingMode.REAL
2025-06-25 22:47:42,931 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2647366968208'>
2025-06-25 22:47:42,931 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 708817b4-47ac-43b2-b7da-3fdce377398b
2025-06-25 22:47:42,935 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2647342785552'>
2025-06-25 22:47:42,936 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 708817b4-47ac-43b2-b7da-3fdce377398b, mode_filter: OperatingMode.PAPER
2025-06-25 22:47:42,937 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2647342785552'>
2025-06-25 22:47:42,937 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 708817b4-47ac-43b2-b7da-3fdce377398b
2025-06-25 22:47:42,939 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2647348303632'>
2025-06-25 22:47:42,941 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 708817b4-47ac-43b2-b7da-3fdce377398b, mode_filter: None
2025-06-25 22:47:42,941 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2647348303632'>
2025-06-25 22:47:42,941 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 2 performance entries for user 708817b4-47ac-43b2-b7da-3fdce377398b
2025-06-25 22:47:42,944 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2647367397776'>
2025-06-25 22:47:42,946 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 708817b4-47ac-43b2-b7da-3fdce377398b, mode_filter: OperatingMode.PAPER
2025-06-25 22:47:42,946 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2647367397776'>
2025-06-25 22:47:42,948 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 708817b4-47ac-43b2-b7da-3fdce377398b
2025-06-25 22:47:42,951 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2647346866384'>
2025-06-25 22:47:42,953 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 708817b4-47ac-43b2-b7da-3fdce377398b, mode_filter: OperatingMode.PAPER
2025-06-25 22:47:42,953 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2647346866384'>
2025-06-25 22:47:42,953 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 708817b4-47ac-43b2-b7da-3fdce377398b with mode_filter: OperatingMode.PAPER
2025-06-25 22:47:42,956 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2647344306704'>
2025-06-25 22:47:42,958 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 708817b4-47ac-43b2-b7da-3fdce377398b, mode_filter: OperatingMode.PAPER
2025-06-25 22:47:42,959 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2647344306704'>
2025-06-25 22:47:42,959 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 708817b4-47ac-43b2-b7da-3fdce377398b with mode_filter: OperatingMode.PAPER
2025-06-25 22:47:42,962 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2647367421008'>
2025-06-25 22:47:42,965 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 708817b4-47ac-43b2-b7da-3fdce377398b, mode_filter: OperatingMode.PAPER
2025-06-25 22:47:42,966 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2647367421008'>
2025-06-25 22:47:42,966 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 708817b4-47ac-43b2-b7da-3fdce377398b
2025-06-25 22:47:42,969 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2647343727056'>
2025-06-25 22:47:42,970 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 708817b4-47ac-43b2-b7da-3fdce377398b, mode_filter: OperatingMode.PAPER
2025-06-25 22:47:42,971 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2647343727056'>
2025-06-25 22:47:42,971 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 708817b4-47ac-43b2-b7da-3fdce377398b
2025-06-25 22:47:42,975 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2647346870992'>
2025-06-25 22:47:42,976 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 708817b4-47ac-43b2-b7da-3fdce377398b, mode_filter: OperatingMode.PAPER
2025-06-25 22:47:42,978 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2647346870992'>
2025-06-25 22:47:42,980 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 708817b4-47ac-43b2-b7da-3fdce377398b
2025-06-25 22:47:42,984 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2647343726736'>
2025-06-25 22:47:42,985 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 708817b4-47ac-43b2-b7da-3fdce377398b, mode_filter: OperatingMode.PAPER
2025-06-25 22:47:42,985 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2647343726736'>
2025-06-25 22:47:42,986 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 708817b4-47ac-43b2-b7da-3fdce377398b
2025-06-25 22:47:43,033 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario ecb79677-874e-473b-9dab-92d7ce7cd01a en modo paper
2025-06-25 22:47:43,039 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 1cb724c2-80ac-4749-b114-b0b745f88d05 en modo paper
2025-06-25 22:47:43,043 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario 7d4b313a-29b9-4f7c-8fd5-096aacb46def en modo paper
2025-06-25 22:47:43,048 - ultibot_backend.services.trading_report_service - ERROR - [MainThread] - trading_report_service.py:79 - Error al obtener trades cerrados para usuario b512372a-571c-4a12-85c6-17015de5912c: Database connection failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_report_service.py", line 65, in get_closed_trades
    trades = await persistence_service.get_closed_trades(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
Exception: Database connection failed
2025-06-25 22:47:43,060 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 1037ad0e-7072-41d2-8ea5-3cf699a3dc00 for symbol BTC/USDT
2025-06-25 22:47:43,062 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy 4d7834d9-9a9f-46db-9763-9897450b2e7b can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:47:43,062 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 1037ad0e-7072-41d2-8ea5-3cf699a3dc00 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:47:43,063 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 1037ad0e-7072-41d2-8ea5-3cf699a3dc00
2025-06-25 22:47:43,073 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity a30c55fd-f25a-42ab-bd84-696dc73df62d for symbol BTC/USDT
2025-06-25 22:47:43,075 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy b568d9f4-ef1c-4123-a788-5ac0fe225704 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:47:43,075 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity a30c55fd-f25a-42ab-bd84-696dc73df62d status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:47:43,076 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity a30c55fd-f25a-42ab-bd84-696dc73df62d
2025-06-25 22:47:43,086 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 95aae878-ff1d-46e6-9e00-af62543676db for symbol BTC/USDT
2025-06-25 22:47:43,087 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy b42ba001-b90d-4218-83c1-39d0d9baff23 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:47:43,088 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 95aae878-ff1d-46e6-9e00-af62543676db status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:47:43,088 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 95aae878-ff1d-46e6-9e00-af62543676db
2025-06-25 22:47:43,098 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 9d0ed5c5-6986-4c72-81a6-e9cbba09de04 for symbol BTC/USDT
2025-06-25 22:47:43,101 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy 56d6c50b-4c8c-4bfe-a928-223420593331 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:47:43,101 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 9d0ed5c5-6986-4c72-81a6-e9cbba09de04 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:47:43,102 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 9d0ed5c5-6986-4c72-81a6-e9cbba09de04
2025-06-25 22:47:43,111 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 4f2ad8a7-4945-40f9-a61d-9736771413b5 for symbol BTC/USDT
2025-06-25 22:47:43,112 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:659 - Unknown strategy type 'CUSTOM_UNKNOWN_TYPE' for strategy 86489a3b-a0b3-4f07-a5fc-aec2ddac3899. Recommending investigation.
2025-06-25 22:47:43,112 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 4f2ad8a7-4945-40f9-a61d-9736771413b5 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:47:43,114 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 4f2ad8a7-4945-40f9-a61d-9736771413b5
2025-06-25 22:47:43,124 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity aff36572-e68c-4245-bf6b-1d14f9a3fc5a for symbol BTC/USDT
2025-06-25 22:47:43,126 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy ab85b356-2bfe-4ef4-b39e-3c9bbc35ca01 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:47:43,126 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity aff36572-e68c-4245-bf6b-1d14f9a3fc5a status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:47:43,127 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity aff36572-e68c-4245-bf6b-1d14f9a3fc5a
2025-06-25 22:47:43,150 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 8d6a907c-1e0c-45de-8664-2bacc192b955 for symbol BTC/USDT
2025-06-25 22:47:43,151 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy 8109f7fa-082e-44e4-aca9-09c564c99846 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:47:43,151 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 8d6a907c-1e0c-45de-8664-2bacc192b955 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:47:43,152 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 8d6a907c-1e0c-45de-8664-2bacc192b955
2025-06-25 22:48:40,958 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:48:40,959 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:48:40,979 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:48:40,979 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:48:41,130 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:48:41,131 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:48:41,150 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:48:41,151 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:48:41,827 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:48:41,827 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:48:41,847 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:48:41,862 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:48:41,864 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:48:41,866 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:48:41,867 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:48:41,875 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:48:41,876 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:48:41,894 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:48:41,899 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:48:41,901 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:48:41,908 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:48:41,908 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:48:41,927 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:48:41,929 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:48:41,931 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:48:41,938 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:48:41,938 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:48:41,956 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:48:41,958 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:48:41,960 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:48:41,967 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:48:41,967 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:48:41,989 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:48:41,991 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:48:41,992 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:48:42,000 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:48:42,000 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:48:42,018 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:48:42,020 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:48:42,020 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:48:42,021 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:48:42,021 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:48:42,021 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:48:42,040 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:48:42,216 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:48:42,216 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:48:42,391 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:48:42,391 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:42,391 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:42,391 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:48:42,407 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:48:42,407 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000002226F209AD0>
2025-06-25 22:48:42,407 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:48:42,408 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:48:42,408 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 422
2025-06-25 22:48:42,419 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:48:42,419 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:48:42,529 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:48:42,530 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:48:42,531 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:48:42,531 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:48:42,705 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:48:42,705 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:48:42,883 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:48:42,884 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:42,884 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:42,884 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:48:42,886 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:48:42,886 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000002226F5553D0>
2025-06-25 22:48:42,888 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:48:42,888 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:48:42,898 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:48:42,907 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:48:42,907 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:48:42,916 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:48:42,916 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:48:42,933 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:48:42,935 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:48:42,935 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:48:42,935 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:48:43,109 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:48:43,110 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:48:43,286 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:48:43,286 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:43,286 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:43,287 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:48:43,291 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:48:43,291 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000002226F1D9AD0>
2025-06-25 22:48:43,291 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:48:43,291 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:48:43,294 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:48:43,302 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:48:43,302 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:48:43,303 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:48:43,309 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:48:43,309 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:48:43,310 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:48:43,311 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:48:43,320 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:48:43,320 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:48:43,341 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:48:43,342 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:48:43,343 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:48:43,343 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:48:43,520 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:48:43,520 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:48:43,691 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:48:43,692 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:43,692 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:43,692 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:48:43,695 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:48:43,695 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000002226F2C6210>
2025-06-25 22:48:43,695 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:48:43,696 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:48:43,700 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:48:43,706 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:48:43,707 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:48:43,708 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:48:43,714 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:48:43,714 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:48:43,724 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:48:43,725 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:48:43,744 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:48:43,745 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:48:43,746 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:48:43,746 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:48:43,922 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:48:43,923 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:48:44,096 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:48:44,097 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:44,097 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:44,097 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:48:44,101 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:48:44,101 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000002226F5159D0>
2025-06-25 22:48:44,101 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:48:44,101 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:48:44,105 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:48:44,112 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:48:44,112 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:48:44,113 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:48:44,119 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:48:44,120 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:48:44,129 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:48:44,129 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:48:44,151 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:48:44,153 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:48:44,153 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:48:44,154 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:48:44,329 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:48:44,329 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:48:44,501 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:48:44,501 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:44,501 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:44,503 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:48:44,506 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:48:44,506 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000002226F491AD0>
2025-06-25 22:48:44,506 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:48:44,506 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:48:44,508 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 422
2025-06-25 22:48:44,525 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 090d723f-ea3b-4a93-8071-8e31cc7e17a4
2025-06-25 22:48:44,526 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:152 - User configuration saved after initializing last_daily_reset for user 1bdde581-bc52-4d7c-be81-78739be8af8a.
2025-06-25 22:48:44,528 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 200.000
2025-06-25 22:48:44,528 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity 090d723f-ea3b-4a93-8071-8e31cc7e17a4
2025-06-25 22:48:44,528 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:48:44,528 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 6557c24d-ef3d-4c42-a9b3-9918402fbc5f from decision c2243722-2910-40b7-8dfe-a02876ec62ef
2025-06-25 22:48:44,529 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 090d723f-ea3b-4a93-8071-8e31cc7e17a4: 'str' object has no attribute 'value'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 259, in execute_trade_from_confirmed_opportunity
    side=trade.side.value.upper(), # Asegurar que se use el valor string del enum
         ^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'value'
2025-06-25 22:48:44,531 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 090d723f-ea3b-4a93-8071-8e31cc7e17a4 status to error_in_processing: Failed to execute trade: 'str' object has no attribute 'value'
2025-06-25 22:48:44,532 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 090d723f-ea3b-4a93-8071-8e31cc7e17a4
2025-06-25 22:48:44,847 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 9a75cfb0-8e53-4df3-bc9d-0a32f096e2f3
2025-06-25 22:48:44,847 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 4800.0, Riesgo Potencial Trade USD: 300.000
2025-06-25 22:48:44,849 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:191 - Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:48:44,849 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 9a75cfb0-8e53-4df3-bc9d-0a32f096e2f3 status to error_in_processing: Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:48:44,851 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 9a75cfb0-8e53-4df3-bc9d-0a32f096e2f3
2025-06-25 22:48:44,862 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity b0127572-78a7-426e-8bca-f54ef5f75ced
2025-06-25 22:48:44,864 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:143 - Daily capital reset triggered for user 16b558d2-4963-4bbc-9813-612335228590. Resetting daily_capital_risked_usd.
2025-06-25 22:48:44,864 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:147 - User configuration saved after daily capital reset for user 16b558d2-4963-4bbc-9813-612335228590.
2025-06-25 22:48:44,864 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 2500.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 100.000
2025-06-25 22:48:44,864 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity b0127572-78a7-426e-8bca-f54ef5f75ced
2025-06-25 22:48:44,865 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:48:44,865 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 49781849-369a-41e4-8c16-ddff14dac0e6 from decision 7b43404f-5e9a-44be-a198-c67526f54417
2025-06-25 22:48:44,865 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity b0127572-78a7-426e-8bca-f54ef5f75ced: 'str' object has no attribute 'value'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 259, in execute_trade_from_confirmed_opportunity
    side=trade.side.value.upper(), # Asegurar que se use el valor string del enum
         ^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'value'
2025-06-25 22:48:44,868 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity b0127572-78a7-426e-8bca-f54ef5f75ced status to error_in_processing: Failed to execute trade: 'str' object has no attribute 'value'
2025-06-25 22:48:44,869 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity b0127572-78a7-426e-8bca-f54ef5f75ced
2025-06-25 22:48:44,891 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:48:44,891 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:48:44,910 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:48:44,911 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 22:48:44,912 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:48:44,912 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:48:45,092 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:48:45,092 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:48:45,272 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:48:45,272 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:45,273 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:45,273 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:48:45,275 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:48:45,276 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000022270960550>
2025-06-25 22:48:45,276 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:48:45,276 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:48:45,276 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:497 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 22:48:45,280 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"cc5acc9c-3fad-4365-b624-17ffccd4b09b","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:48:44.884049Z","submittedAt":"2025-06-26T02:48:44.884049Z","fillTimestamp":"2025-06-26T02:48:44.884049Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:48:44.884049Z","opened_at":"2025-06-26T02:48:44.884049Z","updated_at":"2025-06-26T02:48:44.884049Z","closed_at":"2025-06-26T02:48:44.884049Z"}
2025-06-25 22:48:45,281 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': 'cc5acc9c-3fad-4365-b624-17ffccd4b09b', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:48:44.884049Z', 'submittedAt': '2025-06-26T02:48:44.884049Z', 'fillTimestamp': '2025-06-26T02:48:44.884049Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:48:44.884049Z', 'opened_at': '2025-06-26T02:48:44.884049Z', 'updated_at': '2025-06-26T02:48:44.884049Z', 'closed_at': '2025-06-26T02:48:44.884049Z'}
2025-06-25 22:48:45,281 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"de0f43ee-72e8-4cf2-b290-9121fc66ca80","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:48:44.884049Z","submittedAt":"2025-06-26T02:48:44.884049Z","fillTimestamp":"2025-06-26T02:48:44.884049Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:48:44.884049Z","opened_at":"2025-06-26T02:48:44.884049Z","updated_at":"2025-06-26T02:48:44.884049Z","closed_at":"2025-06-26T02:48:44.884049Z"}
2025-06-25 22:48:45,281 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': 'de0f43ee-72e8-4cf2-b290-9121fc66ca80', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:48:44.884049Z', 'submittedAt': '2025-06-26T02:48:44.884049Z', 'fillTimestamp': '2025-06-26T02:48:44.884049Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:48:44.884049Z', 'opened_at': '2025-06-26T02:48:44.884049Z', 'updated_at': '2025-06-26T02:48:44.884049Z', 'closed_at': '2025-06-26T02:48:44.884049Z'}
2025-06-25 22:48:45,282 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"f4b624c9-e134-482e-b546-26ad5f8bbca2","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:48:44.884049Z","submittedAt":"2025-06-26T02:48:44.884049Z","fillTimestamp":"2025-06-26T02:48:44.884049Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:48:44.884049Z","opened_at":"2025-06-26T02:48:44.884049Z","updated_at":"2025-06-26T02:48:44.884049Z","closed_at":"2025-06-26T02:48:44.884049Z"}
2025-06-25 22:48:45,282 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': 'f4b624c9-e134-482e-b546-26ad5f8bbca2', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:48:44.884049Z', 'submittedAt': '2025-06-26T02:48:44.884049Z', 'fillTimestamp': '2025-06-26T02:48:44.884049Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:48:44.884049Z', 'opened_at': '2025-06-26T02:48:44.884049Z', 'updated_at': '2025-06-26T02:48:44.884049Z', 'closed_at': '2025-06-26T02:48:44.884049Z'}
2025-06-25 22:48:45,282 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:547 - get_closed_trades - Trades recuperados: 3
2025-06-25 22:48:45,283 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:48:45,283 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 22:48:45,302 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:48:45,303 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:48:45,323 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:48:45,324 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 22:48:45,324 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:48:45,325 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:48:45,502 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:48:45,503 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:48:45,681 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:48:45,682 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:45,682 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:45,682 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:48:45,685 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:48:45,685 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000222708FA410>
2025-06-25 22:48:45,685 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:48:45,685 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:48:45,685 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:497 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: BTCUSDT, start_date: None, end_date: None
2025-06-25 22:48:45,689 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"1b0c1695-8bc5-470d-80a5-402b9c4eee35","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:48:45.292276Z","submittedAt":"2025-06-26T02:48:45.292276Z","fillTimestamp":"2025-06-26T02:48:45.292276Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:48:45.292276Z","opened_at":"2025-06-26T02:48:45.292276Z","updated_at":"2025-06-26T02:48:45.292276Z","closed_at":"2025-06-26T02:48:45.292276Z"}
2025-06-25 22:48:45,689 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '1b0c1695-8bc5-470d-80a5-402b9c4eee35', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:48:45.292276Z', 'submittedAt': '2025-06-26T02:48:45.292276Z', 'fillTimestamp': '2025-06-26T02:48:45.292276Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:48:45.292276Z', 'opened_at': '2025-06-26T02:48:45.292276Z', 'updated_at': '2025-06-26T02:48:45.292276Z', 'closed_at': '2025-06-26T02:48:45.292276Z'}
2025-06-25 22:48:45,689 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:547 - get_closed_trades - Trades recuperados: 1
2025-06-25 22:48:45,690 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 1 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:48:45,690 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 22:48:45,705 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:48:45,707 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:48:45,723 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:48:45,725 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 22:48:45,725 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:48:45,725 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:48:45,905 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:48:45,906 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:48:46,093 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:48:46,094 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:46,094 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:46,094 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:48:46,096 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:48:46,098 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000022270A5F7D0>
2025-06-25 22:48:46,098 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:48:46,098 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:48:46,098 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:497 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 22:48:46,101 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"06ee2bc2-ca3b-4c6b-b9d4-ef852f9ee612","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:48:45.700354Z","submittedAt":"2025-06-26T02:48:45.700354Z","fillTimestamp":"2025-06-26T02:48:45.700354Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:48:45.700354Z","opened_at":"2025-06-26T02:48:45.700354Z","updated_at":"2025-06-26T02:48:45.700354Z","closed_at":"2025-06-26T02:48:45.700354Z"}
2025-06-25 22:48:46,102 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '06ee2bc2-ca3b-4c6b-b9d4-ef852f9ee612', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:48:45.700354Z', 'submittedAt': '2025-06-26T02:48:45.700354Z', 'fillTimestamp': '2025-06-26T02:48:45.700354Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:48:45.700354Z', 'opened_at': '2025-06-26T02:48:45.700354Z', 'updated_at': '2025-06-26T02:48:45.700354Z', 'closed_at': '2025-06-26T02:48:45.700354Z'}
2025-06-25 22:48:46,102 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"9d97e1b9-24d7-453c-a10c-a7fe3ae98892","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:48:45.700354Z","submittedAt":"2025-06-26T02:48:45.700354Z","fillTimestamp":"2025-06-26T02:48:45.700354Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:48:45.700354Z","opened_at":"2025-06-26T02:48:45.700354Z","updated_at":"2025-06-26T02:48:45.700354Z","closed_at":"2025-06-26T02:48:45.700354Z"}
2025-06-25 22:48:46,102 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': '9d97e1b9-24d7-453c-a10c-a7fe3ae98892', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:48:45.700354Z', 'submittedAt': '2025-06-26T02:48:45.700354Z', 'fillTimestamp': '2025-06-26T02:48:45.700354Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:48:45.700354Z', 'opened_at': '2025-06-26T02:48:45.700354Z', 'updated_at': '2025-06-26T02:48:45.700354Z', 'closed_at': '2025-06-26T02:48:45.700354Z'}
2025-06-25 22:48:46,103 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"69e08fc5-e4d4-4c1e-8d03-f960b134b92c","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:48:45.700354Z","submittedAt":"2025-06-26T02:48:45.700354Z","fillTimestamp":"2025-06-26T02:48:45.700354Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:48:45.700354Z","opened_at":"2025-06-26T02:48:45.700354Z","updated_at":"2025-06-26T02:48:45.700354Z","closed_at":"2025-06-26T02:48:45.700354Z"}
2025-06-25 22:48:46,103 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '69e08fc5-e4d4-4c1e-8d03-f960b134b92c', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:48:45.700354Z', 'submittedAt': '2025-06-26T02:48:45.700354Z', 'fillTimestamp': '2025-06-26T02:48:45.700354Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:48:45.700354Z', 'opened_at': '2025-06-26T02:48:45.700354Z', 'updated_at': '2025-06-26T02:48:45.700354Z', 'closed_at': '2025-06-26T02:48:45.700354Z'}
2025-06-25 22:48:46,103 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:547 - get_closed_trades - Trades recuperados: 3
2025-06-25 22:48:46,104 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:48:46,104 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 22:48:46,123 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:48:46,123 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:48:46,140 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:48:46,142 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 22:48:46,142 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:48:46,143 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:48:46,313 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:48:46,314 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:48:46,492 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:48:46,492 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:46,492 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:46,493 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:48:46,495 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:48:46,495 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000222709FB310>
2025-06-25 22:48:46,495 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:48:46,496 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:48:46,496 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:497 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: 2025-06-27 02:48:46.141509+00:00, end_date: None
2025-06-25 22:48:46,501 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:547 - get_closed_trades - Trades recuperados: 0
2025-06-25 22:48:46,501 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:48:46,502 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 22:48:46,546 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity c943558a-fc21-4386-9732-e628605a6481 for symbol BTCUSDT
2025-06-25 22:48:46,546 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: b59026fe-28da-43b7-9498-011937484f24
2025-06-25 22:48:46,548 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy 2c80df0b-1ce3-47ab-adc9-20be0d0f6572 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:48:46,557 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity dc8ab649-dac9-4e60-a6e2-bc3e6ff2c05b for symbol BTCUSDT
2025-06-25 22:48:46,558 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy 44d32b97-f6cd-4ed7-9def-a63c8dd38c28 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:48:46,564 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity ebbe701e-eb4a-4fca-8f47-e67734cc4251 for symbol ETHUSDT
2025-06-25 22:48:46,564 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 2ca9e3b4-93ca-48e1-a10a-fb2c44b8facf
2025-06-25 22:48:46,566 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:610 - No active and applicable strategies found for opportunity ebbe701e-eb4a-4fca-8f47-e67734cc4251 with symbol ETHUSDT.
2025-06-25 22:48:46,566 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity ebbe701e-eb4a-4fca-8f47-e67734cc4251 status to rejected_by_system: No active strategies are applicable to this opportunity's symbol.
2025-06-25 22:48:46,566 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity ebbe701e-eb4a-4fca-8f47-e67734cc4251
2025-06-25 22:48:46,575 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 339e7e4b-9bbb-4a1f-9bcf-274004d4f686 for symbol BTCUSDT
2025-06-25 22:48:46,576 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: a82f42b9-1f77-4dba-ae05-385698062152
2025-06-25 22:48:46,576 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:723 - AI confidence 0.65 for strategy b3a6b228-c948-46f5-aec7-8c764c1b5afe is below threshold 0.8.
2025-06-25 22:48:46,578 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:738 - Strategy b3a6b228-c948-46f5-aec7-8c764c1b5afe did not produce a decision for opportunity 339e7e4b-9bbb-4a1f-9bcf-274004d4f686.
2025-06-25 22:48:46,578 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:629 - No affirmative trading decisions made for opportunity 339e7e4b-9bbb-4a1f-9bcf-274004d4f686.
2025-06-25 22:48:46,586 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 1465dc33-7d82-4c78-84dd-7adbc888f103 for symbol BTCUSDT
2025-06-25 22:48:46,587 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: f1d0b172-dfb1-46f3-8ee2-3aa3fd727208
2025-06-25 22:48:46,594 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 7b69779a-2706-421b-9b0f-2369db81df00 for symbol BTCUSDT
2025-06-25 22:48:46,594 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: df60732d-b827-46cf-af8f-0f90fbcf232c
2025-06-25 22:48:46,603 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:48:46,603 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 69eed63a-2cd3-4964-a90c-d43b170a592c from decision 8037b3b6-5514-43df-8e55-722afbaecf9a
2025-06-25 22:48:46,608 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:48:46,609 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 044a1dfa-7725-408a-8045-c778522750b1 from decision 2cea1028-37a4-4f06-b679-cd277014c2cb
2025-06-25 22:48:46,609 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: sell
2025-06-25 22:48:46,609 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade bcd85ab1-0edc-4370-8289-f707b0006489 from decision 2cea1028-37a4-4f06-b679-cd277014c2cb
2025-06-25 22:48:46,615 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:46,615 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:46,625 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:48:46,625 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:48:46,628 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:48:46,630 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity c1e5767b-e452-43cf-be39-66a8b5d2715f
2025-06-25 22:48:46,634 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 96c8876d-6b4e-4bfc-9cd1-27b33dae9edf. Creando y guardando configuración por defecto.
2025-06-25 22:48:46,638 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:48:46,640 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 96c8876d-6b4e-4bfc-9cd1-27b33dae9edf. Using default values.
2025-06-25 22:48:46,640 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 96c8876d-6b4e-4bfc-9cd1-27b33dae9edf with capital: 10000.0
2025-06-25 22:48:46,641 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:48:46,641 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:48:46,642 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:48:46,642 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity c1e5767b-e452-43cf-be39-66a8b5d2715f
2025-06-25 22:48:46,642 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:48:46,642 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 361a535b-847c-4429-a889-834822d9adc1 from decision a303ed33-2b73-4afd-8df9-1d7b70d27758
2025-06-25 22:48:46,643 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity c1e5767b-e452-43cf-be39-66a8b5d2715f: 'str' object has no attribute 'value'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 259, in execute_trade_from_confirmed_opportunity
    side=trade.side.value.upper(), # Asegurar que se use el valor string del enum
         ^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'value'
2025-06-25 22:48:46,671 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:48:46,672 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:48:46,682 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:46,682 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:46,690 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:48:46,691 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:48:46,693 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:48:46,695 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:48:46,695 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:48:46,704 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:46,704 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:46,713 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:48:46,714 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:48:46,715 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:48:46,718 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 348a641f-726c-4c68-8b8f-7a7b5c31f3d8 for symbol BTC/USDT
2025-06-25 22:48:46,721 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 16eefdb1-9375-42a6-a32c-843ee8cc1389. Creando y guardando configuración por defecto.
2025-06-25 22:48:46,724 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:48:46,726 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:678 - AI profile 'ai-profile-scalping-1' for strategy 91e7d4f0-77df-4d3e-ae27-55a7813840fd not found. Skipping AI analysis.
2025-06-25 22:48:46,726 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy 91e7d4f0-77df-4d3e-ae27-55a7813840fd can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:48:46,726 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 348a641f-726c-4c68-8b8f-7a7b5c31f3d8 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:48:46,732 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 348a641f-726c-4c68-8b8f-7a7b5c31f3d8
2025-06-25 22:48:46,733 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:48:46,734 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:48:46,743 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:46,743 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:46,751 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:48:46,752 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:48:46,756 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:48:46,757 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity e61366fc-461f-4b87-b349-3a0d695ec270
2025-06-25 22:48:46,760 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id e97ec6c5-7ecf-40be-ae31-eb45472755d6. Creando y guardando configuración por defecto.
2025-06-25 22:48:46,762 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:48:46,766 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for e97ec6c5-7ecf-40be-ae31-eb45472755d6. Using default values.
2025-06-25 22:48:46,766 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for e97ec6c5-7ecf-40be-ae31-eb45472755d6 with capital: 10000.0
2025-06-25 22:48:46,768 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:48:46,768 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:48:46,768 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:48:46,768 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Autonomous Scalping' as context for confirmed opportunity e61366fc-461f-4b87-b349-3a0d695ec270
2025-06-25 22:48:46,768 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:48:46,769 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 9125e8f6-805e-4ed5-a314-6a22cd76dbe7 from decision 8395293d-2052-433d-9471-4a474d323c08
2025-06-25 22:48:46,769 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity e61366fc-461f-4b87-b349-3a0d695ec270: 'str' object has no attribute 'value'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 259, in execute_trade_from_confirmed_opportunity
    side=trade.side.value.upper(), # Asegurar que se use el valor string del enum
         ^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'value'
2025-06-25 22:48:46,894 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:48:46,896 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:48:46,905 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:46,905 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:46,912 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:48:46,912 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:48:46,916 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:48:46,918 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 647ff0bb-603a-432b-99f0-8d69e0f4547c
2025-06-25 22:48:46,921 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 68193de2-1c06-4ad9-a299-e4dba49ae487. Creando y guardando configuración por defecto.
2025-06-25 22:48:46,924 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:48:46,926 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 68193de2-1c06-4ad9-a299-e4dba49ae487. Using default values.
2025-06-25 22:48:46,926 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 68193de2-1c06-4ad9-a299-e4dba49ae487 with capital: 10000.0
2025-06-25 22:48:46,927 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:48:46,928 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:48:46,928 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:48:46,929 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity 647ff0bb-603a-432b-99f0-8d69e0f4547c
2025-06-25 22:48:46,929 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:48:46,929 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 9da43c45-e577-4433-b8eb-3b8165d83a39 from decision 82331300-df74-4488-bc29-fca72ec3a274
2025-06-25 22:48:46,930 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 647ff0bb-603a-432b-99f0-8d69e0f4547c: 'str' object has no attribute 'value'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 259, in execute_trade_from_confirmed_opportunity
    side=trade.side.value.upper(), # Asegurar que se use el valor string del enum
         ^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'value'
2025-06-25 22:48:46,956 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:48:46,957 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:48:46,967 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:46,968 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:46,976 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:48:46,976 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:48:46,978 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:48:46,980 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 982cb23a-a2ff-4384-807b-758d63e6773d
2025-06-25 22:48:46,984 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id ab19dcfb-1b9a-4b18-bad4-a00519e422e5. Creando y guardando configuración por defecto.
2025-06-25 22:48:46,986 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:48:46,991 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for ab19dcfb-1b9a-4b18-bad4-a00519e422e5. Using default values.
2025-06-25 22:48:46,991 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for ab19dcfb-1b9a-4b18-bad4-a00519e422e5 with capital: 10000.0
2025-06-25 22:48:46,992 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:48:46,993 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:48:46,993 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:48:46,994 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Day Trading Strategy' as context for confirmed opportunity 982cb23a-a2ff-4384-807b-758d63e6773d
2025-06-25 22:48:46,995 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:48:46,995 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 83653e60-dc57-4694-90fc-b79392aab934 from decision 56a00221-4eb5-4519-8c30-d9de1d6a2ce9
2025-06-25 22:48:46,996 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 982cb23a-a2ff-4384-807b-758d63e6773d: 'str' object has no attribute 'value'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 259, in execute_trade_from_confirmed_opportunity
    side=trade.side.value.upper(), # Asegurar que se use el valor string del enum
         ^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'value'
2025-06-25 22:48:47,021 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:48:47,023 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:48:47,032 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:47,032 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:47,039 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:48:47,039 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:48:47,042 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:48:47,045 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:48:47,045 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 66963f16-292f-42bb-b9c7-72d98bc4b6f2 from decision 754df4eb-de13-4e15-a961-6fefa23677a3
2025-06-25 22:48:47,046 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:48:47,047 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:48:47,055 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:47,056 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:47,064 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:48:47,064 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:48:47,066 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:48:47,067 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:48:47,068 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 553e26dc-50b7-4e79-b106-2069b14b2baa from decision 94935b5e-52b5-488b-883d-38888ce3469d
2025-06-25 22:48:47,069 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:48:47,070 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:48:47,077 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:47,078 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:47,086 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:48:47,086 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:48:47,089 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:48:47,090 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:48:47,091 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:48:49,072 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:49,073 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:49,078 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:48:49,079 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:48:49,081 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:48:49,089 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:48:49,093 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:48:49,094 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:48:49,098 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:48:49,104 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:48:49,108 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:48:49,111 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:49,112 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:49,117 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:49,117 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:49,119 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:48:49,123 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:49,124 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:49,131 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:49,131 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:49,139 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:49,139 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:49,142 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:48:49,146 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:49,146 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:49,150 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:286 - Verificación de Binance BINANCE_SPOT exitosa.
2025-06-25 22:48:49,155 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:49,155 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:49,158 - ultibot_backend.services.credential_service - ERROR - [MainThread] - credential_service.py:315 - Error de Binance API durante la verificación: Binance Down
2025-06-25 22:48:49,164 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:49,164 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:49,169 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:48:49,173 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:48:49,173 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:48:49,177 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:241 - Verificación de Telegram exitosa.
2025-06-25 22:48:49,184 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:72 - Conexión con Binance exitosa.
2025-06-25 22:48:49,190 - ultibot_backend.services.market_data_service - WARNING - [MainThread] - market_data_service.py:52 - Credenciales de Binance no encontradas. Por favor, configúrelas.
2025-06-25 22:48:49,195 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:69 - Fallo en la verificación de conexión con Binance. Revise sus credenciales y permisos.
2025-06-25 22:48:49,200 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:77 - Error al acceder a las credenciales de Binance: Decryption failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 45, in get_binance_connection_status
    binance_credential = await self.credential_service.get_credential(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.CredentialError: Decryption failed
2025-06-25 22:48:49,206 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:81 - Error de la API de Binance: API unavailable
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 61, in get_binance_connection_status
    is_connected = await self.credential_service.verify_credential(binance_credential)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.BinanceAPIError: API unavailable
2025-06-25 22:48:49,210 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:48:49,220 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:121 - Error de la API de Binance al obtener balances: Failed to fetch balances
2025-06-25 22:48:49,224 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2346941617424'>
2025-06-25 22:48:49,225 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 274e6138-e6b6-4f22-a802-f4239e692c3f, mode_filter: None
2025-06-25 22:48:49,226 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2346941617424'>
2025-06-25 22:48:49,226 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 274e6138-e6b6-4f22-a802-f4239e692c3f with mode_filter: None
2025-06-25 22:48:49,229 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2346942063888'>
2025-06-25 22:48:49,230 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 274e6138-e6b6-4f22-a802-f4239e692c3f, mode_filter: None
2025-06-25 22:48:49,230 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2346942063888'>
2025-06-25 22:48:49,230 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 274e6138-e6b6-4f22-a802-f4239e692c3f with mode_filter: None
2025-06-25 22:48:49,234 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2346940322064'>
2025-06-25 22:48:49,237 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 274e6138-e6b6-4f22-a802-f4239e692c3f, mode_filter: OperatingMode.PAPER
2025-06-25 22:48:49,237 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2346940322064'>
2025-06-25 22:48:49,238 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 274e6138-e6b6-4f22-a802-f4239e692c3f
2025-06-25 22:48:49,240 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2346944715216'>
2025-06-25 22:48:49,242 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 274e6138-e6b6-4f22-a802-f4239e692c3f, mode_filter: OperatingMode.PAPER
2025-06-25 22:48:49,242 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2346944715216'>
2025-06-25 22:48:49,242 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 274e6138-e6b6-4f22-a802-f4239e692c3f
2025-06-25 22:48:49,245 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2346921276368'>
2025-06-25 22:48:49,246 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 274e6138-e6b6-4f22-a802-f4239e692c3f, mode_filter: OperatingMode.REAL
2025-06-25 22:48:49,247 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2346921276368'>
2025-06-25 22:48:49,247 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 274e6138-e6b6-4f22-a802-f4239e692c3f
2025-06-25 22:48:49,250 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2346921297424'>
2025-06-25 22:48:49,253 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 274e6138-e6b6-4f22-a802-f4239e692c3f, mode_filter: OperatingMode.PAPER
2025-06-25 22:48:49,253 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2346921297424'>
2025-06-25 22:48:49,253 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 274e6138-e6b6-4f22-a802-f4239e692c3f
2025-06-25 22:48:49,257 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2346941332048'>
2025-06-25 22:48:49,258 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 274e6138-e6b6-4f22-a802-f4239e692c3f, mode_filter: None
2025-06-25 22:48:49,259 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2346941332048'>
2025-06-25 22:48:49,259 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 2 performance entries for user 274e6138-e6b6-4f22-a802-f4239e692c3f
2025-06-25 22:48:49,262 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2346916358864'>
2025-06-25 22:48:49,263 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 274e6138-e6b6-4f22-a802-f4239e692c3f, mode_filter: OperatingMode.PAPER
2025-06-25 22:48:49,263 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2346916358864'>
2025-06-25 22:48:49,263 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 274e6138-e6b6-4f22-a802-f4239e692c3f
2025-06-25 22:48:49,267 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2346917323344'>
2025-06-25 22:48:49,269 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 274e6138-e6b6-4f22-a802-f4239e692c3f, mode_filter: OperatingMode.PAPER
2025-06-25 22:48:49,270 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2346917323344'>
2025-06-25 22:48:49,270 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 274e6138-e6b6-4f22-a802-f4239e692c3f with mode_filter: OperatingMode.PAPER
2025-06-25 22:48:49,275 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2346942413136'>
2025-06-25 22:48:49,277 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 274e6138-e6b6-4f22-a802-f4239e692c3f, mode_filter: OperatingMode.PAPER
2025-06-25 22:48:49,277 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2346942413136'>
2025-06-25 22:48:49,277 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 274e6138-e6b6-4f22-a802-f4239e692c3f with mode_filter: OperatingMode.PAPER
2025-06-25 22:48:49,280 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2346919255760'>
2025-06-25 22:48:49,282 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 274e6138-e6b6-4f22-a802-f4239e692c3f, mode_filter: OperatingMode.PAPER
2025-06-25 22:48:49,283 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2346919255760'>
2025-06-25 22:48:49,283 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 274e6138-e6b6-4f22-a802-f4239e692c3f
2025-06-25 22:48:49,286 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2346941322768'>
2025-06-25 22:48:49,289 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 274e6138-e6b6-4f22-a802-f4239e692c3f, mode_filter: OperatingMode.PAPER
2025-06-25 22:48:49,289 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2346941322768'>
2025-06-25 22:48:49,289 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 274e6138-e6b6-4f22-a802-f4239e692c3f
2025-06-25 22:48:49,293 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2346942405456'>
2025-06-25 22:48:49,294 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 274e6138-e6b6-4f22-a802-f4239e692c3f, mode_filter: OperatingMode.PAPER
2025-06-25 22:48:49,295 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2346942405456'>
2025-06-25 22:48:49,295 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 274e6138-e6b6-4f22-a802-f4239e692c3f
2025-06-25 22:48:49,297 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2346940822416'>
2025-06-25 22:48:49,299 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 274e6138-e6b6-4f22-a802-f4239e692c3f, mode_filter: OperatingMode.PAPER
2025-06-25 22:48:49,300 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2346940822416'>
2025-06-25 22:48:49,300 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 274e6138-e6b6-4f22-a802-f4239e692c3f
2025-06-25 22:48:49,345 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario d85e56e9-ce5c-463c-8d24-4dacd3d2095b en modo paper
2025-06-25 22:48:49,351 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 95577636-6b39-4c15-bd4d-59b4501c578a en modo paper
2025-06-25 22:48:49,356 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario ffd40f2d-1d7a-46ef-afe7-02de27292b0b en modo paper
2025-06-25 22:48:49,360 - ultibot_backend.services.trading_report_service - ERROR - [MainThread] - trading_report_service.py:79 - Error al obtener trades cerrados para usuario dace4f7d-5fd3-4da3-a128-357327817136: Database connection failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_report_service.py", line 65, in get_closed_trades
    trades = await persistence_service.get_closed_trades(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
Exception: Database connection failed
2025-06-25 22:48:49,371 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity a6d64dfa-ba9c-4c6c-9461-503d952a6bed for symbol BTC/USDT
2025-06-25 22:48:49,373 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy 79eb29b2-4779-44a8-8e3f-253e0faf8d67 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:48:49,373 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity a6d64dfa-ba9c-4c6c-9461-503d952a6bed status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:48:49,374 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity a6d64dfa-ba9c-4c6c-9461-503d952a6bed
2025-06-25 22:48:49,384 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 45ed7fc6-82bf-4e6d-bf1f-d7d6f9401f61 for symbol BTC/USDT
2025-06-25 22:48:49,386 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy 8e053a21-edc9-421f-8148-a9967b541cb4 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:48:49,386 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 45ed7fc6-82bf-4e6d-bf1f-d7d6f9401f61 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:48:49,387 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 45ed7fc6-82bf-4e6d-bf1f-d7d6f9401f61
2025-06-25 22:48:49,395 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 96e5d323-39c3-4393-ad54-b67f34fd29d1 for symbol BTC/USDT
2025-06-25 22:48:49,397 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy 31a3754b-e6b9-4e81-8818-15ceaea2a954 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:48:49,397 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 96e5d323-39c3-4393-ad54-b67f34fd29d1 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:48:49,398 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 96e5d323-39c3-4393-ad54-b67f34fd29d1
2025-06-25 22:48:49,410 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 27000910-4fcd-4bf2-88cc-105008050cc2 for symbol BTC/USDT
2025-06-25 22:48:49,412 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy a8b10c31-61d8-491a-ad92-cf7c30ab0a31 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:48:49,412 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 27000910-4fcd-4bf2-88cc-105008050cc2 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:48:49,413 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 27000910-4fcd-4bf2-88cc-105008050cc2
2025-06-25 22:48:49,425 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 5982da1b-34ae-4885-b973-d024303789fc for symbol BTC/USDT
2025-06-25 22:48:49,425 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:659 - Unknown strategy type 'CUSTOM_UNKNOWN_TYPE' for strategy 8f394647-457e-4d46-a4c4-40ed1a1e147b. Recommending investigation.
2025-06-25 22:48:49,426 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 5982da1b-34ae-4885-b973-d024303789fc status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:48:49,426 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 5982da1b-34ae-4885-b973-d024303789fc
2025-06-25 22:48:49,437 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 5f6bcb1a-9898-4b6b-ae40-2112c87f64df for symbol BTC/USDT
2025-06-25 22:48:49,439 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy a776fabf-aa65-4086-887c-c2a194e8a382 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:48:49,439 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 5f6bcb1a-9898-4b6b-ae40-2112c87f64df status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:48:49,440 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 5f6bcb1a-9898-4b6b-ae40-2112c87f64df
2025-06-25 22:48:49,464 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 861a5d89-121b-4687-9acc-ad2ce2ab7626 for symbol BTC/USDT
2025-06-25 22:48:49,466 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy 4d5258f0-ea5e-47a4-9f44-08139ba5d590 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:48:49,466 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 861a5d89-121b-4687-9acc-ad2ce2ab7626 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:48:49,467 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 861a5d89-121b-4687-9acc-ad2ce2ab7626
2025-06-25 22:49:35,031 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:49:35,031 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:49:35,050 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:49:35,050 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:49:35,206 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:49:35,206 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:49:35,225 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:49:35,225 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:49:35,899 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:49:35,899 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:49:35,919 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:49:35,934 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:49:35,936 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:49:35,938 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:49:35,939 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:49:35,949 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:49:35,949 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:49:35,970 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:49:35,974 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:49:35,976 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:49:35,982 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:49:35,983 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:49:36,001 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:49:36,005 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:49:36,007 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:49:36,015 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:49:36,015 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:49:36,034 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:49:36,036 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:49:36,039 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:49:36,046 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:49:36,048 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:49:36,068 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:49:36,071 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:49:36,072 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:49:36,081 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:49:36,081 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:49:36,099 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:49:36,102 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:49:36,102 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:49:36,102 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:49:36,103 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:49:36,103 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:49:36,126 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:49:36,304 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:49:36,305 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:49:36,478 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:49:36,479 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:36,479 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:36,479 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:49:36,495 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:49:36,495 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000002052594CCD0>
2025-06-25 22:49:36,495 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:49:36,495 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:49:36,496 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 422
2025-06-25 22:49:36,506 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:49:36,506 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:49:36,617 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:49:36,619 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:49:36,619 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:49:36,619 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:49:36,792 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:49:36,793 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:49:36,969 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:49:36,969 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:36,970 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:36,970 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:49:36,973 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:49:36,973 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000020525C41550>
2025-06-25 22:49:36,973 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:49:36,974 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:49:36,983 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:49:36,992 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:49:36,992 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:49:37,002 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:49:37,003 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:49:37,022 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:49:37,024 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:49:37,025 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:49:37,025 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:49:37,201 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:49:37,202 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:49:37,373 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:49:37,373 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:37,373 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:37,374 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:49:37,376 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:49:37,377 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000205259863D0>
2025-06-25 22:49:37,377 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:49:37,378 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:49:37,381 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:49:37,389 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:49:37,390 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:49:37,391 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:49:37,396 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:49:37,396 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:49:37,398 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:49:37,398 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:49:37,406 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:49:37,406 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:49:37,426 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:49:37,427 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:49:37,427 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:49:37,427 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:49:37,599 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:49:37,600 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:49:37,770 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:49:37,771 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:37,771 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:37,771 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:49:37,774 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:49:37,775 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000020525C413D0>
2025-06-25 22:49:37,775 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:49:37,775 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:49:37,778 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:49:37,786 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:49:37,786 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:49:37,787 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:49:37,792 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:49:37,792 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:49:37,803 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:49:37,803 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:49:37,821 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:49:37,822 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:49:37,823 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:49:37,823 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:49:37,995 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:49:37,996 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:49:38,166 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:49:38,167 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:38,167 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:38,167 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:49:38,170 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:49:38,171 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000020525C05050>
2025-06-25 22:49:38,171 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:49:38,171 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:49:38,175 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:49:38,181 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:49:38,182 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:49:38,183 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:49:38,188 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:49:38,190 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:49:38,199 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:49:38,200 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:49:38,218 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:49:38,220 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:49:38,221 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:49:38,221 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:49:38,396 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:49:38,396 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:49:38,571 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:49:38,571 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:38,571 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:38,572 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:49:38,575 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:49:38,575 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000205259C27D0>
2025-06-25 22:49:38,575 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:49:38,575 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:49:38,576 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 422
2025-06-25 22:49:38,596 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 87fc1a01-603e-4a4f-8238-342d652577ac
2025-06-25 22:49:38,597 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:152 - User configuration saved after initializing last_daily_reset for user 300c316c-bd01-4142-96d1-59e48d6630b3.
2025-06-25 22:49:38,597 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 200.000
2025-06-25 22:49:38,597 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity 87fc1a01-603e-4a4f-8238-342d652577ac
2025-06-25 22:49:38,597 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:49:38,597 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 797d5cda-239c-4c63-b998-b7e17ee355c7 from decision 4ad4681b-2271-43f9-9842-e2327ddaadbf
2025-06-25 22:49:38,599 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 87fc1a01-603e-4a4f-8238-342d652577ac: 'str' object has no attribute 'value'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 259, in execute_trade_from_confirmed_opportunity
    side=trade.side.value.upper(), # Asegurar que se use el valor string del enum
         ^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'value'
2025-06-25 22:49:38,601 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 87fc1a01-603e-4a4f-8238-342d652577ac status to error_in_processing: Failed to execute trade: 'str' object has no attribute 'value'
2025-06-25 22:49:38,602 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 87fc1a01-603e-4a4f-8238-342d652577ac
2025-06-25 22:49:38,910 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 6e3962bd-2cd8-41bc-8a31-4e7c59d5dd2f
2025-06-25 22:49:38,911 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 4800.0, Riesgo Potencial Trade USD: 300.000
2025-06-25 22:49:38,911 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:191 - Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:49:38,911 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 6e3962bd-2cd8-41bc-8a31-4e7c59d5dd2f status to error_in_processing: Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:49:38,912 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 6e3962bd-2cd8-41bc-8a31-4e7c59d5dd2f
2025-06-25 22:49:38,927 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity f44cc78e-31c3-4a05-a407-d7c994136f7f
2025-06-25 22:49:38,927 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:143 - Daily capital reset triggered for user fac246e6-f46b-49b8-803c-94d55bfd9de9. Resetting daily_capital_risked_usd.
2025-06-25 22:49:38,927 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:147 - User configuration saved after daily capital reset for user fac246e6-f46b-49b8-803c-94d55bfd9de9.
2025-06-25 22:49:38,929 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 2500.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 100.000
2025-06-25 22:49:38,929 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity f44cc78e-31c3-4a05-a407-d7c994136f7f
2025-06-25 22:49:38,929 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:49:38,930 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 03b53a65-2133-4a81-a856-e887f8e38569 from decision 6ff6f846-7ca2-4334-84cb-eb9183c2cc8b
2025-06-25 22:49:38,930 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity f44cc78e-31c3-4a05-a407-d7c994136f7f: 'str' object has no attribute 'value'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 259, in execute_trade_from_confirmed_opportunity
    side=trade.side.value.upper(), # Asegurar que se use el valor string del enum
         ^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'value'
2025-06-25 22:49:38,932 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity f44cc78e-31c3-4a05-a407-d7c994136f7f status to error_in_processing: Failed to execute trade: 'str' object has no attribute 'value'
2025-06-25 22:49:38,933 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity f44cc78e-31c3-4a05-a407-d7c994136f7f
2025-06-25 22:49:38,955 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:49:38,955 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:49:38,974 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:49:38,975 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 22:49:38,976 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:49:38,976 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:49:39,149 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:49:39,149 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:49:39,320 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:49:39,321 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:39,321 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:39,321 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:49:39,325 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:49:39,325 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000205270384D0>
2025-06-25 22:49:39,325 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:49:39,325 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:49:39,326 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:497 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 22:49:39,329 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"10ec1196-ee6c-496e-89df-b226356d7f6b","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:49:38.946378Z","submittedAt":"2025-06-26T02:49:38.946378Z","fillTimestamp":"2025-06-26T02:49:38.946378Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:49:38.946378Z","opened_at":"2025-06-26T02:49:38.946378Z","updated_at":"2025-06-26T02:49:38.946378Z","closed_at":"2025-06-26T02:49:38.946378Z"}
2025-06-25 22:49:39,330 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '10ec1196-ee6c-496e-89df-b226356d7f6b', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:49:38.946378Z', 'submittedAt': '2025-06-26T02:49:38.946378Z', 'fillTimestamp': '2025-06-26T02:49:38.946378Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:49:38.946378Z', 'opened_at': '2025-06-26T02:49:38.946378Z', 'updated_at': '2025-06-26T02:49:38.946378Z', 'closed_at': '2025-06-26T02:49:38.946378Z'}
2025-06-25 22:49:39,330 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"3835dacb-21e5-4730-8bb8-da75e0dacb22","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:49:38.946378Z","submittedAt":"2025-06-26T02:49:38.946378Z","fillTimestamp":"2025-06-26T02:49:38.946378Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:49:38.946378Z","opened_at":"2025-06-26T02:49:38.946378Z","updated_at":"2025-06-26T02:49:38.946378Z","closed_at":"2025-06-26T02:49:38.946378Z"}
2025-06-25 22:49:39,330 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': '3835dacb-21e5-4730-8bb8-da75e0dacb22', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:49:38.946378Z', 'submittedAt': '2025-06-26T02:49:38.946378Z', 'fillTimestamp': '2025-06-26T02:49:38.946378Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:49:38.946378Z', 'opened_at': '2025-06-26T02:49:38.946378Z', 'updated_at': '2025-06-26T02:49:38.946378Z', 'closed_at': '2025-06-26T02:49:38.946378Z'}
2025-06-25 22:49:39,330 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"5abce38e-7566-4914-8cb9-f12e5fd89f25","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:49:38.946378Z","submittedAt":"2025-06-26T02:49:38.946378Z","fillTimestamp":"2025-06-26T02:49:38.946378Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:49:38.946378Z","opened_at":"2025-06-26T02:49:38.946378Z","updated_at":"2025-06-26T02:49:38.946378Z","closed_at":"2025-06-26T02:49:38.946378Z"}
2025-06-25 22:49:39,331 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '5abce38e-7566-4914-8cb9-f12e5fd89f25', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:49:38.946378Z', 'submittedAt': '2025-06-26T02:49:38.946378Z', 'fillTimestamp': '2025-06-26T02:49:38.946378Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:49:38.946378Z', 'opened_at': '2025-06-26T02:49:38.946378Z', 'updated_at': '2025-06-26T02:49:38.946378Z', 'closed_at': '2025-06-26T02:49:38.946378Z'}
2025-06-25 22:49:39,331 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:547 - get_closed_trades - Trades recuperados: 3
2025-06-25 22:49:39,331 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:49:39,332 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 22:49:39,350 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:49:39,350 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:49:39,369 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:49:39,371 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 22:49:39,372 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:49:39,372 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:49:39,546 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:49:39,548 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:49:39,723 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:49:39,723 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:39,723 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:39,723 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:49:39,726 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:49:39,726 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000020526FE17D0>
2025-06-25 22:49:39,727 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:49:39,727 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:49:39,728 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:497 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: BTCUSDT, start_date: None, end_date: None
2025-06-25 22:49:39,731 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"0d061924-7405-4959-8f88-86c6684cb5fe","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:49:39.341559Z","submittedAt":"2025-06-26T02:49:39.341559Z","fillTimestamp":"2025-06-26T02:49:39.341559Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:49:39.341559Z","opened_at":"2025-06-26T02:49:39.341559Z","updated_at":"2025-06-26T02:49:39.341559Z","closed_at":"2025-06-26T02:49:39.341559Z"}
2025-06-25 22:49:39,732 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '0d061924-7405-4959-8f88-86c6684cb5fe', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:49:39.341559Z', 'submittedAt': '2025-06-26T02:49:39.341559Z', 'fillTimestamp': '2025-06-26T02:49:39.341559Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:49:39.341559Z', 'opened_at': '2025-06-26T02:49:39.341559Z', 'updated_at': '2025-06-26T02:49:39.341559Z', 'closed_at': '2025-06-26T02:49:39.341559Z'}
2025-06-25 22:49:39,732 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:547 - get_closed_trades - Trades recuperados: 1
2025-06-25 22:49:39,732 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 1 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:49:39,733 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 22:49:39,752 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:49:39,753 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:49:39,769 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:49:39,771 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 22:49:39,771 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:49:39,772 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:49:39,867 - ultibot_backend - INFO - [MainThread] - main.py:104 - Apagando UltiBot Backend (lifespan)...
2025-06-25 22:49:39,867 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:189 - Shutting down dependency container...
2025-06-25 22:49:39,871 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:40 - Redis client closed.
2025-06-25 22:49:39,872 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:196 - Dependency container shut down.
2025-06-25 22:49:39,872 - ultibot_backend - INFO - [MainThread] - main.py:107 - Recursos liberados y aplicación apagada (lifespan).
2025-06-25 22:49:39,954 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:49:39,954 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:49:40,147 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:49:40,148 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:40,148 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:40,148 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:49:40,151 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:49:40,152 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000020527021AD0>
2025-06-25 22:49:40,152 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:49:40,152 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:49:40,153 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:497 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 22:49:40,156 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"c05aa8b9-6c5f-4c4c-9d81-1494a4023a18","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:49:39.742772Z","submittedAt":"2025-06-26T02:49:39.742772Z","fillTimestamp":"2025-06-26T02:49:39.742772Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:49:39.742772Z","opened_at":"2025-06-26T02:49:39.742772Z","updated_at":"2025-06-26T02:49:39.742772Z","closed_at":"2025-06-26T02:49:39.742772Z"}
2025-06-25 22:49:40,156 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': 'c05aa8b9-6c5f-4c4c-9d81-1494a4023a18', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:49:39.742772Z', 'submittedAt': '2025-06-26T02:49:39.742772Z', 'fillTimestamp': '2025-06-26T02:49:39.742772Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:49:39.742772Z', 'opened_at': '2025-06-26T02:49:39.742772Z', 'updated_at': '2025-06-26T02:49:39.742772Z', 'closed_at': '2025-06-26T02:49:39.742772Z'}
2025-06-25 22:49:40,156 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"6fef938b-6b31-4061-998f-ffd5f3edee21","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:49:39.743771Z","submittedAt":"2025-06-26T02:49:39.743771Z","fillTimestamp":"2025-06-26T02:49:39.743771Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:49:39.743771Z","opened_at":"2025-06-26T02:49:39.743771Z","updated_at":"2025-06-26T02:49:39.743771Z","closed_at":"2025-06-26T02:49:39.743771Z"}
2025-06-25 22:49:40,156 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': '6fef938b-6b31-4061-998f-ffd5f3edee21', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:49:39.743771Z', 'submittedAt': '2025-06-26T02:49:39.743771Z', 'fillTimestamp': '2025-06-26T02:49:39.743771Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:49:39.743771Z', 'opened_at': '2025-06-26T02:49:39.743771Z', 'updated_at': '2025-06-26T02:49:39.743771Z', 'closed_at': '2025-06-26T02:49:39.743771Z'}
2025-06-25 22:49:40,158 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"8984d32b-bd02-4cb3-a967-67e449baed56","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:49:39.743771Z","submittedAt":"2025-06-26T02:49:39.743771Z","fillTimestamp":"2025-06-26T02:49:39.743771Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:49:39.743771Z","opened_at":"2025-06-26T02:49:39.743771Z","updated_at":"2025-06-26T02:49:39.743771Z","closed_at":"2025-06-26T02:49:39.743771Z"}
2025-06-25 22:49:40,158 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '8984d32b-bd02-4cb3-a967-67e449baed56', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:49:39.743771Z', 'submittedAt': '2025-06-26T02:49:39.743771Z', 'fillTimestamp': '2025-06-26T02:49:39.743771Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:49:39.743771Z', 'opened_at': '2025-06-26T02:49:39.743771Z', 'updated_at': '2025-06-26T02:49:39.743771Z', 'closed_at': '2025-06-26T02:49:39.743771Z'}
2025-06-25 22:49:40,158 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:547 - get_closed_trades - Trades recuperados: 3
2025-06-25 22:49:40,159 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:49:40,159 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 22:49:40,179 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:49:40,179 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:49:40,196 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:49:40,198 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 22:49:40,198 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:49:40,198 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:49:40,374 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:49:40,374 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:49:40,549 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:49:40,549 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:40,549 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:40,549 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:49:40,552 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:49:40,552 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x00000205270EF590>
2025-06-25 22:49:40,553 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:49:40,553 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:49:40,553 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:497 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: 2025-06-27 02:49:40.197309+00:00, end_date: None
2025-06-25 22:49:40,559 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:547 - get_closed_trades - Trades recuperados: 0
2025-06-25 22:49:40,559 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:49:40,560 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 22:49:40,601 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity c1ccdbb8-eaca-4645-a70a-07ba6d0a8283 for symbol BTCUSDT
2025-06-25 22:49:40,602 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 1381c68a-9b33-4a85-a26d-c8437949f4eb
2025-06-25 22:49:40,602 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy 5b81ac9d-bbc2-4d0b-8844-542e41639bcf can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:49:40,611 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity f004c7e0-2eca-4fef-aa11-ad01b72d01f7 for symbol BTCUSDT
2025-06-25 22:49:40,612 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy 07bf8525-8dd4-41c3-bba4-14827906e639 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:49:40,618 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 50aa1333-10cf-4a7f-8a00-787b189c85cf for symbol ETHUSDT
2025-06-25 22:49:40,619 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: e66981d9-c274-4f0b-8813-0a3d4f88fe0c
2025-06-25 22:49:40,620 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:610 - No active and applicable strategies found for opportunity 50aa1333-10cf-4a7f-8a00-787b189c85cf with symbol ETHUSDT.
2025-06-25 22:49:40,621 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 50aa1333-10cf-4a7f-8a00-787b189c85cf status to rejected_by_system: No active strategies are applicable to this opportunity's symbol.
2025-06-25 22:49:40,622 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 50aa1333-10cf-4a7f-8a00-787b189c85cf
2025-06-25 22:49:40,628 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 05d6dcbb-157c-4e39-96d5-bb8891e50b70 for symbol BTCUSDT
2025-06-25 22:49:40,629 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: e3c41e56-06bf-4d34-9aab-d822538cf847
2025-06-25 22:49:40,629 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:723 - AI confidence 0.65 for strategy c37c4e15-3375-4012-bff3-6e674edc6261 is below threshold 0.8.
2025-06-25 22:49:40,632 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:738 - Strategy c37c4e15-3375-4012-bff3-6e674edc6261 did not produce a decision for opportunity 05d6dcbb-157c-4e39-96d5-bb8891e50b70.
2025-06-25 22:49:40,632 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:629 - No affirmative trading decisions made for opportunity 05d6dcbb-157c-4e39-96d5-bb8891e50b70.
2025-06-25 22:49:40,641 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 15136313-7834-4477-9c94-2d03d4f155de for symbol BTCUSDT
2025-06-25 22:49:40,642 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: f099a027-2d8a-4ef7-86fa-df1882d9328d
2025-06-25 22:49:40,648 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 7bb56a22-a602-4195-be6b-9dde07e8f5a0 for symbol BTCUSDT
2025-06-25 22:49:40,649 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: e6ee9893-6d26-49cd-a55f-de2755716460
2025-06-25 22:49:40,656 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:49:40,656 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade bfaccf89-7b88-4d4b-938e-3aaebabde6dc from decision 11a439bd-c521-417a-9557-4caf5708354b
2025-06-25 22:49:40,663 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:49:40,663 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade ef70f41c-9e9b-4717-b90d-c7ace91c8b86 from decision db2afc3a-a9f3-46ad-8772-83890fae38e0
2025-06-25 22:49:40,664 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: sell
2025-06-25 22:49:40,664 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 784c4d72-9cad-4834-8072-9df35067ec8f from decision db2afc3a-a9f3-46ad-8772-83890fae38e0
2025-06-25 22:49:40,671 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:40,671 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:40,680 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:49:40,680 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:49:40,683 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:49:40,685 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity bab76c1b-8a66-4b5b-a428-1e0003f051df
2025-06-25 22:49:40,687 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 2dd60b48-22b4-4f1f-a2b5-066176312b75. Creando y guardando configuración por defecto.
2025-06-25 22:49:40,690 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:49:40,693 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 2dd60b48-22b4-4f1f-a2b5-066176312b75. Using default values.
2025-06-25 22:49:40,693 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 2dd60b48-22b4-4f1f-a2b5-066176312b75 with capital: 10000.0
2025-06-25 22:49:40,694 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:49:40,695 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:49:40,695 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:49:40,695 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity bab76c1b-8a66-4b5b-a428-1e0003f051df
2025-06-25 22:49:40,696 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:49:40,696 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 29b5271f-fa66-41c7-ad64-bedc4726aedd from decision 84811032-29a9-4a34-9794-a12bcb100858
2025-06-25 22:49:40,696 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity bab76c1b-8a66-4b5b-a428-1e0003f051df: 'str' object has no attribute 'value'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 259, in execute_trade_from_confirmed_opportunity
    side=trade.side.value.upper(), # Asegurar que se use el valor string del enum
         ^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'value'
2025-06-25 22:49:40,725 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:49:40,726 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:49:40,733 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:40,734 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:40,741 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:49:40,741 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:49:40,743 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:49:40,746 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:49:40,748 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:49:40,758 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:40,758 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:40,766 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:49:40,768 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:49:40,770 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:49:40,772 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 3da2fac7-364f-4edd-b7e1-f08d6471f642 for symbol BTC/USDT
2025-06-25 22:49:40,776 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 805b0a35-e22d-454c-be01-f23b2f4a1568. Creando y guardando configuración por defecto.
2025-06-25 22:49:40,779 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:49:40,780 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:678 - AI profile 'ai-profile-scalping-1' for strategy b73c9bf9-6374-44e0-bb04-0f58fce38b43 not found. Skipping AI analysis.
2025-06-25 22:49:40,780 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy b73c9bf9-6374-44e0-bb04-0f58fce38b43 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:49:40,781 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 3da2fac7-364f-4edd-b7e1-f08d6471f642 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:49:40,790 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 3da2fac7-364f-4edd-b7e1-f08d6471f642
2025-06-25 22:49:40,791 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:49:40,792 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:49:40,801 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:40,801 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:40,808 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:49:40,808 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:49:40,812 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:49:40,814 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity a3af3cb0-b0eb-4b45-ae37-a45aeb6cb1f6
2025-06-25 22:49:40,817 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id d84116e8-6437-4cdf-a305-9c76cfcf5975. Creando y guardando configuración por defecto.
2025-06-25 22:49:40,821 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:49:40,823 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for d84116e8-6437-4cdf-a305-9c76cfcf5975. Using default values.
2025-06-25 22:49:40,824 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for d84116e8-6437-4cdf-a305-9c76cfcf5975 with capital: 10000.0
2025-06-25 22:49:40,825 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:49:40,825 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:49:40,826 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:49:40,826 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Autonomous Scalping' as context for confirmed opportunity a3af3cb0-b0eb-4b45-ae37-a45aeb6cb1f6
2025-06-25 22:49:40,826 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:49:40,827 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade cc51c95f-99ca-4d2f-800c-e7e8e7633098 from decision c59dadb8-0e28-4144-92d8-fe81f9cb22d4
2025-06-25 22:49:40,827 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity a3af3cb0-b0eb-4b45-ae37-a45aeb6cb1f6: 'str' object has no attribute 'value'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 259, in execute_trade_from_confirmed_opportunity
    side=trade.side.value.upper(), # Asegurar que se use el valor string del enum
         ^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'value'
2025-06-25 22:49:40,958 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:49:40,959 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:49:40,969 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:40,969 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:40,977 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:49:40,977 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:49:40,979 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:49:40,982 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity cdd35684-75a4-4f74-a970-318264393075
2025-06-25 22:49:40,985 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 8c0d0371-631f-4717-8777-08b981dbea07. Creando y guardando configuración por defecto.
2025-06-25 22:49:40,988 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:49:40,990 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 8c0d0371-631f-4717-8777-08b981dbea07. Using default values.
2025-06-25 22:49:40,991 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 8c0d0371-631f-4717-8777-08b981dbea07 with capital: 10000.0
2025-06-25 22:49:40,992 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:49:40,992 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:49:40,992 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:49:40,993 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity cdd35684-75a4-4f74-a970-318264393075
2025-06-25 22:49:40,993 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:49:40,993 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 89debb55-1d27-4c50-be53-b3e64487047b from decision e473387b-fc5b-4678-b431-6a31afbfdbca
2025-06-25 22:49:40,993 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity cdd35684-75a4-4f74-a970-318264393075: 'str' object has no attribute 'value'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 259, in execute_trade_from_confirmed_opportunity
    side=trade.side.value.upper(), # Asegurar que se use el valor string del enum
         ^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'value'
2025-06-25 22:49:41,020 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:49:41,021 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:49:41,029 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:41,030 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:41,037 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:49:41,037 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:49:41,040 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:49:41,042 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 3b54d09c-60a6-41ab-ba03-4d268d012723
2025-06-25 22:49:41,044 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 044a9145-2a61-47dd-b0b6-1daba3f0da6f. Creando y guardando configuración por defecto.
2025-06-25 22:49:41,048 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:49:41,051 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 044a9145-2a61-47dd-b0b6-1daba3f0da6f. Using default values.
2025-06-25 22:49:41,051 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 044a9145-2a61-47dd-b0b6-1daba3f0da6f with capital: 10000.0
2025-06-25 22:49:41,052 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:49:41,052 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:49:41,054 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:49:41,054 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Day Trading Strategy' as context for confirmed opportunity 3b54d09c-60a6-41ab-ba03-4d268d012723
2025-06-25 22:49:41,054 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:49:41,054 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 9637c369-abaa-4b65-9cbb-2a9e60065235 from decision ca51ade6-fa56-4331-918d-c166a2d7f7b7
2025-06-25 22:49:41,054 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 3b54d09c-60a6-41ab-ba03-4d268d012723: 'str' object has no attribute 'value'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 259, in execute_trade_from_confirmed_opportunity
    side=trade.side.value.upper(), # Asegurar que se use el valor string del enum
         ^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'value'
2025-06-25 22:49:41,079 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:49:41,080 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:49:41,089 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:41,089 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:41,096 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:49:41,096 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:49:41,100 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:49:41,101 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:49:41,102 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 57e6f3c0-cd53-4eb6-9e6d-8a17422a9f6b from decision 294c59d2-8bc2-4044-893a-18497eaf5de1
2025-06-25 22:49:41,103 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:49:41,104 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:49:41,112 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:41,113 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:41,121 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:49:41,121 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:49:41,123 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:49:41,125 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:402 - Trade side determinado: buy
2025-06-25 22:49:41,125 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:453 - Created trade 0d11ecf7-089a-4945-9b85-7bac48f15534 from decision 22eb5efe-fe61-41f7-a5e6-14b53642be90
2025-06-25 22:49:41,126 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:49:41,127 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:49:41,135 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:41,135 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:41,145 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:49:41,145 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:49:41,148 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:49:41,149 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:49:41,151 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:49:43,236 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:43,236 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:43,242 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:49:43,245 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:49:43,247 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:49:43,256 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:49:43,260 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:49:43,261 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:49:43,265 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:49:43,272 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:49:43,276 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:49:43,280 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:43,280 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:43,285 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:43,286 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:43,287 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:49:43,292 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:43,292 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:43,301 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:43,302 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:43,309 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:43,309 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:43,312 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:49:43,316 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:43,316 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:43,322 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:286 - Verificación de Binance BINANCE_SPOT exitosa.
2025-06-25 22:49:43,326 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:43,326 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:43,329 - ultibot_backend.services.credential_service - ERROR - [MainThread] - credential_service.py:315 - Error de Binance API durante la verificación: Binance Down
2025-06-25 22:49:43,333 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:43,333 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:43,338 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:49:43,345 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:43,346 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:43,354 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:241 - Verificación de Telegram exitosa.
2025-06-25 22:49:43,366 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:72 - Conexión con Binance exitosa.
2025-06-25 22:49:43,379 - ultibot_backend.services.market_data_service - WARNING - [MainThread] - market_data_service.py:52 - Credenciales de Binance no encontradas. Por favor, configúrelas.
2025-06-25 22:49:43,389 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:69 - Fallo en la verificación de conexión con Binance. Revise sus credenciales y permisos.
2025-06-25 22:49:43,398 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:77 - Error al acceder a las credenciales de Binance: Decryption failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 45, in get_binance_connection_status
    binance_credential = await self.credential_service.get_credential(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.CredentialError: Decryption failed
2025-06-25 22:49:43,407 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:81 - Error de la API de Binance: API unavailable
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 61, in get_binance_connection_status
    is_connected = await self.credential_service.verify_credential(binance_credential)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.BinanceAPIError: API unavailable
2025-06-25 22:49:43,414 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:49:43,425 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:121 - Error de la API de Binance al obtener balances: Failed to fetch balances
2025-06-25 22:49:43,430 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2221152422800'>
2025-06-25 22:49:43,432 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 55a11c36-5737-41d7-bcb3-4eb6d665173f, mode_filter: None
2025-06-25 22:49:43,432 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2221152422800'>
2025-06-25 22:49:43,433 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 55a11c36-5737-41d7-bcb3-4eb6d665173f with mode_filter: None
2025-06-25 22:49:43,436 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2221156816080'>
2025-06-25 22:49:43,438 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 55a11c36-5737-41d7-bcb3-4eb6d665173f, mode_filter: None
2025-06-25 22:49:43,439 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2221156816080'>
2025-06-25 22:49:43,439 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 55a11c36-5737-41d7-bcb3-4eb6d665173f with mode_filter: None
2025-06-25 22:49:43,443 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2221156782864'>
2025-06-25 22:49:43,445 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 55a11c36-5737-41d7-bcb3-4eb6d665173f, mode_filter: OperatingMode.PAPER
2025-06-25 22:49:43,446 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2221156782864'>
2025-06-25 22:49:43,446 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 55a11c36-5737-41d7-bcb3-4eb6d665173f
2025-06-25 22:49:43,452 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2221153058128'>
2025-06-25 22:49:43,455 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 55a11c36-5737-41d7-bcb3-4eb6d665173f, mode_filter: OperatingMode.PAPER
2025-06-25 22:49:43,455 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2221153058128'>
2025-06-25 22:49:43,455 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 55a11c36-5737-41d7-bcb3-4eb6d665173f
2025-06-25 22:49:43,459 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2221133033424'>
2025-06-25 22:49:43,461 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 55a11c36-5737-41d7-bcb3-4eb6d665173f, mode_filter: OperatingMode.REAL
2025-06-25 22:49:43,461 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2221133033424'>
2025-06-25 22:49:43,461 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 55a11c36-5737-41d7-bcb3-4eb6d665173f
2025-06-25 22:49:43,466 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2221153048400'>
2025-06-25 22:49:43,468 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 55a11c36-5737-41d7-bcb3-4eb6d665173f, mode_filter: OperatingMode.PAPER
2025-06-25 22:49:43,468 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2221153048400'>
2025-06-25 22:49:43,469 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 55a11c36-5737-41d7-bcb3-4eb6d665173f
2025-06-25 22:49:43,472 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2221153084752'>
2025-06-25 22:49:43,474 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 55a11c36-5737-41d7-bcb3-4eb6d665173f, mode_filter: None
2025-06-25 22:49:43,474 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2221153084752'>
2025-06-25 22:49:43,474 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 2 performance entries for user 55a11c36-5737-41d7-bcb3-4eb6d665173f
2025-06-25 22:49:43,478 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2221156426832'>
2025-06-25 22:49:43,479 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 55a11c36-5737-41d7-bcb3-4eb6d665173f, mode_filter: OperatingMode.PAPER
2025-06-25 22:49:43,479 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2221156426832'>
2025-06-25 22:49:43,479 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 55a11c36-5737-41d7-bcb3-4eb6d665173f
2025-06-25 22:49:43,485 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2221152448848'>
2025-06-25 22:49:43,487 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 55a11c36-5737-41d7-bcb3-4eb6d665173f, mode_filter: OperatingMode.PAPER
2025-06-25 22:49:43,487 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2221152448848'>
2025-06-25 22:49:43,488 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 55a11c36-5737-41d7-bcb3-4eb6d665173f with mode_filter: OperatingMode.PAPER
2025-06-25 22:49:43,492 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2221156108880'>
2025-06-25 22:49:43,494 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 55a11c36-5737-41d7-bcb3-4eb6d665173f, mode_filter: OperatingMode.PAPER
2025-06-25 22:49:43,494 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2221156108880'>
2025-06-25 22:49:43,495 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 55a11c36-5737-41d7-bcb3-4eb6d665173f with mode_filter: OperatingMode.PAPER
2025-06-25 22:49:43,498 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2221152358352'>
2025-06-25 22:49:43,501 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 55a11c36-5737-41d7-bcb3-4eb6d665173f, mode_filter: OperatingMode.PAPER
2025-06-25 22:49:43,501 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2221152358352'>
2025-06-25 22:49:43,502 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 55a11c36-5737-41d7-bcb3-4eb6d665173f
2025-06-25 22:49:43,505 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2221156423952'>
2025-06-25 22:49:43,507 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 55a11c36-5737-41d7-bcb3-4eb6d665173f, mode_filter: OperatingMode.PAPER
2025-06-25 22:49:43,508 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2221156423952'>
2025-06-25 22:49:43,508 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 55a11c36-5737-41d7-bcb3-4eb6d665173f
2025-06-25 22:49:43,513 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2221152354896'>
2025-06-25 22:49:43,515 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 55a11c36-5737-41d7-bcb3-4eb6d665173f, mode_filter: OperatingMode.PAPER
2025-06-25 22:49:43,516 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2221152354896'>
2025-06-25 22:49:43,516 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 55a11c36-5737-41d7-bcb3-4eb6d665173f
2025-06-25 22:49:43,521 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='2221156494736'>
2025-06-25 22:49:43,524 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 55a11c36-5737-41d7-bcb3-4eb6d665173f, mode_filter: OperatingMode.PAPER
2025-06-25 22:49:43,525 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='2221156494736'>
2025-06-25 22:49:43,525 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 55a11c36-5737-41d7-bcb3-4eb6d665173f
2025-06-25 22:49:43,579 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario e0ee40dc-63bb-4d8d-8408-50e4c303cea2 en modo paper
2025-06-25 22:49:43,586 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 5f55c026-568b-4050-bf3e-1db08af35d1b en modo paper
2025-06-25 22:49:43,590 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario cc502204-ee79-44ad-b776-34a6f1c9286c en modo paper
2025-06-25 22:49:43,595 - ultibot_backend.services.trading_report_service - ERROR - [MainThread] - trading_report_service.py:79 - Error al obtener trades cerrados para usuario d6c6afa4-2517-43e4-965d-f09c8f0cf6c5: Database connection failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_report_service.py", line 65, in get_closed_trades
    trades = await persistence_service.get_closed_trades(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
Exception: Database connection failed
2025-06-25 22:49:43,608 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 6cad7f9c-b091-44c8-9dde-d5bad6710f0d for symbol BTC/USDT
2025-06-25 22:49:43,609 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy e31e626f-80b8-4d71-821e-8c25d3705fdd can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:49:43,609 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 6cad7f9c-b091-44c8-9dde-d5bad6710f0d status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:49:43,610 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 6cad7f9c-b091-44c8-9dde-d5bad6710f0d
2025-06-25 22:49:43,620 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 96889871-0dfc-4658-880b-5ecb399f1c34 for symbol BTC/USDT
2025-06-25 22:49:43,622 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy 238cb5b3-7294-4870-82f8-b7dbd3ecc681 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:49:43,622 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 96889871-0dfc-4658-880b-5ecb399f1c34 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:49:43,623 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 96889871-0dfc-4658-880b-5ecb399f1c34
2025-06-25 22:49:43,633 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 65d92b8d-a78f-4a92-82ad-933eca39a599 for symbol BTC/USDT
2025-06-25 22:49:43,635 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy dcfa47f9-4c72-44b6-9026-ad150e04148b can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:49:43,635 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 65d92b8d-a78f-4a92-82ad-933eca39a599 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:49:43,636 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 65d92b8d-a78f-4a92-82ad-933eca39a599
2025-06-25 22:49:43,646 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 364a63b4-4f70-4ea8-a160-69d1d2a9bc38 for symbol BTC/USDT
2025-06-25 22:49:43,649 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy 67251c3d-e265-4159-b58d-871a31fa70fa can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:49:43,649 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 364a63b4-4f70-4ea8-a160-69d1d2a9bc38 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:49:43,651 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 364a63b4-4f70-4ea8-a160-69d1d2a9bc38
2025-06-25 22:49:43,661 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity abe0a101-f206-433d-acdb-f25a78e795f2 for symbol BTC/USDT
2025-06-25 22:49:43,661 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:659 - Unknown strategy type 'CUSTOM_UNKNOWN_TYPE' for strategy ad33c9e5-ad84-49d3-9927-8d1ac99d79c7. Recommending investigation.
2025-06-25 22:49:43,661 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity abe0a101-f206-433d-acdb-f25a78e795f2 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:49:43,663 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity abe0a101-f206-433d-acdb-f25a78e795f2
2025-06-25 22:49:43,673 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity 1853cd11-6ec4-4b51-b841-7f47ba0721cd for symbol BTC/USDT
2025-06-25 22:49:43,674 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy ae25c032-d4ab-4288-9cfd-10f6f86bc1b2 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:49:43,675 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity 1853cd11-6ec4-4b51-b841-7f47ba0721cd status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:49:43,676 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity 1853cd11-6ec4-4b51-b841-7f47ba0721cd
2025-06-25 22:49:43,699 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:577 - Processing opportunity e2198e87-2364-4fb7-a410-2be7cba23fda for symbol BTC/USDT
2025-06-25 22:49:43,701 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:730 - Strategy fbb96629-5125-4732-baa9-da6282b02d2e can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:49:43,702 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:541 - Updated opportunity e2198e87-2364-4fb7-a410-2be7cba23fda status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:49:43,703 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:548 - Persisted status update for opportunity e2198e87-2364-4fb7-a410-2be7cba23fda
2025-06-25 22:49:44,614 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:49:44,614 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:49:44,633 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:49:44,634 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:49:44,635 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:49:44,636 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:49:44,636 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:49:44,636 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:49:44,636 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:49:44,674 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:49:44,846 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:49:44,846 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:49:45,025 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:49:45,028 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:45,028 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:45,028 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:49:45,042 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:49:45,043 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001D3626A0650>
2025-06-25 22:49:45,043 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:49:45,043 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:49:45,045 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:49:49,824 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:49:49,824 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:49:49,842 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:49:49,843 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:49:49,843 - ultibot_backend - INFO - [MainThread] - main.py:86 - Iniciando UltiBot Backend (lifespan)...
2025-06-25 22:49:49,845 - ultibot_backend - INFO - [MainThread] - main.py:91 - DependencyContainer adjuntado a app.state: True
2025-06-25 22:49:49,845 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:49:49,845 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:49:49,846 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:49:49,883 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:49:50,057 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:49:50,057 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:49:50,232 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:49:50,235 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:49:50,236 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:49:50,236 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:49:50,247 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:49:50,248 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001B7A243FE50>
2025-06-25 22:49:50,249 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:49:50,249 - ultibot_backend - INFO - [MainThread] - main.py:95 - Contenedor de dependencias inicializado en lifespan.
2025-06-25 22:49:50,250 - ultibot_backend - INFO - [MainThread] - main.py:101 - Aplicación iniciada correctamente (lifespan).
2025-06-25 22:51:40,120 - ultibot_backend - INFO - [MainThread] - main.py:104 - Apagando UltiBot Backend (lifespan)...
2025-06-25 22:51:40,120 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:189 - Shutting down dependency container...
2025-06-25 22:51:40,124 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:40 - Redis client closed.
2025-06-25 22:51:40,125 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:196 - Dependency container shut down.
2025-06-25 22:51:40,125 - ultibot_backend - INFO - [MainThread] - main.py:107 - Recursos liberados y aplicación apagada (lifespan).
2025-06-25 22:54:50,571 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:54:50,572 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:54:50,588 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:54:50,589 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:54:50,747 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:54:50,747 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:54:50,766 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:54:50,768 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 22:54:51,442 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:54:51,442 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:54:51,465 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:54:51,480 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:54:51,482 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:54:51,485 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 22:54:51,486 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 22:54:51,496 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:54:51,496 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:54:51,516 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:54:51,519 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:54:51,521 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:54:51,529 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:54:51,530 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:54:51,548 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:54:51,550 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:54:51,552 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:54:51,559 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:54:51,560 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:54:51,578 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:54:51,581 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:54:51,583 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:54:51,589 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:54:51,590 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:54:51,610 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:54:51,612 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:54:51,614 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 22:54:51,622 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:54:51,623 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:54:51,639 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:54:51,641 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 22:54:51,641 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:54:51,642 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:54:51,642 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 22:54:51,642 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 22:54:51,661 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 22:54:51,836 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:54:51,839 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:54:52,013 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:54:52,014 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:52,014 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:52,014 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:54:52,032 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:54:52,032 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001AF6BDF1D50>
2025-06-25 22:54:52,032 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:54:52,032 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:54:52,033 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 422
2025-06-25 22:54:52,043 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:54:52,045 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:54:52,064 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:54:52,066 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:54:52,066 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:54:52,066 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:54:52,246 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:54:52,248 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:54:52,426 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:54:52,427 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:52,427 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:52,427 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:54:52,430 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:54:52,430 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001AF6BDD0C90>
2025-06-25 22:54:52,431 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:54:52,431 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:54:52,440 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:54:52,447 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:54:52,449 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:54:52,457 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:54:52,457 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:54:52,476 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:54:52,477 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:54:52,478 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:54:52,478 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:54:52,659 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:54:52,659 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:54:52,836 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:54:52,838 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:52,839 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:52,839 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:54:52,842 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:54:52,842 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001AF6C1202D0>
2025-06-25 22:54:52,842 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:54:52,843 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:54:52,846 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:54:52,853 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:54:52,853 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:54:52,855 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:54:52,861 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:54:52,861 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:54:52,862 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:54:52,863 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:54:52,874 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:54:52,875 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:54:52,995 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:54:52,996 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:54:52,996 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:54:52,997 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:54:53,176 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:54:53,176 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:54:53,351 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:54:53,351 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:53,352 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:53,352 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:54:53,355 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:54:53,355 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001AF6BE375D0>
2025-06-25 22:54:53,355 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:54:53,356 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:54:53,360 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:54:53,366 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:54:53,366 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:54:53,368 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:54:53,374 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:54:53,374 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:54:53,382 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:54:53,382 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:54:53,399 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:54:53,401 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 22:54:53,401 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:54:53,401 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:54:53,576 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:54:53,577 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:54:53,754 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:54:53,755 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:53,755 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:53,755 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:54:53,759 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:54:53,759 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001AF6BE4D950>
2025-06-25 22:54:53,759 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:54:53,759 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:54:53,763 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:54:53,767 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:54:53,768 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 22:54:53,769 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:54:53,776 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:54:53,776 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 22:54:53,784 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:54:53,784 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:54:53,804 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:54:53,806 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 22:54:53,807 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:54:53,807 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:54:53,985 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:54:53,986 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:54:54,165 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:54:54,165 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:54,165 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:54,166 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:54:54,169 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:54:54,169 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001AF6BDB1AD0>
2025-06-25 22:54:54,169 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:54:54,169 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:54:54,170 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 422
2025-06-25 22:54:54,186 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity fba623d5-65e8-45d1-b085-f748b58711ab
2025-06-25 22:54:54,189 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:152 - User configuration saved after initializing last_daily_reset for user 6e0a9090-1286-44bc-be03-b22994faa33b.
2025-06-25 22:54:54,189 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 200.000
2025-06-25 22:54:54,190 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity fba623d5-65e8-45d1-b085-f748b58711ab
2025-06-25 22:54:54,190 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:404 - Trade side determinado: buy
2025-06-25 22:54:54,191 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:455 - Created trade a634233b-8cd9-4417-8ec8-b790f19bec29 from decision 7b938dd7-9e3c-48f3-a2b6-1991aa2f3356
2025-06-25 22:54:54,191 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity fba623d5-65e8-45d1-b085-f748b58711ab: 'str' object has no attribute 'value'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 259, in execute_trade_from_confirmed_opportunity
    side=trade.side.value.upper(), # Asegurar que se use el valor string del enum
         ^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'value'
2025-06-25 22:54:54,193 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity fba623d5-65e8-45d1-b085-f748b58711ab status to error_in_processing: Failed to execute trade: 'str' object has no attribute 'value'
2025-06-25 22:54:54,194 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity fba623d5-65e8-45d1-b085-f748b58711ab
2025-06-25 22:54:54,500 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 4c99c0b9-95e8-4846-8bba-b1c3ebb74c9c
2025-06-25 22:54:54,501 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 4800.0, Riesgo Potencial Trade USD: 300.000
2025-06-25 22:54:54,501 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:191 - Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:54:54,502 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 4c99c0b9-95e8-4846-8bba-b1c3ebb74c9c status to error_in_processing: Límite de riesgo de capital diario excedido. Límite: 5000.00, Arriesgado: 4800.0, Nuevo Trade: 300.000
2025-06-25 22:54:54,503 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 4c99c0b9-95e8-4846-8bba-b1c3ebb74c9c
2025-06-25 22:54:54,516 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 2e65403d-0095-42ff-b959-e4fb6f132d15
2025-06-25 22:54:54,517 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:143 - Daily capital reset triggered for user 61b1bfbd-7eeb-4279-a176-61c6ff725db8. Resetting daily_capital_risked_usd.
2025-06-25 22:54:54,517 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:147 - User configuration saved after daily capital reset for user 61b1bfbd-7eeb-4279-a176-61c6ff725db8.
2025-06-25 22:54:54,518 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 2500.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 100.000
2025-06-25 22:54:54,518 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity 2e65403d-0095-42ff-b959-e4fb6f132d15
2025-06-25 22:54:54,518 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:404 - Trade side determinado: buy
2025-06-25 22:54:54,518 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:455 - Created trade 680c8eb4-e1fc-404f-a95b-4ac09825ff31 from decision b948ec12-8a67-4da0-b8e4-25039fd206e5
2025-06-25 22:54:54,519 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 2e65403d-0095-42ff-b959-e4fb6f132d15: 'str' object has no attribute 'value'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 259, in execute_trade_from_confirmed_opportunity
    side=trade.side.value.upper(), # Asegurar que se use el valor string del enum
         ^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'value'
2025-06-25 22:54:54,521 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 2e65403d-0095-42ff-b959-e4fb6f132d15 status to error_in_processing: Failed to execute trade: 'str' object has no attribute 'value'
2025-06-25 22:54:54,522 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 2e65403d-0095-42ff-b959-e4fb6f132d15
2025-06-25 22:54:54,543 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:54:54,543 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:54:54,562 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:54:54,564 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 22:54:54,564 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:54:54,565 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:54:54,738 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:54:54,738 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:54:54,918 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:54:54,919 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:54,919 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:54,919 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:54:54,924 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:54:54,924 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001AF6BB9CF50>
2025-06-25 22:54:54,924 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:54:54,924 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:54:54,925 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:497 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 22:54:54,929 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"e2305b6f-0924-40a7-8592-f2ae85830d0c","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:54:54.537877Z","submittedAt":"2025-06-26T02:54:54.537877Z","fillTimestamp":"2025-06-26T02:54:54.537877Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:54:54.537877Z","opened_at":"2025-06-26T02:54:54.537877Z","updated_at":"2025-06-26T02:54:54.537877Z","closed_at":"2025-06-26T02:54:54.537877Z"}
2025-06-25 22:54:54,929 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': 'e2305b6f-0924-40a7-8592-f2ae85830d0c', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:54:54.537877Z', 'submittedAt': '2025-06-26T02:54:54.537877Z', 'fillTimestamp': '2025-06-26T02:54:54.537877Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:54:54.537877Z', 'opened_at': '2025-06-26T02:54:54.537877Z', 'updated_at': '2025-06-26T02:54:54.537877Z', 'closed_at': '2025-06-26T02:54:54.537877Z'}
2025-06-25 22:54:54,929 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"2896c526-6d49-44c3-b129-1389fbef548c","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:54:54.537877Z","submittedAt":"2025-06-26T02:54:54.537877Z","fillTimestamp":"2025-06-26T02:54:54.537877Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:54:54.537877Z","opened_at":"2025-06-26T02:54:54.537877Z","updated_at":"2025-06-26T02:54:54.537877Z","closed_at":"2025-06-26T02:54:54.537877Z"}
2025-06-25 22:54:54,930 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': '2896c526-6d49-44c3-b129-1389fbef548c', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:54:54.537877Z', 'submittedAt': '2025-06-26T02:54:54.537877Z', 'fillTimestamp': '2025-06-26T02:54:54.537877Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:54:54.537877Z', 'opened_at': '2025-06-26T02:54:54.537877Z', 'updated_at': '2025-06-26T02:54:54.537877Z', 'closed_at': '2025-06-26T02:54:54.537877Z'}
2025-06-25 22:54:54,930 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"31b13d82-1070-40a8-9f22-d3bf600f8a01","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:54:54.537877Z","submittedAt":"2025-06-26T02:54:54.537877Z","fillTimestamp":"2025-06-26T02:54:54.537877Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:54:54.537877Z","opened_at":"2025-06-26T02:54:54.537877Z","updated_at":"2025-06-26T02:54:54.537877Z","closed_at":"2025-06-26T02:54:54.537877Z"}
2025-06-25 22:54:54,930 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '31b13d82-1070-40a8-9f22-d3bf600f8a01', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:54:54.537877Z', 'submittedAt': '2025-06-26T02:54:54.537877Z', 'fillTimestamp': '2025-06-26T02:54:54.537877Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:54:54.537877Z', 'opened_at': '2025-06-26T02:54:54.537877Z', 'updated_at': '2025-06-26T02:54:54.537877Z', 'closed_at': '2025-06-26T02:54:54.537877Z'}
2025-06-25 22:54:54,931 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:547 - get_closed_trades - Trades recuperados: 3
2025-06-25 22:54:54,931 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:54:54,931 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 22:54:54,949 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:54:54,950 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:54:54,967 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:54:54,968 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 22:54:54,969 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:54:54,969 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:54:55,148 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:54:55,149 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:54:55,325 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:54:55,325 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:55,326 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:55,326 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:54:55,328 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:54:55,329 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001AF6C311AD0>
2025-06-25 22:54:55,329 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:54:55,329 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:54:55,329 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:497 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: BTCUSDT, start_date: None, end_date: None
2025-06-25 22:54:55,333 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"a74ef40c-2948-44b1-9a71-c3634163d3dc","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:54:54.941897Z","submittedAt":"2025-06-26T02:54:54.941897Z","fillTimestamp":"2025-06-26T02:54:54.941897Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:54:54.941897Z","opened_at":"2025-06-26T02:54:54.941897Z","updated_at":"2025-06-26T02:54:54.941897Z","closed_at":"2025-06-26T02:54:54.941897Z"}
2025-06-25 22:54:55,333 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': 'a74ef40c-2948-44b1-9a71-c3634163d3dc', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:54:54.941897Z', 'submittedAt': '2025-06-26T02:54:54.941897Z', 'fillTimestamp': '2025-06-26T02:54:54.941897Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:54:54.941897Z', 'opened_at': '2025-06-26T02:54:54.941897Z', 'updated_at': '2025-06-26T02:54:54.941897Z', 'closed_at': '2025-06-26T02:54:54.941897Z'}
2025-06-25 22:54:55,334 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:547 - get_closed_trades - Trades recuperados: 1
2025-06-25 22:54:55,334 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 1 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:54:55,334 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 22:54:55,355 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:54:55,355 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:54:55,374 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:54:55,376 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 22:54:55,376 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:54:55,376 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:54:55,549 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:54:55,549 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:54:55,725 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:54:55,725 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:55,725 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:55,725 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:54:55,729 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:54:55,729 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001AF6BE85E50>
2025-06-25 22:54:55,729 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:54:55,730 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:54:55,730 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:497 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 22:54:55,733 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"17cea112-1d4c-42f4-b60b-8fe80e67ff1e","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:54:55.346083Z","submittedAt":"2025-06-26T02:54:55.346083Z","fillTimestamp":"2025-06-26T02:54:55.346083Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:54:55.346083Z","opened_at":"2025-06-26T02:54:55.346083Z","updated_at":"2025-06-26T02:54:55.346083Z","closed_at":"2025-06-26T02:54:55.346083Z"}
2025-06-25 22:54:55,733 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '17cea112-1d4c-42f4-b60b-8fe80e67ff1e', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:54:55.346083Z', 'submittedAt': '2025-06-26T02:54:55.346083Z', 'fillTimestamp': '2025-06-26T02:54:55.346083Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:54:55.346083Z', 'opened_at': '2025-06-26T02:54:55.346083Z', 'updated_at': '2025-06-26T02:54:55.346083Z', 'closed_at': '2025-06-26T02:54:55.346083Z'}
2025-06-25 22:54:55,733 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"da26d1a5-0314-484e-b27a-2ea6f18090b3","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:54:55.346083Z","submittedAt":"2025-06-26T02:54:55.346083Z","fillTimestamp":"2025-06-26T02:54:55.346083Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:54:55.346083Z","opened_at":"2025-06-26T02:54:55.346083Z","updated_at":"2025-06-26T02:54:55.346083Z","closed_at":"2025-06-26T02:54:55.346083Z"}
2025-06-25 22:54:55,733 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': 'da26d1a5-0314-484e-b27a-2ea6f18090b3', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:54:55.346083Z', 'submittedAt': '2025-06-26T02:54:55.346083Z', 'fillTimestamp': '2025-06-26T02:54:55.346083Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:54:55.346083Z', 'opened_at': '2025-06-26T02:54:55.346083Z', 'updated_at': '2025-06-26T02:54:55.346083Z', 'closed_at': '2025-06-26T02:54:55.346083Z'}
2025-06-25 22:54:55,734 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"c05ce3c8-964e-4f94-8ddd-388fae332458","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T02:54:55.346083Z","submittedAt":"2025-06-26T02:54:55.346083Z","fillTimestamp":"2025-06-26T02:54:55.346083Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T02:54:55.346083Z","opened_at":"2025-06-26T02:54:55.346083Z","updated_at":"2025-06-26T02:54:55.346083Z","closed_at":"2025-06-26T02:54:55.346083Z"}
2025-06-25 22:54:55,734 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': 'c05ce3c8-964e-4f94-8ddd-388fae332458', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T02:54:55.346083Z', 'submittedAt': '2025-06-26T02:54:55.346083Z', 'fillTimestamp': '2025-06-26T02:54:55.346083Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T02:54:55.346083Z', 'opened_at': '2025-06-26T02:54:55.346083Z', 'updated_at': '2025-06-26T02:54:55.346083Z', 'closed_at': '2025-06-26T02:54:55.346083Z'}
2025-06-25 22:54:55,734 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:547 - get_closed_trades - Trades recuperados: 3
2025-06-25 22:54:55,734 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:54:55,735 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 22:54:55,752 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 22:54:55,752 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 22:54:55,769 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 22:54:55,771 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 22:54:55,772 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 22:54:55,772 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 22:54:55,952 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 22:54:55,953 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 22:54:56,130 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 22:54:56,131 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:56,131 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:56,131 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 22:54:56,134 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:54:56,134 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x000001AF6D52B690>
2025-06-25 22:54:56,134 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 22:54:56,135 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 22:54:56,135 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:497 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: 2025-06-27 02:54:55.770431+00:00, end_date: None
2025-06-25 22:54:56,140 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:547 - get_closed_trades - Trades recuperados: 0
2025-06-25 22:54:56,140 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 22:54:56,142 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 22:54:56,186 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 3ccd64d7-1e7b-4051-88d7-918660bb8233 for symbol BTCUSDT
2025-06-25 22:54:56,186 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 52e676f0-4dd2-47f6-8ea1-ea93225edeb7
2025-06-25 22:54:56,186 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy 92e708a2-7c1a-4940-a549-45e7b2b92ed4 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:54:56,195 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 0f1b04b0-3cdf-4ee0-b0ce-cb5cc87ee1ad for symbol BTCUSDT
2025-06-25 22:54:56,195 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy 7fc705ff-d15e-4be8-9332-a40658bbfc4e can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:54:56,202 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 10190116-e0b6-4ec2-a677-88dcc38fd360 for symbol ETHUSDT
2025-06-25 22:54:56,202 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 3fcda8c4-6449-4545-98ab-4d36655ca6a7
2025-06-25 22:54:56,205 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:612 - No active and applicable strategies found for opportunity 10190116-e0b6-4ec2-a677-88dcc38fd360 with symbol ETHUSDT.
2025-06-25 22:54:56,205 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 10190116-e0b6-4ec2-a677-88dcc38fd360 status to rejected_by_system: No active strategies are applicable to this opportunity's symbol.
2025-06-25 22:54:56,206 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 10190116-e0b6-4ec2-a677-88dcc38fd360
2025-06-25 22:54:56,213 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity f525b90c-6a41-4764-9a35-680e694daec8 for symbol BTCUSDT
2025-06-25 22:54:56,214 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: c5d50d41-1ca0-4132-9606-9bcda001442e
2025-06-25 22:54:56,214 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:725 - AI confidence 0.65 for strategy c2397c76-a058-4dad-98d5-3a046c786b4b is below threshold 0.8.
2025-06-25 22:54:56,216 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:740 - Strategy c2397c76-a058-4dad-98d5-3a046c786b4b did not produce a decision for opportunity f525b90c-6a41-4764-9a35-680e694daec8.
2025-06-25 22:54:56,217 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:631 - No affirmative trading decisions made for opportunity f525b90c-6a41-4764-9a35-680e694daec8.
2025-06-25 22:54:56,226 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 22ea27d2-67ff-4404-80a9-b7895eaea8bb for symbol BTCUSDT
2025-06-25 22:54:56,227 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 84e4120f-ecdd-4080-91f7-e33343d3b52d
2025-06-25 22:54:56,234 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity ba22fafa-23a1-42ac-93e5-0c81bed6114a for symbol BTCUSDT
2025-06-25 22:54:56,234 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: f1994154-972c-4ebc-9991-e2d2a402eed7
2025-06-25 22:54:56,242 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:404 - Trade side determinado: buy
2025-06-25 22:54:56,243 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:455 - Created trade e33d0d54-3a8e-4daf-b876-4785571ae4db from decision 9d2d4700-0d78-4641-a6fc-54cadd7c9cbd
2025-06-25 22:54:56,248 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:404 - Trade side determinado: buy
2025-06-25 22:54:56,249 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:455 - Created trade 84a05537-f1b0-4660-961a-30cad9b74977 from decision 34174f6b-a3a6-479c-91ba-88a3cd24bbe0
2025-06-25 22:54:56,249 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:404 - Trade side determinado: sell
2025-06-25 22:54:56,249 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:455 - Created trade a4b4a153-a049-49f5-96a6-8cb1c082f4bf from decision 34174f6b-a3a6-479c-91ba-88a3cd24bbe0
2025-06-25 22:54:56,255 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:56,256 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:56,264 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:54:56,264 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:54:56,267 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:54:56,269 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity faf08da6-5734-4dac-8d3f-3e0cc908fc6d
2025-06-25 22:54:56,273 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 2d4426e0-7f38-4327-b5a8-1f102ffd44d8. Creando y guardando configuración por defecto.
2025-06-25 22:54:56,278 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:54:56,282 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 2d4426e0-7f38-4327-b5a8-1f102ffd44d8. Using default values.
2025-06-25 22:54:56,283 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 2d4426e0-7f38-4327-b5a8-1f102ffd44d8 with capital: 10000.0
2025-06-25 22:54:56,284 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:54:56,284 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:54:56,285 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:54:56,285 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity faf08da6-5734-4dac-8d3f-3e0cc908fc6d
2025-06-25 22:54:56,285 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:404 - Trade side determinado: buy
2025-06-25 22:54:56,286 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:455 - Created trade 8e6a6b1b-a330-4976-bfb8-7bacdd7c7625 from decision a8efc4e4-583d-43ae-9a14-cbe0a5da568f
2025-06-25 22:54:56,286 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity faf08da6-5734-4dac-8d3f-3e0cc908fc6d: 'str' object has no attribute 'value'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 259, in execute_trade_from_confirmed_opportunity
    side=trade.side.value.upper(), # Asegurar que se use el valor string del enum
         ^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'value'
2025-06-25 22:54:56,329 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:54:56,330 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:54:56,339 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:56,340 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:56,348 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:54:56,348 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:54:56,350 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:54:56,353 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:54:56,354 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:54:56,364 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:56,364 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:56,374 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:54:56,375 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:54:56,379 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:54:56,381 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 318c6da3-9ac5-4f42-b7e5-c411c21c76a1 for symbol BTC/USDT
2025-06-25 22:54:56,384 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 114baf48-256f-437c-9270-050b2a8f7dd7. Creando y guardando configuración por defecto.
2025-06-25 22:54:56,386 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:54:56,388 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:680 - AI profile 'ai-profile-scalping-1' for strategy 5c29def5-10fc-4ffa-a253-c85e50eb925e not found. Skipping AI analysis.
2025-06-25 22:54:56,389 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy 5c29def5-10fc-4ffa-a253-c85e50eb925e can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:54:56,389 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 318c6da3-9ac5-4f42-b7e5-c411c21c76a1 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:54:56,396 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 318c6da3-9ac5-4f42-b7e5-c411c21c76a1
2025-06-25 22:54:56,398 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:54:56,399 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:54:56,406 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:56,406 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:56,415 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:54:56,415 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:54:56,417 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:54:56,420 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 811cf590-56bd-4eb0-8e6b-49a28cfc64fc
2025-06-25 22:54:56,424 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id abe0523c-f6d0-4411-b376-d02531ffe91e. Creando y guardando configuración por defecto.
2025-06-25 22:54:56,426 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:54:56,428 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for abe0523c-f6d0-4411-b376-d02531ffe91e. Using default values.
2025-06-25 22:54:56,428 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for abe0523c-f6d0-4411-b376-d02531ffe91e with capital: 10000.0
2025-06-25 22:54:56,431 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:54:56,431 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:54:56,432 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:54:56,432 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Autonomous Scalping' as context for confirmed opportunity 811cf590-56bd-4eb0-8e6b-49a28cfc64fc
2025-06-25 22:54:56,432 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:404 - Trade side determinado: buy
2025-06-25 22:54:56,433 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:455 - Created trade 74340626-64bb-48c5-9a88-7fa35069b42a from decision 2a19fc17-330b-406f-a7a1-d268f10f6c47
2025-06-25 22:54:56,433 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 811cf590-56bd-4eb0-8e6b-49a28cfc64fc: 'str' object has no attribute 'value'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 259, in execute_trade_from_confirmed_opportunity
    side=trade.side.value.upper(), # Asegurar que se use el valor string del enum
         ^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'value'
2025-06-25 22:54:56,566 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:54:56,567 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:54:56,576 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:56,576 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:56,583 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:54:56,584 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:54:56,586 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:54:56,588 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 62b109db-b6c1-4b31-a39f-b24a9cb25f0b
2025-06-25 22:54:56,591 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 225e88ea-a2e9-4691-9cfb-d83038b943c8. Creando y guardando configuración por defecto.
2025-06-25 22:54:56,594 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:54:56,596 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 225e88ea-a2e9-4691-9cfb-d83038b943c8. Using default values.
2025-06-25 22:54:56,597 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 225e88ea-a2e9-4691-9cfb-d83038b943c8 with capital: 10000.0
2025-06-25 22:54:56,598 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:54:56,598 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:54:56,598 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:54:56,598 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'AI-Enhanced Scalping' as context for confirmed opportunity 62b109db-b6c1-4b31-a39f-b24a9cb25f0b
2025-06-25 22:54:56,599 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:404 - Trade side determinado: buy
2025-06-25 22:54:56,599 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:455 - Created trade f4b49715-67b2-4c2d-8cd8-9a6e821548f0 from decision 719f3759-7ae9-4b88-880e-9dec6a95ef84
2025-06-25 22:54:56,599 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 62b109db-b6c1-4b31-a39f-b24a9cb25f0b: 'str' object has no attribute 'value'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 259, in execute_trade_from_confirmed_opportunity
    side=trade.side.value.upper(), # Asegurar que se use el valor string del enum
         ^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'value'
2025-06-25 22:54:56,628 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:54:56,629 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:54:56,636 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:56,636 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:56,644 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:54:56,644 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:54:56,647 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:54:56,649 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 1f195bfd-8e61-4567-8192-c014d081e53f
2025-06-25 22:54:56,652 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 4a1cf062-9496-47a8-9573-0f4f252ab431. Creando y guardando configuración por defecto.
2025-06-25 22:54:56,655 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:54:56,658 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 4a1cf062-9496-47a8-9573-0f4f252ab431. Using default values.
2025-06-25 22:54:56,659 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 4a1cf062-9496-47a8-9573-0f4f252ab431 with capital: 10000.0
2025-06-25 22:54:56,660 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:54:56,661 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 0.000, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 0.0000
2025-06-25 22:54:56,661 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:192 - Último precio de BTC/USDT: 50000.0
2025-06-25 22:54:56,661 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'Day Trading Strategy' as context for confirmed opportunity 1f195bfd-8e61-4567-8192-c014d081e53f
2025-06-25 22:54:56,661 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:404 - Trade side determinado: buy
2025-06-25 22:54:56,662 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:455 - Created trade c7b3a42b-5d30-484f-aacb-60b813c17b38 from decision dec3429e-2867-47fc-b15c-bd4c162f82ea
2025-06-25 22:54:56,662 - ultibot_backend.services.trading_engine_service - ERROR - [MainThread] - trading_engine_service.py:362 - Failed to execute trade for opportunity 1f195bfd-8e61-4567-8192-c014d081e53f: 'str' object has no attribute 'value'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_engine_service.py", line 259, in execute_trade_from_confirmed_opportunity
    side=trade.side.value.upper(), # Asegurar que se use el valor string del enum
         ^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'value'
2025-06-25 22:54:56,689 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:54:56,690 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:54:56,699 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:56,700 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:56,707 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:54:56,707 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:54:56,709 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:54:56,711 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:404 - Trade side determinado: buy
2025-06-25 22:54:56,711 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:455 - Created trade 5362e7d1-6a40-46df-9c83-864c232c2159 from decision 196a67e5-4f70-46af-8c84-411f57d5fa14
2025-06-25 22:54:56,712 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:54:56,713 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:54:56,720 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:56,721 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:56,729 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:54:56,729 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:54:56,731 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:54:56,732 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:404 - Trade side determinado: buy
2025-06-25 22:54:56,733 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:455 - Created trade 754d10fc-02b6-424b-a351-d4aae802c562 from decision 3b619b11-dba3-4a05-a455-b3cdda7d8033
2025-06-25 22:54:56,733 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:54:56,734 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:54:56,743 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:56,743 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:56,750 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 22:54:56,750 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 22:54:56,752 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:54:56,754 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:54:56,755 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:54:58,689 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:58,689 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:58,696 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 22:54:58,698 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 22:54:58,699 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 22:54:58,709 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:54:58,713 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 22:54:58,714 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:54:58,718 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 22:54:58,725 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:54:58,730 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 22:54:58,735 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:58,735 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:58,739 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:58,740 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:58,741 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:54:58,745 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:58,745 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:58,753 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:58,753 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:58,760 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:58,761 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:58,764 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:54:58,768 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:58,769 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:58,772 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:286 - Verificación de Binance BINANCE_SPOT exitosa.
2025-06-25 22:54:58,777 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:58,777 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:58,780 - ultibot_backend.services.credential_service - ERROR - [MainThread] - credential_service.py:315 - Error de Binance API durante la verificación: Binance Down
2025-06-25 22:54:58,784 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:58,784 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:58,789 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 22:54:58,793 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 22:54:58,794 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 22:54:58,797 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:241 - Verificación de Telegram exitosa.
2025-06-25 22:54:58,803 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:72 - Conexión con Binance exitosa.
2025-06-25 22:54:58,811 - ultibot_backend.services.market_data_service - WARNING - [MainThread] - market_data_service.py:52 - Credenciales de Binance no encontradas. Por favor, configúrelas.
2025-06-25 22:54:58,816 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:69 - Fallo en la verificación de conexión con Binance. Revise sus credenciales y permisos.
2025-06-25 22:54:58,820 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:77 - Error al acceder a las credenciales de Binance: Decryption failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 45, in get_binance_connection_status
    binance_credential = await self.credential_service.get_credential(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.CredentialError: Decryption failed
2025-06-25 22:54:58,826 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:81 - Error de la API de Binance: API unavailable
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 61, in get_binance_connection_status
    is_connected = await self.credential_service.verify_credential(binance_credential)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.BinanceAPIError: API unavailable
2025-06-25 22:54:58,830 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 22:54:58,840 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:121 - Error de la API de Binance al obtener balances: Failed to fetch balances
2025-06-25 22:54:58,844 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1852944043920'>
2025-06-25 22:54:58,845 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 57eb0aff-4b60-486c-85ee-5390eb974208, mode_filter: None
2025-06-25 22:54:58,846 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1852944043920'>
2025-06-25 22:54:58,846 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 57eb0aff-4b60-486c-85ee-5390eb974208 with mode_filter: None
2025-06-25 22:54:58,850 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1852944050768'>
2025-06-25 22:54:58,851 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 57eb0aff-4b60-486c-85ee-5390eb974208, mode_filter: None
2025-06-25 22:54:58,851 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1852944050768'>
2025-06-25 22:54:58,851 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 57eb0aff-4b60-486c-85ee-5390eb974208 with mode_filter: None
2025-06-25 22:54:58,854 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1852946070672'>
2025-06-25 22:54:58,856 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 57eb0aff-4b60-486c-85ee-5390eb974208, mode_filter: OperatingMode.PAPER
2025-06-25 22:54:58,857 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1852946070672'>
2025-06-25 22:54:58,857 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 57eb0aff-4b60-486c-85ee-5390eb974208
2025-06-25 22:54:58,860 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1852966827408'>
2025-06-25 22:54:58,862 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 57eb0aff-4b60-486c-85ee-5390eb974208, mode_filter: OperatingMode.PAPER
2025-06-25 22:54:58,862 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1852966827408'>
2025-06-25 22:54:58,862 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 57eb0aff-4b60-486c-85ee-5390eb974208
2025-06-25 22:54:58,865 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1852938518224'>
2025-06-25 22:54:58,866 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 57eb0aff-4b60-486c-85ee-5390eb974208, mode_filter: OperatingMode.REAL
2025-06-25 22:54:58,866 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1852938518224'>
2025-06-25 22:54:58,867 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 57eb0aff-4b60-486c-85ee-5390eb974208
2025-06-25 22:54:58,871 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1852966817808'>
2025-06-25 22:54:58,873 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 57eb0aff-4b60-486c-85ee-5390eb974208, mode_filter: OperatingMode.PAPER
2025-06-25 22:54:58,874 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1852966817808'>
2025-06-25 22:54:58,874 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 57eb0aff-4b60-486c-85ee-5390eb974208
2025-06-25 22:54:58,877 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1852946106128'>
2025-06-25 22:54:58,878 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 57eb0aff-4b60-486c-85ee-5390eb974208, mode_filter: None
2025-06-25 22:54:58,879 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1852946106128'>
2025-06-25 22:54:58,879 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 2 performance entries for user 57eb0aff-4b60-486c-85ee-5390eb974208
2025-06-25 22:54:58,882 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1852936666832'>
2025-06-25 22:54:58,883 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 57eb0aff-4b60-486c-85ee-5390eb974208, mode_filter: OperatingMode.PAPER
2025-06-25 22:54:58,884 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1852936666832'>
2025-06-25 22:54:58,884 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 57eb0aff-4b60-486c-85ee-5390eb974208
2025-06-25 22:54:58,888 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1852938422544'>
2025-06-25 22:54:58,890 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 57eb0aff-4b60-486c-85ee-5390eb974208, mode_filter: OperatingMode.PAPER
2025-06-25 22:54:58,890 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1852938422544'>
2025-06-25 22:54:58,890 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 57eb0aff-4b60-486c-85ee-5390eb974208 with mode_filter: OperatingMode.PAPER
2025-06-25 22:54:58,895 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1852945812112'>
2025-06-25 22:54:58,896 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 57eb0aff-4b60-486c-85ee-5390eb974208, mode_filter: OperatingMode.PAPER
2025-06-25 22:54:58,896 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1852945812112'>
2025-06-25 22:54:58,896 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user 57eb0aff-4b60-486c-85ee-5390eb974208 with mode_filter: OperatingMode.PAPER
2025-06-25 22:54:58,900 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1852936662480'>
2025-06-25 22:54:58,902 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 57eb0aff-4b60-486c-85ee-5390eb974208, mode_filter: OperatingMode.PAPER
2025-06-25 22:54:58,902 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1852936662480'>
2025-06-25 22:54:58,902 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 57eb0aff-4b60-486c-85ee-5390eb974208
2025-06-25 22:54:58,906 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1852965677328'>
2025-06-25 22:54:58,908 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 57eb0aff-4b60-486c-85ee-5390eb974208, mode_filter: OperatingMode.PAPER
2025-06-25 22:54:58,908 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1852965677328'>
2025-06-25 22:54:58,908 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 57eb0aff-4b60-486c-85ee-5390eb974208
2025-06-25 22:54:58,912 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1852938513232'>
2025-06-25 22:54:58,913 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 57eb0aff-4b60-486c-85ee-5390eb974208, mode_filter: OperatingMode.PAPER
2025-06-25 22:54:58,913 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1852938513232'>
2025-06-25 22:54:58,914 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 57eb0aff-4b60-486c-85ee-5390eb974208
2025-06-25 22:54:58,916 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1852940534736'>
2025-06-25 22:54:58,919 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user 57eb0aff-4b60-486c-85ee-5390eb974208, mode_filter: OperatingMode.PAPER
2025-06-25 22:54:58,919 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1852940534736'>
2025-06-25 22:54:58,919 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user 57eb0aff-4b60-486c-85ee-5390eb974208
2025-06-25 22:54:58,964 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario dd1e7235-5e7c-4b9a-b4c7-c8a6f40767d1 en modo paper
2025-06-25 22:54:58,969 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario d58317b5-a6cd-41de-a72d-0e3752f29dda en modo paper
2025-06-25 22:54:58,974 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario f905b734-1b61-4e90-aeaf-d6cca0feb608 en modo paper
2025-06-25 22:54:58,979 - ultibot_backend.services.trading_report_service - ERROR - [MainThread] - trading_report_service.py:79 - Error al obtener trades cerrados para usuario f5a5bdfd-7666-41e1-b523-9756f6a47b4a: Database connection failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_report_service.py", line 65, in get_closed_trades
    trades = await persistence_service.get_closed_trades(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
Exception: Database connection failed
2025-06-25 22:54:58,990 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 332bd0ae-d292-4843-9b64-f9e65704103b for symbol BTC/USDT
2025-06-25 22:54:58,991 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy e1453193-a5b2-4b9c-af84-9900f48dcf00 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:54:58,992 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 332bd0ae-d292-4843-9b64-f9e65704103b status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:54:58,993 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 332bd0ae-d292-4843-9b64-f9e65704103b
2025-06-25 22:54:59,000 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 722886c1-de72-4b5f-81fa-7207332725fa for symbol BTC/USDT
2025-06-25 22:54:59,002 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy a553f756-e69f-4477-b3b3-920863ba36a8 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:54:59,002 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 722886c1-de72-4b5f-81fa-7207332725fa status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:54:59,003 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 722886c1-de72-4b5f-81fa-7207332725fa
2025-06-25 22:54:59,012 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity ad5710ef-f75d-4935-aacb-175afbb74110 for symbol BTC/USDT
2025-06-25 22:54:59,014 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy c0c42e15-898a-49f0-b041-a8f932cac35d can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:54:59,014 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity ad5710ef-f75d-4935-aacb-175afbb74110 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:54:59,015 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity ad5710ef-f75d-4935-aacb-175afbb74110
2025-06-25 22:54:59,026 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity f662edac-0fe8-4703-a9d1-26a6f0747071 for symbol BTC/USDT
2025-06-25 22:54:59,027 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy ff7bfaf8-82ee-4d7a-8acc-e020eccec24e can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:54:59,027 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity f662edac-0fe8-4703-a9d1-26a6f0747071 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:54:59,028 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity f662edac-0fe8-4703-a9d1-26a6f0747071
2025-06-25 22:54:59,038 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity a9259d8e-4778-424f-9cd0-53851ca52c1b for symbol BTC/USDT
2025-06-25 22:54:59,039 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:661 - Unknown strategy type 'CUSTOM_UNKNOWN_TYPE' for strategy 27f477eb-f07c-40a7-8077-e71779bd7df9. Recommending investigation.
2025-06-25 22:54:59,039 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity a9259d8e-4778-424f-9cd0-53851ca52c1b status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:54:59,041 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity a9259d8e-4778-424f-9cd0-53851ca52c1b
2025-06-25 22:54:59,049 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity cff9a80c-390a-4457-81de-6e82f59cf335 for symbol BTC/USDT
2025-06-25 22:54:59,050 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy 5cfbd07e-d45d-4368-aec6-492ae09d619e can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:54:59,051 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity cff9a80c-390a-4457-81de-6e82f59cf335 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:54:59,052 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity cff9a80c-390a-4457-81de-6e82f59cf335
2025-06-25 22:54:59,074 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 1b0fe8a8-e7ef-4777-baef-fd800bc6abae for symbol BTC/USDT
2025-06-25 22:54:59,076 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy c6acb14c-ee0b-464e-8deb-d3f4801346e9 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 22:54:59,076 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 1b0fe8a8-e7ef-4777-baef-fd800bc6abae status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 22:54:59,078 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 1b0fe8a8-e7ef-4777-baef-fd800bc6abae
2025-06-25 23:06:10,597 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 23:06:10,597 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 23:06:10,619 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 23:06:10,620 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 23:06:10,768 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 77124035-6b8d-4bb8-89d1-4e60df94f854
2025-06-25 23:06:10,769 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:152 - User configuration saved after initializing last_daily_reset for user 3179a567-28ac-4337-8db4-99b03c4a3fbb.
2025-06-25 23:06:10,769 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 200.000
2025-06-25 23:06:10,770 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity 77124035-6b8d-4bb8-89d1-4e60df94f854
2025-06-25 23:06:10,770 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:404 - Trade side determinado: buy
2025-06-25 23:06:10,770 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:455 - Created trade 094a0bc2-8e6d-4d4e-a991-acc76eddc8bc from decision 9f8c742f-c4ad-497c-93a3-a4ca3ed87558
2025-06-25 23:06:10,772 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 094a0bc2-8e6d-4d4e-a991-acc76eddc8bc from confirmed opportunity.
2025-06-25 23:06:10,773 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: TradeSide.BUY, OCO side calculated: sell
2025-06-25 23:06:10,773 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:310 - Successfully created OCO order for trade 094a0bc2-8e6d-4d4e-a991-acc76eddc8bc. OCO List ID: oco_list_123
2025-06-25 23:06:10,775 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 3179a567-28ac-4337-8db4-99b03c4a3fbb: 200.0000000000000000000000000 (anterior: 0.0, valor trade: 200.0000000000000000000000000)
2025-06-25 23:06:10,775 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user 3179a567-28ac-4337-8db4-99b03c4a3fbb to 200.0000000000000000000000000.
2025-06-25 23:06:10,776 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 77124035-6b8d-4bb8-89d1-4e60df94f854 status to converted_to_trade_real: Trade 094a0bc2-8e6d-4d4e-a991-acc76eddc8bc executed based on user confirmation.
2025-06-25 23:06:10,776 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 77124035-6b8d-4bb8-89d1-4e60df94f854
2025-06-25 23:06:11,090 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity cda5cf28-55ed-4fb7-91db-fef5a315fa1d
2025-06-25 23:06:11,091 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:143 - Daily capital reset triggered for user edbcabd8-18f4-40b7-92fa-4339a39116c0. Resetting daily_capital_risked_usd.
2025-06-25 23:06:11,091 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:147 - User configuration saved after daily capital reset for user edbcabd8-18f4-40b7-92fa-4339a39116c0.
2025-06-25 23:06:11,091 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 2500.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 100.000
2025-06-25 23:06:11,091 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity cda5cf28-55ed-4fb7-91db-fef5a315fa1d
2025-06-25 23:06:11,092 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:404 - Trade side determinado: buy
2025-06-25 23:06:11,092 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:455 - Created trade 3af058bf-1b82-4476-aaa1-b5bb07f1b517 from decision 94da2b7a-0078-47ea-8fc0-428d5969cfb0
2025-06-25 23:06:11,093 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 3af058bf-1b82-4476-aaa1-b5bb07f1b517 from confirmed opportunity.
2025-06-25 23:06:11,162 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario edbcabd8-18f4-40b7-92fa-4339a39116c0: 100.000 (anterior: 0.0, valor trade: 100.000)
2025-06-25 23:06:11,162 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user edbcabd8-18f4-40b7-92fa-4339a39116c0 to 100.000.
2025-06-25 23:06:11,163 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity cda5cf28-55ed-4fb7-91db-fef5a315fa1d status to converted_to_trade_real: Trade 3af058bf-1b82-4476-aaa1-b5bb07f1b517 executed based on user confirmation.
2025-06-25 23:06:11,164 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity cda5cf28-55ed-4fb7-91db-fef5a315fa1d
2025-06-25 23:07:51,017 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 23:07:51,018 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 23:07:51,036 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 23:07:51,037 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 23:07:51,173 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 03a5762e-8f2b-4ef7-ab10-1ac0c350743f
2025-06-25 23:07:51,174 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:152 - User configuration saved after initializing last_daily_reset for user 254b5972-ade3-4180-8a8f-61edd0a7482d.
2025-06-25 23:07:51,174 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 200.000
2025-06-25 23:07:51,175 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity 03a5762e-8f2b-4ef7-ab10-1ac0c350743f
2025-06-25 23:07:51,175 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:404 - Trade side determinado: buy
2025-06-25 23:07:51,175 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:455 - Created trade 84343b0a-d581-424c-b57d-92609798e050 from decision 288f1c17-deac-4357-9168-dff0c0457415
2025-06-25 23:07:51,176 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade 84343b0a-d581-424c-b57d-92609798e050 from confirmed opportunity.
2025-06-25 23:07:51,176 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: TradeSide.BUY, OCO side calculated: sell
2025-06-25 23:07:51,176 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:310 - Successfully created OCO order for trade 84343b0a-d581-424c-b57d-92609798e050. OCO List ID: oco_list_123
2025-06-25 23:07:51,178 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 254b5972-ade3-4180-8a8f-61edd0a7482d: 200.0000000000000000000000000 (anterior: 0.0, valor trade: 200.0000000000000000000000000)
2025-06-25 23:07:51,178 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user 254b5972-ade3-4180-8a8f-61edd0a7482d to 200.0000000000000000000000000.
2025-06-25 23:07:51,179 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 03a5762e-8f2b-4ef7-ab10-1ac0c350743f status to converted_to_trade_real: Trade 84343b0a-d581-424c-b57d-92609798e050 executed based on user confirmation.
2025-06-25 23:07:51,180 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 03a5762e-8f2b-4ef7-ab10-1ac0c350743f
2025-06-25 23:07:51,189 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 7634efdc-18bc-45c4-aed8-c83dae56fbec
2025-06-25 23:07:51,189 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:143 - Daily capital reset triggered for user 60b6daca-83e4-4934-a162-0159e8f31465. Resetting daily_capital_risked_usd.
2025-06-25 23:07:51,190 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:147 - User configuration saved after daily capital reset for user 60b6daca-83e4-4934-a162-0159e8f31465.
2025-06-25 23:07:51,190 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 2500.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 100.000
2025-06-25 23:07:51,190 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity 7634efdc-18bc-45c4-aed8-c83dae56fbec
2025-06-25 23:07:51,191 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:404 - Trade side determinado: buy
2025-06-25 23:07:51,191 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:455 - Created trade ce25c62d-b00e-4eea-90ab-10aeb2053277 from decision 09d10dac-9521-4265-8e7e-626071df4383
2025-06-25 23:07:51,192 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade ce25c62d-b00e-4eea-90ab-10aeb2053277 from confirmed opportunity.
2025-06-25 23:07:51,193 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario 60b6daca-83e4-4934-a162-0159e8f31465: 100.000 (anterior: 0.0, valor trade: 100.000)
2025-06-25 23:07:51,193 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user 60b6daca-83e4-4934-a162-0159e8f31465 to 100.000.
2025-06-25 23:07:51,194 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 7634efdc-18bc-45c4-aed8-c83dae56fbec status to converted_to_trade_real: Trade ce25c62d-b00e-4eea-90ab-10aeb2053277 executed based on user confirmation.
2025-06-25 23:07:51,194 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 7634efdc-18bc-45c4-aed8-c83dae56fbec
2025-06-25 23:17:12,934 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 23:17:12,935 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 23:17:12,953 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 23:17:12,954 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 23:17:13,243 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:17:13,243 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:17:13,252 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 23:17:13,252 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 23:17:13,267 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:17:13,542 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 23:17:13,544 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 23:17:13,554 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:17:13,554 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:17:13,561 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 23:17:13,562 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 23:17:13,564 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:17:13,657 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 23:17:13,658 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 23:17:13,666 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:17:13,666 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:17:13,674 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 23:17:13,674 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 23:17:13,676 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:17:13,683 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 23:17:13,684 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 23:18:27,746 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 23:18:27,747 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 23:18:27,766 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 23:18:27,766 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 23:18:28,072 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:18:28,072 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:18:28,082 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 23:18:28,082 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 23:18:28,096 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:18:28,101 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 02ad3b6e-1291-41ef-b162-f626176b2414 for symbol BTCUSDT
2025-06-25 23:18:28,102 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:612 - No active and applicable strategies found for opportunity 02ad3b6e-1291-41ef-b162-f626176b2414 with symbol BTCUSDT.
2025-06-25 23:18:28,102 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 02ad3b6e-1291-41ef-b162-f626176b2414 status to rejected_by_system: No active strategies are applicable to this opportunity's symbol.
2025-06-25 23:18:28,103 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 02ad3b6e-1291-41ef-b162-f626176b2414
2025-06-25 23:18:28,458 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 23:18:28,459 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 23:18:28,468 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:18:28,468 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:18:28,475 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 23:18:28,475 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 23:18:28,478 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:18:28,481 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 211c6208-e87f-4c78-8fb7-a7b886c9297b for symbol BTCUSDT
2025-06-25 23:18:28,482 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:612 - No active and applicable strategies found for opportunity 211c6208-e87f-4c78-8fb7-a7b886c9297b with symbol BTCUSDT.
2025-06-25 23:18:28,482 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 211c6208-e87f-4c78-8fb7-a7b886c9297b status to rejected_by_system: No active strategies are applicable to this opportunity's symbol.
2025-06-25 23:18:28,483 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 211c6208-e87f-4c78-8fb7-a7b886c9297b
2025-06-25 23:18:28,506 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 23:18:28,506 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 23:18:28,514 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:18:28,514 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:18:28,523 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 23:18:28,523 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 23:18:28,525 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:18:28,528 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity aa8ae5b1-f984-4c82-b202-43630699494a for symbol BTCUSDT
2025-06-25 23:18:28,529 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:612 - No active and applicable strategies found for opportunity aa8ae5b1-f984-4c82-b202-43630699494a with symbol BTCUSDT.
2025-06-25 23:18:28,529 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity aa8ae5b1-f984-4c82-b202-43630699494a status to rejected_by_system: No active strategies are applicable to this opportunity's symbol.
2025-06-25 23:18:28,530 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity aa8ae5b1-f984-4c82-b202-43630699494a
2025-06-25 23:18:28,535 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 23:18:28,536 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 23:26:36,275 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 23:26:36,276 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 23:26:36,294 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 23:26:36,294 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 23:26:36,590 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:26:36,591 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:26:36,599 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 23:26:36,599 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 23:26:36,614 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:26:36,619 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 7f6a8c02-abbb-4068-9e7a-3d75186305e5 for symbol BTCUSDT
2025-06-25 23:26:36,621 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:612 - No active and applicable strategies found for opportunity 7f6a8c02-abbb-4068-9e7a-3d75186305e5 with symbol BTCUSDT.
2025-06-25 23:26:36,621 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 7f6a8c02-abbb-4068-9e7a-3d75186305e5 status to rejected_by_system: No active strategies are applicable to this opportunity's symbol.
2025-06-25 23:26:36,621 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 7f6a8c02-abbb-4068-9e7a-3d75186305e5
2025-06-25 23:26:36,962 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 23:26:36,963 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 23:26:36,971 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:26:36,971 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:26:36,981 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 23:26:36,982 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 23:26:36,984 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:26:36,986 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 78de3fc4-d098-4c4d-b1f3-452a20242cf4 for symbol BTCUSDT
2025-06-25 23:26:36,987 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:612 - No active and applicable strategies found for opportunity 78de3fc4-d098-4c4d-b1f3-452a20242cf4 with symbol BTCUSDT.
2025-06-25 23:26:36,988 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 78de3fc4-d098-4c4d-b1f3-452a20242cf4 status to rejected_by_system: No active strategies are applicable to this opportunity's symbol.
2025-06-25 23:26:36,988 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 78de3fc4-d098-4c4d-b1f3-452a20242cf4
2025-06-25 23:26:37,013 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 23:26:37,014 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 23:26:37,021 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:26:37,021 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:26:37,029 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 23:26:37,030 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 23:26:37,032 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:26:37,035 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 520261d0-1e61-4f9a-8274-20e21b7cd2ad for symbol BTCUSDT
2025-06-25 23:26:37,036 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:612 - No active and applicable strategies found for opportunity 520261d0-1e61-4f9a-8274-20e21b7cd2ad with symbol BTCUSDT.
2025-06-25 23:26:37,036 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 520261d0-1e61-4f9a-8274-20e21b7cd2ad status to rejected_by_system: No active strategies are applicable to this opportunity's symbol.
2025-06-25 23:26:37,036 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 520261d0-1e61-4f9a-8274-20e21b7cd2ad
2025-06-25 23:26:37,041 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 23:26:37,042 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 23:29:14,920 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 23:29:14,920 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 23:29:14,938 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 23:29:14,939 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 23:29:15,218 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:29:15,218 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:29:15,227 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 23:29:15,228 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 23:29:15,241 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:29:15,245 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 63dba278-ac21-4ce7-bfcb-eb5962210d6c for symbol BTCUSDT
2025-06-25 23:29:15,246 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 63dba278-ac21-4ce7-bfcb-eb5962210d6c status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 23:29:15,246 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 63dba278-ac21-4ce7-bfcb-eb5962210d6c
2025-06-25 23:29:15,493 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 23:29:15,494 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 23:29:15,505 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:29:15,505 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:29:15,514 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 23:29:15,514 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 23:29:15,518 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:29:15,520 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity aa3978a9-71d0-45cd-a086-5b06791f75cb for symbol BTCUSDT
2025-06-25 23:29:15,521 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:725 - AI confidence 0.4 for strategy 3ae2e689-18cb-42f7-baeb-d4c7c1a5bdf2 is below threshold 0.6.
2025-06-25 23:29:15,521 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy 3ae2e689-18cb-42f7-baeb-d4c7c1a5bdf2 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 23:29:15,521 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity aa3978a9-71d0-45cd-a086-5b06791f75cb status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 23:29:15,522 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity aa3978a9-71d0-45cd-a086-5b06791f75cb
2025-06-25 23:29:15,526 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 23:29:15,528 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 23:29:15,536 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:29:15,536 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:29:15,543 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 23:29:15,543 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 23:29:15,545 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:29:15,549 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 6ed22f9a-fed3-4f57-a94b-48ca2b7fdc87 for symbol BTCUSDT
2025-06-25 23:29:15,549 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy 04002dad-3a9d-4fc0-92ae-70ec3b2dff47 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 23:29:15,550 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 6ed22f9a-fed3-4f57-a94b-48ca2b7fdc87 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 23:29:15,550 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 6ed22f9a-fed3-4f57-a94b-48ca2b7fdc87
2025-06-25 23:29:15,556 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 23:29:15,557 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 23:30:31,957 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 23:30:31,957 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 23:30:31,974 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 23:30:31,975 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 23:30:32,282 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:30:32,282 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:30:32,294 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 23:30:32,294 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 23:30:32,310 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:30:32,315 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 04b99a46-263c-4426-8d0e-a575b5c46222 for symbol BTCUSDT
2025-06-25 23:30:32,315 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 04b99a46-263c-4426-8d0e-a575b5c46222 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 23:30:32,315 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 04b99a46-263c-4426-8d0e-a575b5c46222
2025-06-25 23:30:32,575 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 23:30:32,577 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 23:30:32,585 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:30:32,587 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:30:32,599 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 23:30:32,600 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 23:30:32,602 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:30:32,606 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 19906278-7ef1-45d3-a1e4-0ee911818716 for symbol BTCUSDT
2025-06-25 23:30:32,607 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:725 - AI confidence 0.4 for strategy b72ac151-595a-4e45-9c70-c305ad649641 is below threshold 0.6.
2025-06-25 23:30:32,607 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:740 - Strategy b72ac151-595a-4e45-9c70-c305ad649641 did not produce a decision for opportunity 19906278-7ef1-45d3-a1e4-0ee911818716.
2025-06-25 23:30:32,607 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:631 - No affirmative trading decisions made for opportunity 19906278-7ef1-45d3-a1e4-0ee911818716.
2025-06-25 23:30:32,607 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 19906278-7ef1-45d3-a1e4-0ee911818716 status to rejected_by_system: All applicable strategies evaluated, but none resulted in a decision to trade.
2025-06-25 23:30:32,608 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 19906278-7ef1-45d3-a1e4-0ee911818716
2025-06-25 23:30:32,609 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 23:30:32,610 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 23:30:32,620 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:30:32,621 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:30:32,629 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 23:30:32,629 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 23:30:32,632 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:30:32,635 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 73eb4ed2-811d-4f0d-ade2-4720fcd0ebd9 for symbol BTCUSDT
2025-06-25 23:30:32,635 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy 16b5ad0c-4b1f-481b-9d27-62f07ce10f66 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 23:30:32,635 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 73eb4ed2-811d-4f0d-ade2-4720fcd0ebd9 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 23:30:32,637 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 73eb4ed2-811d-4f0d-ade2-4720fcd0ebd9
2025-06-25 23:30:32,643 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 23:30:32,644 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 23:31:05,309 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 23:31:05,310 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 23:31:05,331 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 23:31:05,331 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 23:31:05,636 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:31:05,637 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:31:05,645 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 23:31:05,646 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 23:31:05,660 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:31:05,665 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 3c7f7017-2e15-48b7-9e93-a60bbf5c69fc for symbol BTCUSDT
2025-06-25 23:31:05,666 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 3c7f7017-2e15-48b7-9e93-a60bbf5c69fc status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 23:31:05,666 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 3c7f7017-2e15-48b7-9e93-a60bbf5c69fc
2025-06-25 23:31:05,667 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 23:31:05,668 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 23:31:05,677 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:31:05,677 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:31:05,686 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 23:31:05,686 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 23:31:05,688 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:31:05,691 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 55d67b50-eee2-41d6-af73-25fbd4704e7d for symbol BTCUSDT
2025-06-25 23:31:05,692 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:725 - AI confidence 0.4 for strategy da4b70ec-4110-40af-852b-335cf7fa68cb is below threshold 0.6.
2025-06-25 23:31:05,692 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:740 - Strategy da4b70ec-4110-40af-852b-335cf7fa68cb did not produce a decision for opportunity 55d67b50-eee2-41d6-af73-25fbd4704e7d.
2025-06-25 23:31:05,692 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:631 - No affirmative trading decisions made for opportunity 55d67b50-eee2-41d6-af73-25fbd4704e7d.
2025-06-25 23:31:05,693 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 55d67b50-eee2-41d6-af73-25fbd4704e7d status to rejected_by_system: All applicable strategies evaluated, but none resulted in a decision to trade.
2025-06-25 23:31:05,693 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 55d67b50-eee2-41d6-af73-25fbd4704e7d
2025-06-25 23:31:05,694 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 23:31:05,695 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 23:31:05,703 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:31:05,705 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:31:05,712 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 23:31:05,712 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 23:31:05,715 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:31:05,718 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 53a2741a-a6c5-4f2d-b4ea-1c91b5ac7644 for symbol BTCUSDT
2025-06-25 23:31:05,719 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy 0d5888b3-3a44-47eb-8370-f2897c8741e2 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 23:31:05,719 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 53a2741a-a6c5-4f2d-b4ea-1c91b5ac7644 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 23:31:05,720 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 53a2741a-a6c5-4f2d-b4ea-1c91b5ac7644
2025-06-25 23:31:05,721 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 23:31:05,723 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 23:31:20,546 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 23:31:20,546 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 23:31:20,567 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 23:31:20,567 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 23:31:20,730 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 23:31:20,730 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 23:31:20,746 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 23:31:20,747 - ultibot_backend - INFO - [MainThread] - main.py:222 - Instancia global de la aplicación creada.
2025-06-25 23:31:21,408 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 23:31:21,409 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 23:31:21,429 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 23:31:21,445 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 23:31:21,447 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 23:31:21,449 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /test-config
2025-06-25 23:31:21,450 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /test-config - Status: 200
2025-06-25 23:31:21,460 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 23:31:21,461 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 23:31:21,479 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 23:31:21,482 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 23:31:21,484 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 23:31:21,491 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 23:31:21,491 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 23:31:21,512 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 23:31:21,515 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 23:31:21,516 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 23:31:21,524 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 23:31:21,525 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 23:31:21,542 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 23:31:21,544 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 23:31:21,546 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 23:31:21,553 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 23:31:21,553 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 23:31:21,572 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 23:31:21,576 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 23:31:21,578 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 200
2025-06-25 23:31:21,584 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 23:31:21,586 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 23:31:21,603 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 23:31:21,604 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/performance/strategies
2025-06-25 23:31:21,605 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 23:31:21,605 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 23:31:21,605 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:45 - Using local SQLite database: sqlite+aiosqlite:///ultibot_local.db. This is for development.
2025-06-25 23:31:21,605 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:48 - Initializing database with URL: sqlite+aiosqlite:///ultibot_local.db
2025-06-25 23:31:21,625 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:62 - Database tables created and session factory initialized successfully.
2025-06-25 23:31:21,802 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 23:31:21,803 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 23:31:21,979 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 23:31:21,980 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:31:21,980 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:31:21,980 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 23:31:21,997 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:31:21,997 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000019C9B1F3310>
2025-06-25 23:31:21,997 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 23:31:21,998 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 23:31:21,998 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/performance/strategies - Status: 422
2025-06-25 23:31:22,008 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 23:31:22,009 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 23:31:22,027 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 23:31:22,028 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 23:31:22,028 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 23:31:22,029 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 23:31:22,205 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 23:31:22,205 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 23:31:22,383 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 23:31:22,383 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:31:22,383 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:31:22,384 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 23:31:22,388 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:31:22,388 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000019C9B7AA4D0>
2025-06-25 23:31:22,388 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 23:31:22,388 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 23:31:22,396 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 23:31:22,405 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 23:31:22,405 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 23:31:22,413 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 23:31:22,414 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 23:31:22,431 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 23:31:22,433 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 23:31:22,433 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 23:31:22,433 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 23:31:22,610 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 23:31:22,610 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 23:31:22,786 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 23:31:22,787 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:31:22,787 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:31:22,787 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 23:31:22,790 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:31:22,790 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000019C9B80C0D0>
2025-06-25 23:31:22,790 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 23:31:22,790 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 23:31:22,795 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 23:31:22,801 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 23:31:22,802 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 23:31:22,803 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 23:31:22,808 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 23:31:22,809 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 23:31:22,810 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 23:31:22,810 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 23:31:22,819 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 23:31:22,820 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 23:31:22,925 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 23:31:22,927 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 23:31:22,927 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 23:31:22,928 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 23:31:23,103 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 23:31:23,104 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 23:31:23,278 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 23:31:23,278 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:31:23,278 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:31:23,279 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 23:31:23,281 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:31:23,282 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000019C9B675D90>
2025-06-25 23:31:23,282 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 23:31:23,282 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 23:31:23,286 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 23:31:23,293 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 23:31:23,294 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 23:31:23,295 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 23:31:23,299 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 23:31:23,300 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 23:31:23,309 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 23:31:23,309 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 23:31:23,327 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 23:31:23,328 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/config
2025-06-25 23:31:23,329 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 23:31:23,329 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 23:31:23,506 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 23:31:23,507 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 23:31:23,680 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 23:31:23,680 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:31:23,680 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:31:23,681 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 23:31:23,683 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:31:23,683 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000019C9B533490>
2025-06-25 23:31:23,684 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 23:31:23,684 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 23:31:23,688 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 23:31:23,694 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 23:31:23,694 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/config - Status: 200
2025-06-25 23:31:23,695 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 23:31:23,701 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 23:31:23,702 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 200
2025-06-25 23:31:23,711 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 23:31:23,711 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 23:31:23,729 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 23:31:23,731 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: PATCH /api/v1/config
2025-06-25 23:31:23,731 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 23:31:23,732 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 23:31:23,907 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 23:31:23,908 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 23:31:24,083 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 23:31:24,083 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:31:24,083 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:31:24,083 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 23:31:24,089 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:31:24,089 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000019C9B4A8B10>
2025-06-25 23:31:24,089 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 23:31:24,090 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 23:31:24,090 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: PATCH /api/v1/config - Status: 422
2025-06-25 23:31:24,109 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity ea94b577-0795-4d4a-ae5e-149a4dcfc171
2025-06-25 23:31:24,110 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:152 - User configuration saved after initializing last_daily_reset for user ef57cd14-ab56-4f7a-984d-6f766d7c1763.
2025-06-25 23:31:24,110 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 5000.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 200.000
2025-06-25 23:31:24,111 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity ea94b577-0795-4d4a-ae5e-149a4dcfc171
2025-06-25 23:31:24,111 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:404 - Trade side determinado: buy
2025-06-25 23:31:24,112 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:455 - Created trade bd8fd46f-e99b-4b62-8ae8-4b035d44e0aa from decision 5b09a483-0652-4672-b3b7-063587d521d0
2025-06-25 23:31:24,112 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade bd8fd46f-e99b-4b62-8ae8-4b035d44e0aa from confirmed opportunity.
2025-06-25 23:31:24,113 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:295 - Trade side: TradeSide.BUY, OCO side calculated: sell
2025-06-25 23:31:24,113 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:310 - Successfully created OCO order for trade bd8fd46f-e99b-4b62-8ae8-4b035d44e0aa. OCO List ID: oco_list_123
2025-06-25 23:31:24,114 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario ef57cd14-ab56-4f7a-984d-6f766d7c1763: 200.0000000000000000000000000 (anterior: 0.0, valor trade: 200.0000000000000000000000000)
2025-06-25 23:31:24,114 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user ef57cd14-ab56-4f7a-984d-6f766d7c1763 to 200.0000000000000000000000000.
2025-06-25 23:31:24,114 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity ea94b577-0795-4d4a-ae5e-149a4dcfc171 status to converted_to_trade_real: Trade bd8fd46f-e99b-4b62-8ae8-4b035d44e0aa executed based on user confirmation.
2025-06-25 23:31:24,115 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity ea94b577-0795-4d4a-ae5e-149a4dcfc171
2025-06-25 23:31:24,125 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:132 - Executing trade directly from confirmed opportunity 1ec358ca-db81-4010-82b1-fbd358890c24
2025-06-25 23:31:24,126 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:143 - Daily capital reset triggered for user f839fa28-2722-4c8e-9de7-2c5a49c0f0af. Resetting daily_capital_risked_usd.
2025-06-25 23:31:24,126 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:147 - User configuration saved after daily capital reset for user f839fa28-2722-4c8e-9de7-2c5a49c0f0af.
2025-06-25 23:31:24,127 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:187 - Validación de Capital: Límite Diario USD: 2500.00, Arriesgado Actual USD: 0.0, Riesgo Potencial Trade USD: 100.000
2025-06-25 23:31:24,127 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:206 - Using strategy 'test_strategy' as context for confirmed opportunity 1ec358ca-db81-4010-82b1-fbd358890c24
2025-06-25 23:31:24,127 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:404 - Trade side determinado: buy
2025-06-25 23:31:24,128 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:455 - Created trade a1512c70-c7d6-4260-a9a3-fa11441f6658 from decision be98384a-57b0-491c-92e9-12e795171152
2025-06-25 23:31:24,128 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:271 - Successfully executed trade a1512c70-c7d6-4260-a9a3-fa11441f6658 from confirmed opportunity.
2025-06-25 23:31:24,130 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:345 - Capital arriesgado actualizado para usuario f839fa28-2722-4c8e-9de7-2c5a49c0f0af: 100.000 (anterior: 0.0, valor trade: 100.000)
2025-06-25 23:31:24,130 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:352 - Updated daily_capital_risked_usd for user f839fa28-2722-4c8e-9de7-2c5a49c0f0af to 100.000.
2025-06-25 23:31:24,130 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 1ec358ca-db81-4010-82b1-fbd358890c24 status to converted_to_trade_real: Trade a1512c70-c7d6-4260-a9a3-fa11441f6658 executed based on user confirmation.
2025-06-25 23:31:24,131 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 1ec358ca-db81-4010-82b1-fbd358890c24
2025-06-25 23:31:24,147 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 23:31:24,147 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 23:31:24,165 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 23:31:24,167 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 23:31:24,167 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 23:31:24,168 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 23:31:24,343 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 23:31:24,344 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 23:31:24,516 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 23:31:24,517 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:31:24,517 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:31:24,518 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 23:31:24,521 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:31:24,521 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000019C9B2A0D90>
2025-06-25 23:31:24,522 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 23:31:24,522 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 23:31:24,522 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:497 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 23:31:24,526 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"a909156a-0b3f-4813-a90a-57dbf6f915cc","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T03:31:24.137473Z","submittedAt":"2025-06-26T03:31:24.137473Z","fillTimestamp":"2025-06-26T03:31:24.137473Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T03:31:24.137473Z","opened_at":"2025-06-26T03:31:24.137473Z","updated_at":"2025-06-26T03:31:24.137473Z","closed_at":"2025-06-26T03:31:24.137473Z"}
2025-06-25 23:31:24,526 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': 'a909156a-0b3f-4813-a90a-57dbf6f915cc', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T03:31:24.137473Z', 'submittedAt': '2025-06-26T03:31:24.137473Z', 'fillTimestamp': '2025-06-26T03:31:24.137473Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T03:31:24.137473Z', 'opened_at': '2025-06-26T03:31:24.137473Z', 'updated_at': '2025-06-26T03:31:24.137473Z', 'closed_at': '2025-06-26T03:31:24.137473Z'}
2025-06-25 23:31:24,526 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"3a044d3f-9484-4172-9f0e-d9e8c44e2ace","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T03:31:24.138473Z","submittedAt":"2025-06-26T03:31:24.138473Z","fillTimestamp":"2025-06-26T03:31:24.138473Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T03:31:24.138473Z","opened_at":"2025-06-26T03:31:24.138473Z","updated_at":"2025-06-26T03:31:24.138473Z","closed_at":"2025-06-26T03:31:24.138473Z"}
2025-06-25 23:31:24,527 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': '3a044d3f-9484-4172-9f0e-d9e8c44e2ace', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T03:31:24.138473Z', 'submittedAt': '2025-06-26T03:31:24.138473Z', 'fillTimestamp': '2025-06-26T03:31:24.138473Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T03:31:24.138473Z', 'opened_at': '2025-06-26T03:31:24.138473Z', 'updated_at': '2025-06-26T03:31:24.138473Z', 'closed_at': '2025-06-26T03:31:24.138473Z'}
2025-06-25 23:31:24,527 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"2e00eaca-dc2d-4c9a-bce7-518a93187982","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T03:31:24.138473Z","submittedAt":"2025-06-26T03:31:24.138473Z","fillTimestamp":"2025-06-26T03:31:24.138473Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T03:31:24.138473Z","opened_at":"2025-06-26T03:31:24.138473Z","updated_at":"2025-06-26T03:31:24.138473Z","closed_at":"2025-06-26T03:31:24.138473Z"}
2025-06-25 23:31:24,527 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '2e00eaca-dc2d-4c9a-bce7-518a93187982', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T03:31:24.138473Z', 'submittedAt': '2025-06-26T03:31:24.138473Z', 'fillTimestamp': '2025-06-26T03:31:24.138473Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T03:31:24.138473Z', 'opened_at': '2025-06-26T03:31:24.138473Z', 'updated_at': '2025-06-26T03:31:24.138473Z', 'closed_at': '2025-06-26T03:31:24.138473Z'}
2025-06-25 23:31:24,528 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:547 - get_closed_trades - Trades recuperados: 3
2025-06-25 23:31:24,528 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 23:31:24,528 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 23:31:24,546 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 23:31:24,546 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 23:31:24,564 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 23:31:24,565 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/trades/history/paper
2025-06-25 23:31:24,566 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 23:31:24,566 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 23:31:24,741 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 23:31:24,742 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 23:31:24,915 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 23:31:24,915 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:31:24,916 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:31:24,916 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 23:31:24,920 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:31:24,920 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000019C9B6761D0>
2025-06-25 23:31:24,921 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 23:31:24,921 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 23:31:24,922 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:497 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: BTCUSDT, start_date: None, end_date: None
2025-06-25 23:31:24,925 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"9a6f6a91-d3c2-447b-b5b2-6e74244ea1e3","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T03:31:24.538483Z","submittedAt":"2025-06-26T03:31:24.538483Z","fillTimestamp":"2025-06-26T03:31:24.538483Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T03:31:24.538483Z","opened_at":"2025-06-26T03:31:24.538483Z","updated_at":"2025-06-26T03:31:24.538483Z","closed_at":"2025-06-26T03:31:24.538483Z"}
2025-06-25 23:31:24,926 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '9a6f6a91-d3c2-447b-b5b2-6e74244ea1e3', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T03:31:24.538483Z', 'submittedAt': '2025-06-26T03:31:24.538483Z', 'fillTimestamp': '2025-06-26T03:31:24.538483Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T03:31:24.538483Z', 'opened_at': '2025-06-26T03:31:24.538483Z', 'updated_at': '2025-06-26T03:31:24.538483Z', 'closed_at': '2025-06-26T03:31:24.538483Z'}
2025-06-25 23:31:24,926 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:547 - get_closed_trades - Trades recuperados: 1
2025-06-25 23:31:24,926 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 1 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 23:31:24,927 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/trades/history/paper - Status: 200
2025-06-25 23:31:24,944 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 23:31:24,944 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 23:31:24,963 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 23:31:24,965 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 23:31:24,967 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 23:31:24,967 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 23:31:25,143 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 23:31:25,144 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 23:31:25,320 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 23:31:25,320 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:31:25,320 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:31:25,320 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 23:31:25,323 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:31:25,323 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000019C9B4DF550>
2025-06-25 23:31:25,323 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 23:31:25,323 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 23:31:25,324 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:497 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: None, end_date: None
2025-06-25 23:31:25,326 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-1","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"BTCUSDT","side":"buy","entryOrder":{"orderId_internal":"8d069d0f-ff65-4505-a911-4f4c25c05f00","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T03:31:24.936769Z","submittedAt":"2025-06-26T03:31:24.936769Z","fillTimestamp":"2025-06-26T03:31:24.936769Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"150.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T03:31:24.936769Z","opened_at":"2025-06-26T03:31:24.936769Z","updated_at":"2025-06-26T03:31:24.936769Z","closed_at":"2025-06-26T03:31:24.936769Z"}
2025-06-25 23:31:25,327 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-1', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'BTCUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '8d069d0f-ff65-4505-a911-4f4c25c05f00', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T03:31:24.936769Z', 'submittedAt': '2025-06-26T03:31:24.936769Z', 'fillTimestamp': '2025-06-26T03:31:24.936769Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '150.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T03:31:24.936769Z', 'opened_at': '2025-06-26T03:31:24.936769Z', 'updated_at': '2025-06-26T03:31:24.936769Z', 'closed_at': '2025-06-26T03:31:24.936769Z'}
2025-06-25 23:31:25,327 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-2","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ETHUSDT","side":"sell","entryOrder":{"orderId_internal":"a25a6604-27f5-4907-a54c-088d27cbcb01","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T03:31:24.936769Z","submittedAt":"2025-06-26T03:31:24.936769Z","fillTimestamp":"2025-06-26T03:31:24.936769Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"-75.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T03:31:24.936769Z","opened_at":"2025-06-26T03:31:24.936769Z","updated_at":"2025-06-26T03:31:24.936769Z","closed_at":"2025-06-26T03:31:24.936769Z"}
2025-06-25 23:31:25,327 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-2', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ETHUSDT', 'side': 'sell', 'entryOrder': {'orderId_internal': 'a25a6604-27f5-4907-a54c-088d27cbcb01', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T03:31:24.936769Z', 'submittedAt': '2025-06-26T03:31:24.936769Z', 'fillTimestamp': '2025-06-26T03:31:24.936769Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '-75.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T03:31:24.936769Z', 'opened_at': '2025-06-26T03:31:24.936769Z', 'updated_at': '2025-06-26T03:31:24.936769Z', 'closed_at': '2025-06-26T03:31:24.936769Z'}
2025-06-25 23:31:25,327 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:519 - get_closed_trades - trade_orm.data: {"id":"test-trade-3","user_id":"00000000-0000-0000-0000-000000000001","mode":"paper","symbol":"ADAUSDT","side":"buy","entryOrder":{"orderId_internal":"4fd15f72-5ddd-4979-bfa7-7432c2c7c43d","orderId_exchange":null,"clientOrderId_exchange":null,"orderCategory":"entry","type":"market","status":"filled","requestedPrice":null,"requestedQuantity":"1.0","executedQuantity":"1.0","executedPrice":"50000.0","cumulativeQuoteQty":"50000.0","commissions":[],"commission":"0.0","commissionAsset":null,"timestamp":"2025-06-26T03:31:24.936769Z","submittedAt":"2025-06-26T03:31:24.936769Z","fillTimestamp":"2025-06-26T03:31:24.936769Z","rawResponse":{},"ocoOrderListId":null,"price":null,"stopPrice":null,"timeInForce":null},"exitOrders":[],"positionStatus":"closed","strategyId":null,"opportunityId":null,"aiAnalysisConfidence":null,"pnl_usd":"25.0","pnl_percentage":"0.01","closingReason":null,"ocoOrderListId":null,"takeProfitPrice":null,"trailingStopActivationPrice":null,"trailingStopCallbackRate":null,"currentStopPrice_tsl":null,"riskRewardAdjustments":[],"created_at":"2025-06-26T03:31:24.936769Z","opened_at":"2025-06-26T03:31:24.936769Z","updated_at":"2025-06-26T03:31:24.936769Z","closed_at":"2025-06-26T03:31:24.936769Z"}
2025-06-25 23:31:25,328 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:520 - get_closed_trades - trade_data_from_json: {'id': 'test-trade-3', 'user_id': '00000000-0000-0000-0000-000000000001', 'mode': 'paper', 'symbol': 'ADAUSDT', 'side': 'buy', 'entryOrder': {'orderId_internal': '4fd15f72-5ddd-4979-bfa7-7432c2c7c43d', 'orderId_exchange': None, 'clientOrderId_exchange': None, 'orderCategory': 'entry', 'type': 'market', 'status': 'filled', 'requestedPrice': None, 'requestedQuantity': '1.0', 'executedQuantity': '1.0', 'executedPrice': '50000.0', 'cumulativeQuoteQty': '50000.0', 'commissions': [], 'commission': '0.0', 'commissionAsset': None, 'timestamp': '2025-06-26T03:31:24.936769Z', 'submittedAt': '2025-06-26T03:31:24.936769Z', 'fillTimestamp': '2025-06-26T03:31:24.936769Z', 'rawResponse': {}, 'ocoOrderListId': None, 'price': None, 'stopPrice': None, 'timeInForce': None}, 'exitOrders': [], 'positionStatus': 'closed', 'strategyId': None, 'opportunityId': None, 'aiAnalysisConfidence': None, 'pnl_usd': '25.0', 'pnl_percentage': '0.01', 'closingReason': None, 'ocoOrderListId': None, 'takeProfitPrice': None, 'trailingStopActivationPrice': None, 'trailingStopCallbackRate': None, 'currentStopPrice_tsl': None, 'riskRewardAdjustments': [], 'created_at': '2025-06-26T03:31:24.936769Z', 'opened_at': '2025-06-26T03:31:24.936769Z', 'updated_at': '2025-06-26T03:31:24.936769Z', 'closed_at': '2025-06-26T03:31:24.936769Z'}
2025-06-25 23:31:25,328 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:547 - get_closed_trades - Trades recuperados: 3
2025-06-25 23:31:25,328 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 23:31:25,328 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 23:31:25,348 - ultibot_backend - INFO - [MainThread] - main.py:115 - Creando nueva instancia de FastAPI...
2025-06-25 23:31:25,348 - ultibot_backend - INFO - [MainThread] - main.py:158 - Registrando routers de la API...
2025-06-25 23:31:25,367 - ultibot_backend - INFO - [MainThread] - main.py:169 - Todos los routers han sido registrados.
2025-06-25 23:31:25,369 - ultibot_backend - INFO - [MainThread] - main.py:127 - Middleware: Solicitud entrante: GET /api/v1/portfolio/paper/performance_summary
2025-06-25 23:31:25,369 - ultibot_backend.dependencies - WARNING - [MainThread] - dependencies.py:207 - DependencyContainer no encontrado en app.state. Inicializando contenedor global para tests.
2025-06-25 23:31:25,369 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:106 - Initializing dependency container...
2025-06-25 23:31:25,549 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:12 - RedisCache initialized with URL: redis://localhost:6379/0
2025-06-25 23:31:25,549 - ultibot_backend.adapters.redis_cache - INFO - [MainThread] - redis_cache.py:18 - Redis client created.
2025-06-25 23:31:25,723 - ultibot_backend.services.order_execution_service - INFO - [MainThread] - order_execution_service.py:343 - Paper Trading Service inicializado con capital virtual: 10000.0 USDT
2025-06-25 23:31:25,724 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:31:25,724 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:31:25,724 - ultibot_backend.services.unified_order_execution_service - INFO - [MainThread] - unified_order_execution_service.py:28 - UnifiedOrderExecutionService initialized with both real and paper execution services
2025-06-25 23:31:25,727 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:31:25,727 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <ultibot_backend.adapters.persistence_service.SupabasePersistenceService object at 0x0000019C9B7A4BD0>
2025-06-25 23:31:25,727 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:186 - Dependency container initialized successfully.
2025-06-25 23:31:25,728 - ultibot_backend.dependencies - INFO - [MainThread] - dependencies.py:210 - Contenedor global de contingencia inicializado y servicios cargados.
2025-06-25 23:31:25,728 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:497 - get_closed_trades - user_id: 00000000-0000-0000-0000-000000000001, mode: paper, symbol: None, start_date: 2025-06-27 03:31:25.368007+00:00, end_date: None
2025-06-25 23:31:25,732 - ultibot_backend.adapters.persistence_service - DEBUG - [MainThread] - persistence_service.py:547 - get_closed_trades - Trades recuperados: 0
2025-06-25 23:31:25,732 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario 00000000-0000-0000-0000-000000000001 en modo paper
2025-06-25 23:31:25,733 - ultibot_backend - INFO - [MainThread] - main.py:129 - Middleware: Solicitud procesada: GET /api/v1/portfolio/paper/performance_summary - Status: 200
2025-06-25 23:31:25,779 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity fdfe3087-3bed-41c4-a947-13401b56a642 for symbol BTCUSDT
2025-06-25 23:31:25,779 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: ec7b2512-d916-4ab7-829a-bd1635b8dcf3
2025-06-25 23:31:25,780 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy d7e8f738-7924-4077-897c-91d6d9f63092 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 23:31:25,789 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity dff69a90-2d07-4d03-b2f5-345d2c966da2 for symbol BTCUSDT
2025-06-25 23:31:25,789 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy 306ec320-a36e-41fc-ab25-8bc0a1cace12 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 23:31:25,798 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity f878303a-144e-45f9-b0a0-67166ee2d214 for symbol ETHUSDT
2025-06-25 23:31:25,798 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: b21bc729-30dd-4767-9bbb-0e9ec964c8f0
2025-06-25 23:31:25,799 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:612 - No active and applicable strategies found for opportunity f878303a-144e-45f9-b0a0-67166ee2d214 with symbol ETHUSDT.
2025-06-25 23:31:25,799 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity f878303a-144e-45f9-b0a0-67166ee2d214 status to rejected_by_system: No active strategies are applicable to this opportunity's symbol.
2025-06-25 23:31:25,801 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity f878303a-144e-45f9-b0a0-67166ee2d214
2025-06-25 23:31:25,809 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity f2efbf56-00ec-4a67-9369-3017394f9278 for symbol BTCUSDT
2025-06-25 23:31:25,810 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: f2fb84e9-ea78-48fe-8992-46d0f79e22d0
2025-06-25 23:31:25,810 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:725 - AI confidence 0.65 for strategy 58d2a84c-8d2f-498a-9851-952600a21dec is below threshold 0.8.
2025-06-25 23:31:25,812 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:740 - Strategy 58d2a84c-8d2f-498a-9851-952600a21dec did not produce a decision for opportunity f2efbf56-00ec-4a67-9369-3017394f9278.
2025-06-25 23:31:25,812 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:631 - No affirmative trading decisions made for opportunity f2efbf56-00ec-4a67-9369-3017394f9278.
2025-06-25 23:31:25,821 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity c645ecde-5c82-48b1-94f4-02a2ba879d0a for symbol BTCUSDT
2025-06-25 23:31:25,822 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 689d7ba4-927b-494d-b352-004be00b1a20
2025-06-25 23:31:25,828 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 860e590a-7090-497f-bd61-dbcea0e38761 for symbol BTCUSDT
2025-06-25 23:31:25,830 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: fc18295c-5dcf-49ca-9f4b-99b8aab8f9e7
2025-06-25 23:31:25,836 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:404 - Trade side determinado: buy
2025-06-25 23:31:25,837 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:455 - Created trade 3a40e09b-2417-405c-8a90-7d55921cced9 from decision 180b08b9-af43-4658-a687-55209a908744
2025-06-25 23:31:25,843 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:404 - Trade side determinado: buy
2025-06-25 23:31:25,844 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:455 - Created trade f49ab80c-261f-4f50-b79d-c36538d11af2 from decision 07256847-b5b2-475d-aab7-6c348937dfdc
2025-06-25 23:31:25,844 - ultibot_backend.services.trading_engine_service - DEBUG - [MainThread] - trading_engine_service.py:404 - Trade side determinado: sell
2025-06-25 23:31:25,844 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:455 - Created trade e582c25d-73d9-4f3d-abe2-6b5884f26db1 from decision 07256847-b5b2-475d-aab7-6c348937dfdc
2025-06-25 23:31:25,850 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:31:25,851 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:31:25,861 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 23:31:25,861 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 23:31:25,863 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:31:25,867 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity b570d35b-233f-49bd-a459-04520ef9f005 for symbol BTCUSDT
2025-06-25 23:31:25,867 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity b570d35b-233f-49bd-a459-04520ef9f005 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 23:31:25,868 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity b570d35b-233f-49bd-a459-04520ef9f005
2025-06-25 23:31:25,870 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 23:31:25,871 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 23:31:25,878 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:31:25,878 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:31:25,887 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 23:31:25,887 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 23:31:25,890 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:31:25,893 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 225fa086-6465-4599-89c0-705c4c26fc43 for symbol BTCUSDT
2025-06-25 23:31:25,893 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:725 - AI confidence 0.4 for strategy b73bab9e-1c25-42d5-a8fb-82eb4da26d4e is below threshold 0.6.
2025-06-25 23:31:25,894 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:740 - Strategy b73bab9e-1c25-42d5-a8fb-82eb4da26d4e did not produce a decision for opportunity 225fa086-6465-4599-89c0-705c4c26fc43.
2025-06-25 23:31:25,894 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:631 - No affirmative trading decisions made for opportunity 225fa086-6465-4599-89c0-705c4c26fc43.
2025-06-25 23:31:25,894 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 225fa086-6465-4599-89c0-705c4c26fc43 status to rejected_by_system: All applicable strategies evaluated, but none resulted in a decision to trade.
2025-06-25 23:31:25,894 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 225fa086-6465-4599-89c0-705c4c26fc43
2025-06-25 23:31:25,895 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 23:31:25,896 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 23:31:25,904 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:31:25,905 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:31:25,912 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:85 - No configuration found for 00000000-0000-0000-0000-000000000001. Using default values.
2025-06-25 23:31:25,912 - ultibot_backend.services.portfolio_service - INFO - [MainThread] - portfolio_service.py:87 - Paper trading portfolio initialized for 00000000-0000-0000-0000-000000000001 with capital: 10000.0
2025-06-25 23:31:25,916 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:31:25,919 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 1ae1984c-8d7b-40c8-aeb2-ff132d6e4533 for symbol BTCUSDT
2025-06-25 23:31:25,919 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy 2d909fec-6e1d-4d7d-99fd-db6fc949f064 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 23:31:25,920 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 1ae1984c-8d7b-40c8-aeb2-ff132d6e4533 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 23:31:25,921 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 1ae1984c-8d7b-40c8-aeb2-ff132d6e4533
2025-06-25 23:31:25,922 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 23:31:25,923 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 23:31:27,910 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:31:27,910 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:31:27,917 - ultibot_backend.services.ai_orchestrator_service - INFO - [MainThread] - ai_orchestrator_service.py:144 - AIOrchestrator initialized with gemini-1.5-pro-latest and PydanticOutputParser.
2025-06-25 23:31:27,919 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:302 - MarketDataService: Iniciando cierre...
2025-06-25 23:31:27,919 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:315 - MarketDataService: Cierre completado.
2025-06-25 23:31:27,928 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 23:31:27,932 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:80 - No se encontró configuración para el user_id 00000000-0000-0000-0000-000000000001. Creando y guardando configuración por defecto.
2025-06-25 23:31:27,933 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 23:31:27,936 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:117 - Configuración guardada exitosamente.
2025-06-25 23:31:27,942 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 23:31:27,945 - ultibot_backend.services.config_service - INFO - [MainThread] - config_service.py:71 - Configuración de usuario cargada exitosamente para el user_id: 00000000-0000-0000-0000-000000000001
2025-06-25 23:31:27,949 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:31:27,949 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:31:27,954 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:31:27,955 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:31:27,956 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 23:31:27,959 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:31:27,959 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:31:27,967 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:31:27,968 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:31:27,976 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:31:27,977 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:31:27,980 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 23:31:27,983 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:31:27,983 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:31:27,987 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:286 - Verificación de Binance BINANCE_SPOT exitosa.
2025-06-25 23:31:27,992 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:31:27,992 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:31:27,995 - ultibot_backend.services.credential_service - ERROR - [MainThread] - credential_service.py:315 - Error de Binance API durante la verificación: Binance Down
2025-06-25 23:31:27,999 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:31:27,999 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:31:28,002 - ultibot_backend.services.credential_service - WARNING - [MainThread] - credential_service.py:57 - Advertencia: Token de encriptación inválido. La desencriptación falló.
2025-06-25 23:31:28,007 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:30 - CredentialService __init__ intentando obtener encryption_key de AppSettings: Presente
2025-06-25 23:31:28,007 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:36 - Pasando la siguiente clave (str) a Fernet: m-28N... (truncada por seguridad)
2025-06-25 23:31:28,011 - ultibot_backend.services.credential_service - INFO - [MainThread] - credential_service.py:241 - Verificación de Telegram exitosa.
2025-06-25 23:31:28,017 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:72 - Conexión con Binance exitosa.
2025-06-25 23:31:28,023 - ultibot_backend.services.market_data_service - WARNING - [MainThread] - market_data_service.py:52 - Credenciales de Binance no encontradas. Por favor, configúrelas.
2025-06-25 23:31:28,028 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:69 - Fallo en la verificación de conexión con Binance. Revise sus credenciales y permisos.
2025-06-25 23:31:28,033 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:77 - Error al acceder a las credenciales de Binance: Decryption failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 45, in get_binance_connection_status
    binance_credential = await self.credential_service.get_credential(
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.CredentialError: Decryption failed
2025-06-25 23:31:28,039 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:81 - Error de la API de Binance: API unavailable
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\market_data_service.py", line 61, in get_binance_connection_status
    is_connected = await self.credential_service.verify_credential(binance_credential)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
ultibot_backend.core.exceptions.BinanceAPIError: API unavailable
2025-06-25 23:31:28,045 - ultibot_backend.services.market_data_service - INFO - [MainThread] - market_data_service.py:118 - Balances de Binance obtenidos.
2025-06-25 23:31:28,054 - ultibot_backend.services.market_data_service - ERROR - [MainThread] - market_data_service.py:121 - Error de la API de Binance al obtener balances: Failed to fetch balances
2025-06-25 23:31:28,057 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1772198305744'>
2025-06-25 23:31:28,059 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user d68ba43c-968f-4956-9c6c-ad57d9113589, mode_filter: None
2025-06-25 23:31:28,059 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1772198305744'>
2025-06-25 23:31:28,059 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user d68ba43c-968f-4956-9c6c-ad57d9113589 with mode_filter: None
2025-06-25 23:31:28,062 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1772198378768'>
2025-06-25 23:31:28,064 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user d68ba43c-968f-4956-9c6c-ad57d9113589, mode_filter: None
2025-06-25 23:31:28,064 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1772198378768'>
2025-06-25 23:31:28,064 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user d68ba43c-968f-4956-9c6c-ad57d9113589 with mode_filter: None
2025-06-25 23:31:28,067 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1772198400464'>
2025-06-25 23:31:28,069 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user d68ba43c-968f-4956-9c6c-ad57d9113589, mode_filter: OperatingMode.PAPER
2025-06-25 23:31:28,069 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1772198400464'>
2025-06-25 23:31:28,070 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user d68ba43c-968f-4956-9c6c-ad57d9113589
2025-06-25 23:31:28,073 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1772156934416'>
2025-06-25 23:31:28,075 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user d68ba43c-968f-4956-9c6c-ad57d9113589, mode_filter: OperatingMode.PAPER
2025-06-25 23:31:28,075 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1772156934416'>
2025-06-25 23:31:28,075 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user d68ba43c-968f-4956-9c6c-ad57d9113589
2025-06-25 23:31:28,079 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1772198404240'>
2025-06-25 23:31:28,080 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user d68ba43c-968f-4956-9c6c-ad57d9113589, mode_filter: OperatingMode.REAL
2025-06-25 23:31:28,080 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1772198404240'>
2025-06-25 23:31:28,081 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user d68ba43c-968f-4956-9c6c-ad57d9113589
2025-06-25 23:31:28,083 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1772156859024'>
2025-06-25 23:31:28,086 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user d68ba43c-968f-4956-9c6c-ad57d9113589, mode_filter: OperatingMode.PAPER
2025-06-25 23:31:28,086 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1772156859024'>
2025-06-25 23:31:28,087 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user d68ba43c-968f-4956-9c6c-ad57d9113589
2025-06-25 23:31:28,090 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1772156765264'>
2025-06-25 23:31:28,092 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user d68ba43c-968f-4956-9c6c-ad57d9113589, mode_filter: None
2025-06-25 23:31:28,092 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1772156765264'>
2025-06-25 23:31:28,093 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 2 performance entries for user d68ba43c-968f-4956-9c6c-ad57d9113589
2025-06-25 23:31:28,096 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1772129693008'>
2025-06-25 23:31:28,097 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user d68ba43c-968f-4956-9c6c-ad57d9113589, mode_filter: OperatingMode.PAPER
2025-06-25 23:31:28,097 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1772129693008'>
2025-06-25 23:31:28,098 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user d68ba43c-968f-4956-9c6c-ad57d9113589
2025-06-25 23:31:28,101 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1772198107088'>
2025-06-25 23:31:28,103 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user d68ba43c-968f-4956-9c6c-ad57d9113589, mode_filter: OperatingMode.PAPER
2025-06-25 23:31:28,103 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1772198107088'>
2025-06-25 23:31:28,103 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user d68ba43c-968f-4956-9c6c-ad57d9113589 with mode_filter: OperatingMode.PAPER
2025-06-25 23:31:28,107 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1772197986064'>
2025-06-25 23:31:28,108 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user d68ba43c-968f-4956-9c6c-ad57d9113589, mode_filter: OperatingMode.PAPER
2025-06-25 23:31:28,108 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1772197986064'>
2025-06-25 23:31:28,109 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:140 - No closed trades found for user d68ba43c-968f-4956-9c6c-ad57d9113589 with mode_filter: OperatingMode.PAPER
2025-06-25 23:31:28,112 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1772156916944'>
2025-06-25 23:31:28,115 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user d68ba43c-968f-4956-9c6c-ad57d9113589, mode_filter: OperatingMode.PAPER
2025-06-25 23:31:28,115 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1772156916944'>
2025-06-25 23:31:28,116 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user d68ba43c-968f-4956-9c6c-ad57d9113589
2025-06-25 23:31:28,119 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1772135396752'>
2025-06-25 23:31:28,120 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user d68ba43c-968f-4956-9c6c-ad57d9113589, mode_filter: OperatingMode.PAPER
2025-06-25 23:31:28,121 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1772135396752'>
2025-06-25 23:31:28,121 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user d68ba43c-968f-4956-9c6c-ad57d9113589
2025-06-25 23:31:28,124 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1772129997328'>
2025-06-25 23:31:28,126 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user d68ba43c-968f-4956-9c6c-ad57d9113589, mode_filter: OperatingMode.PAPER
2025-06-25 23:31:28,126 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1772129997328'>
2025-06-25 23:31:28,126 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user d68ba43c-968f-4956-9c6c-ad57d9113589
2025-06-25 23:31:28,129 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:29 - PerformanceService initialized. PersistenceService instance: <AsyncMock spec='SupabasePersistenceService' id='1772132491536'>
2025-06-25 23:31:28,132 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:120 - Fetching performance data for user d68ba43c-968f-4956-9c6c-ad57d9113589, mode_filter: OperatingMode.PAPER
2025-06-25 23:31:28,132 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:129 - Using injected persistence_service: <AsyncMock spec='SupabasePersistenceService' id='1772132491536'>
2025-06-25 23:31:28,132 - ultibot_backend.services.performance_service - INFO - [MainThread] - performance_service.py:180 - Generated 1 performance entries for user d68ba43c-968f-4956-9c6c-ad57d9113589
2025-06-25 23:31:28,179 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario a2282582-9d95-45dc-aac8-1eb4a3648b1a en modo paper
2025-06-25 23:31:28,183 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 3 trades cerrados para usuario 2f368df6-00c1-411a-a82b-24102ef4330a en modo paper
2025-06-25 23:31:28,189 - ultibot_backend.services.trading_report_service - INFO - [MainThread] - trading_report_service.py:75 - Obtenidos 0 trades cerrados para usuario 4cf2de00-5663-415d-9283-913fa18a3ef5 en modo paper
2025-06-25 23:31:28,195 - ultibot_backend.services.trading_report_service - ERROR - [MainThread] - trading_report_service.py:79 - Error al obtener trades cerrados para usuario 2f062df4-001f-4e0b-9d9e-547b5f6b4766: Database connection failed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_backend\services\trading_report_service.py", line 65, in get_closed_trades
    trades = await persistence_service.get_closed_trades(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Program Files\Python311\Lib\unittest\mock.py", line 2237, in _execute_mock_call
    raise effect
Exception: Database connection failed
2025-06-25 23:31:28,205 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity b3cfa7fc-c062-4859-8789-352e6e4d3b89 for symbol BTC/USDT
2025-06-25 23:31:28,206 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy 84af5313-50ac-4ebe-9e8b-ed5d92abb575 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 23:31:28,206 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity b3cfa7fc-c062-4859-8789-352e6e4d3b89 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 23:31:28,207 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity b3cfa7fc-c062-4859-8789-352e6e4d3b89
2025-06-25 23:31:28,216 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity c245d4f9-adcf-40c2-b5a1-f206dccebe71 for symbol BTC/USDT
2025-06-25 23:31:28,217 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy db721a9f-d547-4c18-b6c3-152fe788d65f can operate autonomously. Proceeding with autonomous logic.
2025-06-25 23:31:28,218 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity c245d4f9-adcf-40c2-b5a1-f206dccebe71 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 23:31:28,219 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity c245d4f9-adcf-40c2-b5a1-f206dccebe71
2025-06-25 23:31:28,228 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 2db5d85e-bfda-4056-ba5a-c81b078cba1b for symbol BTC/USDT
2025-06-25 23:31:28,229 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy b1dc5324-55db-457e-a5a9-680aa5a0e055 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 23:31:28,229 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 2db5d85e-bfda-4056-ba5a-c81b078cba1b status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 23:31:28,230 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 2db5d85e-bfda-4056-ba5a-c81b078cba1b
2025-06-25 23:31:28,242 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity d6fed421-fe52-4856-b01f-7d8bfd5ecf1e for symbol BTC/USDT
2025-06-25 23:31:28,244 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy 2e63f623-4ca3-4255-909a-513c3f115b96 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 23:31:28,244 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity d6fed421-fe52-4856-b01f-7d8bfd5ecf1e status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 23:31:28,245 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity d6fed421-fe52-4856-b01f-7d8bfd5ecf1e
2025-06-25 23:31:28,255 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 2547141c-23d8-47c6-b9e3-c0d2b2e5eeff for symbol BTC/USDT
2025-06-25 23:31:28,256 - ultibot_backend.services.trading_engine_service - WARNING - [MainThread] - trading_engine_service.py:661 - Unknown strategy type 'CUSTOM_UNKNOWN_TYPE' for strategy 7d093aed-2c25-43bb-b5d7-0c1e78ead0c7. Recommending investigation.
2025-06-25 23:31:28,256 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 2547141c-23d8-47c6-b9e3-c0d2b2e5eeff status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 23:31:28,257 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 2547141c-23d8-47c6-b9e3-c0d2b2e5eeff
2025-06-25 23:31:28,265 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity fcea3baf-4d00-46b8-82b0-7c92caeddb07 for symbol BTC/USDT
2025-06-25 23:31:28,266 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy 4e7a452c-a5d5-44c7-9126-e18086654c01 can operate autonomously. Proceeding with autonomous logic.
2025-06-25 23:31:28,267 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity fcea3baf-4d00-46b8-82b0-7c92caeddb07 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 23:31:28,268 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity fcea3baf-4d00-46b8-82b0-7c92caeddb07
2025-06-25 23:31:28,289 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:579 - Processing opportunity 135aa1e6-e0c5-45c9-b0f6-b946a3e02925 for symbol BTC/USDT
2025-06-25 23:31:28,292 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:732 - Strategy ccb7d2cb-79b7-4b6d-99a7-8c1e7dc96a6c can operate autonomously. Proceeding with autonomous logic.
2025-06-25 23:31:28,292 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:543 - Updated opportunity 135aa1e6-e0c5-45c9-b0f6-b946a3e02925 status to under_evaluation: 1 potential trade decision(s) generated.
2025-06-25 23:31:28,293 - ultibot_backend.services.trading_engine_service - INFO - [MainThread] - trading_engine_service.py:550 - Persisted status update for opportunity 135aa1e6-e0c5-45c9-b0f6-b946a3e02925
