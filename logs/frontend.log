2025-06-08 18:47:13,232 - __main__ - INFO - Initializing application...
2025-06-08 18:47:13,243 - __main__ - INFO - Stylesheet loaded successfully.
2025-06-08 18:47:13,244 - __main__ - DEBUG - API base URL set to: http://127.0.0.1:8000
2025-06-08 18:47:13,244 - httpx - DEBUG - load_ssl_context verify=True cert=None trust_env=True http2=False
2025-06-08 18:47:13,245 - httpx - DEBUG - load_verify_locations cafile='C:\\Users\\zamor\\UltiBotInversiones\\.venv\\Lib\\site-packages\\certifi\\cacert.pem'
2025-06-08 18:47:13,422 - __main__ - DEBUG - AppController initialized.
2025-06-08 18:47:13,423 - __main__ - DEBUG - Starting AppController initialization.
2025-06-08 18:47:13,423 - __main__ - INFO - Controller: Starting initialization worker.
2025-06-08 18:47:13,423 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001A7EEC39A90>, coroutine_factory: set
2025-06-08 18:47:13,423 - __main__ - DEBUG - Initialization thread starting.
2025-06-08 18:47:13,424 - __main__ - DEBUG - Starting application event loop.
2025-06-08 18:47:13,424 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 18:47:13,424 - asyncio - DEBUG - Using proactor: IocpProactor
2025-06-08 18:47:13,425 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 18:47:13,425 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object UltiBotAPIClient.get_user_configuration at 0x000001A7EEC15460>. Running in event loop.
2025-06-08 18:47:13,425 - src.ultibot_ui.services.api_client - INFO - Obteniendo configuración de usuario.
2025-06-08 18:47:13,425 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/config
2025-06-08 18:47:13,446 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 18:47:13,447 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001A7EFD69550>
2025-06-08 18:47:13,447 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 18:47:13,448 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 18:47:13,448 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 18:47:13,448 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 18:47:13,449 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 18:47:13,831 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 22:47:13 GMT'), (b'server', b'uvicorn'), (b'content-length', b'1001'), (b'content-type', b'application/json')])
2025-06-08 18:47:13,832 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/config "HTTP/1.1 200 OK"
2025-06-08 18:47:13,832 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 18:47:13,832 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 18:47:13,832 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 18:47:13,833 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 18:47:13,833 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: id=UUID('86e5f6c7-02a0-475b-b277-1fccbf23aa56') user_id=UUID('00000000-0000-0000-0000-000000000001') telegramChatId=None notificationPreferences=None enableTelegramNotifications=True defaultPaperTradingCapital=None paperTradingActive=False watchlists=None favoritePairs=None riskProfile=None riskProfileSettings=None realTradingSettings=RealTradingSettings(real_trading_mode_active=False, real_trades_executed_count=0, max_real_trades=5, daily_capital_risked_usd=0.0, last_daily_reset=datetime.datetime(2025, 6, 8, 22, 47, 13, 830575), maxConcurrentOperations=None, dailyLossLimitAbsolute=None, dailyProfitTargetAbsolute=None, assetSpecificStopLoss=None, autoPauseTradingConditions=None) aiStrategyConfigurations=None aiAnalysisConfidenceThresholds=None mcpServerPreferences=None selectedTheme='dark' dashboardLayoutProfiles=None activeDashboardLayoutProfileId=None dashboardLayoutConfig=None cloudSyncPreferences=None createdAt=datetime.datetime(2025, 6, 8, 22, 47, 13, 830558) updatedAt=datetime.datetime(2025, 6, 8, 22, 47, 13, 830561)
2025-06-08 18:47:13,833 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 18:47:13,833 - __main__ - INFO - Controller: Initialization complete. User ID: 86e5f6c7-02a0-475b-b277-1fccbf23aa56
2025-06-08 18:47:13,833 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 18:47:13,833 - __main__ - DEBUG - User configuration received successfully. Creating MainWindow.
2025-06-08 18:47:13,846 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 18:47:13,848 - src.ultibot_ui.services.trading_mode_state - INFO - TradingModeStateManager initialized with mode: paper
2025-06-08 18:47:13,848 - src.ultibot_ui.services.trading_mode_state - INFO - Created global trading mode state manager
2025-06-08 18:47:14,166 - src.ultibot_ui.widgets.portfolio_widget - INFO - Timer de actualización del portafolio iniciado.
2025-06-08 18:47:14,171 - src.ultibot_ui.widgets.chart_widget - INFO - Solicitando datos para BTCUSDT - 1h usando ApiWorker
2025-06-08 18:47:14,171 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001A7EEC39A90>, coroutine_factory: set
2025-06-08 18:47:14,183 - src.ultibot_ui.windows.dashboard_view - INFO - DashboardView: _initialize_async_components INVOCADO
2025-06-08 18:47:14,184 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001A7EEC39A90>, coroutine_factory: set
2025-06-08 18:47:14,463 - src.ultibot_ui.views.opportunities_view - INFO - OpportunitiesView: __init__ called.
2025-06-08 18:47:14,463 - src.ultibot_ui.views.opportunities_view - DEBUG - OpportunitiesView initialized.
2025-06-08 18:47:14,467 - src.ultibot_ui.views.opportunities_view - INFO - OpportunitiesView: _load_initial_data called.
2025-06-08 18:47:14,486 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001A7EEC39A90>, coroutine_factory: set
2025-06-08 18:47:14,487 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001A7EEC39A90>, coroutine_factory: set
2025-06-08 18:47:14,495 - src.ultibot_ui.windows.history_view - INFO - HistoryView inicializada para usuario 86e5f6c7-02a0-475b-b277-1fccbf23aa56
2025-06-08 18:47:14,501 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001A7EEC39A90>, coroutine_factory: set
2025-06-08 18:47:14,501 - src.ultibot_ui.windows.main_window - INFO - Central widget y vistas configuradas.
2025-06-08 18:47:14,528 - src.ultibot_ui.windows.main_window - INFO - MainWindow inicializada y visible.
2025-06-08 18:47:14,636 - __main__ - INFO - Main window shown.
2025-06-08 18:47:14,717 - src.ultibot_ui.views.portfolio_view - INFO - PortfolioView: Fetching portfolio snapshot.
2025-06-08 18:47:14,717 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001A7EEC39A90>, coroutine_factory: set
2025-06-08 18:47:14,718 - src.ultibot_ui.windows.settings_view - INFO - SettingsView: Iniciando carga de datos iniciales (_load_initial_data).
2025-06-08 18:47:14,718 - src.ultibot_ui.windows.settings_view - INFO - SettingsView: Solicitando configuración de usuario general.
2025-06-08 18:47:14,718 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001A7EEC39A90>, coroutine_factory: set
2025-06-08 18:47:14,719 - src.ultibot_ui.windows.settings_view - INFO - SettingsView: Solicitando estado de operativa real.
2025-06-08 18:47:14,719 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001A7EEC39A90>, coroutine_factory: set
2025-06-08 18:47:14,719 - src.ultibot_ui.views.opportunities_view - INFO - Fetching Gemini IA opportunities.
2025-06-08 18:47:14,719 - src.ultibot_ui.views.opportunities_view - DEBUG - Creating ApiWorker.
2025-06-08 18:47:14,720 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001A7EEC39A90>, coroutine_factory: set
2025-06-08 18:47:19,183 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001A7EEC39A90>, coroutine_factory: set
2025-06-08 18:47:28,399 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001A7EEC39A90>, coroutine_factory: set
2025-06-08 18:47:29,189 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 18:47:29,190 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001A7EEC39A90>, coroutine_factory: set
2025-06-08 18:47:29,191 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 18:47:29,191 - asyncio - DEBUG - Using proactor: IocpProactor
2025-06-08 18:47:29,192 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 18:47:29,192 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000001A7EED0B890>. Running in event loop.
2025-06-08 18:47:29,192 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 18:47:29,192 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 18:47:29,192 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 18:47:29,193 - httpcore.connection - DEBUG - close.started
2025-06-08 18:47:29,193 - httpcore.connection - DEBUG - close.failed exception=RuntimeError('Event loop is closed')
2025-06-08 18:47:29,193 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 18:47:29,193 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 18:47:29,194 - src.ultibot_ui.services.api_client - INFO - Obteniendo estado de gestión de capital.
2025-06-08 18:47:29,194 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/capital-management/status
2025-06-08 18:47:29,194 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 18:47:29,194 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 18:47:29,195 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001A7EFD34910>
2025-06-08 18:47:29,195 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001A7EFD34A50>
2025-06-08 18:47:29,195 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 18:47:29,195 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 18:47:29,195 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 18:47:29,196 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 18:47:29,196 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 18:47:29,196 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 18:47:29,196 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 18:47:29,196 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 18:47:29,196 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 18:47:29,196 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 18:47:29,198 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 404, b'Not Found', [(b'date', b'Sun, 08 Jun 2025 22:47:28 GMT'), (b'server', b'uvicorn'), (b'content-length', b'22'), (b'content-type', b'application/json')])
2025-06-08 18:47:29,198 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/capital-management/status "HTTP/1.1 404 Not Found"
2025-06-08 18:47:29,198 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 18:47:29,198 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 18:47:29,198 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 18:47:29,198 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 18:47:29,199 - src.ultibot_ui.services.api_client - ERROR - Error HTTP 404 para GET http://127.0.0.1:8000/api/v1/capital-management/status: {"detail":"Not Found"}
2025-06-08 18:47:29,635 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 22:47:28 GMT'), (b'server', b'uvicorn'), (b'content-length', b'2'), (b'content-type', b'application/json')])
2025-06-08 18:47:29,636 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 18:47:29,636 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 18:47:29,636 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 18:47:29,637 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 18:47:29,637 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 18:47:29,637 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'capital_status': APIError('Error de API (404): Not Found'), 'trading_mode': 'paper'}
2025-06-08 18:47:29,637 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 18:47:29,637 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'capital_status': APIError('Error de API (404): Not Found'), 'trading_mode': 'paper'}
2025-06-08 18:47:29,637 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 18:47:29,637 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener snapshot de portafolio: Event loop is closed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 185, in get_portfolio_snapshot
    data = await self._make_request("GET", "/api/v1/portfolio/snapshot", params=params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 50, in _make_request
    response = await self._client.request(method, endpoint, headers=request_headers, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1585, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1674, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_transports\default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 229, in handle_async_request
    await self._close_connections(closing)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-08 18:47:29,638 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 18:47:29,653 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener estado de capital: Error de API (404): Not Found
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 51, in _make_request
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_models.py", line 763, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://127.0.0.1:8000/api/v1/capital-management/status'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 192, in get_capital_management_status
    data = await self._make_request("GET", "/api/v1/capital-management/status")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 58, in _make_request
    raise APIError(
    ...<3 lines>...
    ) from e
src.ultibot_ui.services.api_client.APIError: Error de API (404): Not Found
2025-06-08 18:47:44,192 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 18:47:44,192 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001A7EEC39A90>, coroutine_factory: set
2025-06-08 18:47:44,193 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 18:47:44,193 - asyncio - DEBUG - Using proactor: IocpProactor
2025-06-08 18:47:44,194 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 18:47:44,194 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000001A7EED0B450>. Running in event loop.
2025-06-08 18:47:44,194 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 18:47:44,194 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 18:47:44,194 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 18:47:44,195 - httpcore.connection - DEBUG - close.started
2025-06-08 18:47:44,195 - httpcore.connection - DEBUG - close.failed exception=RuntimeError('Event loop is closed')
2025-06-08 18:47:44,195 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 18:47:44,195 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 18:47:44,196 - src.ultibot_ui.services.api_client - INFO - Obteniendo estado de gestión de capital.
2025-06-08 18:47:44,196 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/capital-management/status
2025-06-08 18:47:44,196 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 18:47:44,196 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 18:47:44,197 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001A7EFC78D60>
2025-06-08 18:47:44,197 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001A7EFC78510>
2025-06-08 18:47:44,197 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 18:47:44,197 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 18:47:44,197 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 18:47:44,197 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 18:47:44,197 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 18:47:44,197 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 18:47:44,198 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 18:47:44,198 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 18:47:44,198 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 18:47:44,198 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 18:47:44,199 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 404, b'Not Found', [(b'date', b'Sun, 08 Jun 2025 22:47:43 GMT'), (b'server', b'uvicorn'), (b'content-length', b'22'), (b'content-type', b'application/json')])
2025-06-08 18:47:44,199 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/capital-management/status "HTTP/1.1 404 Not Found"
2025-06-08 18:47:44,200 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 18:47:44,200 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 18:47:44,200 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 18:47:44,200 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 18:47:44,200 - src.ultibot_ui.services.api_client - ERROR - Error HTTP 404 para GET http://127.0.0.1:8000/api/v1/capital-management/status: {"detail":"Not Found"}
2025-06-08 18:47:44,486 - src.ultibot_ui.views.opportunities_view - INFO - Fetching Gemini IA opportunities.
2025-06-08 18:47:44,486 - src.ultibot_ui.views.opportunities_view - DEBUG - Creating ApiWorker.
2025-06-08 18:47:44,487 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001A7EEC39A90>, coroutine_factory: set
2025-06-08 18:47:44,706 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 22:47:43 GMT'), (b'server', b'uvicorn'), (b'content-length', b'2'), (b'content-type', b'application/json')])
2025-06-08 18:47:44,707 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 18:47:44,707 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 18:47:44,707 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 18:47:44,707 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 18:47:44,708 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 18:47:44,708 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'capital_status': APIError('Error de API (404): Not Found'), 'trading_mode': 'paper'}
2025-06-08 18:47:44,708 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 18:47:44,709 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'capital_status': APIError('Error de API (404): Not Found'), 'trading_mode': 'paper'}
2025-06-08 18:47:44,709 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 18:47:44,709 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener snapshot de portafolio: Event loop is closed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 185, in get_portfolio_snapshot
    data = await self._make_request("GET", "/api/v1/portfolio/snapshot", params=params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 50, in _make_request
    response = await self._client.request(method, endpoint, headers=request_headers, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1585, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1674, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_transports\default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 229, in handle_async_request
    await self._close_connections(closing)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\proactor_events.py", line 109, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-08 18:47:44,709 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 18:47:44,712 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener estado de capital: Error de API (404): Not Found
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 51, in _make_request
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_models.py", line 763, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Client error '404 Not Found' for url 'http://127.0.0.1:8000/api/v1/capital-management/status'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/404

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 192, in get_capital_management_status
    data = await self._make_request("GET", "/api/v1/capital-management/status")
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 58, in _make_request
    raise APIError(
    ...<3 lines>...
    ) from e
src.ultibot_ui.services.api_client.APIError: Error de API (404): Not Found
2025-06-08 18:47:53,868 - src.ultibot_ui.windows.main_window - INFO - Cleaning up MainWindow resources. Stopping 9 active threads...
2025-06-08 18:47:53,869 - src.ultibot_ui.windows.dashboard_view - INFO - DashboardView: Iniciando limpieza de tareas.
2025-06-08 18:47:53,869 - src.ultibot_ui.widgets.portfolio_widget - INFO - PortfolioWidget: Limpiando hilos y workers activos.
2025-06-08 18:47:53,869 - src.ultibot_ui.widgets.portfolio_widget - INFO - PortfolioWidget: Limpieza completada.
2025-06-08 18:47:53,869 - src.ultibot_ui.widgets.chart_widget - INFO - ChartWidget: Limpieza completada.
2025-06-08 18:47:53,870 - src.ultibot_ui.windows.dashboard_view - INFO - DashboardView: Limpieza completada.
2025-06-08 18:47:53,870 - src.ultibot_ui.widgets.paper_trading_report_widget - INFO - PaperTradingReportWidget cleanup: No hay acciones que tomar.
2025-06-08 18:47:53,870 - src.ultibot_ui.windows.history_view - INFO - HistoryView cleanup completado
2025-06-08 18:47:53,870 - src.ultibot_ui.views.opportunities_view - INFO - Cleaning up OpportunitiesView...
2025-06-08 18:47:53,871 - src.ultibot_ui.views.opportunities_view - INFO - OpportunitiesView cleanup finished.
2025-06-08 18:47:53,871 - src.ultibot_ui.views.portfolio_view - INFO - PortfolioView: Cleaning up...
2025-06-08 18:47:53,872 - src.ultibot_ui.views.portfolio_view - INFO - PortfolioView: Cleanup finished.
2025-06-08 18:47:53,874 - src.ultibot_ui.windows.main_window - INFO - MainWindow cleanup finished.
2025-06-08 18:58:29,155 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 18:58:29,156 - __main__ - INFO - Initializing application...
2025-06-08 18:58:29,168 - __main__ - INFO - Stylesheet loaded successfully.
2025-06-08 18:58:29,342 - src.ultibot_ui.services.api_client - DEBUG - API base URL set to: http://127.0.0.1:8000
2025-06-08 18:58:29,343 - asyncio - DEBUG - Using proactor: _IocpProactor
2025-06-08 18:58:29,343 - __main__ - INFO - Fetching initial user configuration...
2025-06-08 18:58:29,344 - src.ultibot_ui.services.api_client - INFO - Obteniendo configuraciÃ³n de usuario.
2025-06-08 18:58:29,344 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/config
2025-06-08 18:58:29,364 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 18:58:29,365 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001FE5C3F2F90>
2025-06-08 18:58:29,365 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 18:58:29,366 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 18:58:29,366 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 18:58:29,366 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 18:58:29,366 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 18:58:29,367 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 22:58:28 GMT'), (b'server', b'uvicorn'), (b'content-length', b'1001'), (b'content-type', b'application/json')])
2025-06-08 18:58:29,368 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/config "HTTP/1.1 200 OK"
2025-06-08 18:58:29,368 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/config "HTTP/1.1 200 OK"
2025-06-08 18:58:29,368 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 18:58:29,368 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 18:58:29,369 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 18:58:29,369 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 18:58:29,369 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/config "HTTP/HTTP/1.1 200 OK"
2025-06-08 18:58:29,369 - __main__ - INFO - Configuration received for user ID: 86e5f6c7-02a0-475b-b277-1fccbf23aa56
2025-06-08 18:58:29,381 - src.ultibot_ui.services.trading_mode_state - INFO - TradingModeStateManager initialized with mode: paper
2025-06-08 18:58:29,382 - src.ultibot_ui.services.trading_mode_state - INFO - Created global trading mode state manager
2025-06-08 18:58:29,735 - src.ultibot_ui.widgets.portfolio_widget - INFO - Timer de actualizaciÃ³n del portafolio iniciado.
2025-06-08 18:58:29,742 - src.ultibot_ui.widgets.chart_widget - INFO - Solicitando datos para BTCUSDT - 1h usando ApiWorker
2025-06-08 18:58:29,742 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001FE5C3F06E0>, coroutine_factory: set
2025-06-08 18:58:29,752 - src.ultibot_ui.windows.dashboard_view - INFO - DashboardView: _initialize_async_components INVOCADO
2025-06-08 18:58:29,753 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001FE5C3F06E0>, coroutine_factory: set
2025-06-08 18:58:30,038 - src.ultibot_ui.views.opportunities_view - INFO - OpportunitiesView: __init__ called.
2025-06-08 18:58:30,038 - src.ultibot_ui.views.opportunities_view - DEBUG - OpportunitiesView initialized.
2025-06-08 18:58:30,041 - src.ultibot_ui.views.opportunities_view - INFO - OpportunitiesView: _load_initial_data called.
2025-06-08 18:58:30,060 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001FE5C3F06E0>, coroutine_factory: set
2025-06-08 18:58:30,060 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001FE5C3F06E0>, coroutine_factory: set
2025-06-08 18:58:30,069 - src.ultibot_ui.windows.history_view - INFO - HistoryView inicializada para usuario 86e5f6c7-02a0-475b-b277-1fccbf23aa56
2025-06-08 18:58:30,074 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001FE5C3F06E0>, coroutine_factory: set
2025-06-08 18:58:30,074 - src.ultibot_ui.windows.main_window - INFO - Central widget y vistas configuradas.
2025-06-08 18:58:30,100 - src.ultibot_ui.windows.main_window - INFO - MainWindow inicializada y visible.
2025-06-08 18:58:30,211 - __main__ - INFO - Main window shown.
2025-06-08 18:58:30,211 - qasync._windows._EventPoller - DEBUG - Starting (proactor: <_IocpProactor overlapped#=0 result#=0>)...
2025-06-08 18:58:30,211 - qasync._windows._EventWorker - DEBUG - Thread started
2025-06-08 18:58:30,214 - src.ultibot_ui.views.portfolio_view - INFO - PortfolioView: Fetching portfolio snapshot.
2025-06-08 18:58:30,214 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001FE5C3F06E0>, coroutine_factory: set
2025-06-08 18:58:30,215 - src.ultibot_ui.windows.settings_view - INFO - SettingsView: Iniciando carga de datos iniciales (_load_initial_data).
2025-06-08 18:58:30,215 - src.ultibot_ui.windows.settings_view - INFO - SettingsView: Solicitando configuraciÃ³n de usuario general.
2025-06-08 18:58:30,216 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001FE5C3F06E0>, coroutine_factory: set
2025-06-08 18:58:30,216 - src.ultibot_ui.windows.settings_view - INFO - SettingsView: Solicitando estado de operativa real.
2025-06-08 18:58:30,216 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001FE5C3F06E0>, coroutine_factory: set
2025-06-08 18:58:30,216 - src.ultibot_ui.views.opportunities_view - INFO - Fetching Gemini IA opportunities.
2025-06-08 18:58:30,216 - src.ultibot_ui.views.opportunities_view - DEBUG - Creating ApiWorker.
2025-06-08 18:58:30,216 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001FE5C3F06E0>, coroutine_factory: set
2025-06-08 18:58:34,746 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001FE5C3F06E0>, coroutine_factory: set
2025-06-08 18:58:38,129 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 18:58:38,130 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001FE5C3F06E0>, coroutine_factory: set
2025-06-08 18:58:38,130 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 18:58:38,131 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 18:58:38,132 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 18:58:38,132 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000001FE5C36D540>. Running in event loop.
2025-06-08 18:58:38,132 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 18:58:38,132 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 18:58:38,133 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 18:58:38,133 - httpcore.connection - DEBUG - close.started
2025-06-08 18:58:38,133 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 18:58:38,134 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 18:58:38,134 - httpcore.connection - DEBUG - close.complete
2025-06-08 18:58:38,134 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 18:58:38,134 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 18:58:38,135 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001FE5C2B91D0>
2025-06-08 18:58:38,135 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 18:58:38,135 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001FE5C2B8A50>
2025-06-08 18:58:38,136 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 18:58:38,136 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 18:58:38,136 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 18:58:38,136 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 18:58:38,136 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 18:58:38,136 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 18:58:38,136 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 18:58:38,137 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 18:58:38,137 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 18:58:38,139 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 500, b'Internal Server Error', [(b'date', b'Sun, 08 Jun 2025 22:58:37 GMT'), (b'server', b'uvicorn'), (b'content-length', b'195'), (b'content-type', b'application/json')])
2025-06-08 18:58:38,140 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/portfolio/snapshot?user_id=86e5f6c7-02a0-475b-b277-1fccbf23aa56&trading_mode=paper "HTTP/1.1 500 Internal Server Error"
2025-06-08 18:58:38,140 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/portfolio/snapshot?user_id=86e5f6c7-02a0-475b-b277-1fccbf23aa56&trading_mode=paper "HTTP/1.1 500 Internal Server Error"
2025-06-08 18:58:38,141 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 18:58:38,141 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 18:58:38,141 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 18:58:38,141 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 18:58:38,142 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/portfolio/snapshot "HTTP/HTTP/1.1 500 Internal Server Error"
2025-06-08 18:58:38,142 - src.ultibot_ui.services.api_client - ERROR - Error HTTP 500 para GET http://127.0.0.1:8000/api/v1/portfolio/snapshot: {"detail":"Failed to retrieve portfolio snapshot: Error inesperado al inicializar el portafolio: SupabasePersistenceService.get_user_configuration() takes 1 positional argument but 2 were given"}
2025-06-08 18:58:38,639 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 22:58:37 GMT'), (b'server', b'uvicorn'), (b'content-length', b'2'), (b'content-type', b'application/json')])
2025-06-08 18:58:38,640 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 18:58:38,640 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 18:58:38,640 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 18:58:38,640 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 18:58:38,640 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 18:58:38,640 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 18:58:38,641 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades "HTTP/HTTP/1.1 200 OK"
2025-06-08 18:58:38,641 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': APIError('Failed to retrieve portfolio snapshot: Error inesperado al inicializar el portafolio: SupabasePersistenceService.get_user_configuration() takes 1 positional argument but 2 were given'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 18:58:38,641 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 18:58:38,641 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': APIError('Failed to retrieve portfolio snapshot: Error inesperado al inicializar el portafolio: SupabasePersistenceService.get_user_configuration() takes 1 positional argument but 2 were given'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 18:58:38,641 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 18:58:38,641 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener snapshot de portafolio: Error de API (500): Failed to retrieve portfolio snapshot: Error inesperado al inicializar el portafolio: SupabasePersistenceService.get_user_configuration() takes 1 positional argument but 2 were given
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 36, in _make_request
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_models.py", line 763, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Server error '500 Internal Server Error' for url 'http://127.0.0.1:8000/api/v1/portfolio/snapshot?user_id=86e5f6c7-02a0-475b-b277-1fccbf23aa56&trading_mode=paper'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/500

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 55, in get_portfolio_snapshot
    return await self._make_request("GET", "/api/v1/portfolio/snapshot", params=params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 40, in _make_request
    raise APIError(
    ...<2 lines>...
    ) from e
src.ultibot_ui.services.api_client.APIError: Error de API (500): Failed to retrieve portfolio snapshot: Error inesperado al inicializar el portafolio: SupabasePersistenceService.get_user_configuration() takes 1 positional argument but 2 were given
2025-06-08 18:58:38,641 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 18:58:44,729 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 18:58:44,730 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001FE5C3F06E0>, coroutine_factory: set
2025-06-08 18:58:44,730 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 18:58:44,731 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 18:58:44,731 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 18:58:44,731 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000001FE5C36F940>. Running in event loop.
2025-06-08 18:58:44,732 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 18:58:44,732 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 18:58:44,732 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 18:58:44,733 - httpcore.connection - DEBUG - close.started
2025-06-08 18:58:44,733 - httpcore.connection - DEBUG - close.failed exception=RuntimeError('Event loop is closed')
2025-06-08 18:58:44,733 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 18:58:44,734 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 18:58:44,734 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 18:58:44,735 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001FE5C2CCE90>
2025-06-08 18:58:44,735 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 18:58:44,735 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 18:58:44,735 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 18:58:44,736 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 18:58:44,736 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 18:58:45,991 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 22:58:44 GMT'), (b'server', b'uvicorn'), (b'content-length', b'2'), (b'content-type', b'application/json')])
2025-06-08 18:58:45,991 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 18:58:45,991 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 18:58:45,992 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 18:58:45,992 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 18:58:45,992 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 18:58:45,992 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 18:58:45,992 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades "HTTP/HTTP/1.1 200 OK"
2025-06-08 18:58:45,993 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 18:58:45,993 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 18:58:45,993 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 18:58:45,993 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 18:58:45,993 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener snapshot de portafolio: Event loop is closed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 55, in get_portfolio_snapshot
    return await self._make_request("GET", "/api/v1/portfolio/snapshot", params=params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 32, in _make_request
    response = await self._client.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1585, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1674, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_transports\default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 229, in handle_async_request
    await self._close_connections(closing)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 1205, in close
    super().close()
    ~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 865, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-08 18:58:45,993 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 18:58:50,129 - src.ultibot_ui.widgets.chart_widget - INFO - Solicitando datos para BTCUSDT - 1H usando ApiWorker
2025-06-08 18:58:50,130 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001FE5C3F06E0>, coroutine_factory: set
2025-06-08 18:58:59,736 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 18:58:59,736 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001FE5C3F06E0>, coroutine_factory: set
2025-06-08 18:58:59,737 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 18:58:59,737 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 18:58:59,737 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 18:58:59,738 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000001FE5C28C540>. Running in event loop.
2025-06-08 18:58:59,738 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 18:58:59,738 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 18:58:59,738 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 18:58:59,738 - httpcore.connection - DEBUG - close.started
2025-06-08 18:58:59,738 - httpcore.connection - DEBUG - close.failed exception=RuntimeError('Event loop is closed')
2025-06-08 18:58:59,739 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 18:58:59,739 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 18:58:59,739 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 18:58:59,739 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001FE5C2CE3F0>
2025-06-08 18:58:59,740 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 18:58:59,740 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 18:58:59,740 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 18:58:59,740 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 18:58:59,740 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 18:59:00,046 - src.ultibot_ui.views.opportunities_view - INFO - Fetching Gemini IA opportunities.
2025-06-08 18:59:00,047 - src.ultibot_ui.views.opportunities_view - DEBUG - Creating ApiWorker.
2025-06-08 18:59:00,047 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001FE5C3F06E0>, coroutine_factory: set
2025-06-08 18:59:00,381 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 22:58:59 GMT'), (b'server', b'uvicorn'), (b'content-length', b'2'), (b'content-type', b'application/json')])
2025-06-08 18:59:00,382 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 18:59:00,382 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 18:59:00,382 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 18:59:00,382 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 18:59:00,383 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 18:59:00,383 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 18:59:00,383 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades "HTTP/HTTP/1.1 200 OK"
2025-06-08 18:59:00,383 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 18:59:00,383 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 18:59:00,383 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 18:59:00,383 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 18:59:00,383 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener snapshot de portafolio: Event loop is closed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 55, in get_portfolio_snapshot
    return await self._make_request("GET", "/api/v1/portfolio/snapshot", params=params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 32, in _make_request
    response = await self._client.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1585, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1674, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_transports\default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 229, in handle_async_request
    await self._close_connections(closing)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 1205, in close
    super().close()
    ~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 865, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-08 18:59:00,384 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 18:59:06,727 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001FE5C3F06E0>, coroutine_factory: set
2025-06-08 18:59:14,745 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 18:59:14,745 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001FE5C3F06E0>, coroutine_factory: set
2025-06-08 18:59:14,746 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 18:59:14,746 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 18:59:14,746 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 18:59:14,747 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000001FE5C28D140>. Running in event loop.
2025-06-08 18:59:14,747 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 18:59:14,747 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 18:59:14,748 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 18:59:14,748 - httpcore.connection - DEBUG - close.started
2025-06-08 18:59:14,749 - httpcore.connection - DEBUG - close.failed exception=RuntimeError('Event loop is closed')
2025-06-08 18:59:14,749 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 18:59:14,749 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 18:59:14,750 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 18:59:14,750 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001FE5C3C3E30>
2025-06-08 18:59:14,751 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 18:59:14,751 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 18:59:14,751 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 18:59:14,751 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 18:59:14,751 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 18:59:15,136 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 22:59:14 GMT'), (b'server', b'uvicorn'), (b'content-length', b'2'), (b'content-type', b'application/json')])
2025-06-08 18:59:15,137 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 18:59:15,137 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 18:59:15,137 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 18:59:15,137 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 18:59:15,137 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 18:59:15,139 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 18:59:15,139 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades "HTTP/HTTP/1.1 200 OK"
2025-06-08 18:59:15,139 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 18:59:15,139 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 18:59:15,139 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 18:59:15,139 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 18:59:15,140 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener snapshot de portafolio: Event loop is closed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 55, in get_portfolio_snapshot
    return await self._make_request("GET", "/api/v1/portfolio/snapshot", params=params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 32, in _make_request
    response = await self._client.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1585, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1674, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_transports\default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 229, in handle_async_request
    await self._close_connections(closing)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 1205, in close
    super().close()
    ~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 865, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-08 18:59:15,140 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 19:17:47,205 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 19:17:47,206 - __main__ - INFO - Initializing application...
2025-06-08 19:17:47,218 - __main__ - INFO - Stylesheet loaded successfully.
2025-06-08 19:17:47,397 - src.ultibot_ui.services.api_client - DEBUG - API base URL set to: http://127.0.0.1:8000
2025-06-08 19:17:47,398 - asyncio - DEBUG - Using proactor: _IocpProactor
2025-06-08 19:17:47,399 - __main__ - INFO - Fetching initial user configuration...
2025-06-08 19:17:47,399 - src.ultibot_ui.services.api_client - INFO - Obteniendo configuraciÃ³n de usuario.
2025-06-08 19:17:47,399 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/config
2025-06-08 19:17:47,417 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 19:17:47,418 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001E1CACFEF90>
2025-06-08 19:17:47,418 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:17:47,419 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:17:47,419 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:17:47,419 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:17:47,419 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:17:47,815 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 23:17:46 GMT'), (b'server', b'uvicorn'), (b'content-length', b'1001'), (b'content-type', b'application/json')])
2025-06-08 19:17:47,816 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/config "HTTP/1.1 200 OK"
2025-06-08 19:17:47,816 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/config "HTTP/1.1 200 OK"
2025-06-08 19:17:47,817 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 19:17:47,817 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 19:17:47,817 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:17:47,818 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 19:17:47,818 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/config "HTTP/HTTP/1.1 200 OK"
2025-06-08 19:17:47,818 - __main__ - INFO - Configuration received for user ID: 86e5f6c7-02a0-475b-b277-1fccbf23aa56
2025-06-08 19:17:47,833 - src.ultibot_ui.services.trading_mode_state - INFO - TradingModeStateManager initialized with mode: paper
2025-06-08 19:17:47,834 - src.ultibot_ui.services.trading_mode_state - INFO - Created global trading mode state manager
2025-06-08 19:17:48,137 - src.ultibot_ui.widgets.portfolio_widget - INFO - Timer de actualizaciÃ³n del portafolio iniciado.
2025-06-08 19:17:48,142 - src.ultibot_ui.widgets.chart_widget - INFO - Solicitando datos para BTCUSDT - 1h usando ApiWorker
2025-06-08 19:17:48,142 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001E1CACFC6E0>, coroutine_factory: set
2025-06-08 19:17:48,153 - src.ultibot_ui.windows.dashboard_view - INFO - DashboardView: _initialize_async_components INVOCADO
2025-06-08 19:17:48,153 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001E1CACFC6E0>, coroutine_factory: set
2025-06-08 19:17:48,449 - src.ultibot_ui.views.opportunities_view - INFO - OpportunitiesView: __init__ called.
2025-06-08 19:17:48,449 - src.ultibot_ui.views.opportunities_view - DEBUG - OpportunitiesView initialized.
2025-06-08 19:17:48,453 - src.ultibot_ui.views.opportunities_view - INFO - OpportunitiesView: _load_initial_data called.
2025-06-08 19:17:48,471 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001E1CACFC6E0>, coroutine_factory: set
2025-06-08 19:17:48,471 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001E1CACFC6E0>, coroutine_factory: set
2025-06-08 19:17:48,479 - src.ultibot_ui.windows.history_view - INFO - HistoryView inicializada para usuario 86e5f6c7-02a0-475b-b277-1fccbf23aa56
2025-06-08 19:17:48,485 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001E1CACFC6E0>, coroutine_factory: set
2025-06-08 19:17:48,485 - src.ultibot_ui.windows.main_window - INFO - Central widget y vistas configuradas.
2025-06-08 19:17:48,508 - src.ultibot_ui.windows.main_window - INFO - MainWindow inicializada y visible.
2025-06-08 19:17:48,623 - __main__ - INFO - Main window shown.
2025-06-08 19:17:48,623 - qasync._windows._EventPoller - DEBUG - Starting (proactor: <_IocpProactor overlapped#=0 result#=0>)...
2025-06-08 19:17:48,624 - qasync._windows._EventWorker - DEBUG - Thread started
2025-06-08 19:17:48,626 - src.ultibot_ui.views.portfolio_view - INFO - PortfolioView: Fetching portfolio snapshot.
2025-06-08 19:17:48,626 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001E1CACFC6E0>, coroutine_factory: set
2025-06-08 19:17:48,627 - src.ultibot_ui.windows.settings_view - INFO - SettingsView: Iniciando carga de datos iniciales (_load_initial_data).
2025-06-08 19:17:48,627 - src.ultibot_ui.windows.settings_view - INFO - SettingsView: Solicitando configuraciÃ³n de usuario general.
2025-06-08 19:17:48,627 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001E1CACFC6E0>, coroutine_factory: set
2025-06-08 19:17:48,627 - src.ultibot_ui.windows.settings_view - INFO - SettingsView: Solicitando estado de operativa real.
2025-06-08 19:17:48,628 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001E1CACFC6E0>, coroutine_factory: set
2025-06-08 19:17:48,628 - src.ultibot_ui.views.opportunities_view - INFO - Fetching Gemini IA opportunities.
2025-06-08 19:17:48,628 - src.ultibot_ui.views.opportunities_view - DEBUG - Creating ApiWorker.
2025-06-08 19:17:48,628 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001E1CACFC6E0>, coroutine_factory: set
2025-06-08 19:17:53,151 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001E1CACFC6E0>, coroutine_factory: set
2025-06-08 19:18:03,160 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 19:18:03,161 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001E1CACFC6E0>, coroutine_factory: set
2025-06-08 19:18:03,161 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 19:18:03,162 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 19:18:03,162 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 19:18:03,163 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000001E1CADCD540>. Running in event loop.
2025-06-08 19:18:03,163 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 19:18:03,164 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 19:18:03,164 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 19:18:03,165 - httpcore.connection - DEBUG - close.started
2025-06-08 19:18:03,165 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 19:18:03,165 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 19:18:03,165 - httpcore.connection - DEBUG - close.complete
2025-06-08 19:18:03,166 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 19:18:03,166 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 19:18:03,167 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001E1CAC7D1D0>
2025-06-08 19:18:03,167 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:18:03,167 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001E1CAC7CA50>
2025-06-08 19:18:03,167 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:18:03,167 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:18:03,167 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:18:03,167 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:18:03,167 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:18:03,168 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:18:03,168 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:18:03,168 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:18:03,168 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:18:03,482 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 500, b'Internal Server Error', [(b'date', b'Sun, 08 Jun 2025 23:18:02 GMT'), (b'server', b'uvicorn'), (b'content-length', b'573'), (b'content-type', b'application/json')])
2025-06-08 19:18:03,482 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/portfolio/snapshot?user_id=86e5f6c7-02a0-475b-b277-1fccbf23aa56&trading_mode=paper "HTTP/1.1 500 Internal Server Error"
2025-06-08 19:18:03,482 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/portfolio/snapshot?user_id=86e5f6c7-02a0-475b-b277-1fccbf23aa56&trading_mode=paper "HTTP/1.1 500 Internal Server Error"
2025-06-08 19:18:03,482 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 19:18:03,483 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 19:18:03,483 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:18:03,483 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 19:18:03,483 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/portfolio/snapshot "HTTP/HTTP/1.1 500 Internal Server Error"
2025-06-08 19:18:03,483 - src.ultibot_ui.services.api_client - ERROR - Error HTTP 500 para GET http://127.0.0.1:8000/api/v1/portfolio/snapshot: {"detail":"Failed to retrieve portfolio snapshot: Error inesperado al inicializar el portafolio: 2 validation errors for UserConfiguration\nid\n  Input should be a valid string [type=string_type, input_value=UUID('86e5f6c7-02a0-475b-b277-1fccbf23aa56'), input_type=UUID]\n    For further information visit https://errors.pydantic.dev/2.11/v/string_type\nuser_id\n  Input should be a valid string [type=string_type, input_value=UUID('00000000-0000-0000-0000-000000000001'), input_type=UUID]\n    For further information visit https://errors.pydantic.dev/2.11/v/string_type"}
2025-06-08 19:18:03,620 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 23:18:02 GMT'), (b'server', b'uvicorn'), (b'content-length', b'2'), (b'content-type', b'application/json')])
2025-06-08 19:18:03,621 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:18:03,621 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:18:03,621 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 19:18:03,621 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 19:18:03,621 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:18:03,622 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 19:18:03,622 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades "HTTP/HTTP/1.1 200 OK"
2025-06-08 19:18:03,622 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': APIError("Failed to retrieve portfolio snapshot: Error inesperado al inicializar el portafolio: 2 validation errors for UserConfiguration\nid\n  Input should be a valid string [type=string_type, input_value=UUID('86e5f6c7-02a0-475b-b277-1fccbf23aa56'), input_type=UUID]\n    For further information visit https://errors.pydantic.dev/2.11/v/string_type\nuser_id\n  Input should be a valid string [type=string_type, input_value=UUID('00000000-0000-0000-0000-000000000001'), input_type=UUID]\n    For further information visit https://errors.pydantic.dev/2.11/v/string_type"), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:18:03,622 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 19:18:03,622 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 19:18:03,622 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': APIError("Failed to retrieve portfolio snapshot: Error inesperado al inicializar el portafolio: 2 validation errors for UserConfiguration\nid\n  Input should be a valid string [type=string_type, input_value=UUID('86e5f6c7-02a0-475b-b277-1fccbf23aa56'), input_type=UUID]\n    For further information visit https://errors.pydantic.dev/2.11/v/string_type\nuser_id\n  Input should be a valid string [type=string_type, input_value=UUID('00000000-0000-0000-0000-000000000001'), input_type=UUID]\n    For further information visit https://errors.pydantic.dev/2.11/v/string_type"), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:18:03,622 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener snapshot de portafolio: Error de API (500): Failed to retrieve portfolio snapshot: Error inesperado al inicializar el portafolio: 2 validation errors for UserConfiguration
id
  Input should be a valid string [type=string_type, input_value=UUID('86e5f6c7-02a0-475b-b277-1fccbf23aa56'), input_type=UUID]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
user_id
  Input should be a valid string [type=string_type, input_value=UUID('00000000-0000-0000-0000-000000000001'), input_type=UUID]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 36, in _make_request
    response.raise_for_status()
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_models.py", line 763, in raise_for_status
    raise HTTPStatusError(message, request=request, response=self)
httpx.HTTPStatusError: Server error '500 Internal Server Error' for url 'http://127.0.0.1:8000/api/v1/portfolio/snapshot?user_id=86e5f6c7-02a0-475b-b277-1fccbf23aa56&trading_mode=paper'
For more information check: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/500

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 55, in get_portfolio_snapshot
    return await self._make_request("GET", "/api/v1/portfolio/snapshot", params=params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 40, in _make_request
    raise APIError(
    ...<2 lines>...
    ) from e
src.ultibot_ui.services.api_client.APIError: Error de API (500): Failed to retrieve portfolio snapshot: Error inesperado al inicializar el portafolio: 2 validation errors for UserConfiguration
id
  Input should be a valid string [type=string_type, input_value=UUID('86e5f6c7-02a0-475b-b277-1fccbf23aa56'), input_type=UUID]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
user_id
  Input should be a valid string [type=string_type, input_value=UUID('00000000-0000-0000-0000-000000000001'), input_type=UUID]
    For further information visit https://errors.pydantic.dev/2.11/v/string_type
2025-06-08 19:18:03,623 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 19:18:07,998 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001E1CACFC6E0>, coroutine_factory: set
2025-06-08 19:18:18,151 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 19:18:18,151 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001E1CACFC6E0>, coroutine_factory: set
2025-06-08 19:18:18,152 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 19:18:18,152 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 19:18:18,153 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 19:18:18,153 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000001E1CADCD240>. Running in event loop.
2025-06-08 19:18:18,153 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 19:18:18,153 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 19:18:18,153 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 19:18:18,154 - httpcore.connection - DEBUG - close.started
2025-06-08 19:18:18,154 - httpcore.connection - DEBUG - close.failed exception=RuntimeError('Event loop is closed')
2025-06-08 19:18:18,154 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 19:18:18,154 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 19:18:18,154 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 19:18:18,155 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000001E1CAC90E90>
2025-06-08 19:18:18,155 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:18:18,155 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:18:18,155 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:18:18,155 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:18:18,156 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:18:18,468 - src.ultibot_ui.views.opportunities_view - INFO - Fetching Gemini IA opportunities.
2025-06-08 19:18:18,468 - src.ultibot_ui.views.opportunities_view - DEBUG - Creating ApiWorker.
2025-06-08 19:18:18,469 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000001E1CACFC6E0>, coroutine_factory: set
2025-06-08 19:18:18,667 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 23:18:18 GMT'), (b'server', b'uvicorn'), (b'content-length', b'2'), (b'content-type', b'application/json')])
2025-06-08 19:18:18,667 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:18:18,667 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:18:18,668 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 19:18:18,668 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 19:18:18,668 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:18:18,669 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 19:18:18,669 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades "HTTP/HTTP/1.1 200 OK"
2025-06-08 19:18:18,669 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:18:18,669 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 19:18:18,669 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:18:18,669 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 19:18:18,669 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener snapshot de portafolio: Event loop is closed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 55, in get_portfolio_snapshot
    return await self._make_request("GET", "/api/v1/portfolio/snapshot", params=params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 32, in _make_request
    response = await self._client.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1585, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1674, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_transports\default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 229, in handle_async_request
    await self._close_connections(closing)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 1205, in close
    super().close()
    ~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 865, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-08 19:18:18,670 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 19:21:39,158 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 19:21:39,159 - __main__ - INFO - Initializing application...
2025-06-08 19:21:39,170 - __main__ - INFO - Stylesheet loaded successfully.
2025-06-08 19:21:39,348 - src.ultibot_ui.services.api_client - DEBUG - API base URL set to: http://127.0.0.1:8000
2025-06-08 19:21:39,349 - asyncio - DEBUG - Using proactor: _IocpProactor
2025-06-08 19:21:39,350 - __main__ - INFO - Fetching initial user configuration...
2025-06-08 19:21:39,350 - src.ultibot_ui.services.api_client - INFO - Obteniendo configuraciÃ³n de usuario.
2025-06-08 19:21:39,350 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/config
2025-06-08 19:21:39,371 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 19:21:39,372 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002A7E5296F90>
2025-06-08 19:21:39,372 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:21:39,373 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:21:39,373 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:21:39,373 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:21:39,374 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:21:39,795 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 23:21:39 GMT'), (b'server', b'uvicorn'), (b'content-length', b'1001'), (b'content-type', b'application/json')])
2025-06-08 19:21:39,795 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/config "HTTP/1.1 200 OK"
2025-06-08 19:21:39,795 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/config "HTTP/1.1 200 OK"
2025-06-08 19:21:39,796 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 19:21:39,796 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 19:21:39,796 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:21:39,796 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 19:21:39,796 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/config "HTTP/HTTP/1.1 200 OK"
2025-06-08 19:21:39,797 - __main__ - INFO - Configuration received for user ID: 86e5f6c7-02a0-475b-b277-1fccbf23aa56
2025-06-08 19:21:39,808 - src.ultibot_ui.services.trading_mode_state - INFO - TradingModeStateManager initialized with mode: paper
2025-06-08 19:21:39,809 - src.ultibot_ui.services.trading_mode_state - INFO - Created global trading mode state manager
2025-06-08 19:21:40,126 - src.ultibot_ui.widgets.portfolio_widget - INFO - Timer de actualizaciÃ³n del portafolio iniciado.
2025-06-08 19:21:40,130 - src.ultibot_ui.widgets.chart_widget - INFO - Solicitando datos para BTCUSDT - 1h usando ApiWorker
2025-06-08 19:21:40,130 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:21:40,140 - src.ultibot_ui.windows.dashboard_view - INFO - DashboardView: _initialize_async_components INVOCADO
2025-06-08 19:21:40,140 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:21:40,414 - src.ultibot_ui.views.opportunities_view - INFO - OpportunitiesView: __init__ called.
2025-06-08 19:21:40,414 - src.ultibot_ui.views.opportunities_view - DEBUG - OpportunitiesView initialized.
2025-06-08 19:21:40,418 - src.ultibot_ui.views.opportunities_view - INFO - OpportunitiesView: _load_initial_data called.
2025-06-08 19:21:40,434 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:21:40,435 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:21:40,443 - src.ultibot_ui.windows.history_view - INFO - HistoryView inicializada para usuario 86e5f6c7-02a0-475b-b277-1fccbf23aa56
2025-06-08 19:21:40,448 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:21:40,448 - src.ultibot_ui.windows.main_window - INFO - Central widget y vistas configuradas.
2025-06-08 19:21:40,473 - src.ultibot_ui.windows.main_window - INFO - MainWindow inicializada y visible.
2025-06-08 19:21:40,592 - __main__ - INFO - Main window shown.
2025-06-08 19:21:40,592 - qasync._windows._EventPoller - DEBUG - Starting (proactor: <_IocpProactor overlapped#=0 result#=0>)...
2025-06-08 19:21:40,592 - qasync._windows._EventWorker - DEBUG - Thread started
2025-06-08 19:21:40,594 - src.ultibot_ui.views.portfolio_view - INFO - PortfolioView: Fetching portfolio snapshot.
2025-06-08 19:21:40,595 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:21:40,596 - src.ultibot_ui.windows.settings_view - INFO - SettingsView: Iniciando carga de datos iniciales (_load_initial_data).
2025-06-08 19:21:40,596 - src.ultibot_ui.windows.settings_view - INFO - SettingsView: Solicitando configuraciÃ³n de usuario general.
2025-06-08 19:21:40,596 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:21:40,596 - src.ultibot_ui.windows.settings_view - INFO - SettingsView: Solicitando estado de operativa real.
2025-06-08 19:21:40,596 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:21:40,596 - src.ultibot_ui.views.opportunities_view - INFO - Fetching Gemini IA opportunities.
2025-06-08 19:21:40,597 - src.ultibot_ui.views.opportunities_view - DEBUG - Creating ApiWorker.
2025-06-08 19:21:40,597 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:21:45,145 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:21:48,995 - src.ultibot_ui.widgets.chart_widget - INFO - Solicitando datos para BTCUSDT - 1H usando ApiWorker
2025-06-08 19:21:48,995 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:21:52,288 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 19:21:52,288 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:21:52,289 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 19:21:52,289 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 19:21:52,290 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 19:21:52,290 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000002A7E5249540>. Running in event loop.
2025-06-08 19:21:52,291 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 19:21:52,291 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 19:21:52,291 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 19:21:52,292 - httpcore.connection - DEBUG - close.started
2025-06-08 19:21:52,292 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 19:21:52,292 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 19:21:52,293 - httpcore.connection - DEBUG - close.complete
2025-06-08 19:21:52,293 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 19:21:52,293 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 19:21:52,294 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002A7E51591D0>
2025-06-08 19:21:52,294 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:21:52,295 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002A7E5158A50>
2025-06-08 19:21:52,295 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:21:52,295 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:21:52,295 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:21:52,296 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:21:52,296 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:21:52,296 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:21:52,296 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:21:52,296 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:21:52,296 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:21:52,622 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 23:21:51 GMT'), (b'server', b'uvicorn'), (b'content-length', b'363'), (b'content-type', b'application/json')])
2025-06-08 19:21:52,623 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/portfolio/snapshot?user_id=86e5f6c7-02a0-475b-b277-1fccbf23aa56&trading_mode=paper "HTTP/1.1 200 OK"
2025-06-08 19:21:52,623 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/portfolio/snapshot?user_id=86e5f6c7-02a0-475b-b277-1fccbf23aa56&trading_mode=paper "HTTP/1.1 200 OK"
2025-06-08 19:21:52,623 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 19:21:52,623 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 19:21:52,623 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:21:52,623 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 19:21:52,624 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/portfolio/snapshot "HTTP/HTTP/1.1 200 OK"
2025-06-08 19:21:52,772 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 23:21:51 GMT'), (b'server', b'uvicorn'), (b'content-length', b'2'), (b'content-type', b'application/json')])
2025-06-08 19:21:52,772 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:21:52,772 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:21:52,773 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 19:21:52,773 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 19:21:52,773 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:21:52,773 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 19:21:52,773 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades "HTTP/HTTP/1.1 200 OK"
2025-06-08 19:21:52,774 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': {'paper_trading': {'available_balance_usdt': 10000.0, 'total_assets_value_usd': 0.0, 'total_portfolio_value_usd': 10000.0, 'assets': [], 'error_message': None}, 'real_trading': {'available_balance_usdt': 0.0, 'total_assets_value_usd': 0.0, 'total_portfolio_value_usd': 0.0, 'assets': [], 'error_message': 'Real trading data not requested'}, 'last_updated': '2025-06-08T23:21:52.621624'}, 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:21:52,774 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 19:21:52,774 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': {'paper_trading': {'available_balance_usdt': 10000.0, 'total_assets_value_usd': 0.0, 'total_portfolio_value_usd': 10000.0, 'assets': [], 'error_message': None}, 'real_trading': {'available_balance_usdt': 0.0, 'total_assets_value_usd': 0.0, 'total_portfolio_value_usd': 0.0, 'assets': [], 'error_message': 'Real trading data not requested'}, 'last_updated': '2025-06-08T23:21:52.621624'}, 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:21:52,774 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 19:21:52,774 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error fatal procesando datos actualizados: 'PortfolioWidget' object has no attribute '_populate_assets_table'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\widgets\portfolio_widget.py", line 280, in _handle_update_result
    self._update_portfolio_ui(self.current_snapshot, current_mode)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\widgets\portfolio_widget.py", line 306, in _update_portfolio_ui
    self._populate_assets_table(self.assets_table, portfolio_mode_dict.get('assets', []))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'PortfolioWidget' object has no attribute '_populate_assets_table'. Did you mean: '_create_assets_table'?
2025-06-08 19:21:52,775 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 19:21:55,125 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 19:21:55,125 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:21:55,126 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 19:21:55,126 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 19:21:55,127 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 19:21:55,127 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000002A7E524B940>. Running in event loop.
2025-06-08 19:21:55,127 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 19:21:55,128 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 19:21:55,128 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 19:21:55,128 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 19:21:55,128 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 19:21:55,129 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:21:55,129 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:21:55,129 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:21:55,129 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:21:55,129 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:21:55,129 - httpcore.http11 - DEBUG - receive_response_headers.failed exception=RuntimeError('Event loop is closed')
2025-06-08 19:21:55,129 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:21:55,130 - httpcore.http11 - DEBUG - response_closed.failed exception=RuntimeError('Event loop is closed')
2025-06-08 19:21:55,130 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:21:55,130 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:21:55,130 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:21:55,130 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:21:55,130 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:21:55,130 - httpcore.http11 - DEBUG - receive_response_headers.failed exception=RuntimeError('Event loop is closed')
2025-06-08 19:21:55,130 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:21:55,131 - httpcore.http11 - DEBUG - response_closed.failed exception=RuntimeError('Event loop is closed')
2025-06-08 19:21:55,131 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': RuntimeError('Event loop is closed'), 'trading_mode': 'paper'}
2025-06-08 19:21:55,131 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 19:21:55,131 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': RuntimeError('Event loop is closed'), 'trading_mode': 'paper'}
2025-06-08 19:21:55,131 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 19:21:55,131 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener snapshot de portafolio: Event loop is closed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 55, in get_portfolio_snapshot
    return await self._make_request("GET", "/api/v1/portfolio/snapshot", params=params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 32, in _make_request
    response = await self._client.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1585, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1674, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_transports\default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 236, in handle_async_request
    response = await connection.handle_async_request(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool_request.request
        ^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection.py", line 103, in handle_async_request
    return await self._connection.handle_async_request(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 135, in handle_async_request
    await self._response_closed()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 250, in _response_closed
    await self.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 1205, in close
    super().close()
    ~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 865, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-08 19:21:55,132 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 19:21:55,135 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener trades abiertos: Event loop is closed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 60, in get_trades
    return await self._make_request("GET", "/api/v1/trades", params=params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 32, in _make_request
    response = await self._client.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1585, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1674, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_transports\default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 236, in handle_async_request
    response = await connection.handle_async_request(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        pool_request.request
        ^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection.py", line 103, in handle_async_request
    return await self._connection.handle_async_request(request)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 135, in handle_async_request
    await self._response_closed()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 250, in _response_closed
    await self.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 1205, in close
    super().close()
    ~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 865, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-08 19:22:10,145 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 19:22:10,145 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:22:10,146 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 19:22:10,146 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 19:22:10,147 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 19:22:10,147 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000002A7E528CA40>. Running in event loop.
2025-06-08 19:22:10,147 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 19:22:10,147 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 19:22:10,147 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 19:22:10,148 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 19:22:10,148 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 19:22:10,148 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 19:22:10,148 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 19:22:10,149 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002A7E5161940>
2025-06-08 19:22:10,149 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002A7E51610F0>
2025-06-08 19:22:10,149 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:22:10,149 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:22:10,149 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:22:10,150 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:22:10,150 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:22:10,150 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:22:10,150 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:22:10,150 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:22:10,150 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:22:10,150 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:22:10,437 - src.ultibot_ui.views.opportunities_view - INFO - Fetching Gemini IA opportunities.
2025-06-08 19:22:10,437 - src.ultibot_ui.views.opportunities_view - DEBUG - Creating ApiWorker.
2025-06-08 19:22:10,438 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:22:10,466 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 23:22:09 GMT'), (b'server', b'uvicorn'), (b'content-length', b'2'), (b'content-type', b'application/json')])
2025-06-08 19:22:10,466 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:22:10,466 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:22:10,467 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 19:22:10,467 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 19:22:10,467 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:22:10,468 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 19:22:10,468 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades "HTTP/HTTP/1.1 200 OK"
2025-06-08 19:22:10,742 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 23:22:09 GMT'), (b'server', b'uvicorn'), (b'content-length', b'363'), (b'content-type', b'application/json')])
2025-06-08 19:22:10,742 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/portfolio/snapshot?user_id=86e5f6c7-02a0-475b-b277-1fccbf23aa56&trading_mode=paper "HTTP/1.1 200 OK"
2025-06-08 19:22:10,742 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/portfolio/snapshot?user_id=86e5f6c7-02a0-475b-b277-1fccbf23aa56&trading_mode=paper "HTTP/1.1 200 OK"
2025-06-08 19:22:10,743 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 19:22:10,743 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 19:22:10,743 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:22:10,743 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 19:22:10,743 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/portfolio/snapshot "HTTP/HTTP/1.1 200 OK"
2025-06-08 19:22:10,744 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': {'paper_trading': {'available_balance_usdt': 10000.0, 'total_assets_value_usd': 0.0, 'total_portfolio_value_usd': 10000.0, 'assets': [], 'error_message': None}, 'real_trading': {'available_balance_usdt': 0.0, 'total_assets_value_usd': 0.0, 'total_portfolio_value_usd': 0.0, 'assets': [], 'error_message': 'Real trading data not requested'}, 'last_updated': '2025-06-08T23:22:10.741372'}, 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:22:10,744 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 19:22:10,744 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 19:22:10,744 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': {'paper_trading': {'available_balance_usdt': 10000.0, 'total_assets_value_usd': 0.0, 'total_portfolio_value_usd': 10000.0, 'assets': [], 'error_message': None}, 'real_trading': {'available_balance_usdt': 0.0, 'total_assets_value_usd': 0.0, 'total_portfolio_value_usd': 0.0, 'assets': [], 'error_message': 'Real trading data not requested'}, 'last_updated': '2025-06-08T23:22:10.741372'}, 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:22:10,745 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 19:22:10,745 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error fatal procesando datos actualizados: 'PortfolioWidget' object has no attribute '_populate_assets_table'
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\widgets\portfolio_widget.py", line 280, in _handle_update_result
    self._update_portfolio_ui(self.current_snapshot, current_mode)
    ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\widgets\portfolio_widget.py", line 306, in _update_portfolio_ui
    self._populate_assets_table(self.assets_table, portfolio_mode_dict.get('assets', []))
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'PortfolioWidget' object has no attribute '_populate_assets_table'. Did you mean: '_create_assets_table'?
2025-06-08 19:22:25,137 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 19:22:25,137 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:22:25,138 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 19:22:25,138 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 19:22:25,139 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 19:22:25,139 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000002A7E528D040>. Running in event loop.
2025-06-08 19:22:25,139 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 19:22:25,139 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 19:22:25,139 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 19:22:25,139 - httpcore.connection - DEBUG - close.started
2025-06-08 19:22:25,140 - httpcore.connection - DEBUG - close.failed exception=RuntimeError('Event loop is closed')
2025-06-08 19:22:25,140 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 19:22:25,140 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 19:22:25,140 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 19:22:25,141 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002A7E52BBD10>
2025-06-08 19:22:25,141 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:22:25,141 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:22:25,141 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:22:25,141 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:22:25,141 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:22:25,916 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 23:22:24 GMT'), (b'server', b'uvicorn'), (b'content-length', b'2'), (b'content-type', b'application/json')])
2025-06-08 19:22:25,916 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:22:25,916 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:22:25,917 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 19:22:25,917 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 19:22:25,917 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:22:25,917 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 19:22:25,917 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades "HTTP/HTTP/1.1 200 OK"
2025-06-08 19:22:25,917 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:22:25,918 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 19:22:25,918 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:22:25,918 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 19:22:25,918 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener snapshot de portafolio: Event loop is closed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 55, in get_portfolio_snapshot
    return await self._make_request("GET", "/api/v1/portfolio/snapshot", params=params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 32, in _make_request
    response = await self._client.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1585, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1674, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_transports\default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 229, in handle_async_request
    await self._close_connections(closing)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 1205, in close
    super().close()
    ~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 865, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-08 19:22:25,918 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 19:22:39,635 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:22:40,152 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 19:22:40,152 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:22:40,153 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 19:22:40,153 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 19:22:40,154 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 19:22:40,154 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000002A7E528CF40>. Running in event loop.
2025-06-08 19:22:40,155 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 19:22:40,155 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 19:22:40,155 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 19:22:40,155 - httpcore.connection - DEBUG - close.started
2025-06-08 19:22:40,156 - httpcore.connection - DEBUG - close.failed exception=RuntimeError('Event loop is closed')
2025-06-08 19:22:40,156 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 19:22:40,156 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 19:22:40,157 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 19:22:40,157 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002A7E6201260>
2025-06-08 19:22:40,157 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:22:40,158 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:22:40,158 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:22:40,158 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:22:40,158 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:22:40,455 - src.ultibot_ui.views.opportunities_view - INFO - Fetching Gemini IA opportunities.
2025-06-08 19:22:40,455 - src.ultibot_ui.views.opportunities_view - DEBUG - Creating ApiWorker.
2025-06-08 19:22:40,455 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:22:40,935 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 23:22:39 GMT'), (b'server', b'uvicorn'), (b'content-length', b'2'), (b'content-type', b'application/json')])
2025-06-08 19:22:40,936 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:22:40,936 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:22:40,936 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 19:22:40,936 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 19:22:40,936 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:22:40,936 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 19:22:40,937 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades "HTTP/HTTP/1.1 200 OK"
2025-06-08 19:22:40,937 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:22:40,937 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 19:22:40,937 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:22:40,937 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 19:22:40,937 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener snapshot de portafolio: Event loop is closed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 55, in get_portfolio_snapshot
    return await self._make_request("GET", "/api/v1/portfolio/snapshot", params=params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 32, in _make_request
    response = await self._client.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1585, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1674, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_transports\default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 229, in handle_async_request
    await self._close_connections(closing)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 1205, in close
    super().close()
    ~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 865, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-08 19:22:40,937 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 19:22:55,166 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 19:22:55,166 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:22:55,167 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 19:22:55,167 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 19:22:55,168 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 19:22:55,168 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000002A7E528F140>. Running in event loop.
2025-06-08 19:22:55,169 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 19:22:55,169 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 19:22:55,169 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 19:22:55,170 - httpcore.connection - DEBUG - close.started
2025-06-08 19:22:55,170 - httpcore.connection - DEBUG - close.failed exception=RuntimeError('Event loop is closed')
2025-06-08 19:22:55,170 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 19:22:55,170 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 19:22:55,170 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 19:22:55,171 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002A7E62027A0>
2025-06-08 19:22:55,171 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:22:55,171 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:22:55,171 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:22:55,171 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:22:55,171 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:22:55,998 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 23:22:54 GMT'), (b'server', b'uvicorn'), (b'content-length', b'2'), (b'content-type', b'application/json')])
2025-06-08 19:22:55,998 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:22:55,998 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:22:55,998 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 19:22:55,999 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 19:22:55,999 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:22:55,999 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 19:22:55,999 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades "HTTP/HTTP/1.1 200 OK"
2025-06-08 19:22:55,999 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:22:55,999 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 19:22:56,000 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:22:56,000 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 19:22:56,000 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener snapshot de portafolio: Event loop is closed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 55, in get_portfolio_snapshot
    return await self._make_request("GET", "/api/v1/portfolio/snapshot", params=params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 32, in _make_request
    response = await self._client.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1585, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1674, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_transports\default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 229, in handle_async_request
    await self._close_connections(closing)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 1205, in close
    super().close()
    ~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 865, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-08 19:22:56,000 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 19:23:10,180 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 19:23:10,181 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:23:10,182 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 19:23:10,183 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 19:23:10,184 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 19:23:10,185 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000002A7E528F940>. Running in event loop.
2025-06-08 19:23:10,185 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 19:23:10,185 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 19:23:10,186 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 19:23:10,186 - httpcore.connection - DEBUG - close.started
2025-06-08 19:23:10,187 - httpcore.connection - DEBUG - close.failed exception=RuntimeError('Event loop is closed')
2025-06-08 19:23:10,187 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 19:23:10,188 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 19:23:10,188 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 19:23:10,191 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002A7E528E150>
2025-06-08 19:23:10,191 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:23:10,191 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:23:10,192 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:23:10,192 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:23:10,192 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:23:10,453 - src.ultibot_ui.views.opportunities_view - INFO - Fetching Gemini IA opportunities.
2025-06-08 19:23:10,453 - src.ultibot_ui.views.opportunities_view - DEBUG - Creating ApiWorker.
2025-06-08 19:23:10,453 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:23:11,584 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 23:23:10 GMT'), (b'server', b'uvicorn'), (b'content-length', b'2'), (b'content-type', b'application/json')])
2025-06-08 19:23:11,585 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:23:11,585 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:23:11,585 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 19:23:11,585 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 19:23:11,585 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:23:11,586 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 19:23:11,586 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades "HTTP/HTTP/1.1 200 OK"
2025-06-08 19:23:11,586 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:23:11,586 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 19:23:11,586 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:23:11,586 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 19:23:11,586 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener snapshot de portafolio: Event loop is closed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 55, in get_portfolio_snapshot
    return await self._make_request("GET", "/api/v1/portfolio/snapshot", params=params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 32, in _make_request
    response = await self._client.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1585, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1674, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_transports\default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 229, in handle_async_request
    await self._close_connections(closing)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 1205, in close
    super().close()
    ~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 865, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-08 19:23:11,587 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 19:23:25,186 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 19:23:25,186 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:23:25,187 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 19:23:25,187 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 19:23:25,188 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 19:23:25,188 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000002A7E528DD40>. Running in event loop.
2025-06-08 19:23:25,188 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 19:23:25,188 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 19:23:25,189 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 19:23:25,189 - httpcore.connection - DEBUG - close.started
2025-06-08 19:23:25,189 - httpcore.connection - DEBUG - close.failed exception=RuntimeError('Event loop is closed')
2025-06-08 19:23:25,189 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 19:23:25,189 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 19:23:25,190 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 19:23:25,190 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002A7E528D850>
2025-06-08 19:23:25,191 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:23:25,191 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:23:25,191 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:23:25,191 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:23:25,192 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:23:26,275 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 23:23:24 GMT'), (b'server', b'uvicorn'), (b'content-length', b'2'), (b'content-type', b'application/json')])
2025-06-08 19:23:26,275 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:23:26,275 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:23:26,275 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 19:23:26,276 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 19:23:26,276 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:23:26,276 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 19:23:26,276 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades "HTTP/HTTP/1.1 200 OK"
2025-06-08 19:23:26,276 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:23:26,277 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 19:23:26,277 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 19:23:26,277 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:23:26,277 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener snapshot de portafolio: Event loop is closed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 55, in get_portfolio_snapshot
    return await self._make_request("GET", "/api/v1/portfolio/snapshot", params=params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 32, in _make_request
    response = await self._client.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1585, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1674, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_transports\default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 229, in handle_async_request
    await self._close_connections(closing)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 1205, in close
    super().close()
    ~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 865, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-08 19:23:26,277 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 19:23:40,196 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 19:23:40,197 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:23:40,197 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 19:23:40,197 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 19:23:40,198 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 19:23:40,198 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000002A7E528DB40>. Running in event loop.
2025-06-08 19:23:40,198 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 19:23:40,198 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 19:23:40,198 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 19:23:40,199 - httpcore.connection - DEBUG - close.started
2025-06-08 19:23:40,200 - httpcore.connection - DEBUG - close.failed exception=RuntimeError('Event loop is closed')
2025-06-08 19:23:40,200 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 19:23:40,200 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 19:23:40,201 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 19:23:40,202 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002A7E510E8A0>
2025-06-08 19:23:40,202 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:23:40,202 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:23:40,202 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:23:40,202 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:23:40,203 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:23:40,476 - src.ultibot_ui.views.opportunities_view - INFO - Fetching Gemini IA opportunities.
2025-06-08 19:23:40,476 - src.ultibot_ui.views.opportunities_view - DEBUG - Creating ApiWorker.
2025-06-08 19:23:40,477 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:23:41,258 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 23:23:39 GMT'), (b'server', b'uvicorn'), (b'content-length', b'2'), (b'content-type', b'application/json')])
2025-06-08 19:23:41,259 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:23:41,259 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:23:41,259 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 19:23:41,259 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 19:23:41,260 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:23:41,260 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 19:23:41,260 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades "HTTP/HTTP/1.1 200 OK"
2025-06-08 19:23:41,260 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:23:41,260 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 19:23:41,260 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:23:41,260 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 19:23:41,261 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener snapshot de portafolio: Event loop is closed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 55, in get_portfolio_snapshot
    return await self._make_request("GET", "/api/v1/portfolio/snapshot", params=params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 32, in _make_request
    response = await self._client.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1585, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1674, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_transports\default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 229, in handle_async_request
    await self._close_connections(closing)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 1205, in close
    super().close()
    ~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 865, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-08 19:23:41,261 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 19:23:55,202 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 19:23:55,203 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:23:55,204 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 19:23:55,205 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 19:23:55,206 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 19:23:55,207 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000002A7E528E240>. Running in event loop.
2025-06-08 19:23:55,207 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 19:23:55,208 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 19:23:55,208 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 19:23:55,209 - httpcore.connection - DEBUG - close.started
2025-06-08 19:23:55,209 - httpcore.connection - DEBUG - close.failed exception=RuntimeError('Event loop is closed')
2025-06-08 19:23:55,210 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 19:23:55,210 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 19:23:55,210 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 19:23:55,212 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002A7E510CF50>
2025-06-08 19:23:55,212 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:23:55,213 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:23:55,213 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:23:55,213 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:23:55,214 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:23:56,222 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 23:23:54 GMT'), (b'server', b'uvicorn'), (b'content-length', b'2'), (b'content-type', b'application/json')])
2025-06-08 19:23:56,222 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:23:56,222 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:23:56,223 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 19:23:56,223 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 19:23:56,223 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:23:56,223 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 19:23:56,224 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades "HTTP/HTTP/1.1 200 OK"
2025-06-08 19:23:56,224 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:23:56,224 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 19:23:56,224 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:23:56,224 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 19:23:56,224 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener snapshot de portafolio: Event loop is closed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 55, in get_portfolio_snapshot
    return await self._make_request("GET", "/api/v1/portfolio/snapshot", params=params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 32, in _make_request
    response = await self._client.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1585, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1674, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_transports\default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 229, in handle_async_request
    await self._close_connections(closing)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 1205, in close
    super().close()
    ~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 865, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-08 19:23:56,225 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 19:24:10,207 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 19:24:10,207 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:24:10,208 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 19:24:10,208 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 19:24:10,208 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 19:24:10,209 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000002A7E528C740>. Running in event loop.
2025-06-08 19:24:10,209 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 19:24:10,209 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 19:24:10,209 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 19:24:10,209 - httpcore.connection - DEBUG - close.started
2025-06-08 19:24:10,210 - httpcore.connection - DEBUG - close.failed exception=RuntimeError('Event loop is closed')
2025-06-08 19:24:10,210 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 19:24:10,210 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 19:24:10,210 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 19:24:10,211 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002A7E61E4750>
2025-06-08 19:24:10,211 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:24:10,211 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:24:10,211 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:24:10,212 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:24:10,212 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:24:10,486 - src.ultibot_ui.views.opportunities_view - INFO - Fetching Gemini IA opportunities.
2025-06-08 19:24:10,487 - src.ultibot_ui.views.opportunities_view - DEBUG - Creating ApiWorker.
2025-06-08 19:24:10,487 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:24:11,182 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 23:24:10 GMT'), (b'server', b'uvicorn'), (b'content-length', b'2'), (b'content-type', b'application/json')])
2025-06-08 19:24:11,183 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:24:11,183 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:24:11,183 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 19:24:11,183 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 19:24:11,184 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:24:11,184 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 19:24:11,184 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades "HTTP/HTTP/1.1 200 OK"
2025-06-08 19:24:11,184 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:24:11,184 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 19:24:11,185 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:24:11,185 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 19:24:11,185 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener snapshot de portafolio: Event loop is closed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 55, in get_portfolio_snapshot
    return await self._make_request("GET", "/api/v1/portfolio/snapshot", params=params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 32, in _make_request
    response = await self._client.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1585, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1674, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_transports\default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 229, in handle_async_request
    await self._close_connections(closing)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 1205, in close
    super().close()
    ~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 865, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-08 19:24:11,185 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 19:24:25,214 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 19:24:25,215 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:24:25,215 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 19:24:25,216 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 19:24:25,217 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 19:24:25,217 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000002A7E5249D40>. Running in event loop.
2025-06-08 19:24:25,217 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 19:24:25,217 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 19:24:25,218 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 19:24:25,218 - httpcore.connection - DEBUG - close.started
2025-06-08 19:24:25,218 - httpcore.connection - DEBUG - close.failed exception=RuntimeError('Event loop is closed')
2025-06-08 19:24:25,218 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 19:24:25,219 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 19:24:25,219 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 19:24:25,220 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002A7E61E7690>
2025-06-08 19:24:25,220 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:24:25,220 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:24:25,221 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:24:25,221 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:24:25,221 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:24:26,173 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 23:24:24 GMT'), (b'server', b'uvicorn'), (b'content-length', b'2'), (b'content-type', b'application/json')])
2025-06-08 19:24:26,174 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:24:26,174 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:24:26,175 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 19:24:26,175 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 19:24:26,175 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:24:26,176 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 19:24:26,176 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades "HTTP/HTTP/1.1 200 OK"
2025-06-08 19:24:26,177 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:24:26,177 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 19:24:26,177 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:24:26,177 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 19:24:26,177 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener snapshot de portafolio: Event loop is closed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 55, in get_portfolio_snapshot
    return await self._make_request("GET", "/api/v1/portfolio/snapshot", params=params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 32, in _make_request
    response = await self._client.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1585, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1674, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_transports\default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 229, in handle_async_request
    await self._close_connections(closing)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 1205, in close
    super().close()
    ~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 865, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-08 19:24:26,178 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 19:24:40,213 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 19:24:40,214 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:24:40,215 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 19:24:40,216 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 19:24:40,217 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 19:24:40,218 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000002A7E524AB40>. Running in event loop.
2025-06-08 19:24:40,218 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 19:24:40,218 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 19:24:40,219 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 19:24:40,219 - httpcore.connection - DEBUG - close.started
2025-06-08 19:24:40,220 - httpcore.connection - DEBUG - close.failed exception=RuntimeError('Event loop is closed')
2025-06-08 19:24:40,220 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 19:24:40,220 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 19:24:40,221 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 19:24:40,222 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002A7E51A1640>
2025-06-08 19:24:40,222 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:24:40,223 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:24:40,223 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:24:40,223 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:24:40,223 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:24:40,482 - src.ultibot_ui.views.opportunities_view - INFO - Fetching Gemini IA opportunities.
2025-06-08 19:24:40,482 - src.ultibot_ui.views.opportunities_view - DEBUG - Creating ApiWorker.
2025-06-08 19:24:40,483 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:24:41,567 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 23:24:39 GMT'), (b'server', b'uvicorn'), (b'content-length', b'2'), (b'content-type', b'application/json')])
2025-06-08 19:24:41,567 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:24:41,567 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:24:41,568 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 19:24:41,568 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 19:24:41,569 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:24:41,569 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 19:24:41,569 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades "HTTP/HTTP/1.1 200 OK"
2025-06-08 19:24:41,569 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:24:41,569 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 19:24:41,570 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:24:41,570 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 19:24:41,570 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener snapshot de portafolio: Event loop is closed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 55, in get_portfolio_snapshot
    return await self._make_request("GET", "/api/v1/portfolio/snapshot", params=params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 32, in _make_request
    response = await self._client.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1585, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1674, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_transports\default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 229, in handle_async_request
    await self._close_connections(closing)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 1205, in close
    super().close()
    ~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 865, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-08 19:24:41,572 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 19:24:55,238 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 19:24:55,239 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:24:55,239 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 19:24:55,239 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 19:24:55,240 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 19:24:55,240 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000002A7E61E0940>. Running in event loop.
2025-06-08 19:24:55,241 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 19:24:55,241 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 19:24:55,241 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 19:24:55,242 - httpcore.connection - DEBUG - close.started
2025-06-08 19:24:55,242 - httpcore.connection - DEBUG - close.failed exception=RuntimeError('Event loop is closed')
2025-06-08 19:24:55,242 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 19:24:55,242 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 19:24:55,242 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 19:24:55,243 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002A7E61DDA90>
2025-06-08 19:24:55,243 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:24:55,244 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:24:55,244 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:24:55,244 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:24:55,244 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:24:56,229 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 23:24:54 GMT'), (b'server', b'uvicorn'), (b'content-length', b'2'), (b'content-type', b'application/json')])
2025-06-08 19:24:56,230 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:24:56,230 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:24:56,230 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 19:24:56,230 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 19:24:56,231 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:24:56,231 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 19:24:56,231 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades "HTTP/HTTP/1.1 200 OK"
2025-06-08 19:24:56,231 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:24:56,232 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 19:24:56,232 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:24:56,232 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 19:24:56,232 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener snapshot de portafolio: Event loop is closed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 55, in get_portfolio_snapshot
    return await self._make_request("GET", "/api/v1/portfolio/snapshot", params=params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 32, in _make_request
    response = await self._client.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1585, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1674, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_transports\default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 229, in handle_async_request
    await self._close_connections(closing)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 1205, in close
    super().close()
    ~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 865, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-08 19:24:56,233 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 19:25:10,250 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 19:25:10,251 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:25:10,251 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 19:25:10,252 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 19:25:10,252 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 19:25:10,252 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000002A7E61E0F40>. Running in event loop.
2025-06-08 19:25:10,253 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 19:25:10,253 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 19:25:10,253 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 19:25:10,254 - httpcore.connection - DEBUG - close.started
2025-06-08 19:25:10,254 - httpcore.connection - DEBUG - close.failed exception=RuntimeError('Event loop is closed')
2025-06-08 19:25:10,254 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 19:25:10,254 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 19:25:10,254 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 19:25:10,255 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002A7E61DEE10>
2025-06-08 19:25:10,256 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:25:10,256 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:25:10,256 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:25:10,256 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:25:10,256 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:25:10,484 - src.ultibot_ui.views.opportunities_view - INFO - Fetching Gemini IA opportunities.
2025-06-08 19:25:10,485 - src.ultibot_ui.views.opportunities_view - DEBUG - Creating ApiWorker.
2025-06-08 19:25:10,485 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:25:11,207 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 23:25:10 GMT'), (b'server', b'uvicorn'), (b'content-length', b'2'), (b'content-type', b'application/json')])
2025-06-08 19:25:11,207 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:25:11,207 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:25:11,208 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 19:25:11,208 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 19:25:11,208 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:25:11,208 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 19:25:11,209 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades "HTTP/HTTP/1.1 200 OK"
2025-06-08 19:25:11,209 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:25:11,209 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 19:25:11,209 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 19:25:11,209 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:25:11,209 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener snapshot de portafolio: Event loop is closed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 55, in get_portfolio_snapshot
    return await self._make_request("GET", "/api/v1/portfolio/snapshot", params=params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 32, in _make_request
    response = await self._client.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1585, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1674, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_transports\default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 229, in handle_async_request
    await self._close_connections(closing)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 1205, in close
    super().close()
    ~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 865, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-08 19:25:11,210 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 19:25:25,261 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 19:25:25,261 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:25:25,261 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 19:25:25,262 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 19:25:25,262 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 19:25:25,263 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000002A7E61E1340>. Running in event loop.
2025-06-08 19:25:25,263 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 19:25:25,263 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 19:25:25,263 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 19:25:25,263 - httpcore.connection - DEBUG - close.started
2025-06-08 19:25:25,263 - httpcore.connection - DEBUG - close.failed exception=RuntimeError('Event loop is closed')
2025-06-08 19:25:25,264 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 19:25:25,264 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 19:25:25,264 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 19:25:25,265 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002A7E61E95A0>
2025-06-08 19:25:25,265 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:25:25,265 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:25:25,265 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:25:25,265 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:25:25,265 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:25:26,205 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 23:25:24 GMT'), (b'server', b'uvicorn'), (b'content-length', b'2'), (b'content-type', b'application/json')])
2025-06-08 19:25:26,206 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:25:26,206 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:25:26,207 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 19:25:26,207 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 19:25:26,207 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:25:26,207 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 19:25:26,207 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades "HTTP/HTTP/1.1 200 OK"
2025-06-08 19:25:26,208 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:25:26,208 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 19:25:26,208 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:25:26,208 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 19:25:26,208 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener snapshot de portafolio: Event loop is closed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 55, in get_portfolio_snapshot
    return await self._make_request("GET", "/api/v1/portfolio/snapshot", params=params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 32, in _make_request
    response = await self._client.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1585, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1674, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_transports\default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 229, in handle_async_request
    await self._close_connections(closing)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 1205, in close
    super().close()
    ~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 865, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-08 19:25:26,209 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 19:25:40,275 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 19:25:40,276 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:25:40,276 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 19:25:40,277 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 19:25:40,277 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 19:25:40,277 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000002A7E5249240>. Running in event loop.
2025-06-08 19:25:40,278 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 19:25:40,278 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 19:25:40,278 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 19:25:40,278 - httpcore.connection - DEBUG - close.started
2025-06-08 19:25:40,279 - httpcore.connection - DEBUG - close.failed exception=RuntimeError('Event loop is closed')
2025-06-08 19:25:40,279 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 19:25:40,279 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 19:25:40,279 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 19:25:40,280 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002A7E61EA150>
2025-06-08 19:25:40,280 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:25:40,280 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:25:40,281 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:25:40,281 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:25:40,281 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:25:40,478 - src.ultibot_ui.views.opportunities_view - INFO - Fetching Gemini IA opportunities.
2025-06-08 19:25:40,479 - src.ultibot_ui.views.opportunities_view - DEBUG - Creating ApiWorker.
2025-06-08 19:25:40,479 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:25:41,291 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 23:25:39 GMT'), (b'server', b'uvicorn'), (b'content-length', b'2'), (b'content-type', b'application/json')])
2025-06-08 19:25:41,291 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:25:41,291 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:25:41,292 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 19:25:41,292 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 19:25:41,292 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:25:41,293 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 19:25:41,293 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades "HTTP/HTTP/1.1 200 OK"
2025-06-08 19:25:41,293 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:25:41,294 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 19:25:41,294 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:25:41,294 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 19:25:41,294 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener snapshot de portafolio: Event loop is closed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 55, in get_portfolio_snapshot
    return await self._make_request("GET", "/api/v1/portfolio/snapshot", params=params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 32, in _make_request
    response = await self._client.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1585, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1674, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_transports\default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 229, in handle_async_request
    await self._close_connections(closing)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 1205, in close
    super().close()
    ~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 865, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-08 19:25:41,295 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 19:25:55,275 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 19:25:55,275 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:25:55,276 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 19:25:55,276 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 19:25:55,277 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 19:25:55,277 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000002A7E61E1D40>. Running in event loop.
2025-06-08 19:25:55,277 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 19:25:55,277 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 19:25:55,277 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 19:25:55,277 - httpcore.connection - DEBUG - close.started
2025-06-08 19:25:55,278 - httpcore.connection - DEBUG - close.failed exception=RuntimeError('Event loop is closed')
2025-06-08 19:25:55,278 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 19:25:55,278 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 19:25:55,278 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 19:25:55,279 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002A7E61CD090>
2025-06-08 19:25:55,279 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:25:55,279 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:25:55,279 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:25:55,279 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:25:55,279 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:25:56,328 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 23:25:55 GMT'), (b'server', b'uvicorn'), (b'content-length', b'2'), (b'content-type', b'application/json')])
2025-06-08 19:25:56,328 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:25:56,328 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:25:56,328 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 19:25:56,329 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 19:25:56,329 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:25:56,329 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 19:25:56,329 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades "HTTP/HTTP/1.1 200 OK"
2025-06-08 19:25:56,329 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:25:56,330 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 19:25:56,330 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 19:25:56,330 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:25:56,330 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener snapshot de portafolio: Event loop is closed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 55, in get_portfolio_snapshot
    return await self._make_request("GET", "/api/v1/portfolio/snapshot", params=params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 32, in _make_request
    response = await self._client.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1585, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1674, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_transports\default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 229, in handle_async_request
    await self._close_connections(closing)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 1205, in close
    super().close()
    ~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 865, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-08 19:25:56,330 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 19:26:10,291 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 19:26:10,291 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:26:10,291 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 19:26:10,292 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 19:26:10,293 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 19:26:10,293 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000002A7E61E2340>. Running in event loop.
2025-06-08 19:26:10,293 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 19:26:10,293 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 19:26:10,293 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 19:26:10,294 - httpcore.connection - DEBUG - close.started
2025-06-08 19:26:10,294 - httpcore.connection - DEBUG - close.failed exception=RuntimeError('Event loop is closed')
2025-06-08 19:26:10,294 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 19:26:10,294 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 19:26:10,296 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 19:26:10,297 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002A7E513B930>
2025-06-08 19:26:10,297 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:26:10,297 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:26:10,297 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:26:10,297 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:26:10,297 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
2025-06-08 19:26:10,479 - src.ultibot_ui.views.opportunities_view - INFO - Fetching Gemini IA opportunities.
2025-06-08 19:26:10,479 - src.ultibot_ui.views.opportunities_view - DEBUG - Creating ApiWorker.
2025-06-08 19:26:10,479 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:26:11,405 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'date', b'Sun, 08 Jun 2025 23:26:09 GMT'), (b'server', b'uvicorn'), (b'content-length', b'2'), (b'content-type', b'application/json')])
2025-06-08 19:26:11,406 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:26:11,406 - httpx - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades?trading_mode=paper&limit=100&offset=0&status=open "HTTP/1.1 200 OK"
2025-06-08 19:26:11,406 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'GET']>
2025-06-08 19:26:11,406 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-06-08 19:26:11,407 - httpcore.http11 - DEBUG - response_closed.started
2025-06-08 19:26:11,407 - httpcore.http11 - DEBUG - response_closed.complete
2025-06-08 19:26:11,407 - src.ultibot_ui.services.api_client - INFO - HTTP Request: GET http://127.0.0.1:8000/api/v1/trades "HTTP/HTTP/1.1 200 OK"
2025-06-08 19:26:11,407 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine finished. Result: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:26:11,407 - src.ultibot_ui.workers - DEBUG - ApiWorker: result_ready signal emitted.
2025-06-08 19:26:11,408 - src.ultibot_ui.widgets.portfolio_widget - INFO - DATOS COMPLETOS RECIBIDOS EN HANDLER: {'portfolio_snapshot': RuntimeError('Event loop is closed'), 'open_trades': [], 'trading_mode': 'paper'}
2025-06-08 19:26:11,408 - src.ultibot_ui.workers - DEBUG - ApiWorker: Closing event loop.
2025-06-08 19:26:11,408 - src.ultibot_ui.widgets.portfolio_widget - ERROR - Error al obtener snapshot de portafolio: Event loop is closed
Traceback (most recent call last):
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 55, in get_portfolio_snapshot
    return await self._make_request("GET", "/api/v1/portfolio/snapshot", params=params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\src\ultibot_ui\services\api_client.py", line 32, in _make_request
    response = await self._client.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1585, in request
    return await self.send(request, auth=auth, follow_redirects=follow_redirects)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1674, in send
    response = await self._send_handling_auth(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<4 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1702, in _send_handling_auth
    response = await self._send_handling_redirects(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1739, in _send_handling_redirects
    response = await self._send_single_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_client.py", line 1776, in _send_single_request
    response = await transport.handle_async_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpx\_transports\default.py", line 377, in handle_async_request
    resp = await self._pool.handle_async_request(req)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 256, in handle_async_request
    raise exc from None
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 229, in handle_async_request
    await self._close_connections(closing)
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection_pool.py", line 345, in _close_connections
    await connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\connection.py", line 173, in aclose
    await self._connection.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_async\http11.py", line 258, in aclose
    await self._network_stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\httpcore\_backends\anyio.py", line 53, in aclose
    await self._stream.aclose()
  File "C:\Users\zamor\UltiBotInversiones\.venv\Lib\site-packages\anyio\_backends\_asyncio.py", line 1314, in aclose
    self._transport.close()
    ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 1205, in close
    super().close()
    ~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\selector_events.py", line 865, in close
    self._loop.call_soon(self._call_connection_lost, None)
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 833, in call_soon
    self._check_closed()
    ~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\zamor\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed
2025-06-08 19:26:11,408 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method finished.
2025-06-08 19:26:25,300 - src.ultibot_ui.widgets.portfolio_widget - INFO - Actualizando datos del portafolio para modo: paper
2025-06-08 19:26:25,300 - src.ultibot_ui.workers - DEBUG - ApiWorker initialized with api_client: <src.ultibot_ui.services.api_client.UltiBotAPIClient object at 0x000002A7E52946E0>, coroutine_factory: set
2025-06-08 19:26:25,301 - src.ultibot_ui.workers - DEBUG - ApiWorker: run method started.
2025-06-08 19:26:25,301 - asyncio - DEBUG - Using selector: SelectSelector
2025-06-08 19:26:25,302 - src.ultibot_ui.workers - DEBUG - ApiWorker: Creating coroutine from factory.
2025-06-08 19:26:25,302 - src.ultibot_ui.workers - DEBUG - ApiWorker: Coroutine created: <coroutine object PortfolioWidget._start_update_worker.<locals>.fetch_data_coroutine at 0x000002A7E5249740>. Running in event loop.
2025-06-08 19:26:25,302 - src.ultibot_ui.widgets.portfolio_widget - DEBUG - PortfolioWidget: Iniciando fetch_data_coroutine para modo paper.
2025-06-08 19:26:25,302 - src.ultibot_ui.services.api_client - INFO - Obteniendo snapshot del portafolio para 86e5f6c7-02a0-475b-b277-1fccbf23aa56, modo: paper
2025-06-08 19:26:25,303 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/portfolio/snapshot
2025-06-08 19:26:25,303 - httpcore.connection - DEBUG - close.started
2025-06-08 19:26:25,303 - httpcore.connection - DEBUG - close.failed exception=RuntimeError('Event loop is closed')
2025-06-08 19:26:25,304 - src.ultibot_ui.services.api_client - INFO - Obteniendo trades, modo: paper, filtros: {'trading_mode': 'paper', 'limit': 100, 'offset': 0, 'status': 'open'}
2025-06-08 19:26:25,304 - src.ultibot_ui.services.api_client - DEBUG - APIClient: _make_request invocado para GET /api/v1/trades
2025-06-08 19:26:25,304 - httpcore.connection - DEBUG - connect_tcp.started host='127.0.0.1' port=8000 local_address=None timeout=30.0 socket_options=None
2025-06-08 19:26:25,305 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x000002A7E50205F0>
2025-06-08 19:26:25,305 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'GET']>
2025-06-08 19:26:25,306 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-06-08 19:26:25,306 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'GET']>
2025-06-08 19:26:25,306 - httpcore.http11 - DEBUG - send_request_body.complete
2025-06-08 19:26:25,306 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'GET']>
